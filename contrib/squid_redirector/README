$Id$

0. Co to?

Ten ma³y zestaw narzêdzi pozwala za pomoc± squida w dosyæ elegancki sposób 
wy¶wietlaæ wiadomo¶ci administracyjne oraz w razie potrzeby blokowaæ dostêp
do w3cache. Oczywi¶cie aby to dzia³a³o w 100%, wszyscy klienci musz± 
korzystaæ ze squida.

1. Instalacja.

Mo¿na wyró¿niæ 3 etapy:

a) konfiguracja squida
b) konfiguracja redirectora
c) konfiguracja serwera wirtualnego

Ad a.

Do squid.conf dodajemy dwie linie:
------
redirector_bypass on
redirect_program /sciezka/do/lms-squid
------
które informuj± squida aby dla ka¿dego adresu u¿ywa³ naszego redirectora.

Ad b.

Otwieramy w naszym ulubionym edytorze plik lms-squid i praktycznie wszystko 
co mo¿na ustawiæ w naszym redirectorze to:
------
my $configfile = '/etc/lms/lms.ini';
------
Czyli po³o¿enie pliku konfiguracyjnego. Reszta konfiguracji ustawiana jest 
w lms.ini, gdzie dopisujemy:
------
[redirector]
redirect        = http://nasz.serwer.pl/winetka/
------
Czyli adres winetki.

Ad c.

Do katalogu gdzie ma byæ widoczna winetka kopiujemy index.php, message.html 
i zawarto¶æ katalog img.

2. W dzia³aniu.

Kluczowym elementem jest redirector. Odpowiada on za to, aby w momencie 
ustawienia dla danego komputera flagi warn lub no access, przekierowywa³ 
wszystkie ¿±dania wysy³ane do squida na nasz, ustalony wcze¶niej adres. 
Przekierowaniu nie ulegaj± adresy zawieraj±ce adres naszej winetki, tak aby 
umo¿liwiæ za³adowanie siê obrazków.

Je¶li komputer ma ustawion± flagê warn, to po przekierowaniu u¿ytkownik ma 
mo¿liwo¶æ oznaczenia wiadomo¶ci jako przeczytanej, po czym skrypt automatycznie 
kieruje przegl±darkê na pierwotnie wywo³ywany URL, w przypadku oznaczeniu danego 
komputera jako wy³±czony, u¿ytkownik bêdzie zawsze przekierowywany na adres 
winetki, bez mo¿liwo¶ci oznaczenia wiadomo¶ci jako przeczytanej.

Po drodze nigdzie nie s± wykorzystywane ¿adne regu³ki firewalla, ani ¿aden
daemon nie jest prze³adowywany. Skrypty podczas dzia³ania nie modyfikuj±
¿adnych plików. Jedyn± wad± mo¿e byæ nieznaczne spowolnienie pracy squida
(przyk³adowo, na moim Athlonie 1.2 przetworzenie 2000 adresów, z czego po³owa 
podlega³a przekierowaniu, a druga nie trwa³o 0,774 sekundy, co daje czas 
przetwarzania oko³o 0,000387 sekundy na adres. W momencie pisania tego tekstu
strona g³ówna Wirtualnej Polski sk³ada³a siê z 62 elementów, przez co 
redirector zwiêkszy³ jej czas ³adowania o 0,023994 sekundy).