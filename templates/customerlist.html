{include file="header.html"}
<!--// $Id$ //-->
{literal}
<script type="text/javascript" language="JavaScript">
<!--
    function rozliczklienta(idek,nazwa,kwota)
    {
	if(confirm('Klient : '+nazwa+'\nBilans : '+kwota+'\n\n{/literal}{trans("Are you sure, you want to account ALL debts of customer ?")}{literal}')) {
	    document.getElementById('src_balance'+idek).src='img/empty.gif';
	    document.getElementById('src_balance'+idek).style.display='none';
	    document.getElementById('str_balance'+idek).innerHTML='{/literal}{0.00|money_format}{literal}';
	    document.getElementById('str_balance'+idek).style.color='#000000';
	    sendPOST('?m=axrequest','action=balanceok&idown='+idek);
	}
    }

    function setCustomerAccess(idek)
    {
	if(document.getElementById('staccess'+idek).value=='1') {
	    document.getElementById('staccess'+idek).value='0';
	    addClass(document.getElementById('idtr'+idek),'blend');
	    addClass(document.getElementById('idtra'+idek),'blend');
	    document.getElementById('src_access'+idek).src='img/noaccess.gif';
	    sendPOST('?m=axrequest','action=nodeaccess&idown='+idek+'&access=0');
	} else {
	    document.getElementById('staccess'+idek).value='1';
	    removeClass(document.getElementById('idtr'+idek),'blend');
	    removeClass(document.getElementById('idtra'+idek),'blend');
	    document.getElementById('src_access'+idek).src='img/access.gif';
	    sendPOST('?m=axrequest','action=nodeaccess&idown='+idek+'&access=1');
	}
    }

    function setCustomerWarning(idek)
    {
	if(document.getElementById('stwarning'+idek).value=='1')
	{
	    document.getElementById('stwarning'+idek).value='0';
	    document.getElementById('src_warning'+idek).src='img/warningoff.gif';
	    sendPOST('?m=axrequest','action=warning&idown='+idek+'&warning=0');
	}
	else
	{
	    document.getElementById('stwarning'+idek).value='1';
	    document.getElementById('src_warning'+idek).src='img/warningon.gif';
	    sendPOST('?m=axrequest','action=warning&idown='+idek+'&warning=1');
	}
    }
//-->
</script>
{/literal}
<H1>{$layout.pagetitle}</H1>
<P>
<TABLE cellpadding="3" WIDTH="100%">
	<TR class="dark" {tip text="Click on column name to change sorting order"}>
		<TD width="97%" class="fleftu">
			<img src="img/customer.gif" ALT="">&nbsp;<a href="?m={$layout.module}&s={$listdata.state}&o=customername{if $listdata.direction eq "asc" && $listdata.order eq "customername"},desc{/if}">{trans("First/last or Company name")}</A></B> {if $listdata.order eq "customername"}<IMG SRC="img/{if $listdata.direction eq "desc"}asc{else}desc{/if}_order.gif" alt="">{/if}<BR>
			<img src="img/home.gif" ALT="">&nbsp;<a href="?m={$layout.module}&s={$listdata.state}&o=address{if $listdata.direction eq "asc" && $listdata.order eq "address"},desc{/if}">{trans("Address:")}</A> {if $listdata.order eq "address"}<IMG SRC="img/{if $listdata.direction eq "desc"}asc{else}desc{/if}_order.gif" alt="">{/if}
		</TD>
		<TD align="right" width="1%" class="fbt" VALIGN="top" NOWRAP>
			<a href="?m={$layout.module}&s={$listdata.state}&o=id{if $listdata.direction eq "asc" && $listdata.order eq "id"},desc{/if}">{trans("ID:")}</A></B> {if $listdata.order eq "id"}<IMG SRC="img/{if $listdata.direction eq "desc"}asc{else}desc{/if}_order.gif" alt="">{/if}<BR>
			{trans("Services:")}
		</TD>
		<TD width="1%" class="fbt" ALIGN="right" VALIGN="TOP" NOWRAP>
		{if !check_conf('privileges.hide_finances')}
			<a href="?m={$layout.module}&s={$listdata.state}&o=balance{if $listdata.direction eq "asc" && $listdata.order eq "balance"},desc{/if}">{trans("Balance:")}</A>&nbsp;{if $listdata.order eq "balance"}<IMG SRC="img/{if $listdata.direction eq "desc"}asc{else}desc{/if}_order.gif" alt="">{/if}<BR>
			<a href="?m={$layout.module}&s={$listdata.state}&o=tariff{if $listdata.direction eq "asc" && $listdata.order eq "tariff"},desc{/if}">{trans("Subscription:")}</A>&nbsp;{if $listdata.order eq "tariff"}<IMG SRC="img/{if $listdata.direction eq "desc"}asc{else}desc{/if}_order.gif" alt="">{/if}
		{/if}
		</TD>
		<TD width="1%" align="right" class="frightu">
			<NOBR><B>{t a=$listdata.total}Total: $a{/t}</B><br><a href="javascript:document.choosefilter.submit();">od≈õwierz</a></NOBR>
		</TD>
	</TR>
	<TR CLASS="DARK">
		<TD CLASS="fall" colspan="4">
			<FORM METHOD="GET" ACTION="?m={$layout.module}" NAME="choosefilter">
				<INPUT type="submit" class="hiddenbtn">
				<INPUT TYPE="HIDDEN" NAME="m" VALUE="customerlist">
				<INPUT TYPE="HIDDEN" NAME="page" VALUE="1">
				<B>{trans("Filter:")}</B> <NOBR>{trans("Customers:")}
				<SELECT SIZE="1" NAME="s" ONCHANGE="document.choosefilter.submit();">
					<OPTION VALUE="0"{if $listdata.state eq 0} SELECTED{/if}>{trans("- all customers -")}</OPTION>
					<OPTION VALUE="3"{if $listdata.state eq 3} SELECTED{/if}>{trans("connected<!plural>")}</OPTION>
					<OPTION VALUE="2"{if $listdata.state eq 2} SELECTED{/if}>{trans("awaiting")}</OPTION>
					<OPTION VALUE="1"{if $listdata.state eq 1} SELECTED{/if}>{trans("interested<!plural>")}</OPTION>
					<OPTION VALUE="4"{if $listdata.state eq 4} SELECTED{/if}>{trans("deleted<!plural>")}</OPTION>
					<OPTION VALUE="5"{if $listdata.state eq 5} SELECTED{/if}>{trans("disconnected<!plural>")}</OPTION>
					{if !check_conf('privileges.hide_finances')}
					<OPTION VALUE="6"{if $listdata.state eq 6} SELECTED{/if}>{trans("in debt")}</OPTION>
					<OPTION VALUE="11"{if $listdata.state eq 11} SELECTED{/if}>{trans("in debt above 100%")}</OPTION>
					<OPTION VALUE="12"{if $listdata.state eq 12} SELECTED{/if}>{trans("in debt above 200%")}</OPTION>
					{/if}
					<OPTION VALUE="7"{if $listdata.state eq 7} SELECTED{/if}>{trans("online")}</OPTION>
					<OPTION VALUE="8"{if $listdata.state eq 8} SELECTED{/if}>{trans("without group")}</OPTION>
					<OPTION VALUE="9"{if $listdata.state eq 9} SELECTED{/if}>{trans("without tariff")}</OPTION>
					<OPTION VALUE="10"{if $listdata.state eq 10} SELECTED{/if}>{trans("suspended<!plural>")}</OPTION>
				</SELECT></NOBR>
				<NOBR>{trans("Division")}:
				<SELECT SIZE="1" NAME="d" ONCHANGE="document.choosefilter.submit();">
				        <OPTION VALUE="" {if !$listdata.division} SELECTED {/if}>- {trans("all")} -</OPTION>
				        {foreach from=$divisions item=division}
				        <OPTION VALUE="{$division.id}"{if $listdata.division eq $division.id} SELECTED {/if}>{$division.shortname|truncate:30:"...":true}</OPTION>
					{/foreach}
				</SELECT></NOBR>
				<NOBR>{trans("Network:")}
				<SELECT SIZE="1" NAME="n" ONCHANGE="document.choosefilter.submit();">
					<OPTION value="0" {if !$listdata.network} SELECTED {/if}>{trans("- all networks -")}</OPTION>
					{section name=networks loop=$networks}
					<OPTION value="{$networks[networks].id}" {if $listdata.network eq $networks[networks].id} SELECTED {/if}>{$networks[networks].name|truncate:30:"...":true}</OPTION>
					{/section}
				</SELECT></NOBR>
				<NOBR>{trans("Group:")}
				<SELECT SIZE="1" NAME="g" ONCHANGE="document.choosefilter.submit();">
					<OPTION value="" {if !$listdata.customergroup} SELECTED {/if}>{trans("- all groups -")}</OPTION>
					{section name=customergroups loop=$customergroups}
					<OPTION value="{$customergroups[customergroups].id}" {if $listdata.customergroup eq $customergroups[customergroups].id} SELECTED {/if}>{$customergroups[customergroups].name|truncate:30:"...":true}</OPTION>
					{/section}
				</SELECT></NOBR>
				<NOBR>{trans("Nodes Group:<!short>")}
				<SELECT SIZE="1" NAME="ng" ONCHANGE="document.choosefilter.submit();">
	        			<OPTION value="" {if !$listdata.nodegroup} SELECTED {/if}>{trans("- all groups -")}</OPTION>
		        		{foreach from=$nodegroups item=nodegroup}
			        	<OPTION value="{$nodegroup.id}" {if $listdata.nodegroup eq $nodegroup.id} SELECTED {/if}>{$nodegroup.name|truncate:30:"...":true}</OPTION>
				        {/foreach}
				</SELECT></NOBR>
				
			</FORM>
		</TD>
	</TR>		
	{if $listdata.total != 0}
	<TR CLASS="DARK">
		<TD COLSPAN="4" CLASS="FALL">
			{include file="scroller.html" loop=$customerlist}
		</TD>
	</TR>
	{/if}
	{cycle values="light,lucid" print=false}
	{section name=customerlist loop=$customerlist start=$start max=$pagelimit}
	{assign var='idek' value=$customerlist[customerlist].id}
	<TR id="idtr{$idek}" class="{cycle}{if $customerlist[customerlist].account && !$customerlist[customerlist].nodeac} blend{/if}" onmouseover="addClass(this, 'highlight')" onmouseout="removeClass(this, 'highlight')">
		<TD onClick="return self.location.href='?m=customerinfo&id={$customerlist[customerlist].id}';" class="fleft" valign="top">
			<IMG src="img/{if $customerlist[customerlist].status eq 1}unk{/if}{if $customerlist[customerlist].status eq 2}wait{/if}{if $customerlist[customerlist].status eq 3}customer{/if}.gif" alt="">{if $customerlist[customerlist].info}&nbsp;<img src="img/info1.gif" alt="" {tip text=$customerlist[customerlist].info}>{/if}<A name="{$customerlist[customerlist].id}" {tip a=$customerlist[customerlist].id dynpopup='?m=customerinfoshort&id=$a'} id="idtra{$idek}">&nbsp;<B>{$customerlist[customerlist].customername|escape}</B></A><BR>
			<IMG src="img/home.gif" alt="">&nbsp;{$customerlist[customerlist].address}{if $customerlist[customerlist].city neq ""},{/if} {$customerlist[customerlist].zip} {$customerlist[customerlist].city}{if $customerlist[customerlist].country neq ""}, {t}{$customerlist[customerlist].country}{/t}{/if}
		</TD>
		<TD valign="top" align="right">
			({$customerlist[customerlist].id|string_format:"%04d"})<BR>
			{if $customerlist[customerlist].account}
			    <IMG SRC="img/node{if !$customerlist[customerlist].online}_off{/if}.gif" ALT="" {tip a=$customerlist[customerlist].id dynpopup='?m=nodelistshort&id=$a' sticky=1}></A>
			{/if}
		</TD>
		<TD align="right" valign="top" NOWRAP>
			{if !check_conf('privileges.hide_finances')}
				<div id="str_balance{$idek}">{if $customerlist[customerlist].balance < 0}<font class="alert">{/if}{$customerlist[customerlist].balance|money_format}{if $customerlist[customerlist].balance < 0}</font>{/if}</DIV>
				<font CLASS="blend">{$customerlist[customerlist].tariffvalue|money_format}</font>
			{/if}
		</TD>
		<TD align="right" class="fright">
			<NOBR>
			{if !check_conf('privileges.hide_finances')}
				{if $customerlist[customerlist].balance < 0}
					<img id="src_balance{$idek}" src="img/pay.gif" border="0" style="cursor:pointer;" onclick="rozliczklienta({$idek},'{$customerlist[customerlist].customername}','{$customerlist[customerlist].balance}');">
				{/if}
			{/if}
			{if $customerlist[customerlist].account}
			    {if $customerlist[customerlist].status eq 3}
				{if $customerlist[customerlist].nodeac eq 1}
						<input type="hidden" id="staccess{$idek}" value="1">
						<img src="img/access.gif" id="src_access{$idek}" border="0" style="cursor:pointer;" onclick="setCustomerAccess({$idek});">
				{else}
				    {if $customerlist[customerlist].nodeac eq 2}
							<input type="hidden" id="staccess{$idek}" value="0">
							<img src="img/mixaccess.gif" id="src_access{$idek}" border="0" style="cursor:pointer;" onclick="setCustomerAccess({$idek});">
				    {else}
						    <input type="hidden" id="staccess{$idek}" value="0">
						    <img src="img/noaccess.gif" id="src_access{$idek}" border="0" style="cursor:pointer;" onclick="setCustomerAccess({$idek});">
				    {/if}
				{/if}
			    {else}
				<img src="{$img.empty}" width="16">
			    {/if}
			{/if}
			{if $customerlist[customerlist].warncount}
				{if $customerlist[customerlist].status eq 3}
					{if $customerlist[customerlist].nodewarn >= 1}
					
						<input type="hidden" id="stwarning{$idek}" value="1">
						<img src="img/warningon.gif" id="src_warning{$idek}" border="0" style="cursor:pointer;" onClick="setCustomerWarning('{$idek}');">
					{else}
						<input type="hidden" id="stwarning{$idek}" value="0">
						<img src="img/warningoff.gif" id="src_warning{$idek}" border="0" style="cursor:pointer;" onClick="setCustomerWarning('{$idek}');">
					{/if}
				{else}
				    <img src="{$img.empty}" width="16">
				{/if}
			{/if}
			
			{if $listdata.state eq 4}
			<A href="?m=customeredit&id={$customerlist[customerlist].id}&action=recover"><IMG src="img/recover.gif" alt="[ {trans("Recover")} ]" title="[ {trans("Recover")} ]"></A> 
			{else}
			<A href="?m=customerdel&id={$customerlist[customerlist].id}" OnCLick="return confirmLink(this, '{t a=$customerlist[customerlist].customername|escape:"javascript"|escape:"html"}Are you sure, you want to remove customer \'$a\' from database?\n\nIf that customer have some nodes, they will be also removed and data definitely lost!{/t}');"><IMG src="img/delete.gif" alt="[ {trans("Delete")} ]" title="[ {trans("Delete")} ]"></A> 
			<A href="?m=customeredit&id={$customerlist[customerlist].id}"><IMG src="img/edit.gif" alt="[ {trans("Edit")} ]" title="[ {trans("Edit")} ]"></A> 
			{/if}
			<A href="?m=customerinfo&id={$customerlist[customerlist].id}"><IMG src="img/info.gif" alt="[ {trans("Info")} ]" title="[ {trans("Info")} ]"></A>
			</NOBR>
		</TD>
	</TR>
	{sectionelse}
	<TR>
		<TD colspan="4" align="center" class="flr">
			<p>&nbsp;</p>
			<p><B>{trans("No such customers matching search criteria or list is empty.")}</B></p>
			<p>&nbsp;</p>
		</TD>
	</TR>
	{/section}
	{if $listdata.total != 0}
	<TR CLASS="DARK">
		<TD COLSPAN="4" CLASS="FALL">
			{include file="scroller.html" loop=$customerlist}
		</TD>
	</TR>
	{/if}
	<TR class="light">
		<TD class="fleftu" align="right">
			&nbsp;
		</TD>
		<TD class="fbt" align="right">
			{if !check_conf('privileges.hide_finances') && !check_conf('privileges.hide_summaries')}
			<B>{trans("Outstandings")}:<BR>
			{trans("Overcharges")}:</B>
			{/if}
		</TD>
		<TD class="fbt" align="right" nowrap>
			{if !check_conf('privileges.hide_finances') && !check_conf('privileges.hide_summaries')}
			<B>{$listdata.below|money_format}<BR>
			{$listdata.over|money_format}</B>
			{/if}
		</TD>
		<TD class="frightu" align="right" valign="top">
			<B>{trans("Total:")} {$listdata.total}</B>
		</TD>
	</TR>
</TABLE>
</P>
{include file="footer.html"}
