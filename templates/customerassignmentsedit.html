{include file="header.html"}
<!--// $Id$ //-->
<H1>{$layout.pagetitle}</H1>
{include file="calendar_js.html"}
{literal}
<SCRIPT type="text/javascript">
	function CheckAll()
	{
	    var inputs = document.getElementById('nodeslist').getElementsByTagName('INPUT');
	    for (var i=0; i<inputs.length; i++) {
            inputs[i].checked = document.assignment.allbox.checked;
        }
    }
    function CheckAll2()
    {
        document.assignment.allbox.checked = !document.assignment.allbox.checked;
        CheckAll();
    }
    function set_tariff()
    {
        var val = document.forms['assignment'].elements['assignment[tariffid]'].value;

{/literal}{if $promotionschemas}
        document.getElementById('a_schema').style.display = val == -2 ? '' : 'none';
        document.getElementById('a_schematariff').style.display = val == -2 ? '' : 'none';
{/if}{literal}
        document.getElementById('a_tax').style.display = val == '' ? '' : 'none';
        document.getElementById('a_value').style.display = val == '' ? '' : 'none';
        document.getElementById('a_productid').style.display = val == '' ? '' : 'none';
        document.getElementById('a_name').style.display = val == '' ? '' : 'none';

        document.getElementById('a_options').style.display = val == -1 ? 'none' : '';
        document.getElementById('a_nodes').style.display = val == -1 ? 'none' : '';
        document.getElementById('a_day').style.display = val == -1 ? 'none' : '';
        document.getElementById('a_discount').style.display = val < -1 ? 'none' : '';
    }
{/literal}{if $promotionschemas}{literal}
    function set_schema()
    {
        var sid = document.forms['assignment'].elements['assignment[schemaid]'].value,
            assignments = {{/literal}{strip}
                {foreach name=fps from=$promotionschemas item=schema}
                {if $smarty.foreach.fps.index},{/if}"{$schema.id}": [{$schema.tariffs}]
                {/foreach}
            {/strip}{literal}},
            select = document.forms['assignment'].elements['assignment[stariffid]'],
            t_select = document.forms['assignment'].elements['assignment[tariffid]'],
            options = t_select.getElementsByTagName('OPTION'),
            selected = select.value,
            i, len;

        // remove old options
        select.innerHTML = '';
        // copy options from t_select element
        for (i=0, len=options.length; i<len; i++)
            if (inArray(assignments[sid], options[i].value))
                select.appendChild(options[i].cloneNode(true));

        select.value = selected;
    }
{/literal}{/if}{literal}
</SCRIPT>
{/literal}
<FORM method="POST" name="assignment" action="?m={$layout.module}{if $assignment.id}&id={$assignment.id}{if $assignment.liabilityid}&lid={$assignment.liabilityid}{/if}{else}&id={$customerinfo.id}{/if}">
<INPUT type="submit" class="hiddenbtn">
<TABLE width="100%" cellpadding="3">
	<TR class="DARK">
		<TD class="fleftu" width="1%">
			<IMG src="img/money.gif" alt="">
		</TD>
		<TD class="fbt" width="1%">
			<B>{t}Type{/t}/{t}Tariff{/t}:</B>
		</TD>
		<TD class="frightu" width="98%">
		    <SELECT size="1" name="assignment[tariffid]" {tip text="Select liability type" trigger="tariffid"} onchange="set_tariff()">
			    <OPTION value=""{if !$assignment.tariffid} SELECTED{/if}>- {t}tariffless liability{/t} -</OPTION>
			    <OPTION value="-1"{if $assignment.tariffid == -1} SELECTED{/if}>{t}- all liabilities suspended -{/t}</OPTION>
			    {if $promotionschemas}
			    <OPTION value="-2"{if $assignment.tariffid == -2} SELECTED{/if}>- {t}per promotion schema{/t} -</OPTION>
                {/if}
			    {section name=t loop=$tariffs}
			    <OPTION value="{$tariffs[t].id}" {if $tariffs[t].id==$assignment.tariffid}SELECTED{/if}>
			    {$tariffs[t].name} ({$tariffs[t].value|money_format}{if $tariffs[t].upceil || $tariffs[t].downceil}, {$tariffs[t].downceil}/{$tariffs[t].upceil} kbit/s{/if})
			    </OPTION>
		        {/section}
		    </SELECT>
		</TD>
	</TR>
{if $promotionschemas}
	<TR class="LIGHT" id="a_schema">
		<TD class="fleft" width="1%">
			<IMG src="img/promoschema.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Schema{/t}:</B>
		</TD>
		<TD class="fright" width="98%">
			<SELECT size="1" name="assignment[schemaid]" {tip text="Select promotion schema"} onchange="set_schema()">
				{foreach from=$promotionschemas item=schema}
				<OPTION value="{$schema.id}"{if $assignment.schemaid == $schema.id} SELECTED{/if}>{$schema.promotion|truncate:40:"...":true} / {$schema.name|truncate:40:"...":true}</OPTION>
				{/foreach}
			</SELECT>
		</TD>
	</TR>
	<TR class="LIGHT" id="a_schematariff">
		<TD class="fleft" width="1%">
			<IMG src="img/money.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Tariff{/t}:</B>
		</TD>
		<TD class="fright" width="98%">
		    <SELECT size="1" name="assignment[stariffid]" {tip text="Select subscription" trigger="stariffid"}>
			    {section name=t loop=$tariffs}
			    <OPTION value="{$tariffs[t].id}" {if $tariffs[t].id==$assignment.stariffid}SELECTED{/if}>
			    {$tariffs[t].name} ({$tariffs[t].value|money_format}{if $tariffs[t].upceil || $tariffs[t].downceil}, {$tariffs[t].downceil}/{$tariffs[t].upceil} kbit/s{/if})
			    </OPTION>
		        {/section}
		    </SELECT>
		</TD>
	</TR>
{/if}
	<TR class="LIGHT">
	    <TD width="100%" colspan="3" class="flr">
	        <TABLE width="100%" cellpadding="0">
	            <TR>
	                <TD width="50%" style="vertical-align:top;">
	                    <TABLE width="100%" cellpadding="3">
	<TR id="a_name">
		<TD width="1%">
			<IMG src="img/money.gif" alt="">
		</TD>
		<TD width="1%" nowrap>
			<B>{t}Name:{/t}</B>
		</TD>
		<TD width="98%">
		    <INPUT type="text" name="assignment[name]" value="{if $assignment.tariffid<=0}{$assignment.name}{/if}" size="30" {tip text="Enter liability name/description (tariffless liabilities only)" trigger="name"}>
		</TD>
	</TR>
	<TR id="a_day">
		<TD width="1%">
			<IMG src="img/calendar.gif" alt="">
		</TD>
		<TD width="1%" nowrap>
			<B>{t}Accounting:{/t}</B>
		</TD>
		<TD width="98%">
			<SELECT size="1" name="assignment[period]" {tip text="Select time period to account liability"}>
				{foreach from=$_PERIODS key=key item=item}
				<OPTION value="{$key}"{if $assignment.period == $key} SELECTED{/if}>{$item}</OPTION>
				{/foreach}
			</SELECT>
			<INPUT type="TEXT" name="assignment[at]" value="{if $assignment.at}{$assignment.at}{/if}" {tip text="Enter accounting time. For disposable accounting enter date in format YYYY/MM/DD, for weekly accounting enter day of week (Monday = 1), for monthly accounting enter day of month (1 to 28), for yearly accounting enter day and month in format DD/MM (15/09 means September 15th), for half-yearly DD/MM (MM <=6) and for quarterly DD/MM (MM <= 3)" trigger="at"} SIZE="8">
		</TD>
	</TR>
	<TR id="a_preiod">
		<TD width="1%">
			<IMG src="img/calendar.gif" alt="">
		</TD>
		<TD width="1%" nowrap>
			<B>{t}Period:{/t}</B>
		</TD>
		<TD width="98%" nowrap>
			{t}from:{/t} <INPUT type="TEXT" name="assignment[datefrom]" value="{if $assignment.datefrom}{$assignment.datefrom}{/if}" OnClick="cal3.popup();" {tip text="Enter accounting start date in YYYY/MM/DD format. If you don't want to define 'From' date leave this field empty" trigger="datefrom"} SIZE="10"> 
			{t}to:{/t} <INPUT type="TEXT" name="assignment[dateto]" value="{if $assignment.dateto}{$assignment.dateto}{/if}" OnClick="cal4.popup();" {tip text="Enter accounting end date in YYYY/MM/DD format. Leave this field empty if you don't want to set expiration date" trigger="dateto"} SIZE="10">
		</TD>
	</TR>
	<TR id="a_value">
		<TD width="1%">
			<IMG src="img/value.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Value:{/t}</B>
		</TD>
		<TD width="98%">
			<INPUT type="text" name="assignment[value]" value="{if $assignment.value}{$assignment.value}{/if}" size="10" {tip text="Enter liability value (tariffless liabilities only)" trigger="value"}>
		</TD>
	</TR>
	<TR id="a_discount">
		<TD width="1%">
			<IMG src="img/value.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Discount:{/t}</B>
		</TD>
		<TD width="98%">
		    <INPUT type="text" size="3" name="assignment[discount]" value="{if $assignment.discount!=0}{$assignment.discount|string_format:"%.2f"}{/if}" {tip text="Enter discount percentage" trigger="discount"}>
		</TD>
	</TR>
	<TR id="a_tax">
		<TD width="1%">
			<IMG src="img/tax.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Tax:{/t}</B>
		</TD>
		<TD width="98%">
		    <SELECT SIZE="1" name="assignment[taxid]" {tip text="Select Tax value"}>
		        {foreach item=tax from=$taxeslist}
                <OPTION value="{$tax.id}"{if $tax.value==$_config.phpui.default_taxrate} selected{/if}>{$tax.label}</OPTION>
		        {/foreach}
		    </SELECT>
		</TD>
	</TR>
	<TR id="a_productid">
		<TD width="1%">
			<IMG src="img/class.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Product ID:{/t}</B>
		</TD>
		<TD width="98%">
			<INPUT type="text" name="assignment[prodid]" value="{$assignment.prodid}" size="10" {tip text="Enter liability Product ID (tariffless liabilities only)"}>
		</TD>
	</TR>
	<TR id="a_numberplan">
		<TD width="1%">
			<IMG src="img/id.gif" alt="">
		</TD>
		<TD width="1%" nowrap>
			<B>{t}Numbering Plan:{/t}</B>
		</TD>
		<TD width="98%">
		    <SELECT name="assignment[numberplanid]" {tip text="Select numbering plan"}>
		        <OPTION value=""{if !$assignment.numberplanid} selected{/if}>- {t}default{/t} -</OPTION>
		        {foreach item=plan from=$numberplanlist}
		        {assign var=period value=$plan.period}
		        <OPTION value="{$plan.id}"{if $plan.id==$assignment.numberplanid} SELECTED{/if}>{$plan.template} ({$_NUM_PERIODS.$period})</OPTION>
		        {/foreach}
            </SELECT>
		</TD>
	</TR>
	<TR id="a_paytype">
		<TD width="1%">
			<IMG src="img/print.gif" alt="">
		</TD>
		<TD width="1%" nowrap>
			<B>{t}Payment Type:{/t}</B>
		</TD>
		<TD width="98%">
		    <SELECT name="assignment[paytype]" {tip text="Select payment type" trigger="paytype"}>
		        <OPTION value=""{if !$assignment.paytype} selected{/if}>- {t}default{/t} -</OPTION>
		        {foreach from=$_PAYTYPES item=item key=key}
		        <OPTION value="{$key}"{if $assignment.paytype==$key} selected{/if}>{$item}</OPTION>
		        {/foreach}
		    </SELECT>
		</TD>
	</TR>
	                    </TABLE>
                    </TD>
	                <TD width="50%" style="vertical-align:top;">
	                    <TABLE width="100%" cellpadding="3">
	<TR id="a_options">
		<TD width="1%">
			<IMG src="img/options.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Options:{/t}</B>
		</TD>
		<TD width="98%">
		    <NOBR><INPUT type="checkbox" name="assignment[invoice]" value="1" {if $assignment.invoice}CHECKED{/if}> <A HREF="javascript:setCheckbox('assignment[invoice]')">{t}with invoice{/t}</a></NOBR>
			<NOBR><INPUT type="checkbox" name="assignment[settlement]" value="1" {if $assignment.settlement}CHECKED{/if}> <A HREF="javascript:setCheckbox('assignment[settlement]')">{t}with settlement of first deficient period{/t}</a></NOBR>
		</TD>
	</TR>
{if $customernodes}
	<TR id="a_nodes">
		<TD width="1%">
			<IMG src="img/node.gif" alt="">
		</TD>
		<TD width="1%">
			<B>{t}Nodes:{/t}</B>
		</TD>
		<TD width="98%" nowrap id="nodeslist">
			{section name=customernodes loop=$customernodes}
			    {assign var=nodeid value=$customernodes[customernodes].id}
				<INPUT type="checkbox" name="assignment[nodes][{counter}]" value="{$customernodes[customernodes].id}" {if in_array($nodeid, (array)$assignment.nodes)} checked{/if}>
				<A HREF="javascript:setCheckbox('assignment[nodes][{counter name=counter2}]')"><B>{$customernodes[customernodes].name}</B> ({$customernodes[customernodes].id|string_format:"%04d"}){if $customernodes[customernodes].location} / {$customernodes[customernodes].location|truncate:"60":"...":true}{/if}</a>
                <BR>
			{/section}
			{if sizeof($customernodes) > 1}
                <INPUT TYPE="checkbox" NAME="allbox" onClick="CheckAll();" VALUE="Check All Boxes"> <A HREF="javascript:CheckAll2();">{t}check all<!items>{/t}</A>
			{/if}
		</TD>
	</TR>
{/if}
                        </TABLE>
                    </TD>
                </TR>
			</TABLE>
		</TD>
	</TR>
	<TR class="LIGHT">
		<TD class="fbottomu" align="RIGHT" colspan="3">
			<A href="javascript:document.assignment.submit()">{t}Submit{/t} <IMG src="img/save.gif" alt=""></A>&nbsp;
			<A href="?m=customerinfo&id={$customerinfo.id}">{t}Cancel{/t} <IMG src="img/cancel.gif" alt=""></A>
		</TD>
	</TR>
</TABLE>
</FORM>
<BR>
{include file="customerassignments.html"}
<SCRIPT type="text/javascript">
var cal3 = new calendar(document.forms['assignment'].elements['assignment[datefrom]']);
cal3.time_comp = false;
var cal4 = new calendar(document.forms['assignment'].elements['assignment[dateto]']);
cal4.time_comp = false;
set_tariff();
{if $promotionschemas}set_schema();{/if}
{literal}
function setCheckbox(id)
{
	document.forms['assignment'].elements[id].checked = !document.forms['assignment'].elements[id].checked;
}
{/literal}
</SCRIPT>
{include file="footer.html"}
