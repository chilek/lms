<!--// $Id$ //-->
{literal}
<SCRIPT type="text/javascript">
	<!--

	function CheckAll()
	{
		for (var i=0; i<document.addbalance.elements.length; i++)
		{
			var e = document.addbalance.elements[i];
			if (e.type == 'checkbox' && e.name != 'allbox' 
				&& e.name != 'copy' && e.name != 'original' && e.name != 'duplicate') 
			{
				e.checked = document.addbalance.allbox.checked;
			}
		}
	}

	function CheckAll2()
	{
		document.addbalance.allbox.checked = !document.addbalance.allbox.checked;
		CheckAll();
	}

	function AddBalance()
	{
		if(document.forms['addbalance'].elements['addbalance[value]'].value != '')
			document.addbalance.submit();
		else
			alert('{/literal}{t}Enter transaction value{/t}{literal}!');
	}

	function printr()
	{
		var add = "";
		if(document.addbalance.original.checked && document.addbalance.copy.checked)
			add = "";
		else if(document.addbalance.original.checked && !document.addbalance.copy.checked)
			add = "&which=original";
		else if(!document.addbalance.original.checked && document.addbalance.copy.checked)
			add = "&which=copy";
		
		document.addbalance.action = "?m=receipt&print=cached&cash=1" + add;
		document.addbalance.target = "_blank";
		document.addbalance.submit();
	}

	function print_doc(type)
	{
		var add = "";
		if(document.addbalance.original.checked)
			add = "&original=1";
		if(document.addbalance.copy.checked)
			add += "&copy=1";
		if(document.addbalance.duplicate.checked)
			add += "&duplicate=1";

		document.addbalance.action="?m=" + type + "&print=cached&cash=1" + add;
		document.addbalance.target="_blank";
		document.addbalance.submit();
	}

	function show_list()
	{
		var type = document.getElementById('showlistselect').value;

		if (type == 'invoice')
			document.addbalance.action = '?m=invoicelist';
		else if (type == 'note')
			document.addbalance.action = '?m=notelist';
		else
			return window.location = '?m=customerbalance&id={/literal}{$balancelist.customerid}{literal}';

		document.addbalance.target = '';
		document.addbalance.submit();
	}

	function new_doc()
	{
		location.href = document.getElementById('newdocselect').value;
	}
{/literal}{if $_config.phpui.delete_link_in_customerbalancebox|chkconfig}{literal}
	function delpos()
	{ 	 
		if(! confirm('{/literal}{t}Are you sure, you want to delete selected operation(s) and document item(s)?{/t}{literal}'))
		        return;
	
	        document.addbalance.action="?m=balancedel";
		document.addbalance.target="";
		document.addbalance.submit();
	}
{/literal}{/if}
	//-->
</SCRIPT>
<FORM name="addbalance" method="POST" action="?m=balanceadd&id={$balancelist.customerid}">
<INPUT type="submit" class="hiddenbtn">
<TABLE WIDTH="100%" CELLPADDING="3">
	<TR CLASS="DARK">
	<TD {if $limit}class="fleftu hand" onCLick="showOrHide('customerbalance');" {else}class="fleftu" {/if}nowrap>
			<IMG src="img/pay.gif" alt="">
			<B>{t}Customer Account:{/t}</B> 
			{if $limit}
				{math equation="x * -1" x=$limit assign=n}
				({t a=$n}last $a transactions{/t})
			{/if}
		</TD>
		<TD class="frightu" align="right" nowrap>
			<A href="javascript: new_doc()">{t}New document:{/t}</A>
			<SELECT name="newdocument" id="newdocselect">
				<OPTION value="?m=invoicenew&action=init&customerid={$balancelist.customerid}">{t}invoice{/t}</OPTION>
				<OPTION value="?m=receiptadd&type=in&action=init&customerid={$balancelist.customerid}">{t}cash-in receipt{/t}</OPTION>
				<OPTION value="?m=receiptadd&type=out&action=init&customerid={$balancelist.customerid}">{t}cash-out receipt{/t}</OPTION>
				<OPTION value="?m=noteadd&action=init&customerid={$balancelist.customerid}">{t}debit note{/t}</OPTION>
			</SELECT>&nbsp;
			<A href="javascript: show_list()">{t}Show All:{/t}</A>
			<INPUT type="hidden" name="cat" value="customerid">
			<INPUT type="hidden" name="search" value="{$balancelist.customerid}">
			<SELECT name="showlist" id="showlistselect">
				{if $limit}<OPTION value="list">{t}transactions{/t}</OPTION>{/if}
				<OPTION value="invoice">{t}invoices{/t}</OPTION>
				<OPTION value="note">{t}debit notes{/t}</OPTION>
			</SELECT>
		</TD>
	</TR>
	<TR id="customerbalance">
		<TD width="100%" colspan="2" class="fall">
			<TABLE cellpadding="5" cellspacing="0" width="100%">
				<TR class="dark">
					<TD width="1%" class="fleftu">{t}Date:{/t}</TD>
					<TD width="1%" class="fbt">{t}User:{/t}</TD>
					<TD width="1%" class="fbt" align="right">{t}Liability:{/t}</TD>
					<TD width="1%" class="fbt" align="right">{t}Income:{/t}</TD>
					<TD width="1%" class="fbt" align="right">{t}Expense:{/t}</TD>
					<TD width="1%" class="fbt" align="center">&raquo;</TD>
					<TD width="1%" class="fbt" align="right">{t}After:{/t}</TD>
					<TD width="92%" class="fbt">{t}Description:{/t}</TD>
					<TD width="1%" class="frightu">&nbsp;</TD>
				</TR>
				{cycle name=bal values="light,lucid" print=false}
				{section name=balancelist loop=$balancelist.id start=$limit}
				<TR class="{cycle name=bal}" onmouseover="addClass(this, 'highlight')" onmouseout="removeClass(this, 'highlight')">
					<TD width="1%"><nobr>{$balancelist.date[balancelist]}</nobr></TD>
					<TD width="1%" nowrap>{$balancelist.username[balancelist]|truncate:16:"...":true}</TD>
					<TD width="1%" align="right" nowrap>{if !$balancelist.type[balancelist]}{($balancelist.value[balancelist]*-1)|money_format}{else}-{/if}</TD>
					<TD width="1%" align="right" nowrap>{if $balancelist.type[balancelist] && $balancelist.value[balancelist] > 0}{$balancelist.value[balancelist]|money_format}{else}-{/if}</TD>
					<TD width="1%" align="right" nowrap>{if $balancelist.type[balancelist] && $balancelist.value[balancelist] < 0}{($balancelist.value[balancelist]*-1)|money_format}{else}-{/if}</TD>
					<TD width="1%" align="center">&raquo;</TD>
					<TD width="1%" align="right" nowrap>{if $balancelist.after[balancelist] < 0}<FONT class="red">{/if}{$balancelist.after[balancelist]|money_format}{if $balancelist.after[balancelist] < 0}</FONT>{/if}</TD>
					<TD width="92%">{$balancelist.comment[balancelist]}</TD>
					<TD width="1%" align="right" nowrap>
						{if $balancelist.docid[balancelist]}
							{if $balancelist.doctype[balancelist] == $smarty.const.DOC_INVOICE}
								<A href="?m=invoice&id={$balancelist.docid[balancelist]}" TARGET="_blank"><IMG SRC="img/print.gif" ALT="[ {t}Invoice{/t} ]" {tip a=$balancelist.docid[balancelist] dynpopup='?m=number&id=$a'}></A>
							{elseif $balancelist.doctype[balancelist] == $smarty.const.DOC_CNOTE}
								<A href="?m=invoice&id={$balancelist.docid[balancelist]}" TARGET="_blank"><IMG SRC="img/printn.gif" ALT="[ {t}Credit note{/t} ]" {tip a=$balancelist.docid[balancelist] dynpopup='?m=number&id=$a'}></A>
							{elseif $balancelist.doctype[balancelist] == $smarty.const.DOC_RECEIPT}
								<A href="?m=receipt&id={$balancelist.docid[balancelist]}" TARGET="_blank"><IMG SRC="img/printr.gif" ALT="[ {t}Cash receipt{/t} ]" {tip a=$balancelist.docid[balancelist] dynpopup='?m=number&id=$a'}></A>
							{elseif $balancelist.doctype[balancelist] == $smarty.const.DOC_DNOTE}
								<A href="?m=note&id={$balancelist.docid[balancelist]}" TARGET="_blank"><IMG SRC="img/printd.gif" ALT="[ {t}Debit note{/t} ]" {tip a=$balancelist.docid[balancelist] dynpopup='?m=number&id=$a'}></A>
							{/if}
						{/if}
						<INPUT TYPE="checkbox" NAME="marks[{$balancelist.id[balancelist]}]" VALUE="{$balancelist.id[balancelist]}">
					</TD>
				</TR>
				{sectionelse}
				<TR>
					<TD align="center" width="100%" colspan="9">
						<p>&nbsp;</p>
						<p><B>{t}That customer hasn't got any transactions.{/t}</B></p>
						<p>&nbsp;</p>
					</TD>
				</TR>
				{/section}
				<TR class="light">
					<TD CLASS="ftop" ALIGN="left" colspan="9">
					    <TABLE cellpadding="0" cellspacing="0">
						<TR><TD width="99%" NOWRAP>
						{if $_config.phpui.delete_link_in_customerbalancebox|chkconfig}
						<A href="javascript:delpos();">{t}Delete{/t} <IMG src="img/delete.gif" alt="{t}Delete{/t}"></A>&nbsp;
						{/if}
						{t}Print{/t}:
						<A href="javascript:print_doc('invoice');">{t}invoices{/t} <IMG src="img/print.gif" alt=""></A>&nbsp;
						<A href="javascript:printr();">{t}cash receipts{/t} <IMG src="img/printr.gif" alt=""></A>&nbsp;
						<A href="javascript:print_doc('note');">{t}debit notes{/t} <IMG src="img/printd.gif" alt=""></A>&nbsp;
						<INPUT type="checkbox" name="original" id="inv-original"{if preg_match('/original/i',$_config.invoices.default_printpage)} checked{/if}> <A HREF="javascript:checkElement('inv-original')">{t}original{/t}&nbsp;</a>
						<INPUT type="checkbox" name="copy" id="inv-copy"{if preg_match('/copy/i',$_config.invoices.default_printpage)} checked{/if}> <A HREF="javascript:checkElement('inv-copy')">{t}copy{/t}</a>
						<INPUT type="checkbox" name="duplicate" id="inv-duplicate"{if preg_match('/duplicate/i',$_config.invoices.default_printpage)} checked{/if}> <A HREF="javascript:checkElement('inv-duplicate')">{t}duplicate{/t}</a>
						</TD><TD width="1%" align="right" NOWRAP>
						<A href="javascript:CheckAll2();">{t}Check All{/t}</A><INPUT TYPE="checkbox" NAME="allbox" onClick="CheckAll();" VALUE="Check All Boxes">
						</TD></TR>
					    </TABLE>
					</TD>
				</TR>
				<TR class="light">
					<TD class="ftop">
						<INPUT TYPE="hidden" NAME="addbalance[customerid]" VALUE="{$balancelist.customerid}">
						<INPUT TYPE="text" name="addbalance[time]" size="15" maxsize="16" {tip text="Enter transaction time in 'yyyy/mm/dd hh:mm' format (empty field means current time). Click to select date from calendar."} onClick="cal3.popup();" {if $time}VALUE="{$time|date_format:"%Y/%m/%d %H:%M"}"{/if}>
					</TD>
					<TD class="ftop" nowrap>
						{$layout.logname|truncate:16:"...":true}
					</TD>
					<TD class="ftop" colspan="2" nowrap>
						<INPUT TYPE="text" size="8" name="addbalance[value]" accesskey="s" {if $value}VALUE="{$value}"{/if} {tip text="Enter transaction value"}>&nbsp;
						<SELECT SIZE="1" name="addbalance[taxid]" {tip text="Select Tax value"}>
						{foreach item=tax from=$taxeslist}
							<OPTION value="{$tax.id}" {if ($taxid && $tax.id == $taxid) || (!$taxid && $tax.value == $_config.phpui.default_taxrate)}selected{/if}>{$tax.label}</OPTION>
						{/foreach}
						</SELECT>
					</TD>
					<TD class="ftop" colspan="3" nowrap>
						<INPUT TYPE="radio" NAME="addbalance[type]" ID="operation0" VALUE="0" {tip text="Select type of operation"}><A HREF="javascript:checkElement('operation0')">{t}liability{/t}</a><BR>
						<INPUT TYPE="radio" NAME="addbalance[type]" ID="operation1" VALUE="1" {tip text="Select type of operation"} checked><A HREF="javascript:checkElement('operation1')">{t}income/expense{/t}</a>
						{if $sourcelist}
						<BR><IMG src="img/isource.gif" alt="">
						<SELECT name="addbalance[sourceid]" {tip text="Select import source (optional)" trigger="source"}>
						<OPTION value="0">{t}- none -{/t}</OPTION> 
						{foreach from=$sourcelist item=item}
						<OPTION value="{$item.id}"{if $item.id == $sourceid} SELECTED{/if}>{$item.name}</OPTION>
						{/foreach}
						</SELECT>
						{/if}
					</TD>
					<TD class="ftop" colspan="2">
						<INPUT TYPE="text" size="30" align="left" name="addbalance[comment]" value="{$comment}" {tip text="Enter short description of transaction"}> 
					</TD>
				</TR>
				<TR class="light">
					<TD colspan="7">
						{if $customerinfo.balance < 0}
						<A href="?m=customerbalanceok&id={$customerinfo.id}" OnClick="return confirmLink(this, '{t a=$customerinfo.customername|escape:"javascript"|escape:"html"}Are you sure, you want to account ALL debts of customer \'$a\'?{/t}');">{t}Clear Account{/t} <IMG src="img/edit.gif" alt=""></A>
						{/if}
					</TD>
					<TD align="right" colspan="2">
						<A href="javascript:AddBalance();">{t}Submit{/t} <IMG src="img/save.gif" alt=""></A>
					</TD>
				</TR>
			</TABLE>
		</TD>
	</TR>
</TABLE>
</FORM>
<SCRIPT type="text/javascript">
<!--
var cal3 = new calendar(document.forms['addbalance'].elements['addbalance[time]']);
{if $limit}{literal}
if(getCookie('customerbalance')=='0')
{
	document.getElementById('customerbalance').style.display = 'none';
}
{/literal}{/if}
//-->
</SCRIPT>
