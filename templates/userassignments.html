<!--// $Id$ //-->
<TABLE WIDTH="100%" CELLPADDING="3">
	<TR CLASS="DARK" onClick="showOrHide('userassignments');">
		<TD class="fall">
			<IMG src="img/money.gif" border="0" ALT="" align="absmiddle">
			<B><A name="balance">{t}Customer Liabilities:{/t}</A></B>
		</TD>
	</TR>
	<TR id="userassignments" style="display:none;">
		<TD WIDTH="100%" class="fall">
			<TABLE cellpadding="5" cellspacing="0" WIDTH="100%">
				<TR class="dark">
					<TD WIDTH="1%" NOWRAP class="fleftu"><B>{t}Subscription:{/t}</B></TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Value:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt">{t}Accounting day:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Downrate (ceil):{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Uprate (ceil):{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt">{t}Invoice:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt">{t}Discount:{/t}</TD>
					<TD WIDTH="92%" NOWRAP class="fbt">{t}Period:{/t}</TD>
					<TD WIDTH="1%" class="frightu">&nbsp;</TD>
				</TR>
				{cycle values="#DFD5BD,#EBE4D6" print=false}
				{foreach from=$assignments item=a}
				<TR bgcolor="{cycle}" {cycle print=false} onmouseover="setPointer(this, '#CCFFCC')" onmouseout="setPointer(this, '{cycle}')" {if ($a.dateto < $smarty.now && $a.dateto) || ($a.datefrom > $smarty.now && $a.datefrom) || $a.suspended}CLASS="blend"{/if}>
					{if !$a.tariffid}
					<TD WIDTH="7%" COLSPAN="7"><B>{t}Suspending of all liabilities{/t}</B></TD>
					{else}
					<TD WIDTH="1%" NOWRAP OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'"><B><A HREF="?m=tariffinfo&id={$a.tariffid}">{$a.name}</A></B></TD>
					<TD WIDTH="1%" NOWRAP ALIGN="RIGHT" OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'">{$a.value|money_format}</TD>
					<TD WIDTH="1%" NOWRAP OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'">{$a.period} ({$a.at})</TD>
					<TD WIDTH="1%" NOWRAP ALIGN="RIGHT" OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'">{$a.downrate|default:"-"}({$a.downceil|default:"-"}) kbps</TD>
					<TD WIDTH="1%" NOWRAP ALIGN="RIGHT" OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'">{$a.uprate|default:"-"}({$a.upceil|default:"-"}) kbps</TD>
					<TD WIDTH="1%" OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'">{if $a.invoice}{t}yes{/t}{else}&nbsp;{/if}</TD>
					<TD WIDTH="1%" OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'">{if $a.discount!=0}{$a.discount}%{else}-{/if}</TD>
					{/if}
					<TD WIDTH="92%" {if $a.tariffid}OnClick="return self.location.href='?m=userassignmentsedit&id={$a.id}'"{/if}>
						{if $a.datefrom}od {$a.datefrom|date_format:"%Y/%m/%d"}{/if}
						{if $a.dateto}do {$a.dateto|date_format:"%Y/%m/%d"}{/if}
					</TD>
					<TD WIDTH="1%" ALIGN="RIGHT" NOWRAP>
						{if $a.tariffid}
						<A href="?m=userassignments&action=suspend&id={$balancelist.userid}&aid={$a.id}&suspend={if $a.suspended}0{else}1{/if}" {tip text="Enable/disable accounting of selected liability"}><IMG SRC="img/wait.gif" ALT="[ {if $a.suspended}{t}Restore{/t}{else}{t}Suspend{/t}{/if} ]" BORDER="0" ALIGN="ABSMIDDLE"></A>
						{/if}
						<A HREF="?m=userassignmentsedit&id={$a.id}"><IMG SRC="img/edit.gif" ALT="[ {t}Edit{/t} ]" BORDER="0" ALIGN="ABSMIDDLE"></A>
						<A onClick="return confirmLink(this, '{t}Are you sure, you want to delete this liability?{/t}')" HREF="?m=userassignments&action=delete&aid={$a.id}&id={$balancelist.userid}" {tip text="Delete customer's liability"}><IMG SRC="img/delete.gif" ALT="[ {t}Delete{/t} ]" BORDER="0" ALIGN="ABSMIDDLE"></A>
					</TD>
				</TR>
				{foreachelse}
				<TR>
					<TD align="center" WIDTH="100%" colspan="9">
						<P>&nbsp;</P>
						<P><B>{t}That customer hasn't got any assigned subscriptions.{/t}</B></P>
						<P>&nbsp;</P>
					</TD>
				</TR>
				{/foreach}
				<TR bgcolor="#DFD5BD">
					<TD CLASS="ftop" ALIGN="RIGHT"><B>{t}Total:{/t}</B></TD>
					<TD CLASS="ftop" NOWRAP ALIGN="RIGHT">{sum array=$assignments column="value" string_format=$LANGDEFS.$_language.money_format}</TD>
					<TD CLASS="ftop" NOWRAP ALIGN="LEFT">({sum array=$assignments column="discounted_value" string_format=$LANGDEFS.$_language.money_format})</TD>
					<TD CLASS="ftop" NOWRAP ALIGN="RIGHT">{sum array=$assignments column="downrate" default="-"}({sum array=$assignments column="downceil" default="-"}) kbps</TD>
					<TD CLASS="ftop" NOWRAP ALIGN="RIGHT">{sum array=$assignments column="uprate" default="-"}({sum array=$assignments column="upceil" default="-"}) kbps</TD>
					<TD CLASS="ftop">&nbsp;</TD>
					<TD CLASS="ftop" COLSPAN="3">&nbsp;</TD>
				</TR>
				<FORM METHOD="POST" NAME="assignment" ACTION="?m=userassignments&action=add&id={$balancelist.userid}">
				<TR bgcolor="#DFD5BD">
					<TD COLSPAN="8">
						<TABLE>
							<TR>
								<TD>
								    <B>{t}Add:{/t}</B>
								</TD>
								<TD>
								    <SELECT size="1" name="assignment[tariffid]" {tip text="Select subscription to assign to customer or suspend accounting of all liabilities in choosen time" trigger="tariffid"}>
									<OPTION value="" SELECTED>{t}... select subscription ...{/t}</OPTION>
									<OPTION value="0">{t}- all liabilities suspended -{/t}</OPTION>
									{section name=t loop=$tariffs}
									    <OPTION VALUE="{$tariffs[t].id}" {if $tariffs[t].id==$assignment.tariffid}SELECTED{/if}>
									    {$tariffs[t].name} ({$tariffs[t].value|money_format}{if $tariffs[t].downrate || $tariffs[t].downceil}, {$tariffs[t].downrate}-{$tariffs[t].downceil} down{/if}{if $tariffs[t].uprate || $tariffs[t].upceil}, {$tariffs[t].uprate}-{$tariffs[t].upceil} up{/if})
									    </OPTION>
									{/section}
								    </SELECT>
								    <INPUT CLASS="box" TYPE="checkbox" NAME="assignment[invoice]" VALUE="1" {if $assignment.invoice}CHECKED{/if}> {t}with invoice{/t}
								</TD>
							</TR>
							<TR>
								<TD></TD>
								<TD>
								    <B>{t}Period:{/t}</B>
								    <SELECT size="1" NAME="assignment[period]" {tip text="Select time period to account liability"}>
									<OPTION VALUE="0" {if $assignment.period==0}SELECTED{/if}>{t}weekly{/t}</OPTION>
									<OPTION VALUE="1" {if $assignment.period==1 || $assignment.period==''}SELECTED{/if}>{t}monthly{/t}</OPTION>
				    					<OPTION VALUE="2" {if $assignment.period==2}SELECTED{/if}>{t}quarterly{/t}</OPTION>
									<OPTION VALUE="3" {if $assignment.period==3}SELECTED{/if}>{t}yearly{/t}</OPTION>
								    </SELECT>
								    <B>{t}When:{/t}</B> <INPUT type="TEXT" name="assignment[at]" value="{$assignment.at}" {tip text="Enter accounting time. For weekly accounting enter day of week (Monday = 1), for monthly accounting enter day of month (1 to 28), for yearly accounting enter day and month in format DD/MM (15/09 means September 15th), and for quarterly DD/MM (MM <= 3)" trigger="at"} SIZE="5">
								    {t}from:{/t} <INPUT type="TEXT" name="assignment[datefrom]" value="{if $assignment.datefrom}{$assignment.datefrom}{/if}" OnClick="cal1.popup();" {tip text="Enter accounting start date in YYYY/MM/DD format. If you don't want to define 'From' date leave this field empty" trigger="datefrom"} SIZE="10"> 
								    {t}to:{/t} <INPUT type="TEXT" name="assignment[dateto]" value="{if $assignment.dateto}{$assignment.dateto}{/if}" OnClick="cal2.popup();" {tip text="Enter accounting end date in YYYY/MM/DD format. Leave this field empty if you don't want to set expiration date" trigger="dateto"} SIZE="10">
								    <B>{t}Discount:{/t} <INPUT type="TEXT" name="assignment[discount]" value="{if $assignment.discount!=0}{$assignment.discount}{/if}" size="3" {tip text="Enter discount percentage" trigger="discount"}>
								</TD>
							</TR>
						</TABLE>
					</TD>
					<TD ALIGN="RIGHT" VALIGN="bottom" NOWRAP>
						<A HREF="javascript:document.assignment.submit()" {tip text="Assign subscription to customer"}>{t}Add{/t} <IMG SRC="img/save.gif" BORDER="0" ALT="" ALIGN="ABSMIDDLE"></A>
					</TD>
				</TR>
				</FORM>
			</TABLE>
		</TD>
	</TR>
</TABLE>
{literal}
<SCRIPT>
<!--
var cal1 = new calendar(document.forms['assignment'].elements['assignment[datefrom]']);
cal1.time_comp = false;
var cal2 = new calendar(document.forms['assignment'].elements['assignment[dateto]']);
cal2.time_comp = false;

if(getCookie('userassignments')=='1')
{
	document.getElementById('userassignments').style.display = '';
}
//-->
</SCRIPT>
{/literal}
