<!--// $Id$ //-->
{assign var=today value=$smarty.now|date_format:"%x 00:00:00"}{assign var=today value=$today|date_format:"%s"}
<TABLE WIDTH="100%" CELLPADDING="3">
	<TR CLASS="DARK">
		<TD width="99%" class="fleftu hand" align="left" nowrap="nowrap" onClick="showOrHide('customerassignments');">
			<IMG src="img/money.gif" alt="">
			<B>{t}Customer Liabilities:{/t}</B>
		</TD>
		<TD width="1%" class="frightu" align="right" nowrap>
		    {if !$customerinfo.deleted}
		    <A href="?m=customerassignmentadd&id={$customerinfo.id}">{t}New Liability{/t} &raquo;</A>
			{if $layout.module == 'customerassignmentedit'}
		        <A href="?m={$layout.module}&expired={if $expired}0{else}1{/if}&id={$assignment.id}">{if $expired}{t}Hide expired{/t}{else}{t}Show expired{/t}{/if} &raquo;</A>&nbsp;
			{else}
			    <A href="?m={$layout.module}&expired={if $expired}0{else}1{/if}&id={if $nodeinfo}{$nodeinfo.id}{else}{$customerinfo.id}{/if}">{if $expired}{t}Hide expired{/t}{else}{t}Show expired{/t}{/if} &raquo;</A>&nbsp;
			{/if}
			{/if}
		</TD>
	</TR>
	<TR id="customerassignments" style="display:none;">
		<TD WIDTH="100%" class="fall" colspan="2">
			<TABLE cellpadding="5" cellspacing="0" WIDTH="100%">
				<TR class="dark">
					<TD WIDTH="92%" NOWRAP class="fleftu"><B>{t}Liability:{/t}</B></TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Value:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Discount:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt">{t}Accounting:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Downceil:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt" ALIGN="RIGHT">{t}Upceil:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt">{t}Options:{/t}</TD>
					<TD WIDTH="1%" NOWRAP class="fbt">{t}Period:{/t}</TD>
					<TD WIDTH="1%" class="frightu">&nbsp;</TD>
				</TR>
				{cycle name=assign values="light,lucid" print=false}
				{foreach from=$assignments item=a}
				<TR class="{cycle name=assign}
				    {if ($a.dateto < $today && $a.dateto) || ($a.liabilityid && $a.at < $today && $a.at > 365)} blend{elseif ($a.datefrom > $today && $a.datefrom && $a.period) && !($a.suspended)} alertblend{elseif ($a.suspended)}suspended{/if}"
				    onmouseover="addClass(this, 'highlight')" onmouseout="removeClass(this, 'highlight')" >
					{if !$a.tariffid && !$a.liabilityid}
					<TD COLSPAN="7" OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'"><B>{t}Suspending of all liabilities{/t}</B></TD>
					{else}
					<TD OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">
						{if $a.tariffid}
							<A HREF="?m=tariffinfo&id={$a.tariffid}"><B>{$a.name}</B></A>
						{else}
							{$a.name}
						{/if}
						{if $a.nodes}({foreach from=$a.nodes item=item key=key}{$item.name}{if $key+1<sizeof($a.nodes)}, {/if}{/foreach}){/if}
					</TD>
					<TD NOWRAP ALIGN="RIGHT" OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">
					    {$a.value|money_format}
					</TD>
					<TD ALIGN="RIGHT" OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">
					    {if $a.discount!=0}{$a.discount}%{else}-{/if}
					</TD>
					<TD NOWRAP OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">{$a.payday}</TD>
					<TD NOWRAP ALIGN="RIGHT" OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">
					    {if $a.downceil}{$a.downceil} kbit/s{else}-{/if}
					</TD>
					<TD NOWRAP ALIGN="RIGHT" OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">
					    {if $a.upceil}{$a.upceil} kbit/s{else}-{/if}
					</TD>
					<TD NOWRAP ALIGN="RIGHT">
					    <img src="img/options.gif" alt="" {tip a=$a.id dynpopup='?m=customerassignmentinfo&id=$a'}>
					</TD>
					{/if}
					<TD NOWRAP OnClick="return self.location.href='?m=customerassignmentedit&id={$a.id}'">
						{if $a.datefrom}{t}from{/t} {$a.datefrom|date_format:"%Y/%m/%d"}{/if}
						{if $a.dateto}{t}to{/t} {$a.dateto|date_format:"%Y/%m/%d"}{/if}
					</TD>
					<TD ALIGN="RIGHT" NOWRAP>
						{if ($a.tariffid || $a.liabilityid) && (($a.dateto > $today || !$a.dateto) || ($a.liabilityid && $a.at > $today))}
						<A href="?m=customerassignmentedit&action=suspend&id={$a.id}&suspend={if $a.suspended}0{else}1{/if}" {tip text="Enable/disable accounting of selected liability"}><IMG SRC="img/wait.gif" alt="[ {if $a.suspended}{t}Restore{/t}{else}{t}Suspend{/t}{/if} ]"></A>
						{/if}
						<A onClick="return confirmLink(this, '{t}Are you sure, you want to delete this liability?{/t}')" HREF="?m=customerassignmentdel&id={$a.id}" {tip text="Delete customer's liability"}><IMG SRC="img/delete.gif" alt="[ {t}Delete{/t} ]"></A>
						<A HREF="?m=customerassignmentedit&id={$a.id}"><IMG SRC="img/edit.gif" ALT="[ {t}Edit{/t} ]" title="[ {t}Edit{/t} ]"></A>
					</TD>
				</TR>
				{foreachelse}
				<TR>
					<TD align="center" WIDTH="100%" colspan="9">
						<P>&nbsp;</P>
						<P><B>{t}That customer hasn't got any assigned subscriptions.{/t}</B></P>
						<P>&nbsp;</P>
					</TD>
				</TR>
				{/foreach}
				<TR class="light">
					<TD CLASS="ftop" ALIGN="RIGHT"><B>{t}Total:{/t}</B></TD>
					<TD CLASS="ftop" NOWRAP ALIGN="RIGHT">{sum array=$assignments column="real_value" string_format=$LANGDEFS.$_language.money_format}</TD>
					<TD CLASS="ftop" NOWRAP ALIGN="LEFT">({sum array=$assignments column="real_disc_value" string_format=$LANGDEFS.$_language.money_format})</TD>
					<TD CLASS="FTOP">&nbsp;</TD>
					<TD CLASS="ftop" NOWRAP ALIGN="RIGHT">{sum array=$assignments column="real_downceil" assign=downceilsum}{if $downceilsum}{$downceilsum} kbit/s{/if}</TD>
					<TD CLASS="ftop" NOWRAP ALIGN="RIGHT">{sum array=$assignments column="real_upceil" assign=upceilsum}{if $upceilsum}{$upceilsum} kbit/s{/if}</TD>
					<TD CLASS="ftop" COLSPAN="3">&nbsp;</TD>
				</TR>
			</TABLE>
		</TD>
	</TR>
</TABLE>
{literal}
<SCRIPT type="text/javascript">
if(getCookie('customerassignments')=='1')
{
	document.getElementById('customerassignments').style.display = '';
}
</SCRIPT>
{/literal}
