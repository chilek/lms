<!--// $Id$ //-->
<table class="lmsbox" id="documentpromotions" style="display: none;">
	<colgroup>
		<col style="width: 100%;">
	</colgroup>
	<thead>
		<tr class="hand lmsbox-titlebar" data-lmsbox-content="documentpromotionpanel">
			<td>
				{icon name="money"}
				<strong>{trans("Promotion Schema:")}</strong>
			</td>
		</tr>
	</thead>
	<tbody>
		<tr id="documentpromotionpanel"  style="display: none;">
			<td>
				<table class="lmsbox-inner">
					<tbody>
						<tr>
							<td>
								{include file="customer/customerassignmenthelper.html" variable_prefix="document[assignment]" variables=$document.assignment promotion_only=1}
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
	</tbody>
</table>

<script>

	var tariffTypes = [];
	{foreach $tariffs as $tariff}
	tariffTypes[{$tariff.id}] = {$tariff.tarifftype};
	{/foreach}

	var selected = {};
	{if !empty($document.assignment.snodes)}
	selected["snodes"] = {json_encode($document.assignment.snodes)};
	{/if}
	{if !empty($document.assignment.sphones)}
	selected["sphones"] = {json_encode($document.assignment.sphones)};
	{/if}
	selected["location"] = "{if isset($document.assignment.location)}{$document.assignment.location}{/if}";
	selected["recipient_address_id"] = "{if isset($document.assignment.recipient_address_id)}{$document.assignment.recipient_address_id}{else}0{/if}";

	var assignment_settings = {
		customerid: {if !empty($cid)}{$cid}{else}0{/if},
		selected: selected,
		internetTariffType: {$smarty.const.SERVICE_INTERNET},
		phoneTariffType: {$smarty.const.SERVICE_PHONE},
		tariffTypes: tariffTypes,
		variablePrefix: 'document[assignment]',
		hideFinances: {if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')}true{else}false{/if}
	}

	var customer_assignment_helper = new CustomerAssignmentHelper(assignment_settings);

	$('#a_period').remove();

	$(function() {
		$('#submit-button,#print-button').click(function (e) {
			if (!$(this)[0].form.checkValidity() || (parseInt($('#promotion-select').val()) && !customer_assignment_helper.validate(e))) {
				return;
			}
			document.documentadd.submit();
		});

		$('[data-lmsbox-content="documentpromotionpanel"]').click(function() {
			init_multiselects('select.lms-ui-multiselect-deferred:visible');
		});
	});

	if (getCookie('documentpromotionpanel') == '1')
		$('#documentpromotionpanel').show();

</script>
