{extends file="layout.html"}
{block name=title}LMS: {$layout.pagetitle|striphtml}{/block}
{block name=module_content}
<!-- $Id$ -->
<H1>{$layout.pagetitle}</H1>
<TABLE class="lmsbox">
        <COLGROUP>
                <COL style="width: 1%;">
                <COL style="width: 1%;">
                <COL style="width: 98%;">
	</COLGROUP>
    <THEAD>
        <TR>
		<TD colspan="2" class="nobr">
		    {icon name="helpdesk" label="{t}Subject:{/t} {$message.subject|escape}" label_class="bold"}
		</TD>
	</TR>
    </THEAD>
    <TBODY>
	<TR>
		<TD>
            {icon name="uptime" label="Date:" label_class="bold" class="fa-fw"}
		</TD>
		<TD class="nobr">
			{$message.createtime|date_format:"%Y/%m/%d %H:%M.%S"}
		</TD>
	</TR>	
	<TR>
		<TD class="nobr">
		    {if $message.userid}
				{icon name="user"}
			{else}
				{icon name="requestor" class="fa-fw" label="Requestor:" label_class="bold"}
			{/if}
		</TD>
		<TD>
			{if $message.customerid}
				<A href="?m=customerinfo&id={$message.customerid}">{$message.customername} ({$message.customerid|escape|string_format:"%04d"})</A>
			{elseif $message.userid}
				<A href="?m=userinfo&id={$message.userid}">{$message.username}</A>
			{elseif $message.mailfrom}
				<A href="mailto:{$message.mailfrom|escape}">{$message.mailfrom|escape}</A>
			{elseif $message.phonefrom}
				<A class="phone_number" href="tel:{$message.phonefrom}">{$message.phonefrom}</A>
			{else}
				{$message.requestor|escape}
			{/if}
		</TD>
	</TR>
	{if $message.headers}
	<TR>
		<TD class="nobr">
            {icon name="message" label="Headers:" label_class="bold"}
		</TD>
		<TD>
			<TEXTAREA rows="5" cols="100" readonly>{$message.headers|escape}</TEXTAREA>
		</TD>
	</TR>
	{/if}
	{if $message.messageid}
	<TR>
		<TD class="nobr">
            {icon name="message" label="Message-Id:" label_class="bold" class="fa-fw"}
		</TD>
		<TD>
			{$message.messageid|escape}
		</TD>
	</TR>
	{/if}
	{if $message.replyto}
	<TR>
		<TD class="nobr">
            {icon name="message" label="Reply-To:" label_class="bold" class="fa-fw"}
		</TD>
		<TD>
			{$message.replyto|escape}
		</TD>
	</TR>
	{/if}
	{if $message.inreplyto}
	<TR>
		<TD>
            {icon name="message" label="In-Reply-To:" label_class="bold" class="fa-fw"}
		</TD>
		<TD>
			<A href="?m=rtmessageview&id={$message.inreplyto}">{$message.inreplytoid|escape}</A>
		</TD>
	</TR>
	{/if}
	<TR>
		<TD>
            {icon name="edit" label="Message:" label_class="bold" class="fa-fw"}
		</TD>
		<TD>
			<TEXTAREA rows="5" cols="100" readonly>{$message.body|escape}</TEXTAREA>
		</TD>
	</TR>
	{if $message.attachments}
	<TR>
		<TD>
            {icon name="fileupload" label="Attachments:" label_class="bold" class="fa-fw"}
		</TD>
		<TD>
			{foreach from=$message.attachments item=a}
				{documentview id="{$message.id}-{$a@index}" type=$a.contenttype name=$a.filename
					url="?m=rtmessageview&tid={$message.ticketid}&mid={$message.id}&file={urlencode($a.filename)}"
					text="{$a.filename} ({$a.size|string_format:"%.1f"} {$a.unit})"}
				<BR>
			{/foreach}
		</TD>
	</TR>
	{/if}
	{if $message.deleted == 1 && (ConfigHelper::checkPrivilege('helpdesk_advanced_operations'))}
	<TR>
		<TD class="nobr">
			{icon name="user" label="Remover:" label_class="bold fa-fw"}
		</TD>
		<TD>
			<A href="?m=userinfo&id={$message.deluserid}">{$message.delusername|escape}</A>
		</TD>
	</TR>
	<TR>
		<TD class="nobr">
			{icon name="timetable" label="Remove date:" label_class="bold fa-fw"}
		</TD>
		<TD>
			{$message.deltime|date_format:"%Y/%m/%d %H:%M.%S"}
		</TD>
	</TR>
	{/if}
	<TR>
		<TD colspan="2" class="nobr text-right">
			{button type="link-button" href="?m=rtmessageadd&id={$message.id}&ticketid={$message.ticketid}" icon="message" label="Reply"}
			{button type="link-button" href="?m=rtticketview&id={$message.ticketid}" icon="cancel" label="Cancel"}
		</TD>
	</TR>
    </TBODY>
</TABLE>
{/block}
