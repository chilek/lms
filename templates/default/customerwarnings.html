{include file="header.html"}
<!--// $Id$ //-->
{$xajax}
<script type="text/javascript" src="img/tinymce3/tiny_mce.js"> </script>
<SCRIPT type="text/javascript">
<!--
	function SelectAllCustomers()
	{
		if (document.setwarnings.customers.checked) 
			for (var i = 0; i < document.getElementById('customerslist').length; i++)
				document.getElementById('customerslist').options[i].selected = true;
		else
			for (var i = 0; i < document.getElementById('customerslist').length; i++)
				document.getElementById('customerslist').options[i].selected = false;
	}

	function SelectAllCustomers2()
	{
		document.setwarnings.customers.checked = !document.setwarnings.customers.checked;
		SelectAllCustomers();
	}
	
	function switchbox(id)
	{
		if ((id.name == 'setwarnings[warnon]') && id.checked ) 
			document.setwarnings.elements['setwarnings[warnoff]'].checked = false;
		if ((id.name == 'setwarnings[warnoff]') && id.checked ) 
			document.setwarnings.elements['setwarnings[warnon]'].checked = false;
	}

	function switchbox1()
	{
		document.setwarnings.elements['setwarnings[warnon]'].checked = !document.setwarnings.elements['setwarnings[warnon]'].checked;
		switchbox(document.setwarnings.elements['setwarnings[warnon]']);
	}

	function switchbox2()
	{
		document.setwarnings.elements['setwarnings[warnoff]'].checked = !document.setwarnings.elements['setwarnings[warnoff]'].checked;
		switchbox(document.setwarnings.elements['setwarnings[warnoff]']);
	}

	function change_message_template(tmplid) {
		if (tmplid) {
			xjx.$('msgtmplid').disabled = true;
			xajax_getMessageTemplate(tmplid);
		}
	}

	function messageTemplateReceived(message) {
		if (tinyMCE.get('message') != undefined) {
			tinyMCE.get('message').setContent(message);
			xjx.$('message').value = message;
		} else
			xjx.$('message').value = message;
		xjx.$('msgtmplid').disabled = false;
	}
//-->
</SCRIPT>
<H1>{$layout.pagetitle}</H1>
<P><FORM NAME="setwarnings" METHOD="POST" ACTION="?m=customerwarn" id="setwarnings">
<INPUT type="submit" class="hiddenbtn">
<TABLE width="100%" cellpadding="3">
	<TR>
		<TD WIDTH="1%" VALIGN="TOP">
			<TABLE class="lmsbox">
                            <THEAD>
				<TR>
					<TD WIDTH="1%">
						<IMG SRC="img/customer.gif" alt="">&nbsp;<B>{trans("Customers:")}</B>
					</TD>
					<TD WIDTH="99%" COLSPAN="2">
						<IMG SRC="img/mail.gif" alt="">&nbsp;<B>{trans("Notice content:")}</B>
					</TD>
				</TR>
                            </THEAD>
                            <TBODY>
				<TR>
					<TD>
						<SELECT size="30" name="setwarnings[mcustomerid][]" id="customerslist" multiple {tip text="Select customers"}>
							{foreach from=$customerlist key=key item=item}
							<OPTION value="{$key}" {if $item.warning}CLASS="red"{/if}{if isset($selected.$key)} SELECTED{/if}>{$item.customername|truncate:40:"...":true} ({$key|string_format:"%04d"})</OPTION>
							{/foreach}
						</SELECT>
					</TD>
					<TD COLSPAN="2">
						<TABLE CELLPADDING="3">
							<TR>
								<TD>
									<input type="checkbox" id="message_label" onClick="javascript:toggle_visual_editor('message');"{if get_conf('phpui.default_editor') == 'wysiwyg'} checked{/if}>
									<label for="message_label">{trans("visual editor")}</label>
								</TD>
								<TD colspan="2" style="text-align: right;">
									<label for="">{trans("Message template:")}</label>
									<select name="setwarnings[tmplid]" id="msgtmplid" {tip trigger="msgtmplid" text="Select message template"} onChange="javascript:change_message_template(this.options[this.selectedIndex].value);">
										<option value="0">{trans("- none -")}</option>
										{foreach $messagetemplates as $msgtmpl}
										<option value="{$msgtmpl.id}">{$msgtmpl.name}</option>
										{/foreach}
									</select>
								</TD> 
							</TR>
							<TR>
								<TD COLSPAN="3" {tip text="Customer notice content"}>
									<TEXTAREA NAME="setwarnings[message]" id="message" ROWS="20" COLS="75">{$warnmessage}</TEXTAREA>
								</TD>
							</TR>
							<TR>
								<td colspan="3">
									<input type="radio" name="setwarnings[tmploper]" id="msgtmplradionone" value="1" onClick="javascript:document.getElementById('msgtmplname').style.display='none';" checked><label for="msgtmplradionone">{trans("no operation on message template")}</label><br>
									<input type="radio" name="setwarnings[tmploper]" id="msgtmplradioupdate" value="2" onClick="javascript:document.getElementById('msgtmplname').style.display='none';"><label for="msgtmplradioupdate">{trans("message template update")}</label><br>
									<input type="radio" name="setwarnings[tmploper]" id="msgtmplradionew" value="3" onClick="javascript:document.getElementById('msgtmplname').style.display='';"><label for="msgtmplradionew">{trans("message template creation")}</label>
									<input type="text" size="40" name="setwarnings[tmplname]" id="msgtmplname" style="display: none;" {tip trigger="tmplname" text="Enter name of the new message template"}>
								</td>
							</TR>
						</TABLE>
					</TD>
				</TR>
				<TR>
					<TD WIDTH="1%">
						<INPUT TYPE="checkbox" NAME="customers" OnClick="javascript:SelectAllCustomers()"><A HREF="javascript:SelectAllCustomers2()">{trans("Select All<!masculine>")}</A></INPUT>
					</TD>
					<TD ALIGN="left">
						 <NOBR>
						 <INPUT TYPE="checkbox" NAME="setwarnings[warnon]" ID="warnon" OnClick="switchbox(this);"{if $warnon}CHECKED{/if}><A HREF="javascript:switchbox1()">{trans("Enable")}</A></INPUT>
						 / <INPUT TYPE="checkbox" NAME="setwarnings[warnoff]" ID="warnoff" OnClick="switchbox(this);" {if $warnoff}CHECKED{/if}><A HREF="javascript:switchbox2()">{trans("Disable")}</A></INPUT>
						 </NOBR>
					</TD>
					<TD ALIGN="RIGHT">
						<A HREF="javascript:document.setwarnings.submit()" accesskey="s">{trans("Submit")} <IMG SRC="img/save.gif" ALT=""></A>
					</TD>
				<TR>
                            </TBODY>
			</TABLE>
		</TD>
	</TR>
</TABLE>
</FORM>
</P>
<SCRIPT type="text/javascript">
<!--//
document.forms['setwarnings'].elements['setwarnings[message]'].focus();

tinymce_init('{$_ui_language}');
{if get_conf('phpui.default_editor') == 'wysiwyg'}
toggle_visual_editor('message');
{/if}
//-->
</SCRIPT>

{include file="footer.html"}
