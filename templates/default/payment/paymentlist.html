{extends file="layout.html"}
{block name=title}LMS: {$layout.pagetitle|striphtml}{/block}
{block name=module_content}
<!-- $Id$ -->
<H1>{$layout.pagetitle}</H1>
<TABLE class="lmsbox lms-ui-background-cycle">
	<COLGROUP>
		<COL style="width: 1%;">
		<COL style="width: 95%;">
		<COL style="width: 1%;">
		<COL style="width: 1%;">
		<COL style="width: 1%;">
		<COL style="width: 1%;">
	</COLGROUP>
    <THEAD>
	<TR>
		<TD>
			{icon name='comment'}<BR>
			{icon name='customer'}
		</TD>
		<TD class="text-left">
			<B>{trans("Name:")}</B><BR>
			{trans("Creditor:")}
		</TD>
		<TD class="text-right">
			{trans("ID:")}
		</TD>
		<TD class="text-right">
			{trans("Value:")}
		</TD>
		<TD class="text-right nobr">
			{trans("Payment day:")}
		</TD>
		<TD class="bold text-right nobr">
			{button icon='add' label='New Payment' href='?m=paymentadd'}
		</TD>
	</TR>
    </THEAD>
    <TBODY>
	{foreach $paymentlist as $payment}
	<TR class="highlight" data-target-url="?m=paymentinfo&id={$payment.id}" data-name="{$payment.name}">
		<FORM NAME="addbalance{$payment@index}" METHOD="POST" ACTION="?m=balanceadd">
		<TD>
			{icon name='comment'}<BR>
			{icon name='customer'}
		</TD>
		<TD>
			<B>{$payment.name}</B><BR>
			{if $payment.customerid}<a href="?m=customerinfo&id="{$payment.customerid}">#{$payment.customerid} ({$payment.customername})</a>{/if}
			{if $payment.creditor}{$payment.creditor}{/if}
		</TD>
		<TD class="text-right">
			({$payment.id|string_format:"%04d"})
		</TD>
		<TD class="text-right nobr">
			{$payment.value|money_format}
		</TD>
		<TD class="text-right nobr">
			{$payment.payday}
		</TD>
		<TD class="lms-ui-buttons text-right nobr">
			<INPUT type="submit" class="hiddenbtn">
			<INPUT TYPE="HIDDEN" NAME="m" VALUE="balanceadd">
			<INPUT TYPE="HIDDEN" NAME="addbalance[value]" VALUE="{math equation="x*-1" x=$payment.value}">
			<INPUT TYPE="HIDDEN" NAME="addbalance[comment]" VALUE="{$payment.name} / {$payment.creditor}">
			{button type='link' href="javascript:document.addbalance{$payment@index}.submit();" icon='money' tip='Account payment'}
			{button type='link' class='delete-payment' href="?m=paymentdel&id={$payment.id}" icon='delete' tip='Delete'}
			{button type='link' href="?m=paymentedit&id={$payment.id}" icon='edit' tip='Edit'}
			{button type='link' href="?m=paymentinfo&id={$payment.id}" icon='info' tip='Info'}
		</TD>
		</FORM>
	</TR>
	{foreachelse}
	<tr>
		<td colspan="6" class="empty-table">
			{trans("No such standing payments in database.")}
		</td>
	</tr>
	{/foreach}
    </TBODY>
    <TFOOT>
	<TR>
		<TD COLSPAN="3">
			&nbsp;
		</TD>
		<TD class="bold text-right">
			<IMG SRC="img/info2.gif" ALT="">&nbsp;<B>{trans("Total:")}</B>
		</TD>
		<TD class="bold text-left">
			{$listdata.total}
		</TD>
		<td class="bold text-right">
			{t a=$listdata.total}Total: $a{/t}
		</td>
	</TR>
    </TFOOT>
</TABLE>
	<script>
		$('.delete-payment').click(function() {
			var name = $(this).closest('tr').attr('data-name');
			confirmDialog($t("Are you sure, you want to delete payment '$a'?", name), this).done(function() {
				location.href = $(this).attr('href');
			});
			return false;
		});
	</script>
{/block}
