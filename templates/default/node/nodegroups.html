<!--// $Id$ //-->

<FORM METHOD="POST" NAME="nodegroupassignment" id="nodegroupassignment" ACTION="?m=nodegroup&action=add&id={$nodeinfo.id}">
</FORM>

{css}

{tab_container id="nodegroups"}

	{tab_header content_id="nodegroupspanel"}
		{tab_header_cell icon="lms-ui-nodegroup-icon"}
			<strong>{trans("Node Groups:")}</strong>
		{/tab_header_cell}
	{/tab_header}

	{tab_contents id="nodegroupspanel"}

		{tab_table}

			{if $nodegroups}
			<div class="lms-ui-tab-table-row header">
				<div class="lms-ui-tab-table-wrapper col-3">
					<div class="lms-ui-tab-table-column name">
						{trans("Name:")}
					</div>
					<div class="lms-ui-tab-table-wrapper col-2">
						<div class="lms-ui-tab-table-column description">
							{trans("Description:")}
						</div>
						<div class="lms-ui-tab-table-column id">
							{trans("ID:")}
						</div>
					</div>
				</div>

				<div class="lms-ui-tab-table-column buttons">
				</div>
			</div>
			{/if}

			{foreach $nodegroups as $nodegroup}
			<div class="lms-ui-tab-table-row" data-target-url="?m=nodegroupinfo&id={$nodegroup.id}">
				<div class="lms-ui-tab-table-wrapper col-3">
					<div class="lms-ui-tab-table-column name">
						{$nodegroup.name}
					</div>
					<div class="lms-ui-tab-table-wrapper col-2">
						<div class="lms-ui-tab-table-column description">
							{$nodegroup.description}
						</div>
						<div class="lms-ui-tab-table-column id">
							({$nodegroup.id|string_format:"%04d"})
						</div>
					</div>
				</div>

				<div class="lms-ui-tab-table-column buttons">
					<A class="lms-ui-delete-button" onClick="return confirmLink(this, '{trans("Are you sure, you want to remove node from group?")}')"
							href="?m=nodegroup&action=delete&nodegroupid={$nodegroup.id}&id={$nodeinfo.id}">
						<i title="{trans("Remove assignment")}"></i>
					</A>
					<input type="checkbox" form="nodegroupassignment" name="markednodegroupid[{$nodegroup.id}]" value="{$nodegroup.id}" class="lms-ui-multi-check">
				</div>
			</div>

			{foreachelse}
			<div class="lms-ui-tab-empty-table">
				{trans("That node is not a member of any group.")}
			</div>
			{/foreach}

		{/tab_table}

		{tab_button_panel}
			{tab_buttons}
				{if !empty($othernodegroups)}
				<button type="button" id="add-nodegroups" class="lms-ui-button lms-ui-add-button" {tip text="Add node to groups"}>
					<i></i> {trans("Add")}
				</button>
				<SELECT SIZE="1" NAME="nodegroupid[]" form="nodegroupassignment" class="lms-ui-multiselect"
						{tip text="Select groups to attribute to node"} multiple data-default-value="{trans("... select groups ...")}"
						data-shorten-to-default-value="false">
					{foreach $othernodegroups as $item}
					<OPTION VALUE="{$item.id}">{$item.name} ({$item.id|string_format:"%04d"})</OPTION>
					{/foreach}
				</SELECT>
				{/if}
			{/tab_buttons}
			{tab_buttons}
				<button type="button" id="delete-nodegroups" class="lms-ui-button lms-ui-delete-button">
					<i></i> {trans("Delete")}
				</button>
				<label>
					{trans("Check All")}
					<input type="checkbox" class="lms-ui-multi-check-all">
				</label>
			{/tab_buttons}
		{/tab_button_panel}

	{/tab_contents}
{/tab_container}

<script>

	$(function() {
		{if !empty($othernodegroups)}
		$('#add-nodegroups').click(function() {
			if ($("input[name='nodegroupid[]']").filter(':checked').length) {
				$('form#nodegroupassignment').submit();
			}
		});
		{/if}
		$('#delete-nodegroups').click(function() {
			if ($(this).closest('div.lms-ui-multi-check').find('input:checked').length
				&& confirm('{trans("Are you sure, you want to remove node from selected groups?")}')) {
				$('form#nodegroupassignment').attr('action', '?m=nodegroup&action=delete&id={$nodeinfo.id}&is_sure=1')
					.submit();
			}
		});
	});

</script>
