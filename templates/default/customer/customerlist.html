{extends file="layout.html"}
{block name=title}::: LMS :{$layout.pagetitle|striphtml} :::{/block}
{block name=module_content}
    <!--// $Id$ //-->
    <H1>{$layout.pagetitle}</H1>
        {block name="customerlist-list-filters"}
        <FORM method="get" action="?m={$layout.module}" name="choosefilter">
            <p style="display: none;">
                <INPUT type="submit" class="hiddenbtn">
                <INPUT type="hidden" NAME="m" VALUE="customerlist">
                <INPUT type="hidden" NAME="page" id="page" VALUE="1">
            </p>
            <table class="lmsbox">
                <tr>
                    <td>
                        {trans("Customers:")}
                        <SELECT NAME="s" ONCHANGE="document.choosefilter.submit();">
                            <OPTION VALUE="0"{if $listdata.state == 0} SELECTED{/if}>{trans("- all customers -")}</OPTION>
                                {foreach $_CSTATUSES as $statusidx => $status}
                                <OPTION VALUE="{$statusidx}"{if $listdata.state == $statusidx} selected{/if}>{$status.plurallabel}</OPTION>
                                {/foreach}
                            <OPTION VALUE="50"{if $listdata.state == 50} SELECTED{/if}>{trans("deleted<!plural>")}</OPTION>
                            <OPTION VALUE="51"{if $listdata.state == 51} SELECTED{/if}>{trans("with disconnected nodes")}</OPTION>
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                                <OPTION VALUE="52"{if $listdata.state == 52} SELECTED{/if}>{trans("in debt")}</OPTION>
                                <OPTION VALUE="57"{if $listdata.state == 57} SELECTED{/if}>{trans("in debt above 100%")}</OPTION>
                                <OPTION VALUE="58"{if $listdata.state == 58} SELECTED{/if}>{trans("in debt above 200%")}</OPTION>
                                {/if}
                            <OPTION value="59"{if $listdata.state == 59} SELECTED{/if}>{trans("without contracts")}</OPTION>
                            <OPTION value="60"{if $listdata.state == 60} SELECTED{/if}>{trans("with expired contracts")}</OPTION>
                            <OPTION value="61"{if $listdata.state == 61} SELECTED{/if}>{trans("with expiring contracts")}</OPTION>
                            <OPTION VALUE="53"{if $listdata.state == 53} SELECTED{/if}>{trans("online")}</OPTION>
                            <OPTION VALUE="54"{if $listdata.state == 54} SELECTED{/if}>{trans("without group")}</OPTION>
                            <OPTION VALUE="55"{if $listdata.state == 55} SELECTED{/if}>{trans("without tariff")}</OPTION>
                            <OPTION VALUE="56"{if $listdata.state == 56} SELECTED{/if}>{trans("suspended<!plural>")}</OPTION>
                            <OPTION VALUE="62"{if $listdata.state == 62} SELECTED{/if}>{trans("with e-invoice")}</OPTION>
                            <OPTION VALUE="63"{if $listdata.state == 63} SELECTED{/if}>{trans("with connected nodes")}</OPTION>
                            <OPTION VALUE="64"{if $listdata.state == 64} SELECTED{/if}>{trans("with nodes")}</OPTION>
                            <OPTION VALUE="65"{if $listdata.state == 65} SELECTED{/if}>{trans("without nodes")}</OPTION>
                        </SELECT>
                        &nbsp;
                        {trans("Division")}:
                        <SELECT NAME="d" ONCHANGE="document.choosefilter.submit();">
                            <OPTION VALUE="" {if !$listdata.division} SELECTED {/if}>- {trans("all")} -</OPTION>
                                {foreach from=$divisions item=division}
                                <OPTION VALUE="{$division.id}"{if $listdata.division == $division.id} SELECTED {/if}>{$division.shortname|truncate:30:"...":true}</OPTION>
                                {/foreach}
                        </SELECT>
                        &nbsp;
                        {trans("Network:")}
                        <SELECT NAME="n" ONCHANGE="document.choosefilter.submit();">
                            <OPTION value="0" {if !$listdata.network} SELECTED {/if}>{trans("- all networks -")}</OPTION>
                                {section name=networks loop=$networks}
                                <OPTION value="{$networks[networks].id}" {if $listdata.network == $networks[networks].id} SELECTED {/if}>{$networks[networks].name|truncate:30:"...":true}</OPTION>
                                {/section}
                        </SELECT>
                        &nbsp;
                        {trans("Group:")}
                        <SELECT NAME="g" ONCHANGE="document.choosefilter.submit();">
                            <OPTION value="" {if !$listdata.customergroup} SELECTED {/if}>{trans("- all groups -")}</OPTION>
                                {section name=customergroups loop=$customergroups}
                                <OPTION value="{$customergroups[customergroups].id}" {if $listdata.customergroup == $customergroups[customergroups].id} SELECTED {/if}>{$customergroups[customergroups].name|truncate:30:"...":true}</OPTION>
                                {/section}
                        </SELECT>
                        &nbsp;
                        {trans("Nodes Group:<!short>")}
                        <SELECT NAME="ng" ONCHANGE="document.choosefilter.submit();">
                            <OPTION value="" {if !$listdata.nodegroup} SELECTED {/if}>{trans("- all groups -")}</OPTION>
                                {foreach from=$nodegroups item=nodegroup}
                                <OPTION value="{$nodegroup.id}" {if $listdata.nodegroup == $nodegroup.id} SELECTED {/if}>{$nodegroup.name|truncate:30:"...":true}</OPTION>
                                {/foreach}
                        </SELECT>
                        &nbsp;
                        {trans("Assigments:")}
                        <select name="assigments" onchange="document.choosefilter.submit();" {if $listdata.assigments}class="active"{/if}>
                            <option value="0" {if $listdata.assigments eq '0'} selected {/if}>{trans('- all -')}</option>
                            <option value="7" {if $listdata.assigments eq '7'} selected {/if}>{trans('expire in $a days', 7)}</option>
                            <option value="14" {if $listdata.assigments eq '14'} selected {/if}>{trans('expire in $a days', 14)}</option>
                            <option value="30" {if $listdata.assigments eq '30'} selected {/if}>{trans('expire in $a days', 30)}</option>
                            <option value="-1" {if $listdata.assigments eq '-1'} selected {/if}>{trans('without end date')}</option>
                            <option value="-2" {if $listdata.assigments eq '-2'} selected {/if}>{trans('active')}</option>
                            <option value="-3" {if $listdata.assigments eq '-3'} selected {/if}>{trans('active, with invoice')}</option>
                            <option value="-4" {if $listdata.assigments eq '-4'} selected {/if}>{trans('suspended')}</option>
                        </select>
                    </TD>
                </TR>
            </table>
        </FORM>
    {/block}

    <TABLE class="lmsbox">
        <COLGROUP>
            {block name="customerlist-list-columns"}
                <COL style="width: 1%">
                <COL style="width: 80%">
                <COL style="width: 1%">
                <COL style="width: 3%">
                <COL style="width: 4%">
                <COL style="width: 10%">
                {assign var='number_of_table_columns' value='6'}
            {/block}
        </COLGROUP>
        <THEAD>
            {block name="customerlist-list-header-pagination"}
                {if $pagination->getTotal() != 0}
                    <TR>
                        <TD class="pagination" colspan="{$number_of_table_columns}">
                            {include file="pagination.html"}
                        </TD>
                    </TR>
                {/if}
            {/block}
            {block name="customerlist-list-header"}
                <TR {tip text="Click on column name to change sorting order"}>
                    <td scope="col" class="nobr">&nbsp;</td>
                    <td scope="col">
                        <a href="?m={$layout.module}&amp;s={$listdata.state}&amp;o=customername{if $listdata.direction == "asc" && $listdata.order == "customername"},desc{/if}">{trans("First/last or Company name")}</A>
                        {if $listdata.order == "customername"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                        /
                        <a href="?m={$layout.module}&amp;s={$listdata.state}&amp;o=address{if $listdata.direction == "asc" && $listdata.order == "address"},desc{/if}">{trans("Address")}</A>
                        {if $listdata.order == "address"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                    </td>
                    <td scope="col">
                        <a href="?m={$layout.module}&amp;s={$listdata.state}&amp;o=id{if $listdata.direction == "asc" && $listdata.order == "id"},desc{/if}">{trans("ID")}</A>
                        {if $listdata.order == "id"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                    </td>
                    <td scope="col">
                        {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                            <a href="?m={$layout.module}&amp;s={$listdata.state}&amp;o=tariff{if $listdata.direction == "asc" && $listdata.order == "tariff"},desc{/if}">{trans("Subscription")}</A>
                            {if $listdata.order == "tariff"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                        {/if}
                    </td>
                    <td scope="col">
                        {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                            <a href="?m={$layout.module}&amp;s={$listdata.state}&amp;o=balance{if $listdata.direction == "asc" && $listdata.order == "balance"},desc{/if}">{trans("Balance")}</A>
                            {if $listdata.order == "balance"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                        {/if}
                    </td>
                    <td scope="col">
                        {t a=$pagination->getTotal()}Total: $a{/t}
                    </td>
                </TR>
            {/block}
        </THEAD>
        <TFOOT>
            {block name="customerlist-list-footer-pagination"}
                {if $pagination->getTotal() != 0}
                    <TR>
                        <TD class="pagination" colspan="{$number_of_table_columns}">
                            {include file="pagination.html"}
                        </TD>
                    </TR>
                {/if}
            {/block}
        </TFOOT>
        <TBODY>
            {cycle values="light,lucid" print=false}
            {section name=customerlist loop=$customerlist}
                {block name="customerlist-list-row"}
                    <TR class="highlight {cycle}{if $customerlist[customerlist].account && !$customerlist[customerlist].nodeac} blend{/if}"  >
                        <td class="nobr">
                            {if $_CSTATUSES[$customerlist[customerlist].status].alias=="connected"}
                                <i class="fa fa-user fa-lg fa-fw success" aria-hidden="true"></i>
                            {else}
                                <i class="fa fa-user fa-lg fa-fw danger" aria-hidden="true"></i>
                            {/if}
                            {if $customerlist[customerlist].account}
                                <i class="fa fa-desktop fa-lg{if !$customerlist[customerlist].online} success{else} muted{/if}" aria-hidden="true" {tip a=$customerlist[customerlist].id dynpopup='?m=nodelistshort&amp;id=$a' sticky=1}></i>
                            {/if}
                            {if $customerlist[customerlist].info}
                                <i class="fa fa-info-circle fa-lg fa-fw primary" aria-hidden="true" {tip text=$customerlist[customerlist].info}></i>
                            {/if}
                        </td>
                        <TD onClick="return self.location.href = '?m=customerinfo&amp;id={$customerlist[customerlist].id}';">
                            <A name="{$customerlist[customerlist].id}" {tip a=$customerlist[customerlist].id dynpopup='?m=customerinfoshort&amp;id=$a'}>
                                <b>{$customerlist[customerlist].customername|escape}</b><br>
                                {$customerlist[customerlist].address}{if $customerlist[customerlist].city != ""},{/if} {$customerlist[customerlist].zip} {$customerlist[customerlist].city}{if $customerlist[customerlist].country != ""}, {t}{$customerlist[customerlist].country}{/t}{/if}
                            </A>
                        </TD>
                        <TD class="text-right" onClick="return self.location.href = '?m=customerinfo&amp;id={$customerlist[customerlist].id}';">
                            {$customerlist[customerlist].id|string_format:"%04d"}
                        </TD>
                        <TD class="text-right nobr" onClick="return self.location.href = '?m=customerinfo&amp;id={$customerlist[customerlist].id}';">
                            {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                                <span class="blend">{$customerlist[customerlist].tariffvalue|money_format}</span>
                            {/if}
                        </TD>
                        <TD class="text-right nobr" onClick="return self.location.href = '?m=customerinfo&amp;id={$customerlist[customerlist].id}';">
                            {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                                <span class="{if $customerlist[customerlist].balance < 0}alert{/if}">{$customerlist[customerlist].balance|money_format}</span>
                            {/if}
                        </TD>
                        <TD class="text-right nobr">
                            {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                                {if $customerlist[customerlist].balance < 0}
                                    <A href="?m=customerbalanceok&amp;id={$customerlist[customerlist].id}" OnClick="return confirmLink(this, '{t a=$customerlist[customerlist].customername|escape:"javascript"|escape:"html"}Are you sure, you want to account ALL debts of customer \'$a\'?{/t}');"><i class="fa fa-shopping-cart fa-lg fa-fw success" aria-hidden="true" title="{trans("Account")}"></i></A>
                                    {/if}
                                {/if}
                                {if $customerlist[customerlist].account}
                                    {if $customerlist[customerlist].status == $smarty.const.CSTATUS_CONNECTED}
                                        {if $customerlist[customerlist].nodeac == 1}
                                        <A href="?m=nodeset&amp;ownerid={$customerlist[customerlist].id}"><i class="fa fa-toggle-on fa-lg fa-fw success" aria-hidden="true" title="{trans("Disconnect all")}"></i></A>
                                        {else}
                                            {if $customerlist[customerlist].nodeac == 2}
                                            <A href="?m=nodeset&amp;ownerid={$customerlist[customerlist].id}"><i class="fa fa-toggle-on fa-lg fa-fw success" aria-hidden="true" title="{trans("Disconnect all")}"></i></A>
                                        {else}<A href="?m=nodeset&amp;ownerid={$customerlist[customerlist].id}&amp;access=1"><i class="fa fa-toggle-off fa-lg fa-fw muted" aria-hidden="true" title="{trans("Connect all")}"></i></A>
                                            {/if}
                                        {/if}
                                    {/if}
                                {/if}
                                {if $customerlist[customerlist].warncount}
                                    {if $customerlist[customerlist].status == $smarty.const.CSTATUS_CONNECTED}
                                        {if $customerlist[customerlist].nodewarn == 1}
                                        <A href="?m=nodewarn&amp;ownerid={$customerlist[customerlist].id}" {if $customerlist[customerlist].message}{tip text=$customerlist[customerlist].message}{/if}><i class="fa fa-exclamation-triangle fa-lg fa-fw warning" aria-hidden="true" title="{trans("Disable notices for all")}"></i></A>
                                        {else}
                                            {if $customerlist[customerlist].nodewarn == 2}
                                            <A href="?m=nodewarn&amp;ownerid={$customerlist[customerlist].id}" {if $customerlist[customerlist].message}{tip text=$customerlist[customerlist].message}{/if}><i class="fa fa-exclamation-triangle fa-lg fa-fw warning" aria-hidden="true" title="{trans("Disable notices for all")}"></i></A>
                                            {else}
                                            <A href="?m=nodewarn&amp;ownerid={$customerlist[customerlist].id}&amp;warning=1" {if $customerlist[customerlist].message}{tip text=$customerlist[customerlist].message}{/if}><i class="fa fa-exclamation-triangle fa-lg fa-fw muted" aria-hidden="true" title="{trans("Enable notices for all")}"></i></A>
                                            {/if}
                                        {/if}
                                    {/if}
                                {/if}
                                {if $listdata.state == 50}
                                <A href="?m=customeredit&amp;id={$customerlist[customerlist].id}&amp;action=recover"><i class="fa fa-ambulance fa-lg fa-fw danger" aria-hidden="true" title="{trans("Recover")}"></i>
                                {else}
                                    <A href="?m=customerdel&amp;id={$customerlist[customerlist].id}" OnCLick="return confirmLink(this, '{t a=$customerlist[customerlist].customername|escape:"javascript"|escape:"html"}Are you sure, you want to remove customer \'$a\' from database?\n\nIf that customer have some nodes, they will be also removed and data definitely lost!{/t}');"><i class="fa fa-trash fa-lg fa-fw danger" aria-hidden="true" title="{trans("Delete")}"></i></A>
                                    <A href="?m=customeredit&amp;id={$customerlist[customerlist].id}"><i class="fa fa-pencil-square fa-lg fa-fw primary" aria-hidden="true" title="{trans("Edit")}"></i></A>
                                    {/if}
                        </TD>
                    </TR>
                {/block}
            {sectionelse}
                {block name="customerlist-list-empty-row"}
                    <TR>
                        <TD colspan="{$number_of_table_columns}" class="empty-table">
                            <p>{trans("No such customers matching search criteria or list is empty.")}</p>
                        </TD>
                    </TR>
                {/block}
            {/section}
        </TBODY>
    </TABLE>
    {block name="customerlist-list-footer"}
        <table class="lmsbox">
            <tr>
                <td>
                    {if ConfigHelper::checkConfig('privileges.superuser') || (!ConfigHelper::checkConfig('privileges.hide_finances') && !ConfigHelper::checkConfig('privileges.hide_summaries'))}
                        {trans("Outstandings")}: <b>{$listdata.below|money_format}</b>
                    {/if}
                </td>
                <td>
                    {if ConfigHelper::checkConfig('privileges.superuser') || (!ConfigHelper::checkConfig('privileges.hide_finances') && !ConfigHelper::checkConfig('privileges.hide_summaries'))}
                        {trans("Overcharges")}: <b>{$listdata.over|money_format}</b>
                    {/if}
                </td>
                <td>
                    {t a=$pagination->getTotal()}Total: $a{/t}
                </td>
            </tr>
        </table>
    {/block}
{/block}

