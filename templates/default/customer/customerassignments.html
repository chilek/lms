<!--// $Id$ //-->
{assign var=today value=$smarty.now|date_format:"%x 00:00:00"}{assign var=today value=$today|date_format:"%s"}
<table class="lmsbox">
    <thead>
        <tr>
            <td style="width: 99%;" class="hand text-left bold nobr" onClick="showOrHide('customerassignments');">
                <img src="img/money.gif" alt="">
                {trans("Customer Liabilities:")}
            </td>
            <td style="width: 1%;" class="text-right nobr">
                {if !$customerinfo.deleted}
                <a href="?m=customerassignmentadd&amp;id={$customerinfo.id}">{trans("New Liability")} &raquo;</a>
                {if $layout.module == 'customerassignmentedit'}
                <a href="?m={$layout.module}&amp;expired={if $expired}0{else}1{/if}&amp;id={$assignment.id}">{if $expired}{trans("Hide expired")}{else}{trans("Show expired")}{/if} &raquo;</a>
                {else}
                <a href="?m={$layout.module}&amp;expired={if $expired}0{else}1{/if}&amp;id={if $nodeinfo}{$nodeinfo.id}{else}{$customerinfo.id}{/if}">{if $expired}{trans("Hide expired")}{else}{trans("Show expired")}{/if} &raquo;</a>
                {/if}
                <a onClick="return confirmLink(this, '{trans("Are you sure, you want to delete all liabilities?")}')" href="?m=customerassignmentdel&amp;cid={$customerinfo.id}">{trans("Delete all")} &raquo;</a>
                {/if}
            </td>
        </tr>
    </thead>
    <tbody>
        <tr id="customerassignments" style="display: none;">
            <td style="width: 100%;" colspan="2">
                <table class="lmsbox-inner">
                    <colgroup>
                        {block name=customer_assignment_list_columns}
                        <col style="width: 92%">
                        <col style="width: 1%" span="8">
                        {/block}
                    </colgroup>
                    <thead>
                        {block name=customer_assignment_list_header}
                        <tr>
                            <td class="bold nobr">{trans("Liability:")}</td>
                            <td class="text-right nobr">
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}{trans("Value:")}{/if}
                            </td>
                            <td class="text-right nobr">
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}{trans("Discount:")}{/if}
                            </td>
                            <td class="nobr">{trans("Accounting:")}</td>
                            <td class="text-right nobr">{trans("Downceil:")}</td>
                            <td class="text-right nobr">{trans("Upceil:")}</td>
                            <td class="nobr">{trans("Options:")}</td>
                            <td class="nobr">{trans("Period:")}</td>
                            <td>&nbsp;</td>
                        </tr>
                        {/block}
                    </thead>
                    <tbody>
                        {cycle name=assign values="light,lucid" print=false}
                        {foreach from=$assignments item=a}
                        {block name=customer_assignment_list_row}
                        <tr class="highlight {cycle name=assign}
                            {if ($a.dateto < $today && $a.dateto) || ($a.liabilityid && $a.at < $today && $a.at > 365)} blend{elseif ($a.datefrom > $today && $a.datefrom && $a.period) && !($a.suspended)} alertblend{elseif ($a.suspended)}suspended{/if}">
                            {if !$a.tariffid && !$a.liabilityid}
                            <td colspan="7" class="bold" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {trans("Suspending of all liabilities")}
                            </td>
                            {else}
                            <td OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {if $a.tariffid}
                                <a href="?m=tariffinfo&amp;id={$a.tariffid}"><span class="bold">{$a.name}</span></a><b>{if $a.attribute} - {$a.attribute}{/if}</b>
                                {else}
                                {$a.name}
                                {/if}
                                {if $a.nodes}({foreach from=$a.nodes item=item key=key}{$item.name}{if $key+1 < sizeof($a.nodes)}, {/if}{/foreach}){/if}
                            </td>
                            <td class="text-right nobr" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}{$a.value|money_format}{/if}
                            </td>
                            <td class="nobr" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}{if $a.pdiscount != 0}{$a.pdiscount}%{else}{if $a.vdiscount != 0}{$a.vdiscount|money_format}{else}-{/if}{/if}{/if}
                            </td>
                            <td class="nobr" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">{$a.payday}</td>
                            <td class="text-right nobr" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {if $a.downceil}{$a.downceil} kbit/s{else}-{/if}
                            </td>
                            <td class="text-right nobr" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {if $a.upceil}{$a.upceil} kbit/s{else}-{/if}
                            </td>
                            <td class="text-right nobr">
                                <img src="img/options.gif" alt="" {tip a=$a.id dynpopup='?m=customerassignmentinfo&amp;id=$a'}>
                            </td>
                            {/if}
                            <td class="nobr" OnClick="return self.location.href = '?m=customerassignmentedit&amp;id={$a.id}'">
                                {if $a.datefrom}{trans("from")} {$a.datefrom|date_format:"%Y/%m/%d"}{/if}
                                {if $a.dateto}{trans("to")} {$a.dateto|date_format:"%Y/%m/%d"}{/if}
                            </td>
                            <td class="text-right nobr">
                                {if ($a.tariffid || $a.liabilityid) && (($a.dateto > $today || !$a.dateto) || ($a.liabilityid && $a.at > $today))}
                                <a href="?m=customerassignmentedit&amp;action=suspend&amp;id={$a.id}&amp;suspend={if $a.suspended}0{else}1{/if}" {tip text="Enable/disable accounting of selected liability"}><img src="img/wait.gif" alt="[ {if $a.suspended}{trans("Restore")}{else}{trans("Suspend")}{/if} ]"></a>
                                {/if}
                                <a onClick="return confirmLink(this, '{trans("Are you sure, you want to delete this liability?")}')" href="?m=customerassignmentdel&amp;id={$a.id}" {tip text="Delete customer's liability"}><img src="img/delete.gif" alt="[ {trans("Delete")} ]"></a>
                                <a href="?m=customerassignmentedit&amp;id={$a.id}"><img src="img/edit.gif" alt="[ {trans("Edit")} ]" title="[ {trans("Edit")} ]"></a>
                            </td>
                        </tr>
                        {/block}
                        {foreachelse}
                        {block name=customer_assignment_list_empty_row}
                        <tr>
                            <td class="empty-table" colspan="9">
                                <P>&nbsp;</P>
                                <P>{trans("That customer hasn't got any assigned subscriptions.")}</P>
                                <P>&nbsp;</P>
                            </td>
                        </tr>
                        {/block}
                        {/foreach}
                    </tbody>
                    <tfoot>
                        {block name=customer_assignment_list_footer}
                        <tr>
                            <td class="ftop text-right bold">{trans("Total:")}</td>
                            <td class="ftop text-right nobr">
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                                {sum array=$assignments column="real_value" string_format=$LANGDEFS.$_language.money_format}
                                {/if}
                            </td>
                            <td class="ftop text-left nobr">
                                {if ConfigHelper::checkConfig('privileges.superuser') || !ConfigHelper::checkConfig('privileges.hide_finances')}
                                ({sum array=$assignments column="real_disc_value" string_format=$LANGDEFS.$_language.money_format})
                                {/if}
                            </td>
                            <td class="ftop">&nbsp;</td>
                            <td class="ftop text-right nobr">{sum array=$assignments column="real_downceil" assign=downceilsum}{if $downceilsum}{$downceilsum} kbit/s{/if}</td>
                            <td class="ftop text-right nobr">{sum array=$assignments column="real_upceil" assign=upceilsum}{if $upceilsum}{$upceilsum} kbit/s{/if}</td>
                            <td class="ftop" colspan="3">&nbsp;</td>
                        </tr>
                        {/block}
                    </tfoot>
                </table>
            </td>
        </tr>
    </tbody>
</table>
<script type="text/javascript">
<!--
    if (getCookie('customerassignments') == '1') {
        document.getElementById('customerassignments').style.display = '';
    }
//-->
</script>
