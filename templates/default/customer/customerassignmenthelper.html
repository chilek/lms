<style>
    div.lms-ui-multiselect hr {
        margin-top: 0px;
        margin-bottom: 0px;
    }
	div.nodes img,
	div.netdevnodes img,
	div.phones img {
		padding-top: 5px;
		padding-bottom: 5px;
	}
</style>

{if isset($promotion_only)}
<select id="tariff-select" name="{$variable_prefix}[tariffid]" style="display: none;">
<option value="-2"></option>
</select>
{/if}

<table class="lmsbox-inner">
	<COLGROUP>
		<COL style="width: 50%;">
		<COL style="width: 50%;">
	</COLGROUP>
	<TBODY>
	<tr>
		<td class="valign-top">
			<table width="100%;" cellpadding="3">
				{if !empty($promotions)}
				<tr>
					<td>
						<table id="a_promotions" style="display: none;">
							<TR>
								<TD>
									<IMG src="img/promoschema.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Schema")}:
								</TD>
								<TD style="width: 98%;">
									<SELECT size="1" name="{$variable_prefix}[schemaid]" id="promotion-select" {tip text="Select promotion schema"}>
										{if $promotion_only}
										<option value="0">{trans("<!promotionschema>- none -")}</option>
										{/if}
										{foreach $promotions as $promotion}
										<optgroup label="{$promotion.name}" data-valid="{$promotion.valid}"{if !$promotion.valid} class="blend"{if !$variables.alltariffs} style="display: none;"{/if}{/if}>
										{foreach $promotion.schemas as $schemaid => $schema}
										<OPTION value="{$schemaid}"{if $variables.schemaid == $schemaid} SELECTED{/if} data-valid="{$promotion.valid}"{if !$promotion.valid} class="blend"{/if}>{$schema.name|truncate:40:"...":true}</OPTION>
										{/foreach}
										</optgroup>
										{/foreach}
									</SELECT>
								</TD>
							</TR>
							<tr id="a_location" style="display: none;">
								<td>
									<img src="img/location.png" alt="">
								</td>
								<td class="bold">
									{trans("Location:")}
								</td>
								<td style="width: 98%;">
									<select name="{$variable_prefix}[location]" id="location-select" {tip text="Select promotion location"}>
										{*
										this contents is generated by ajax
										?m=customerassignmenthelper&api=1&customerid=... call
										*}
									</select>
								</td>
							</tr>
							<TR>
								<TD></TD>
								<TD colspan="2">
									{foreach $promotions as $promotionid => $promotion}
										{foreach $promotion.schemas as $schemaid => $schema}
										<table class="promotion-table" id="schema{$schemaid}">
											{foreach $schema.items as $label => $item}
											<tr>
												<td class="valign-top text-right">
													{t a=$label}<!tariffselection>$a:{/t}
												</td>
												<td class="valign-top" style="padding-bottom: 10px; padding-top: 0;">
													<table>
														<tr>
															{if isset($item.single)}
															<td class="valign-top{if !$item.single.optional} blend{/if}">
																<label>
																	<input class="schema-tariff-checkbox" type="checkbox" name="{$variable_prefix}[stariffid][{$schemaid}][{$label}]"
																		   value="{$item.single.tariffid}" data-label="{$label}"
																		   data-tarifftype="{$item.single.type}"
																		   {if isset($variables.stariffid[$schemaid][$label]) || !$item.single.optional} checked{/if}
																	{if !$item.single.optional} disabled data-mandatory="1"{/if}
																	data-tariffaccess="{$item.single.authtype}">
																	{$item.single.tariff}
																</label>
															</td>
															{else}
															<td class="valign-top">
																<select class="schema-tariff-selection" name="{$variable_prefix}[stariffid][{$schemaid}][{$label}]" data-label="{$label}">
																	{if !$item.selection.required}
																	<option value="0" data-tariffaccess="-1" data-tarifftype="0">{trans("- none -")}</option>
																	{/if}
																	{foreach $item.selection.items as $item}
																	<option value="{$item.tariffid}" data-tariffaccess="{$item.authtype}"
																			data-tarifftype="{$item.type}"
																			{if in_array($item.tariffid, (array)$variables.stariffid[$schemaid])} selected{/if}>{$item.tariff}</option>
																	{/foreach}
																</select>
															</td>
															{/if}
														</tr>
														<tr class="customerdevices" data-schemaid="{$schemaid}" data-label="{$label}">
															{*
															content of this row is generated by ajax
															?m=customerassignmenthelper&api=1&customerid=... call
															*}
														</tr>
													</table>
												</td>
											</tr>
											{/foreach}
										</table>
										{/foreach}
									{/foreach}
								</TD>
							</TR>
						</table>
					</td>
				</tr>
				{/if}
				<tr id="a_properties" style="display: none;">
					<td>
						<TABLE width="100%" cellpadding="3">
							<COLGROUP>
								<COL style="width: 1%;">
								<COL style="width: 1%;">
								<COL style="width: 98%;">
							</COLGROUP>

							<TBODY>

							<TR id="a_name" style="display: none;">
								<TD>
									<IMG src="img/money.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Name:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[name]" value="{if $variables.tariffid<=0}{$variables.name}{/if}" size="30" {tip text="Enter liability name/description (tariffless liabilities only)" trigger="name"}>
								</TD>
							</TR>

							<TR id="a_attribute" style="display: none;">
								<TD>
									<IMG src="img/money.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Attribute:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[attribute]" value="{if $variables.attribute}{$variables.attribute}{/if}" size="30" {tip text="Enter tariff attribute" trigger="attribute"}>
								</TD>
							</TR>

							<TR id="a_day" style="display: none;">
								<TD>
									<IMG src="img/calendar.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Accounting:")}
								</TD>
								<TD>
									<SELECT size="1" name="{$variable_prefix}[period]" {tip text="Select time period to account liability"}>
										{foreach from=$_PERIODS key=key item=item}
										<OPTION value="{$key}"{if $variables.period == $key} SELECTED{/if}>{$item}</OPTION>
										{/foreach}
									</SELECT>

									<INPUT type="TEXT" name="{$variable_prefix}[at]" value="{if $variables.at}{$variables.at}{/if}" {tip text="Enter accounting time. For disposable accounting enter date in format YYYY/MM/DD, for weekly accounting enter day of week (Monday = 1), for monthly accounting enter day of month (1 to 28), for yearly accounting enter day and month in format DD/MM (15/09 means September 15th), for half-yearly DD/MM (MM <=6) and for quarterly DD/MM (MM <= 3)" trigger="at"} SIZE="8">
									{if $variables.atwarning}
									<INPUT type="hidden" name="{$variable_prefix}[atwarning]" value="1">
									{/if}
								</TD>
							</TR>

							<TR id="a_period">
								<TD>
									<IMG src="img/calendar.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Period:")}
								</TD>
								<TD class="nobr">
									{trans("from:")}
									<INPUT type="TEXT" name="{$variable_prefix}[datefrom]" value="{if $variables.datefrom}{$variables.datefrom}{/if}" placeholder="{trans("yyyy/mm/dd")}" {tip class="calendar" text="Enter accounting start date in YYYY/MM/DD format. If you don't want to define 'From' date leave this field empty" trigger="datefrom"} SIZE="10">

									{trans("to:")}
									<INPUT type="TEXT" name="{$variable_prefix}[dateto]" value="{if $variables.dateto}{$variables.dateto}{/if}" placeholder="{trans("yyyy/mm/dd")}" {tip class="calendar" text="Enter accounting end date in YYYY/MM/DD format. Leave this field empty if you don't want to set expiration date" trigger="dateto"} SIZE="10">
								</TD>
							</TR>

							<TR id="a_value" style="display: none;">
								<TD>
									<IMG src="img/value.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Value:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[value]" value="{if $variables.value}{$variables.value}{/if}" size="10" {tip text="Enter liability value (tariffless liabilities only)" trigger="value"}>
								</TD>
							</TR>

							<TR id="a_discount" style="display: none;">
								<TD style="{if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')} display: none;{/if}">
									<IMG src="img/value.gif" alt="">
								</TD>
								<TD class="bold" style="{if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')} display: none;{/if}">
									<span class="bold">{trans("Discount:")}</span>
								</TD>
								<TD style="{if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')} display: none;{/if}">
									<INPUT type="text" size="8" name="{$variable_prefix}[discount]" value="{if $variables.pdiscount != 0}{$variables.pdiscount|string_format:"%.2f"}{else}{if $variables.vdiscount != 0}{$variables.vdiscount|string_format:"%.2f"}{/if}{/if}" {tip text="Enter discount percentage or amount" trigger="discount"}>
									<SELECT name="{$variable_prefix}[discount_type]">
										{foreach from=$_DISCOUNTTYPES item=item key=key}
										<OPTION value="{$key}"{if $variables.discount_type == $key} selected{/if}>{$item}</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<TR id="a_tax" style="display: none;">
								<TD>
									<IMG src="img/tax.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Tax:")}
								</TD>
								<TD>
									<SELECT SIZE="1" name="{$variable_prefix}[taxid]" {tip text="Select Tax value"}>
										{foreach item=tax from=$taxeslist}
										<OPTION value="{$tax.id}"{if ($variables.taxid && $tax.id == $variables.taxid) || (!$variables.taxid && $tax.value == ConfigHelper::getConfig('phpui.default_taxrate'))} selected{/if}>{$tax.label}</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<TR id="a_productid" style="display: none;">
								<TD>
									<IMG src="img/class.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Product ID:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[prodid]" value="{$variables.prodid}" size="10" {tip text="Enter liability Product ID (tariffless liabilities only)"}>
								</TD>
							</TR>

							<TR id="a_numberplan" style="display: none;">
								<TD>
									<IMG src="img/id.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Numbering Plan:")}
								</TD>
								<TD>
									<SELECT name="{$variable_prefix}[numberplanid]" {tip text="Select numbering plan"}>
										<OPTION value=""{if !$variables.numberplanid} selected{/if}>- {trans("default")} -</OPTION>

										{foreach item=plan from=$numberplanlist}
										{assign var=period value=$plan.period}
										<OPTION value="{$plan.id}"{if $plan.id==$variables.numberplanid} SELECTED{/if}>{$plan.template} ({$_NUM_PERIODS.$period})</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<TR id="a_paytype" style="display: none;">
								<TD>
									<IMG src="img/print.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Payment Type:")}
								</TD>
								<TD>
									<SELECT name="{$variable_prefix}[paytype]" {tip text="Select payment type" trigger="paytype"}>
										<OPTION value=""{if !$variables.paytype} selected{/if}>- {trans("default")} -</OPTION>

										{foreach from=$_PAYTYPES item=item key=key}
										<OPTION value="{$key}"{if $variables.paytype==$key} selected{/if}>{$item}</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<tr id="a_address" style="display: none;">
								<td>
									<img src="img/info3.gif" alt="">
								</td>
								<td class="bold">
									<span class="bold">{trans("Recipient:")}</span>
								</td>
								<td>
									<select id="recipient-select" name="{$variable_prefix}[recipient_address_id]">
										{*
										this contents is generated by ajax
										?m=customerassignmenthelper&api=1&customerid=... call
										*}
									</select>
								</td>
							</tr>

							</TBODY>
						</TABLE>
					</td>
				</tr>
			</table>
		</td>
		<td class="valign-top">
			<TABLE style="width: 100%;" cellpadding="3">
				<COLGROUP>
					<COL style="width: 1%;">
					<COL style="width: 1%;">
					<COL style="width: 98%;">
				</COLGROUP>

				<TBODY>
				<TR id="a_options" style="display: none;">
					<TD>
						<IMG src="img/options.gif" alt="">
					</TD>
					<TD class="bold">
						{trans("Options:")}
					</TD>
					<TD class="nobr">
						<label>
							{trans("document type:")}&nbsp;
							<SELECT name="{$variable_prefix}[invoice]">
								<OPTION value="0">{trans("without document")}</OPTION>
								<OPTION value="{$smarty.const.DOC_INVOICE}"{if $variables.invoice == $smarty.const.DOC_INVOICE} selected{/if}>{trans("invoice")}</OPTION>
								<OPTION value="{$smarty.const.DOC_INVOICE_PRO}"{if $variables.invoice == $smarty.const.DOC_INVOICE_PRO} selected{/if}>{trans("pro forma invoice")}</OPTION>
							</SELECT>
						</label>
						<br>
						<label>
							<input type="checkbox" name="{$variable_prefix}[separatedocument]" value="1"{if $variables.separatedocument} checked{/if}>
							{trans("separate document")}
						</label>
						<br>
						<label>
							{if $variables.id}
							<INPUT type="checkbox" name="{$variable_prefix}[settlement]" value="1"{if $variables.settlement} checked{/if}>
							{trans("with settlement of first deficient period")}
							{else}
							{trans("settlement type of first deficient period:")}
							<SELECT name="{$variable_prefix}[settlement]">
								<OPTION value="0">{trans("<!settlement>- none -")}</OPTION>
								<OPTION value="1"{if $variables.settlement == 1} selected{/if}>{trans("<!settlement>next period")}</OPTION>
								<OPTION value="2"{if $variables.settlement == 2} selected{/if}>{trans("<!settlement>current period")}</OPTION>
							</SELECT>
							{/if}
						</label>
					</TD>
				</TR>

				<TR id="a_existingassignments" style="display: none;">
					<TD>
						<IMG src="img/money.gif" alt="">
					</TD>
					<TD class="bold">
						{trans("Existing assignments:")}
					</TD>
					<TD class="nobr">
						<select name="{$variable_prefix}[existing_assignments][operation]">
							{foreach $_EXISTINGASSIGNMENTS as $operid => $operation}
							<option value="{$operid}"{if $variables.existing_assignments.operation == $operid} selected{/if}>{$operation}</option>
							{/foreach}
						</select>
						<label id="a_reference_document_limit" style="display: none;">
							<input type="checkbox" name="{$variable_prefix}[existing_assignments][reference_document_limit]"
								value="1"{if isset($variables.existing_assignments.reference_document_limit)} checked{/if}>
							{trans("limit to reference document")}
						</label>
						<label id="a_assignment_type_limit" style="display: none;">
							<input type="checkbox" name="{$variable_prefix}[existing_assignments][assignment_type_limit]"
								id="assignment_type_limit"
								value="1"{if isset($variables.existing_assignments.assignment_type_limit)} checked{/if}>
							{trans("limit to type")}
						</label>
					</TD>
				</TR>

				{if $customernodes}
				<tr id="a_nodes" style="display: none;">
					<td>
						<img src="img/node.gif" alt="">
					</td>
					<td class="bold">
						{trans("Nodes:")}
					</td>
					<td class="nobr" id="nodelist">
						{foreach $customernodes as $customernode}
						<span data-tariffaccess="{$customernode.authtype}" class="global-node-checkbox">
							<label>
								<input type="checkbox" name="{$variable_prefix}[nodes][{counter}]" value="{$customernode.id}"{if in_array($customernode.id, (array)$variables.nodes)} checked{/if}>
								<span class="bold">{$customernode.name}</span> ({$customernode.id|string_format:"%04d"}){if $customernode.location} / {$customernode.location|truncate:"60":"...":true}{/if}
							</label>
							<br>
						</span>
						{/foreach}
					</td>
				</tr>
				{/if}

				{if $customernetdevnodes}
				<tr id="a_netdevnodes" style="display: none;">
					<td>
						<img src="img/netdev.gif" alt="">
					</td>
					<td class="bold">
						{trans("Network Devices:")}
					</td>
					<td class="nobr" id="nodelist">
						{foreach $customernetdevnodes as $customernode}
						<span data-tariffaccess="{$customernode.authtype}" class="global-node-checkbox">
							<label>
								<input type="checkbox" name="{$variable_prefix}[nodes][{counter}]" value="{$customernode.id}"{if in_array($customernode.id, (array)$variables.nodes)} checked{/if}>
								<span class="bold">{$customernode.name}</span> {if !empty($customernode.netdev_name)} / {$customernode.netdev_name}{/if}  ({$customernode.id|string_format:"%04d"}){if $customernode.location} / {$customernode.location|truncate:"60":"...":true}{/if}
							</label>
							<br>
						</span>
						{/foreach}
					</td>
				</tr>
				{/if}

				{if $voipaccounts}
				<tr id="a_phones" style="display: none;">
					<td>
						<img src="img/voip.gif" alt="">
					</td>
					<td class="bold">
						{trans("Phones:")}
					</td>
					<td class="nobr" id="nodelist">
						{foreach $voipaccounts as $account}
						{foreach $account.phones as $phone}
						<label>
							<input type="checkbox" name="{$variable_prefix}[phones][]" value="{$phone.id}" {if !empty($variables.phones) && in_array($phone.id, (array)$variables.phones)} checked{/if}>
							<span class="bold">{$phone.phone}</span> / {$account.login}
						</label>
						<br>
						{/foreach}
						{/foreach}
					</td>
				</tr>
				{/if}

				{if ($customernodes && count($customernodes)) || ($customernetdevnodes && count($customernetdevnodes)) || ($voipaccounts && count($voipaccounts))}
				<tr id="a_checkall" style="display: none;">
					<td colspan=2"></td>
					<td>
						<label>
							<INPUT TYPE="checkbox" NAME="allbox" onchange="javascript:checkAllNodes();" VALUE="1">
							{trans("check all<!items>")}
						</label>
					</td>
				</tr>
				{/if}
				</TBODY>
			</TABLE>
		</td>
	</tr>
	</TBODY>
</TABLE>

<script src="img/customerassignmenthelper.js"></script>
