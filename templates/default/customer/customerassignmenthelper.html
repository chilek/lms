{$promotion_show_period_values = ConfigHelper::checkConfig('phpui.promotion_show_period_values')}

<style>

    div.lms-ui-multiselect hr {
        margin-top: 0px;
        margin-bottom: 0px;
    }
	div.nodes img,
	div.netdevnodes img,
	div.phones img {
		padding-top: 5px;
		padding-bottom: 5px;
	}

	table.single-assignment {
		border: 1px dotted;
		margin-left: 2em;
	}
	table.single-assignment tr:not(:last-child) {
		border-bottom: 1px dotted;
	}
	table.single-assignment td {
		text-align: center;
	}
	table.single-assignment td:not(:last-child) {
		border-right: 1px dotted;
	}
	table.single-assignment input[type="text"] {
		width: 5em;
		text-align: center;
	}
	table.single-assignment [data-restore-selector] {
		cursor: pointer;
	}

	.customerassignment-data {
		width: 100%;
		display: flex;
		flex-direction: row;
		justify-content: flex-start;
		align-items: flex-start;
		flex-wrap: wrap;
	}

	.customerassignment > div {
		flex-grow: 1;
	}

	#customerassignment-right-panel {
		margin-right: 2em;
		flex-grow: 1;
	}

	#customerassignment-left-panel {
		display: flex;
		margin-right: 10em;
		flex-grow: 1;
	}

	.schema-tariff-container-row {
		display: flex;
		flex-wrap: wrap;
	}

	.schema-tariff-container-row > td:first-child {
		display: flex;
		flex-direction: column;
	}

	.schema-tariff-count {
		padding-top: 0.5em;
	}

	.schema-tariff-count input {
		width: 5em;
	}

	@media screen and (max-width: 600px) {
		#customerassignment-left-panel {
			margin-right: 0em;
		}
		#customerassignment-right-panel {
			margin-right: 0em;
		}
	}

	@media screen and (max-width: 450px) {
		.customerdevices .lms-ui-multiselect-wrapper {
			width: 170px;
			div.lms-ui-multiselect {
				min-width: 170px;
			}
		}

		[name="assignment[name]"] {
			width: 150px;
		}

		[name="assignment[numberplanid]"] {
			width: 150px;
		}

		[name="assignment[attribute]"] {
			width: 150px;
		}

		#recipient-select {
			width: 150px;
		}
	}


</style>

{if isset($promotion_only)}
<select id="tariff-select" name="{$variable_prefix}[tariffid]" style="display: none;">
<option value="-2"></option>
</select>
{/if}

<table class="lmsbox-inner" width="100%">
	<TBODY>
	<tr>
		<td>
		<div class="customerassignment-data">
			<div id="customerassignment-left-panel">
			<table width="100%;" cellpadding="3">
				{if !empty($promotions)}
				<tr>
					<td>
						<table id="a_promotions" style="display: none;">
							<TR>
								<TD>
									<IMG src="img/promoschema.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Schema")}:
								</TD>
								<TD style="width: 98%;">
									<SELECT size="1" name="{$variable_prefix}[schemaid]" id="promotion-select" {tip text="Select promotion schema" trigger="promotion-select"}>
										{if $promotion_only}
										<option value="0">{trans("<!promotionschema>- none -")}</option>
										{/if}
										{foreach $promotions as $promotion}
										<optgroup title="{$promotion.description|escape|truncate:512:"...":true}"
											label="{$promotion.name}" data-valid="{$promotion.valid}"
											{if !$promotion.valid} class="blend"
											{if !$variables.alltariffs} style="display: none;"{/if}{/if}
										>
										{foreach $promotion.schemas as $schemaid => $schema}
										<OPTION title="{$schema.description|escape|truncate:512:"...":true}"
											value="{$schemaid}"{if $variables.schemaid == $schemaid} SELECTED{/if}
											data-valid="{$promotion.valid}"{if !$promotion.valid} class="blend"{/if}
										>{$schema.name|truncate:40:"...":true}</OPTION>
										{/foreach}
										</optgroup>
										{/foreach}
									</SELECT>
									<i id="promotion-schema-info" class="lms-ui-icon-info"></i>
								</TD>
							</TR>
							<tr id="a_location" style="display: none;">
								<td>
									<img src="img/location.png" alt="">
								</td>
								<td class="bold">
									{trans("Location:")}
								</td>
								<td style="width: 98%;">
									<select name="{$variable_prefix}[location]" id="location-select" {tip text="Select promotion location"}>
										{*
										this contents is generated by ajax
										?m=customerassignmenthelper&api=1&customerid=... call
										*}
									</select>
								</td>
							</tr>
							<tr id="a_check_all_terminals" style="display: none;">
								<td colspan="2">
								</td>
								<td>
									<label>
										<input type="checkbox" id="check_all_terminals" name="{$variable_prefix}[check_all_terminals]"
											value="1" {if $variables.check_all_terminals} checked{/if}>
										{trans("all terminals")}
									</label>
								</td>
							</tr>
							<TR>
								<TD></TD>
								<TD colspan="2">
									{foreach $promotions as $promotionid => $promotion}
										{foreach $promotion.schemas as $schemaid => $schema}
										<table class="promotion-table" id="schema{$schemaid}">
											{foreach $schema.items as $label => $item}
											<tr>
												<td class="valign-top text-right">
													{t a=$label}<!tariffselection>$a:{/t}
												</td>
												<td class="valign-top" style="padding-bottom: 10px; padding-top: 0;">
													<table>
														<tr class="schema-tariff-container">
															{textformat assign="countid"}counts-{$schemaid}-{iconv('UTF-8', 'ASCII//TRANSLIT', preg_replace('/[ _]/', '-', $label))}{/textformat}
															{if isset($item.single)}
															<td class="valign-top{if !$item.single.optional} blend{/if}">
																<table>
																	<tr class="schema-tariff-container-row">
																		<td>
																			<label>
																				<input class="schema-tariff-checkbox" type="checkbox" name="{$variable_prefix}[sassignmentid][{$schemaid}][{$label}]"
																						value="{$item.single.tariffid}" data-label="{$label}"
																						data-tarifftype="{$item.single.type}"
																						data-assignment-id="{$item.single.assignmentid}"
																						{if isset($variables.sassignmentid[$schemaid][$label]) || !$item.single.optional} checked{/if}
																				{if !$item.single.optional} disabled data-mandatory="1"{/if}
																				data-tariffaccess="{$item.single.authtype}">
																				{if $promotion_show_period_values}
																					{t a=$item.single.tariff b=moneyf($item.single.value, $item.single.currency) c=implode(' / ', $item.single.periodvalues)}$a (default: $b; $c){/t}
																				{else}
																					{t a=$item.single.tariff b=moneyf($item.single.value, $item.single.currency)}$a (default: $b){/t}
																				{/if}
																			</label>
																			<span class="schema-tariff-count">
																				{trans("Count:")}
																				<input type="number" name="{$variable_prefix}[counts][{$schemaid}][{$label}]"
																					id="{$countid}" min="1" max="50" required
																					value="{if isset($variables.counts[$schemaid][$label])}{$variables.counts[$schemaid][$label]}{else}1{/if}">
																			</span>
																		</td>
																		<td>
																			<table class="single-assignment" data-assignment-id="{$item.single.assignmentid}"
																					{if !isset($variables.sassignmentid[$schemaid][$label]) && $item.single.optional}style="display: none;"{/if}>
																				<tr>
																					{foreach $item.single.periods as $period}
																					<td>{$period.label}</td>
																					{/foreach}
																				</tr>
																				<tr>
																					{foreach $item.single.periods as $key => $period}
																					<td>
																						{if $period.modifiable}
																							{textformat assign="elemid"}value-{$schemaid}-{iconv('UTF-8', 'ASCII//TRANSLIT', preg_replace('/[ _]/', '-', $label))}-{$item.single.tariffid}-{$key}{/textformat}
																							<input id="{$elemid}" type="text" name="{$variable_prefix}[values][{$schemaid}][{$label}][{$item.single.tariffid}][{$key}]"
																									value="{if isset($variables.values[$schemaid][$label][$item.single.tariffid][$key])}{$variables.values[$schemaid][$label][$item.single.tariffid][$key]}{else}{$period.value}{/if}"
																									{tip trigger=$elemid}>
																							<i class="lms-ui-icon-restore" data-restore-selector="#{$elemid}" data-restore-value="{$period.value}"></i>
																						{else}
																							{if $period.value == ''}
																								-
																							{else}
																								{moneyf($period.value, $item.single.currency)}
																							{/if}
																						{/if}
																					</td>
																					{/foreach}
																				</tr>
																			</table>
																		</td>
																	</tr>
																</table>
															</td>
															{else}
															<td class="valign-top">
																<table>
																	<tr class="schema-tariff-container-row">
																		<td>
																			<select class="schema-tariff-selection" name="{$variable_prefix}[sassignmentid][{$schemaid}][{$label}]" data-label="{$label}">
																				{if !$item.selection.required}
																				<option value="0" data-tariffaccess="-1" data-tarifftype="0">{trans("- none -")}</option>
																				{/if}
																				{foreach $item.selection.items as $item}
																				<option value="{$item.assignmentid}" data-tariffaccess="{$item.authtype}"
																						data-tarifftype="{$item.type}" data-assignment-id="{$item.assignmentid}"
																						{if in_array($item.assignmentid, (array)$variables.sassignmentid[$schemaid])} selected{/if}
																					>{if $promotion_show_period_values}{t a=$item.tariff b=moneyf($item.value, $item.currency) c=implode(' / ', $item.periodvalues)}$a (default: $b; $c){/t}{else}{t a=$item.tariff b=moneyf($item.value, $item.currency)}$a (default: $b){/t}{/if}</option>
																				{/foreach}
																			</select>
																			<span class="schema-tariff-count">
																				{trans("Count:")}
																				<input type="number" name="{$variable_prefix}[counts][{$schemaid}][{$label}]"
																					id="{$countid}" min="1" max="50" required
																					value="{if isset($variables.counts[$schemaid][$label])}{$variables.counts[$schemaid][$label]}{else}1{/if}">
																			</span>
																		</td>
																		<td>
																			{foreach $item.selection.items as $item}
																			<table class="single-assignment" data-assignment-id="{$item.assignmentid}"
																					{if !in_array($item.assignmentid, (array)$variables.sassignmentid[$schemaid])}style="display: none;"{/if}>
																				<tr>
																					{foreach $item.periods as $period}
																						<td>{$period.label}</td>
																					{/foreach}
																				</tr>
																				<tr>
																					{foreach $item.periods as $key => $period}
																						<td>
																							{if $period.modifiable}
																								{textformat assign="elemid"}value-{$schemaid}-{iconv('UTF-8', 'ASCII//TRANSLIT', preg_replace('/[ _]/', '-', $label))}-{$item.assignmentid}-{$key}{/textformat}
																								<input id="{$elemid}"
																										type="text" name="{$variable_prefix}[values][{$schemaid}][{$label}][{$item.assignmentid}][{$key}]"
																										value="{if isset($variables.values[$schemaid][$label][$item.assignmentid][$key])}{$variables.values[$schemaid][$label][$item.assignmentid][$key]}{else}{$period.value}{/if}"
																										{tip trigger=$elemid}>
																								<i class="lms-ui-icon-restore" data-restore-selector="#{$elemid}" data-restore-value="{$period.value}"></i>
																							{else}
																								{if $period.value == ''}
																									-
																								{else}
																									{$period.value|money_format}
																								{/if}
																							{/if}
																						</td>
																					{/foreach}
																				</tr>
																			</table>
																			{/foreach}
																		</td>
																	</tr>
																</table>
															</td>
															{/if}
														</tr>
														<tr class="customerdevices" data-schemaid="{$schemaid}" data-label="{$label}">
															{*
															content of this row is generated by ajax
															?m=customerassignmenthelper&api=1&customerid=... call
															*}
														</tr>
													</table>
												</td>
											</tr>
											{/foreach}
										</table>
										{/foreach}
									{/foreach}
								</TD>
							</TR>
						</table>
					</td>
				</tr>
				{/if}
				<tr id="a_properties" style="display: none;">
					<td>
						<TABLE width="100%" cellpadding="3">
							<COLGROUP>
								<COL style="width: 1%;">
								<COL style="width: 1%;">
								<COL style="width: 98%;">
							</COLGROUP>

							<TBODY>
							{block name="customerassignmenthelper-properties"}

							<TR id="a_count" style="display: none;">
								<TD>
									<IMG src="img/values.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Count:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[count]" value="{if $variables.count}{$variables.count}{else}1{/if}" size="15" pattern="[0-9]+([\.][0-9]+)?" formnovalidate {tip text="Enter count in numeric format" trigger="count"}>
								</TD>
							</TR>

							<TR id="a_name" style="display: none;">
								<TD>
									<IMG src="img/money.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Name:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[name]" value="{if $variables.tariffid<=0}{$variables.name}{/if}" size="30" {tip text="Enter liability name/description (tariffless liabilities only)" trigger="name"}>
								</TD>
							</TR>

							<TR id="a_attribute" style="display: none;">
								<TD>
									<IMG src="img/money.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Attribute:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[attribute]" value="{if $variables.attribute}{htmlspecialchars($variables.attribute)}{/if}" size="30" {tip text="Enter tariff attribute" trigger="attribute"}>
								</TD>
							</TR>

							<TR id="a_day" style="display: none;">
								<TD>
									<IMG src="img/calendar.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Accounting:")}
								</TD>
								<TD>
									<SELECT id="assignment-period" size="1" name="{$variable_prefix}[period]" {tip text="Select time period to account liability"}>
										{foreach from=$_PERIODS key=key item=item}
										<OPTION value="{$key}"{if $variables.period == $key} SELECTED{/if}>{$item}</OPTION>
										{/foreach}
									</SELECT>

									<INPUT id="a-day-of-month" type="TEXT" name="{$variable_prefix}[at]"
										value="{if $variables.at}{$variables.at}{/if}"
										{tip text="Enter accounting time. For disposable accounting enter date in format YYYY/MM/DD, for weekly accounting enter day of week (Monday = 1), for monthly accounting enter day of month (1 to 28), for yearly accounting enter day and month in format DD/MM (15/09 means September 15th), for half-yearly DD/MM (MM <=6) and for quarterly DD/MM (MM <= 3)" trigger="at"}
										{if $variables.at == 0 && $variables.at != ''} style="display: none;" disabled{/if}
										SIZE="8">
									<label{if $variables.period != $smarty.const.MONTHLY} style="display: none;"{/if}>
										<input type="checkbox" id="last-day-of-month" name="{$variable_prefix}[at]" value="0"
											{if $variables.period != $smarty.const.MONTHLY} disabled{else}{if $variables.at == 0 && $variables.at != ''} checked{/if}{/if}>
										{trans("last day of month")}
									</label>
									{if $variables.atwarning}
									<INPUT type="hidden" name="{$variable_prefix}[atwarning]" value="1">
									{/if}
								</TD>
							</TR>

							<TR id="a_period">
								<TD>
									<IMG src="img/calendar.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Period:")}
								</TD>
								<TD>
									{trans("from:")}
									<INPUT type="TEXT" name="{$variable_prefix}[datefrom]" value="{if $variables.datefrom}{$variables.datefrom}{/if}" placeholder="{trans("yyyy/mm/dd")}" {tip class="lms-ui-date" text="Enter accounting start date in YYYY/MM/DD format. If you don't want to define 'From' date leave this field empty" trigger="datefrom"} SIZE="10">

									{trans("to:")}
									<INPUT type="TEXT" name="{$variable_prefix}[dateto]" value="{if $variables.dateto}{$variables.dateto}{/if}" placeholder="{trans("yyyy/mm/dd")}" {tip class="lms-ui-date" text="Enter accounting end date in YYYY/MM/DD format. Leave this field empty if you don't want to set expiration date" trigger="dateto"} SIZE="10">
								</TD>
							</TR>

							<TR id="a_value" style="display: none;">
								<TD>
									<IMG src="img/value.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Value:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[value]" value="{if $variables.value}{$variables.value}{/if}" size="10" {tip text="Enter liability value (tariffless liabilities only)" trigger="value"}>

									{currency_selection selected=$variables.currency elementname=$variable_prefix|cat:"[currency]"}

									<label>
										<input type="checkbox" name="{$variable_prefix}[splitpayment]" value="1"{if $variables.splitpayment} checked{/if}>
										{trans("split payment")}
									</label>
								</TD>
							</TR>

							<TR id="a_discount" style="display: none;">
								<TD style="{if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')} display: none;{/if}">
									<IMG src="img/value.gif" alt="">
								</TD>
								<TD class="bold" style="{if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')} display: none;{/if}">
									<span class="bold">{trans("Discount:")}</span>
								</TD>
								<TD style="{if !ConfigHelper::checkConfig('privileges.superuser') && ConfigHelper::checkConfig('privileges.hide_finances')} display: none;{/if}">
									<INPUT type="text" size="8" name="{$variable_prefix}[discount]" value="{if $variables.pdiscount != 0}{$variables.pdiscount|string_format:"%.2f"}{else}{if $variables.vdiscount != 0}{$variables.vdiscount|string_format:"%.2f"}{/if}{/if}" {tip text="Enter discount percentage or amount" trigger="discount"}>
									<SELECT name="{$variable_prefix}[discount_type]">
										{foreach from=$_DISCOUNTTYPES item=item key=key}
										<OPTION value="{$key}"{if $variables.discount_type == $key} selected{/if}>{$item}</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<TR id="a_tax" style="display: none;">
								<TD>
									<IMG src="img/tax.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Tax:")}
								</TD>
								<TD>
									<SELECT SIZE="1" name="{$variable_prefix}[taxid]" {tip text="Select Tax value"}>
										{foreach item=tax from=$taxeslist}
										<OPTION value="{$tax.id}"{if ($variables.taxid && $tax.id == $variables.taxid) || (!$variables.taxid && $tax.value == ConfigHelper::getConfig('phpui.default_taxrate'))} selected{/if}>{$tax.label}</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<TR id="a_productid" style="display: none;">
								<TD>
									<IMG src="img/class.gif" alt="">
								</TD>
								<TD class="bold">
									{trans("Product ID:")}
								</TD>
								<TD>
									<INPUT type="text" name="{$variable_prefix}[prodid]" value="{$variables.prodid}" size="10" {tip text="Enter liability Product ID (tariffless liabilities only)"}>
								</TD>
							</TR>

							<TR id="a_numberplan" style="display: none;">
								<TD>
									<IMG src="img/id.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Numbering Plan:")}
								</TD>
								<TD>
									<SELECT name="{$variable_prefix}[numberplanid]" {tip text="Select numbering plan"}>
										<OPTION value=""{if !$variables.numberplanid} selected{/if}>- {trans("default")} -</OPTION>

										{foreach item=plan from=$numberplanlist}
										{assign var=period value=$plan.period}
										<OPTION value="{$plan.id}"{if $plan.id==$variables.numberplanid} SELECTED{/if}>{$plan.template} ({$_NUM_PERIODS.$period})</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<TR id="a_paytype" style="display: none;">
								<TD>
									<IMG src="img/print.gif" alt="">
								</TD>
								<TD class="bold nobr">
									{trans("Payment Type:")}
								</TD>
								<TD>
									<SELECT name="{$variable_prefix}[paytype]" {tip text="Select payment type" trigger="paytype"}>
										<OPTION value=""{if !$variables.paytype} selected{/if}>- {trans("default")} -</OPTION>

										{foreach from=$_PAYTYPES item=item key=key}
										<OPTION value="{$key}"{if $variables.paytype==$key} selected{/if}>{$item}</OPTION>
										{/foreach}
									</SELECT>
								</TD>
							</TR>

							<tr id="a_address" style="display: none;">
								<td>
									<img src="img/info3.gif" alt="">
								</td>
								<td class="bold">
									<span class="bold">{trans("Recipient:")}</span>
								</td>
								<td>
									<select id="recipient-select" name="{$variable_prefix}[recipient_address_id]">
										{*
										this contents is generated by ajax
										?m=customerassignmenthelper&api=1&customerid=... call
										*}
									</select>
								</td>
							</tr>

							{/block}
							</TBODY>
						</TABLE>
					</td>
				</tr>
			</table>
			</div>
			<div id="customerassignment-right-panel">
			<TABLE style="width: 100%;" cellpadding="3">
				<COLGROUP>
					<COL style="width: 1%;">
					<COL style="width: 1%;">
					<COL style="width: 98%;">
				</COLGROUP>

				<TBODY>
				<TR id="a_options" style="display: none;">
					<TD>
						<IMG src="img/options.gif" alt="">
					</TD>
					<TD class="bold">
						{trans("Options:")}
					</TD>
					<TD>
						<label>
							{trans("document type:")}&nbsp;
							<SELECT name="{$variable_prefix}[invoice]">
								<OPTION value="0">{trans("without document")}</OPTION>
								<OPTION value="{$smarty.const.DOC_INVOICE}"{if $variables.invoice == $smarty.const.DOC_INVOICE} selected{/if}>{trans("invoice")}</OPTION>
								<OPTION value="{$smarty.const.DOC_INVOICE_PRO}"{if $variables.invoice == $smarty.const.DOC_INVOICE_PRO} selected{/if}>{trans("pro forma invoice")}</OPTION>
								<OPTION value="{$smarty.const.DOC_DNOTE}"{if $variables.invoice == $smarty.const.DOC_DNOTE} selected{/if}>{trans("debit note")}</OPTION>
							</SELECT>
						</label>
						<br>
						<label>
							<input type="checkbox" name="{$variable_prefix}[separatedocument]" value="1"{if $variables.separatedocument} checked{/if}>
							{trans("separate document")}
						</label>
						<br>
						<label>
							{if $variables.id}
							<INPUT type="checkbox" name="{$variable_prefix}[settlement]" value="1"{if $variables.settlement} checked{/if}>
							{trans("with settlement of first deficient period")}
							{else}
							{trans("settlement type of first deficient period:")}
							<SELECT name="{$variable_prefix}[settlement]">
								<OPTION value="0">{trans("<!settlement>- none -")}</OPTION>
								<OPTION value="1"{if $variables.settlement == 1} selected{/if}>{trans("<!settlement>next period")}</OPTION>
								<OPTION value="2"{if $variables.settlement == 2} selected{/if}>{trans("<!settlement>current period")}</OPTION>
							</SELECT>
							{/if}
						</label>
						{if !$variables.id}
						<br>
						<label>
							<INPUT type="checkbox" name="{$variable_prefix}[last-settlement]" value="1"{if $variables['last-settlement']} checked{/if}>
							{trans("with settlement of last deficient period")}
						</label>
						{/if}
					</TD>
				</TR>

				<TR id="a_existingassignments" style="display: none;">
					<TD>
						<IMG src="img/money.gif" alt="">
					</TD>
					<TD class="bold">
						{trans("Existing assignments:")}
					</TD>
					<TD>
						<select name="{$variable_prefix}[existing_assignments][operation]">
							{foreach $_EXISTINGASSIGNMENTS as $operid => $operation}
							<option value="{$operid}"{if $variables.existing_assignments.operation == $operid} selected{/if}>{$operation}</option>
							{/foreach}
						</select>
						<label id="a_reference_document_limit" style="display: none;">
							<input type="checkbox" name="{$variable_prefix}[existing_assignments][reference_document_limit]"
								value="1"{if isset($variables.existing_assignments.reference_document_limit)} checked{/if}>
							{trans("limit to reference document")}
						</label>
						<label id="a_assignment_type_limit" style="display: none;">
							<input type="checkbox" name="{$variable_prefix}[existing_assignments][assignment_type_limit]"
								id="assignment_type_limit"
								value="1"{if isset($variables.existing_assignments.assignment_type_limit)} checked{/if}>
							{trans("limit to type")}
						</label>
					</TD>
				</TR>

				{if $customernodes}
				<tr id="a_nodes" style="display: none;">
					<td>
						<img src="img/node.gif" alt="">
					</td>
					<td class="bold">
						{trans("Nodes:")}
					</td>
					<td id="nodelist">
						{foreach $customernodes as $customernode}
						<span data-tariffaccess="{$customernode.authtype}" class="global-node-checkbox">
							<label>
								<input type="checkbox" name="{$variable_prefix}[nodes][{$customernode.id}]" value="{$customernode.id}"{if isset((array)$variables.nodes[$customernode.id])} checked{/if}>
								<span class="bold">{$customernode.name}</span> ({$customernode.id|string_format:"%04d"}){if $customernode.location} / {$customernode.location|truncate:"60":"...":true}{/if}
							</label>
							{if isset($variables.node_warns[$customernode.id])}
								<input type="hidden" name="{$variable_prefix}[node_warns][{$customernode.id}]" value="{$customernode.id}">
							{/if}
							<br>
						</span>
						{/foreach}
					</td>
				</tr>
				{/if}

				{if $customernetdevnodes}
				<tr id="a_netdevnodes" style="display: none;">
					<td>
						<img src="img/netdev.gif" alt="">
					</td>
					<td class="bold">
						{trans("Network Devices:")}
					</td>
					<td id="nodelist">
						{foreach $customernetdevnodes as $customernode}
						<span data-tariffaccess="{$customernode.authtype}" class="global-node-checkbox">
							<label>
								<input type="checkbox" name="{$variable_prefix}[nodes][{$customernode.id}]" value="{$customernode.id}"{if isset((array)$variables.nodes[$customernode.id])} checked{/if}>
								<span class="bold">{$customernode.name}</span> {if !empty($customernode.netdev_name)} / {$customernode.netdev_name}{/if}  ({$customernode.id|string_format:"%04d"}){if $customernode.location} / {$customernode.location|truncate:"60":"...":true}{/if}
							</label>
							{if isset($variables.node_warns[$customernode.id])}
								<input type="hidden" name="{$variable_prefix}[node_warns][{$customernode.id}]" value="{$customernode.id}">
							{/if}
							<br>
						</span>
						{/foreach}
					</td>
				</tr>
				{/if}

				{if $voipaccounts}
				<tr id="a_phones" style="display: none;">
					<td>
						<img src="img/voip.gif" alt="">
					</td>
					<td class="bold">
						{trans("Phones:")}
					</td>
					<td id="nodelist">
						{foreach $voipaccounts as $account}
						{foreach $account.phones as $phone}
						<label>
							<input type="checkbox" name="{$variable_prefix}[phones][]" value="{$phone.id}" {if !empty($variables.phones) && in_array($phone.id, (array)$variables.phones)} checked{/if}>
							<span class="bold">{$phone.phone}</span> / {$account.login}
						</label>
						<br>
						{/foreach}
						{/foreach}
					</td>
				</tr>
				{/if}

				{if ($customernodes && count($customernodes)) || ($customernetdevnodes && count($customernetdevnodes)) || ($voipaccounts && count($voipaccounts))}
				<tr id="a_checkall" style="display: none;">
					<td colspan=2"></td>
					<td>
						<label>
							<INPUT TYPE="checkbox" NAME="allbox" onchange="javascript:checkAllNodes();" VALUE="1">
							{trans("check all<!items>")}
						</label>
					</td>
				</tr>
				{/if}
				</TBODY>
			</TABLE>
			</div>
		</div>
		</td>
	</tr>
	</TBODY>
</TABLE>

<script src="js/customerassignmenthelper.js"></script>
