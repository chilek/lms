$Id$

planowane psucie bazy co obi±æ moim skromnym powinno w finansach:

Otó¿ imvho, timestamp jest dobry, ale robi±c w/w operacje chcia³bym 
je oznaczaæ równie¿ dat± w sensie YYYY/MM/DD. Otó¿ wp³ata powinna byæ 
oznaczona równie¿ dniem zaksiêgowania jej. Powodów wiele.

id | number | number_plan | refersto | paytime | paytype | financial_peroid
11 |   1    |      1      |    NULL  |   14    |    1    |      3

12 |   1    |      2      |     11   |   10    |    1    |      3       | 
13 |   2    |      1      |     11   |   10    |    1    |      3       | 


Zarówno id 12 jak i 13 mog± byæ korekt± 11, 

12 ma swój inny plan numerowania ( np numer/LMSKOR/2005) 
13 korzysta z planu "1" ( np numer/LMS/2005) 

Daje to mo¿liwo¶æ pój¶cia zarówno w stronê LMS jak i LMSKOR

Ten ca³y financial_peroid to próba racjonalizacji korzystania z cdate, 
to co jest dzia³a ale pachnie ¼le. Chcia³bym i¶æ w kierunku:

lms=> SELECT * from numberplans ;
 id |  template   |  default  | period | doctype
----+-------------+-----------+--------+---------
  5 | %d-%n-%y-%m |         0 |      3 |       1

Doctype i period takie jak w lib/definitions.php

Default ma prawo byæ tylko jeden dla ka¿dego doctype.

³±czniki i sta³e. Tutaj mia³bym za³o¿enie takie ¿e w template MUSI wystêpowaæ:
%N przynajmniej/dok³adnie raz. (%NN %NNNN czy %4N ?).
alec> ten z 4 bêdzie ³atwiej sparsowaæ
%Y/%YY/%YYYY --dok³adnie RAZ. (wymóg do¶æ racjonalny).
³±czniki -- uznajemy: .-/=\#'
s³owa to litery mog±ce zawieraæ cyfry ale nie zaczynaæ siê od cyfr
pomiêdzy znakami procentów i ³±cznikami oraz s³owami nie ma prawa byæ SPACJI.

Wa¿ne:

Co raz wiêcej razy w kodzie jest co¶ takiego:

if($list = $DB->GetAll('SELECT * FROM numberplans ORDER BY id'))
	    {
        $count = $DB->GetAllByKey('SELECT numberplanid AS id,
		[...]
        $max = $DB->GetAllByKey('SELECT numberplanid AS id, 
		[...]

To siê a¿ prosi o to aby kiedy¶ kto¶ co¶ doda³ "w miedzyczasie" i by³ problem.

Czy mo¿emy robiæ tak:
$DB->BeginTrans
	[kod]
$DB->EndTrans

I co na to mysql oraz sqlite ?

Wiêc tak:

A) korekty dotycz± tylko i wy³±cznie dokumentów ¼ród³owych a nie korekt. Ale 
z poziomu bazy to nie oznacza ¿e mo¿na bezpiecznie u¿ywaæ nr faktury, nale¿y 
u¿ywaæ id z bazy.

B) number_plan choæby mia³byæ 1 dla faktur i 2 dla koryguj±cych MA BYÆ i ju¿.
i nie jest to typ... choæ mo¿emy za³o¿yæ ¿e numerki 2,4,6,8... koryguj± 1,3,5,7..

C) z templatem numerowania nale¿y uciec kompletnie z lms.ini i mieæ go w bazie...
i teraz maj±c numbering_plan "1" N/M/LMS/Y to nr 2 powinien byæ: N/M/LMSKOR/Y

D) aby sobie nie strzeliæ w stopê:
 *] koryguj±ce fakturki maj± inn± numeracjê, ale inn± tylko co do "/LMSKOR/" 
	ca³a reszta jak wybór schematu miesciêczny/roczny zostaje

 *] domy¶lnie faktura koryguj±ca musi mieæ jakiekolwiek pozycje, bez nich nei 
    mo¿e jej byæ bo nic nie koryguje
 *] zapisujemy pozycje PO_SKORYGOWANIU 


UI=>

