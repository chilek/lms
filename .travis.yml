if: (repo = chilek/lms) OR (branch =~ /^stable/)

env:
  global:
    - COMPOSER_DISABLE_XDEBUG_WARN="1"

matrix:
  include:
    - os: linux
      language: php
      php: 7.3
      dist: xenial
      env:
        PHPCS_VER="^3"
        PHPCS_STANDARD="phpcs3.xml"
        INSTALL_PHP_ZIP_EXTENSION=false
      addons:
        postgresql: 9.4

    - os: linux
      language: php
      php: 7.4
      dist: xenial
      env:
        PHPCS_VER="^3"
        PHPCS_STANDARD="phpcs3.xml"
        INSTALL_PHP_ZIP_EXTENSION=true
      addons:
        postgresql: 9.4

    - os: linux
      language: php
      php: 8.0
      dist: xenial
      env:
        PHPCS_VER="^3"
        PHPCS_STANDARD="phpcs3.xml"
        INSTALL_PHP_ZIP_EXTENSION=true
      addons:
        postgresql: 9.4

    - os: linux
      language: php
      php: 8.1
      dist: xenial
      env:
        PHPCS_VER="^3"
        PHPCS_STANDARD="phpcs3.xml"
        INSTALL_PHP_ZIP_EXTENSION=true
      addons:
        postgresql: 9.4

    - os: linux
      language: php
      php: 8.2
      dist: jammy
      env:
        PHPCS_VER="^3"
        PHPCS_STANDARD="phpcs3.xml"
        INSTALL_PHP_ZIP_EXTENSION=true
      addons:
        postgresql: 14

    - os: linux
      language: php
      php: 8.3
      dist: jammy
      env:
        PHPCS_VER="^3"
        PHPCS_STANDARD="phpcs3.xml"
        INSTALL_PHP_ZIP_EXTENSION=true
      addons:
        postgresql: 14

#    - os: linux
#      language: php
#      php: 8.4
#      dist: jammy
#      env:
#        PHPCS_VER="^3"
#        PHPCS_STANDARD="phpcs3.xml"
#        INSTALL_PHP_ZIP_EXTENSION=true
#      addons:
#        postgresql: 14

services:
  - postgresql
  - mysql

#before_install:
#   - if ${INSTALL_PHP_ZIP_EXTENSION}; then sudo apt-get install libzip-dev; pecl install zip; fi
#   - echo "extension = libzip.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
#  - echo "extension = snmp.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini

install:
  - composer install
  - npm install -g jshint

before_script:
  - psql -c 'create database lms;' -U postgres
  - psql -U postgres -f doc/lms.pgsql
  - mysql -e 'CREATE DATABASE lms;'
  - mysql lms < doc/lms.mysql
  - devel/test-incremental.sh
  #- ./vendor/bin/phpunit

script: true

notifications:
  email:
#    recipients:
#      - admin@chilan.com
#      - r.pietraszewicz@gmail.com
    on_success: change
    on_failure: always
