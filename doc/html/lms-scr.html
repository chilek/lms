<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Language" content="pl">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<title>::: LMS : Dokumentacja :::</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>
<body topmargin="0" leftmargin="0" marginheight="0" marginwidth="0" bgcolor="#EBE4D6" link="#800000" vlink="#800000" alink="#336600">
<table bgcolor="#CEBD9B" cellpadding="3" cellspacing="0" width="100%" style="border-width: 1pt; border-style: solid;">
<tr>
<td width="50%" valign="middle">
	<img border="0" src="logo-small.png" align="left" alt="LMS 1.0">
</td>
<td width="50%">
<p align="right">
<a href="http://lms.rulez.pl">Strona domowa</a>
</p>
</td>
</tr>
<TR>
<TD width="50%">
<p><a href="lms-mgc.html">&lt;&lt; Poprzednia</a></p>
</TD>
<TD width="50%">
<p align="right">
Nastêpna &gt;&gt;</p>
</TD>
</TR>
</table>
<table border="0" cellpadding="10" cellspacing="0" width="100%"><tr><td width="1%" style="border-right-style: dashed; border-right-width: 1pt; border-right-color: #333333; border-left-style: dashed; border-left-width: 1pt; border-left-color: #333333;" bgcolor="#F4F0EC" valign="top">
<table width="100%">
<TR>
<TD width="100%" nowrap>
<!-- Spis treœci idzie tutaj -->
<H2>Zawarto¶æ</H2>
<img src="tab1.gif"><a href="index.html">Przedmowa</a><br><br>
<img src="tab1.gif"><a href="lms.html">Rozdzia³ 1 - Na pocz±tek</a><br>
<img src="tab2.gif"><a href="lms.html#1">Czym jest LMS</a><br>
<img src="tab2.gif"><a href="lms.html#2">Co LMS mo¿e a czego nie</a><br>
<img src="tab2.gif"><a href="lms.html#3">Co wchodzi w sk³ad LMS</a><br>
<img src="tab2.gif"><a href="lms.html#4">Instalacja</a><br>
<img src="tab2.gif"><a href="lms.html#5">Konfiguracja</a><br>
<img src="tab2.gif"><a href="lms.html#6">Pierwsze logowanie</a><br>
<img src="tab2.gif"><a href="lms.html#7">Prawa dostêpu</a><br>
<img src="tab1.gif"><a href="lms-ui.html">Rozdzia³ 2 - LMS UI (User Interface)</a><br>
<img src="tab2.gif"><a href="lms-ui.html#1">Konfiguracja</a><br>
<img src="tab1.gif"><a href="lms-mgc.html">Rozdzia³ 3 - LMS-MGC</a><br>
<img src="tab1.gif"><a href="lms-scr.html">Rozdzia³ 4 - Skrypty</a><br>
<img src="tab2.gif"><a href="lms-scr.html#1">Instalacja</a><br>
<img src="tab2.gif"><a href="lms-scr.html#2">lms-notify</a><br>
<img src="tab2.gif"><a href="lms-scr.html#3">lms-cutoff</a><br>
<img src="tab2.gif"><a href="lms-scr.html#4">lms-eachmonth</a><br>
<!-- A tutaj spis siê koñczy -->
</td>
</TR>				
</TABLE>
</p></td>
<td width="99%" valign="top" style="border-right-style: dashed; border-right-width: 1pt; border-right-color: #333333;">
<!-- A tutaj zaczyna siê tresæ -->
<H1
>Rozdzia³ 4. Skrypty</H1
>
               <H2
><a name="1">Instalacja</a></H2
>
        <P
align="justify">Je¶li chcemy ustawiæ konfiguracjê którego¶ ze skryptów, robimy to w odpowiedniej sekcji <TT
>lms.ini</TT
>. Same skrypty przenosimy do katalogu <TT
>/usr/sbin</TT
>. Po przeniesieniu musimy je jeszcze dopisaæ do crontaba tak, aby by³y uruchamiane automatycznie w³a¶nie wtedy kiedy tego chcemy.
        <P
align="justify">Pamiêtaj ¿e przewa¿nie bêdziesz chcia³ aby te skrypty by³y uruchamiane tylko raz w miesi±cu (no chyba ¿e chcesz naliczaæ u¿ytkownikom op³aty kilka razy w miesi±cu.)
        <P
align="justify">Przyk³adowo, je¶li chcieliby¶my aby op³ata abonamentowa by³a naliczana uzytkownikom 5 dnia ka¿dego miesi±ca o godzinie 1:20, przyk³adowy wpis w <TT
>crontab</TT
> powinien wygl±daæ tak:
        <P><TABLE
border="1"
bgcolor="#F4F0EC"
width="100%"
><TR
><TD
><PRE
>20 1 5 * *       /usr/sbin/lms-eachmonth</PRE
></TD
></TR
></TABLE
>
        <P
align="justify">Po wiêcej informacji mo¿esz siêgn±æ do <FONT
color="brown"
>man crontab</FONT
>
       
       	<H2
><a name="2">lms-notify</a></H2
>
	 	  <H3
>Szablony</H3
>
          
	  <P
align="justify">lms-notify jest dobrym sposobem przypominania ludziom o tym ¿e do pracy sieci i ³±cz konieczne s± ich pieni±¿ki. Pozwala on na napisanie kilku[-nastu] plików tekstowych [w iso-8859-2] i traktowania ich jako szablonów do mailingu.
	  <P
align="justify">W plikach mo¿na u¿ywaæ nastêpuj±cych zmiennych:
	  <P><UL
>	    <LI>	       <P
align="justify">%date-m - zostanie zast±pione aktualnym miesi±cem, licz±c od 1 poprzedzone 0, np. 02
	    <P>
	    <LI>	       <P
align="justify">%date-y - zostanie zast±pione aktualnym rokiem, np 2003
	    <P>
	    <LI>	       <P
align="justify">%saldo - zostanie zast±pione aktualnym saldem u¿ytkownika, np. 535
	    <P>
	    <LI>	       <P
align="justify">%abonament - zostanie zast±pione kwot± abonamentu jaka jest do danego u¿ytkownika przypisana, np. 107
	    <P>
	    <LI>	       <P
align="justify">%b - saldo z zanegowanym znakiem, np. 107
	    <P>
	    <LI>	       <P
align="justify">%B - saldo z prawdziwym znakiem, np. -107
	    <P>
	    <LI>	       <P
align="justify">%last_10_in_a_table - wyci±g ostatnich 10 operacji kasowych na koncie u¿ytkownika, np:
	    <P>
	  </UL
>
	  <P
>	   <B
>Przyk³adowy wyci±g 10 ostatnich operacji kasowych</B
>
<P><TABLE
border="1"
bgcolor="#F4F0EC"
width="100%"
><TR
><TD
><PRE
>Data       | Opis                                                 | Warto¶æ
-----------+------------------------------------------------------+---------
2003-02-02 | Abonament za miesi±c 2003/02                         |  107.00
2003-02-01 | Wp³ata                                               | -107.00
2003-02-01 | Abonament za miesi±c 2003/02                         |  107.00
2003-02-01 | Wp³ata                                               | -321.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
-----------+------------------------------------------------------+---------</PRE
></TD
></TR
></TABLE
></P
>
	  <P
>           <B
>Przyk³ad szablonu:</B
>
<P><TABLE
border="1"
bgcolor="#F4F0EC"
width="100%"
><TR
><TD
><PRE
>UWAGA! Ta wiadomo¶æ zosta³a wygenerowana automatycznie.

Uprzejmie informujemy i¿ na Pani/Pana koncie figuruje zaleg³o¶æ w op³atach za
internet w wysoko¶ci %B z³.

Je¿eli porozumieli siê ju¿ Pañstwo z administratorami w kwestii op³aty za
bierz±cy miesi±c czyli %date-m %date-y roku, prosimy o
zignorowanie tej wiadomo¶ci.

W wypadku gdy uwa¿aj± Pañstwo i¿ zaleg³o¶æ ta jest nieporozumieniem prosimy o
jak najszybszy kontakt.

Wszelkie informacje na temat Pañstwa rozliczeñ mog± Pañstwo znale¼æ pod
adresem http://www.naszasiec.pl/mojekonto/

Je¿eli chcieliby Pañstwo uregulowaæ zaleg³o¶ci prosimy o kontakt:

Dzia³ Rozliczeñ ASK NaszaSiec

Gerwazy Regu³a
telefon: 0-509031337
email: gerwazy@staff.naszasiec.pl

Gwidon Mniejwa¿ny
telefon: 0-606666666
email: gwidonm@naszasiec.pl

ps. za³±czamy ostatnie 10 operacji jakie zosta³o zarejestrowane przez nasz
system bilingowy na Pañstwa koncie:

kwota operacji | typ operacji | data

%last_10_in_a_table

--
Amatorska Sieæ Komputerowa NaszaSiec
http://www.naszasiec.pl/</PRE
></TD
></TR
></TABLE
></P
>
          
	  	  <H3
>Konfiguracja</H3
>
           
           <P
align="justify">Konfiguracjê dla lms-notify mo¿emy ustaliæ w pliku <TT
>lms.ini</TT
> w sekcji <I
>[notify]</I
>. Mo¿emy tam ustawiæ nastêpuj±ce parametry:
	   <P><UL
>            <LI>	     <P
align="justify">limit (opcjonalny)
	     <P
align="justify">Pozwala na ustalenie limitu bilansu poni¿ej którego do u¿ytkownika zostanie wys³any email z upomnieniem. Domy¶lnie limit = 0
	     <P
><B
>Przyk³ad:</B
><P
align="justify">limit = -20</P
>
	    <P>
            <LI>	     <P
align="justify">mailsubject (wymagany)
	     <P
align="justify">Pozwala na ustalenie tematu emaila wysy³anego do u¿ytkownika. Mo¿na u¿ywaæ podstawieñ znanych z szablonów (%B, %b, %date-y, %date-m, %last_10_in_a_table). Domy¶lnie nieustawione.
	     <P
><B
>Przyk³ad:</B
><P
align="justify">mailsubject = Informacje o zaleg³o¶ciach w op³atach za internet</P
>
	    <P>
	    <LI>	     <P
align="justify">mailtemplate (wymagany)
	     <P
align="justify">Pozwala na wskazanie szablonu wiadomo¶ci która zostanie wys³ana do u¿ytkownika. Wiêcej o szablonach tutaj. Domy¶lnie nieustawione
	     <P
><B
>Przyk³ad:</B
><P
align="justify">mailtemplate = /etc/lms/notifytemplate.txt</P
>
            <P>
            <LI>             <P
align="justify">mailfrom
             <P
align="justify">Adres e-mail z którego zostanie wys³any e-mail. Proszê pamiêtaæ, ¿e na niektórych MTA (np. exim) konto to musi istnieæ w systemie. Domy¶lnie nieustawione
             <P
><B
>Przyk³ad:</B
><P
align="justify">mailfrom	= staff@domain.pl</P
>
            <P>
            <LI>             <P
align="justify">mailfname
             <P
align="justify">Nazwa nadawcy maila
             <P
><B
>Przyk³ad:</B
><P
align="justify">mailfname	= Administratorzy</P
>
            <P>
            <LI>             <P
align="justify">smtp_server
             <P
align="justify">Serwer SMTP przez który ma zostaæ wys³ana wiadomo¶æ. Domy¶lnie: 127.0.0.1
             <P
><B
>Przyk³ad:</B
><P
align="justify">smtp_server = smtp.mydomain.pl</P
>
            <P>
            <LI>             <P
align="justify">debug_email (opcjonalny)
             <P
align="justify">Adres email do debugowania. Gdy ustawiony, ca³a poczta zostaje wys³ana na dany email zamiast do u¿ytkowników. Przydatne do debugowania i sprawdzania czy wszystko dzia³a OK. Domy¶lnie nieustawiony.
             <P
><B
>Przyk³ad:</B
><P
align="justify">lexx@domain.pl</P
>
            <P>
          </UL
>
          
	
		 <H2
><a name="3">lms-cutoff</a></H2
>
	 <P
align="justify">Skrypt pozwala na od³±czenie (a raczej zmianê w bazie danych stanu komputerów na wy³±czony) u¿ytkowników których bilans jest poni¿ej zadanej warto¶ci. W³a¶ciwe od³±czanie powinno byæ realizowane przez generator plików konfiguracyjnych.
         <P
align="justify">Konfiguracjê dla lms-cutoff mo¿emy ustaliæ w pliku <TT
>lms.ini</TT
> w sekcji <I
>[cutoff]</I
>. Mo¿emy tam ustawiæ nastêpuj±ce parametry:
	 <P><UL
>          <LI>	   <P
align="justify">limit (opcjonalny)
	   <P
align="justify">Pozwala na ustalenie limitu bilansu poni¿ej którego do bazy danych zostanie zapisany stan od³±czony. Domy¶lnie limit = 0
	   <P
><B
>Przyk³ad:</B
><P
align="justify">limit = -20</P
>
	  <P>
	 </UL
>
	
		 <H2
><a name="4">lms-eachmonth</a></H2
>
	 <P
align="justify">Skrypt po uruchomieniu nalicza u¿ytkownikom op³atê abonamentow±. Aby dzia³a³ poprawnie powinien byæ uruchamiany tylko raz w miesi±cu (o ile u¿ytkownicy wnosz± op³aty co miesi±c). Skrypt ten nie posiada ¿adnych opcji konfiguracyjnych.

<!-- A tutaj konczy siê tresæ -->
</TD>
</TR>
</TABLE><TABLE cellpadding="3" cellspacing="0" style="border-width: 1pt; border-style: solid; border-collapse:collapse" bordercolor="#000000" width="100%" bgcolor="#CEBD9B">
<TR>
<TD width="50%">
<p><a href="lms-mgc.html">&lt;&lt; Poprzednia</a><br><br>
<a href="index.html#autorzy">&copy; 2001-2003 LMS Developers<br></A></p>
</TD>
<TD width="50%">
<p align="right">
Nastêpna &gt;&gt;<br><br>
<b>LMS 1.0</b>
</p>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>