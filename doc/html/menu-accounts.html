<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Konta</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.5-cvs"
HREF="index.html"><LINK
REL="UP"
TITLE="Interfejs U¿ytkownika (LMS-UI)"
HREF="user.html"><LINK
REL="PREVIOUS"
TITLE="Taryfy i Finanse"
HREF="menu-finances.html"><LINK
REL="NEXT"
TITLE="Mailing"
HREF="menu-mailing.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-2"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.5-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="menu-finances.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Rozdzia&#322; 3. Interfejs U¿ytkownika (LMS-UI)</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="menu-mailing.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="MENU-ACCOUNTS"
>3.8. Konta</A
></H1
><P
>Zarz±dzanie kontami ró¿nych us³ug na serwerze jest teraz
	mo¿liwe. Funkcjonalno¶æ ta jest przeznaczona dla zaawansowanych 
	administratorów. Wymaga znajomo¶ci tych us³ug i ich konfiguracji
	w celu korzystania z bazy danych.</P
><P
>W LMSie mo¿na utworzyæ cztery rodzaje kont: shell (1), poczta (2),
	www (4), ftp (8). W nawiasach podano numeryczne wewnêtrzne oznaczenie
	typu konta w bazie. Konta mog± byæ wielotypowe. Przyk³adowo, je¶li 
	zdefiniujesz konto shell+poczta+ftp w bazie zostanie zapisana cyfra 11.
	Oznacza to, ¿e do rozpoznawania typu konta w warunkach WHERE zapytañ
	SQL nale¿y stosowaæ sumowanie binarne (jak na przyk³adach w dalszej
	czê¶ci rozdzia³u).</P
><P
>Masz tak¿e mo¿liwo¶æ definiowania domen i aliasów.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-ACCOUNTS"
>3.8.1. Konta</A
></H2
><P
>Na li¶cie przedstawione s± podstawowe informacje o kontach.
	    Mo¿liwe jest dowolne sortowanie listy poprzez klikniêcie nazwy
	    kolumny oraz filtrowanie wg zadanych kryteriów. Przej¶cie do edycji 
	    danych konta nastêpuje po wybraniu ikony [Edytuj]. Administrator ma 
	    tak¿e prawo do zmiany has³a.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-NEW"
>3.8.2. Nowe konto</A
></H2
><P
>Definiuj±c dane konto musisz podaæ login, has³o i
	    wybraæ typ konta oraz przypisaæ u¿ytkownika (lub utworzyæ tzw. konto
	    systemowe). Nazwa domeny jest wymagana tylko dla kont mailowych. Data 
	    wa¿no¶ci konta jest opcjonalna. Pozostawienie pustego pola z dat± 
	    oznacza, ¿e konto nigdy nie wygasa.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-ALIASES"
>3.8.3. Aliasy</A
></H2
><P
>Konta (g³ównie mailowe) mog± posiadaæ dowoln± ilo¶æ aliasów.
	    Administrator serwera pocztowego mo¿e przekierowaæ (lokalnie) pocztê
	    z wszystkich aliasów do jednego kota. Na li¶cie aliasów przedstawione 
	    s± podstawowe informacje o nich i o kontach na które aliasy te wskazuj±.
	    Mo¿liwe jest dowolne sortowanie listy poprzez klikniêcie nazwy
	    kolumny oraz filtrowanie wg zadanych kryteriów. Nie ma mo¿liwo¶ci
	    edycji aliasu, nale¿y go usun±æ i utworzyæ nowy. Dodawanie nowego
	    aliasu nastêpuje poprzez formularz na dole listy.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-DOMAINS"
>3.8.4. Domeny</A
></H2
><P
>Na li¶cie przedstawione s± podstawowe informacje o zdefiniowanych
	    domenach. Mo¿liwe jest dowolne sortowanie listy poprzez klikniêcie nazwy
	    kolumny. Mo¿liwa jest edycja danych domeny po wybraniu ikony [Edytuj].
	    Do utworzenia nowej domeny s³u¿y formularz na dole listy.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-EXAMPLES"
>3.8.5. Przyk³ady</A
></H2
><P
>Poni¿szy listing zawiera istotne fragmenty pliku konfiguracyjnego
	    demona proftpd (w wersji 1.2.10) umo¿liwiaj±cy przechowywanie danych
	    o kontach ftp w bazie LMSa. Przyk³ad zawiera konfiguracjê dla bazy
	    danych PostgreSQL, w komentarzach podano rozwi±zania dla MySQLa:
	    <DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E1"
></A
><P
><B
>Przyk&#322;ad 3-1. Konta. Konfiguracja proftpd.</B
></P
><PRE
CLASS="SCREEN"
>  ServerName	"LMS FTP Server"
  
  #nazwa_bazy@host:port u¿ytkownik has³o
  SQLConnectInfo lms@localhost:5432 lms mypassword
  
  SQLAuthTypes Crypt Plaintext
  SQLUserInfo passwd login password uid NULL home NULL
  RequireValidShell off
  SQLAuthenticate users
  
  # utworzenie katalogu domowego gdy nie istnieje
  SQLHomedirOnDemand on
  
  # komunikat przy logowaniu
  SQLShowInfo PASS "230" "Last login: %{getlastlogin}"
  SQLLog PASS setlastlogin
  
  # SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE FROM_UNIXTIME(lastlogin) END FROM passwd WHERE login='%u'"
  # SQLNamedQuery setlastlogin UPDATE "lastlogin=UNIX_TIMESTAMP() WHERE login='%u'" passwd 
  SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE lastlogin::abstime::timestamp::text END FROM passwd WHERE login='%u'"
  SQLNamedQuery setlastlogin UPDATE "lastlogin=EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)) WHERE login='%u'" passwd
  
  # Sprawdzamy datê wa¿no¶ci konta oraz ograniczamy szukanie do kont ftp
  # SQLUserWhereClause "type &#38; 8 = 8 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())"
  SQLUserWhereClause "type &#38; 8 = 8 AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))"</PRE
></DIV
></P
><P
>W kolejnym przyk³adzie przedstawimy jak skonfigurowaæ serwer
	    Postfix 2.1.1 oraz Cyrus-SASL 2.1.19, Courier-IMAP/POP3 3.0.4, aby korzysta³y
	    z bazy danych LMSa. LMS'owe konta bêd± kontami wirtualnymi, a poczta
	    przechowywana bêdzie w formacie Maildir.</P
><P
>Poniewa¿ has³a w LMS'ie s± szyfrowane, wymagane jest zainstalowanie
	    SASL'a z ³at± pozwalaj±c± na to. W komentarzach podano warto¶ci opcji
	    charakterystycznych dla bazy MySQL. Listing zawiera tylko opcje bezpo¶rednio
	    zwi±zane z baz± danych:
	    <DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E2"
></A
><P
><B
>Przyk&#322;ad 3-2. Konta. Konfiguracja serwera pocztowego (postfix+sasl+courier).</B
></P
><PRE
CLASS="SCREEN"
># Plik smtpd.conf (Cyrus-SASL):

pwcheck_method: auxprop
#sql_engine: mysql
sql_engine: pgsql
sql_user: lms
sql_passwd: has³o
sql_hostnames: localhost
sql_database: lms
#sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
#       AND login='%u' AND domains.name ='%r' AND type &#38; 2 = 2 
#	AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
	AND login='%u' AND domains.name ='%r' AND type &#38; 2 = 2 
	AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))
password_format: crypt
mech_list: login plain

# authpgsqlrc (lub authmysqlrc) (Courier):

#MYSQL_PORT		3306
PGSQL_PORT		5432
#MYSQL_USERNAME		lms
PGSQL_USERNAME		lms
#MYSQL_PASSWORD		has³o
PGSQL_PASSWORD		has³o
#MYSQL_DATABASE		lms
PGSQL_DATABASE		lms
#MYSQL_SELECT_CLAUSE SELECT login, \
#       password, '', 104, 104, '/var/spool/mail/virtual', \
#       CONCAT(login,'/'), '', login, '' \
#       FROM passwd, domains WHERE domainid = domains.id 
#       AND login = '$(local_part)' AND domains.name = '$(domain)' \
#       AND type &#38; 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
PGSQL_SELECT_CLAUSE SELECT login, \
        password, '', 104, 104, '/var/spool/mail/virtual', \
        login ||'/', '', login, '' \
        FROM passwd, domains WHERE domainid = domains.id 
        AND login = '$(local_part)' AND domains.name = '$(domain)' \
        AND type &#38; 2 = 2 \
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# main.cf (Postfix):

virtual_mailbox_base = /var/spool/mail/virtual
virtual_mailbox_domains = pgsql:/etc/postfix/pgsql_virtual_domains_maps.cf
virtual_mailbox_maps = pgsql:/etc/postfix/pgsql_virtual_mailbox_maps.cf
virtual_alias_maps = pgsql:/etc/postfix/pgsql_virtual_alias_maps.cf

# pgsql_virtual_domains_maps.cf (Postfix):

user = lms
password = has³o
hosts = localhost
dbname = lms
query = SELECT name FROM domains WHERE name = '%s'

# pgsql_virtual_mailbox_maps.cf (Postfix):

user = lms
password = has³o
hosts = localhost
dbname = lms
#query = SELECT CONCAT(login,'/') FROM passwd, domains WHERE domainid = domains.id
#       AND login = '%u' AND domains.name = '%d' 
#       AND type &#38; 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
query = SELECT login || '/' FROM passwd, domains WHERE domainid = domains.id
        AND login = '%u' AND domains.name = '%d' 
        AND type &#38; 2 = 2 
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# pgsql_virtual_alias_maps.cf (Postfix):

user = lms
password = has³o
hosts = localhost
dbname = lms
#query = SELECT CONCAT(passwd.login,'@',domains.name) FROM passwd, domains, aliases 
#       WHERE passwd.domainid = domains.id AND passwd.id = aliases.accountid
#       AND aliases.login = '%u' AND domains.name = '%d' 
query = SELECT passwd.login || '@' || domains.name FROM passwd, domains, aliases 
        WHERE passwd.domainid = domains.id AND passwd.id = aliases.accountid
        AND aliases.login = '%u' AND domains.name = '%d' </PRE
></DIV
></P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="menu-finances.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="menu-mailing.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Taryfy i Finanse</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="user.html"
ACCESSKEY="U"
>Pocz&#261;tek rozdzia&#322;u</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Mailing</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>