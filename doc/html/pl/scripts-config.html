<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Opis i konfiguracja</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.6-cvs"
HREF="index.html"><LINK
REL="UP"
TITLE="Skrypty"
HREF="scripts.html"><LINK
REL="PREVIOUS"
TITLE="Lista dostêpnych skryptów"
HREF="scripts-list.html"><LINK
REL="NEXT"
TITLE="Generator plików konfiguracyjnych (lms-mgc)"
HREF="mgc.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-2"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.6-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="scripts-list.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Rozdzia&#322; 4. Skrypty</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="mgc.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SCRIPTS-CONFIG"
>4.3. Opis i konfiguracja</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-NOTIFY"
>4.3.1. lms-notify</A
></H2
><P
>lms-notify jest dobrym sposobem przypominania ludziom o tym ¿e do pracy sieci 
	  i ³±cz konieczne s± ich pieni±¿ki. Pozwala on na napisanie kilku[-nastu] plików tekstowych 
	  (w iso-8859-2) i traktowania ich jako szablonów do mailingu.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LMS-NOTIFY-TEMPLATES"
>4.3.1.1. Szablony</A
></H3
><P
>W szablonach mo¿na u¿ywaæ nastêpuj±cych zmiennych:</P
><UL
><LI
><P
>%date-m - zostanie zast±pione aktualnym miesi±cem, licz±c od 1 poprzedzone 0, np. 02</P
></LI
><LI
><P
>%date-y - zostanie zast±pione aktualnym rokiem, np. 2003</P
></LI
><LI
><P
>%date_month_name - zostanie zast±pione nazw± bie¿±cego miesi±ca, np. marzec</P
></LI
><LI
><P
>%saldo - zostanie zast±pione aktualnym saldem klienta, np. 535</P
></LI
><LI
><P
>%abonament - zostanie zast±pione kwot± abonamentu jaka jest do danego klienta przypisana, np. 107</P
></LI
><LI
><P
>%b - saldo z zanegowanym znakiem, np. 107</P
></LI
><LI
><P
>%B - saldo z prawdziwym znakiem, np. -107</P
></LI
><LI
><P
>%last_10_in_a_table - wyci±g ostatnich 10 operacji kasowych na koncie klienta, np:</P
></LI
><LI
><P
>%pin - numer PIN klienta.</P
></LI
><LI
><P
>%phone1 - pierwszy numer telefonu klienta.</P
></LI
></UL
><DIV
CLASS="EXAMPLE"
><A
NAME="NOTIFY-EXAMPLE"
></A
><P
><B
>Przyk&#322;ad 4-1. Lms-notify: Przyk³adowy wyci±g 10 ostatnich operacji kasowych</B
></P
><PRE
CLASS="SCREEN"
>-----------+------------------------------------------------------+---------
2003-02-02 | Abonament za miesi±c 2003/02                         |  107.00
2003-02-01 | Wp³ata                                               | -107.00
2003-02-01 | Abonament za miesi±c 2003/02                         |  107.00
2003-02-01 | Wp³ata                                               | -321.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
-----------+------------------------------------------------------+---------</PRE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="NOTIFY-TEMPLATE"
></A
><P
><B
>Przyk&#322;ad 4-2. Lms-notify: Przyk³ad szablonu</B
></P
><PRE
CLASS="SCREEN"
>UWAGA! Ta wiadomo¶æ zosta³a wygenerowana automatycznie.

Uprzejmie informujemy i¿ na Pani/Pana koncie figuruje zaleg³o¶æ w op³atach za
internet w wysoko¶ci %B z³.

Je¿eli porozumieli siê ju¿ Pañstwo z administratorami w kwestii op³aty za
bie¿±cy miesi±c czyli %date-m %date-y roku, prosimy o
zignorowanie tej wiadomo¶ci.

W wypadku gdy uwa¿aj± Pañstwo i¿ zaleg³o¶æ ta jest nieporozumieniem prosimy o
jak najszybszy kontakt.

Wszelkie informacje na temat Pañstwa rozliczeñ mog± Pañstwo znale¼æ pod
adresem http://www.naszasiec.pl/mojekonto/

Je¿eli chcieliby Pañstwo uregulowaæ zaleg³o¶ci prosimy o kontakt:

Dzia³ Rozliczeñ ASK NaszaSiec

Gerwazy Regu³a
telefon: 0-509031337
e-mail: gerwazy@staff.naszasiec.pl

Gwidon Mniejwa¿ny
telefon: 0-606666666
e-mail: gwidonm@naszasiec.pl

ps. za³±czamy ostatnie 10 operacji jakie zosta³o zarejestrowane przez nasz
system bilingowy na Pañstwa koncie:

Data       | Opis                                                 | Warto¶æ
%last_10_in_a_table

--
Amatorska Sieæ Komputerowa NaszaSiec
http://www.naszasiec.pl/</PRE
></DIV
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LMS-NOTIFY-CONFIG"
>4.3.1.2. Konfiguracja</A
></H3
><P
>Konfiguracjê dla lms-notify mo¿na ustaliæ w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
> w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[notify]</I
></SPAN
>. 
	   Mo¿esz tam ustawiæ nastêpuj±ce parametry:</P
><UL
><LI
><P
>limit (opcjonalny)</P
><P
>Pozwala na ustalenie limitu bilansu, poni¿ej którego do klienta zostanie wys³any e-mail z upomnieniem. Domy¶lnie limit = 0</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>mailsubject (wymagany)</P
><P
>Pozwala na ustalenie tematu e-maila wysy³anego do klienta. Mo¿na u¿ywaæ podstawieñ znanych z szablonów (%B, %b, %date-y, %date-m, %last_10_in_a_table). Domy¶lnie: nie ustawione.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailsubject = Informacje o zaleg³o¶ciach w op³atach za internet</SAMP
></P
></LI
><LI
><P
>mailtemplate (wymagany)</P
><P
>Pozwala na wskazanie szablonu wiadomo¶ci, która zostanie wys³ana do klienta. Wiêcej o szablonach tutaj. Domy¶lnie: nie ustawione.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailtemplate = /etc/lms/notifytemplate.txt</SAMP
></P
></LI
><LI
><P
>mailfrom</P
><P
>Adres e-mail z którego zostanie wys³any e-mail. Proszê pamiêtaæ, ¿e na niektórych MTA (np. exim) konto to musi istnieæ w systemie. Domy¶lnie nieustawione</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailfrom = staff@domain.pl</SAMP
></P
></LI
><LI
><P
>mailfname</P
><P
>Nazwa nadawcy maila</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailfname = Administratorzy</SAMP
></P
></LI
><LI
><P
>smtp_server</P
><P
>Serwer SMTP, przez który ma zostaæ wys³ana wiadomo¶æ. Domy¶lnie: 127.0.0.1</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>smtp_server = smtp.mydomain.pl</SAMP
></P
></LI
><LI
><P
>debug_email (opcjonalny)</P
><P
>Adres e-mail do debugowania. Gdy ustawiony, ca³a poczta zostaje wys³ana na dany email zamiast do klientów. Przydatne do debugowania i sprawdzania czy wszystko dzia³a OK. Domy¶lnie: nie ustawiony.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>debug_email = lexx@domain.pl</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-NOTIFY-SMS"
>4.3.2. lms-notify-sms</A
></H2
><P
>lms-notify-sms to odpowiednik lms-notify, s³u¿±cy do wysy³ania
	  smsów. Do wysy³ania wiadomo¶ci potrzebna jest komórka Nokii oraz oprogramowanie,
	  które nale¿y pobraæ z (<A
HREF="http://www.gnokii.org"
TARGET="_top"
>www.gnokii.org</A
>)
	  i zainstalowaæ w systemie.</P
><P
>Konfiguracjê dla lms-notify-sms mo¿na ustaliæ w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
> 
	  w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[notify-sms]</I
></SPAN
>, a masz do dyspozycji nastêpuj±ce opcje:</P
><UL
><LI
><P
>limit (opcjonalny)</P
><P
>Pozwala na ustalenie limitu bilansu poni¿ej którego do klienta 
	     zostanie wys³any sms z upomnieniem. Domy¶lnie: 0</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>smstemplate (wymagany)</P
><P
>Szablon wiadomo¶ci. Domy¶lnie: nie ustawione.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>smstemplate = /etc/lms/smstemplate.txt</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-CUTOFF"
>4.3.3. lms-cutoff</A
></H2
><P
>Skrypt pozwala na od³±czenie (a raczej zmianê w bazie danych stanu komputerów na wy³±czony) klientów których bilans jest poni¿ej zadanej warto¶ci. W³a¶ciwe od³±czanie powinno byæ realizowane przez generator plików konfiguracyjnych.</P
><P
>Konfiguracjê dla lms-cutoff mo¿emy ustaliæ w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
> w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[cutoff]</I
></SPAN
>. Mo¿emy tam ustawiæ nastêpuj±ce parametry:</P
><UL
><LI
><P
>limit (opcjonalny)</P
><P
>Pozwala na ustalenie limitu bilansu poni¿ej którego do bazy danych zostanie zapisany stan od³±czony. Domy¶lnie: 0</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>message (optional)</P
><P
>Je¶li nie jest pusta, wiadomo¶æ ta po od³aczeniu u¿ytkownika zostanie 
	   zapisana do jego rekordu w polu wiadomo¶ci administracyjnej. W tre¶ci wiadomo¶ci
	   mo¿na u¿yæ zmiennej %now, która zostanie zamieniona na bie¿±c± datê.
	   Domy¶lnie: 'Automatic cutoff caused by exceeding of liabilities limit on %now'</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>message = ''</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-PAYMENTS"
>4.3.4. lms-payments</A
></H2
><P
>Skrypt s³u¿±cy do naliczania op³at abonamentowych przypisanych
	 klientom oraz op³at sta³ych. Ponadto zapisuje dane do faktur.
	 Aby dzia³a³ poprawnie powinien byæ uruchamiany codziennie.</P
><P
>Skrypt ten udostêpnia trzy opcje do fakturowania, które mo¿na ustawiæ
	 w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[payments]</I
></SPAN
> pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>:
	  <UL
><LI
><P
>deadline (opcjonalny)</P
><P
>Pozwala na ustalenie terminu p³atno¶ci w dniach. Domy¶lnie: 14</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>deadline = 7</SAMP
></P
></LI
><LI
><P
>paytype (opcjonalny)</P
><P
>Okre¶la rodzaj p³atno¶ci. Domy¶lnie: 'TRANSFER'</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>paytype = 'PRZELEW'</SAMP
></P
></LI
><LI
><P
>comment (opcjonalny)</P
><P
>Opis pozycji na fakturze za naliczane zobowi±zanie</P
><P
>Domy¶lnie: 'Tariff %tariff subscription for period %period'</P
><P
>Niektóre ze s³ów kluczowych s± zastêpowane:</P
><P
>%tariff - nazwa taryfy</P
><P
>%period - okres (liczony od dzi¶ do ostatniego dnia cyklu rozliczeniowego, w formacie YYYY/MM/DD)</P
><P
>%%current_month - okres od pierwszego dnia bie¿±cego miesi±ca do jego koñca</P
><P
>%desc - opis taryfy</P
><P
>Przyk³ad:       <SAMP
CLASS="PROMPT"
>paytype = 'Abonament za %current_month w/g taryfy %tariff'</SAMP
></P
></LI
><LI
><P
>suspension_description (opcjonalny)</P
><P
>Tekst dodawany na koñcu opisu operacji dla obci±¿eñ zawieszonych. 
	   Domy¶lnie: ''</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>suspension_description = (zawieszenie)</SAMP
></P
></LI
></UL
>
	 </P
><P
>Ponadto mamy do dyspozycji jeden przydatny parametr wiersza poleceñ
	 <SAMP
CLASS="PROMPT"
>--fakedate</SAMP
> (<SAMP
CLASS="PROMPT"
>-f</SAMP
>). Przy jego u¿yciu mo¿na 
	 sprawiæ, aby skrypt dzia³a³ z podmienion± dat± systemow± (w formacie YYYY/MM/DD),
	 na przyk³ad <SAMP
CLASS="PROMPT"
>--fakedate=2004/10/10</SAMP
>.
	 </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-TRAFFIC"
>4.3.5. lms-traffic</A
></H2
><P
>Skrypt s³u¿y do logowania informacji o ilo¶ci danych pobranych i wys³anych
	przez ka¿dy komputer w sieci lokalnej. W bazie danych zapisywana jest ilo¶æ
	danych w bajtach, numer komputera z bazy lms i znacznik czasu. 
	Od klienta zale¿y w jakich odstêpach dane bêd± odczytywane.
	Poniewa¿ dane odczytywane s± z pliku utworzonego przez klienta, nie ma
	znaczenia z jakiego ¼ród³a pochodz±, mo¿e to byæ iptables, ipchains lub
	program zewnêtrzny np. ipfm.
    </P
><P
>Przegl±danie wykresów wykorzystania ³±cza oraz definiowanie filtrów
	dostêpne jest z g³ównego menu 'Statystyki'.
    </P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LMS-TRAFFIC-CONFIG"
>4.3.5.1. Instalacja</A
></H3
><P
>Przed uruchomieniem lms-traffic nale¿y zadbaæ o utworzenie
	    pliku z danymi. Zawarto¶æ pliku powinna mieæ nastêpuj±cy format:</P
><PRE
CLASS="SCREEN"
>&lt;adres IP&gt; &lt;n_spacji&gt; &lt;upload&gt; &lt;n_spacji&gt; &lt;download&gt;
&lt;adres IP&gt; &lt;n_spacji&gt; &lt;upload&gt; &lt;n_spacji&gt; &lt;download&gt;
...</PRE
><P
>Skrypt tworz±cy statystyki nale¿y uruchamiaæ z tak± sam± czêstotliwo¶ci± 
	    co lms-traffic.</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Notatka"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Przyk³ad takiego skryptu dla iptables znajduje siê w 
	    pliku <TT
CLASS="FILENAME"
>/sample/traffic_ipt.pl</TT
>.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Nastêpnie instalujemy skrypt dopisuj±c do crontaba.
	    Oprócz standardowych opcji wiersza poleceñ mo¿liwe jest
	    zdefiniowanie lokalizacji pliku z logiem</P
><PRE
CLASS="SCREEN"
>-f=/plik 	po³o¿enie i nazwa pliku ze statystykami domy¶lnie /var/log/traffic.log</PRE
><P
>	    <DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Ostrze&#380;enie"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Czêstotliwo¶æ zapisywania danych do bazy ustala klient. Ustawienie
	    jej poni¿ej 10 minut, mo¿e spowodowaæ szybki przyrost ilo¶ci rekordów w 
	    bazie danych, a co za tym idzie zwiêkszyæ czas oczekiwania na wy¶wietlenie
	    wyników.</P
></TD
></TR
></TABLE
></DIV
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-TRAFFIC-LOGIPTABLES"
>4.3.6. lms-traffic-logiptables</A
></H2
><P
>Skrypt s³u¿y do logowania informacji o ilo¶ci danych pobranych i wys³anych
	przez ka¿dy komputer z sieci lokalnej, na podstawie liczników iptables. Dane 
	sczytuje z firewalla, tworz±c jednocze¶nie odpowiednie regu³y. Zatem, nie jest 
	konieczne rêczne tworzenie regu³ iptables, ani wywo³ywanie skryptu  
	<TT
CLASS="FILENAME"
>lms-traffic</TT
>.
	</P
><P
>Konfiguracjê nale¿y umie¶ciæ w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[traffic-logiptables]</I
></SPAN
>:
	    <UL
><LI
><P
>outfile</P
><P
>Lokalizacja skryptu z regu³ami iptables. Domy¶lnie: /etc/rc.d/rc.stat</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>outfile = /etc/rc.d/rc.stat</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Lokalizacja programu iptables. Domy¶lnie: /usr/sbin/iptables</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>wan_interfaces</P
><P
>Nazwy interfejsów, na których dane maj± byæ zliczane. Domy¶lnie: niezdefiniowane.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>wan_interfaces = eth0</SAMP
></P
></LI
><LI
><P
>local_ports</P
><P
>Lista portów (¼ród³owych i docelowych) dla zliczanych pakietów. Domy¶lnie: niezdefiniowane.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>local_ports = 80</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID w³a¶ciciela skryptu okre¶lonego w 'outfile'. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID w³a¶ciciela skryptu okre¶lonego w 'outfile'. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Uprawnienia skryptu okre¶lonego w 'outfile'. Domy¶lnie: 700 (rwx------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
></UL
>
	</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEDHCPCONF"
>4.3.7. lms-makedhcpconf</A
></H2
><P
>Tworzenie pliku konfiguracyjnego serwera DHCP - dhcpd.conf. Konfiguracjê
	skryptu umieszcza siê w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[dhcp]</I
></SPAN
>:
	    <UL
><LI
><P
>config_file</P
><P
>Lokalizacja pliku wynikowego. Domy¶lnie: /etc/dhcpd.conf</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_file = /tmp/dhcpd.conf</SAMP
></P
></LI
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony konfig dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>Lista nazw grup (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony konfig dla wszystkich grup.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>usergroups = grupa1 grupa2</SAMP
></P
></LI
><LI
><P
>default_lease_time</P
><P
>Domy¶lny czas dzier¿awy. Domy¶lnie: 86400.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>default_lease_time = 43200</SAMP
></P
></LI
><LI
><P
>max_lease_time</P
><P
>Maksymalny czas dzier¿awy. Domy¶lnie: 86400.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>max_lease_time = 43200</SAMP
></P
></LI
><LI
><P
>ignore_ddns</P
><P
>Nie generuj wpisu 'ddns-update-style none;' na pocz±tku pliku.
		    Przydatne przy starszych (2.2) wersjach demona dhcpd. Domy¶lnie: wy³±czone.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>ignore_ddns = 1</SAMP
></P
></LI
><LI
><P
>log_facility</P
><P
>Ustawienie trybu logowania daemona dhcp. Je¿eli puste to tryb domy¶lny.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>log_facility = 7</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID w³a¶ciciela skryptu okre¶lonego w 'config_file'. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID w³a¶ciciela skryptu okre¶lonego w 'config_file'. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Uprawnienia skryptu okre¶lonego w 'config_file'. Domy¶lnie: 600 (rwx------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
></UL
>
	</P
><P
>Mo¿esz podaæ czasy dzier¿awy dla konkretnych sieci poprzez stworzenie
	sekcji <SAMP
CLASS="PROMPT"
>[dhcp:nazwasieci]</SAMP
> np.:
<PRE
CLASS="SCREEN"
>[dhcp:public-custa] # nazwa sieci ma³ymi literami!
default_lease_time = 3600
max_lease_time     = 3600</PRE
>

Mo¿esz podaæ gateway, serwer dns, nazwê domeny i wins dla konkretnego
hosta poprzez stworzenie sekcji <SAMP
CLASS="PROMPT"
>[dhcp:adresip]</SAMP
> np.:
<PRE
CLASS="SCREEN"
>[dhcp:213.25.209.216]
domain  = anotherdomain.pl
gateway = 213.25.209.251
dns     = 213.25.209.8
wins    = 213.25.209.10</PRE
>
	</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEIPTABLES"
>4.3.8. lms-makeiptables, lms-makeipchains</A
></H2
><P
>Para skryptów s³u¿±cych do generowania plików zawieraj±cych
	    regu³y firewalla. Do utworzonego pliku mo¿esz do³±czyæ inne wcze¶niej
	    utworzone pliki, a w koñcu nadaæ mu odpowiednie uprawnienia. Skrypty nie
	    uruchamiaj± wygenerowanych plików.</P
><P
>Konfiguracjê dla tych skryptów mo¿esz ustaliæ w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
> w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[iptables]</I
></SPAN
>
	    (i odpowiednio <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[ipchains]</I
></SPAN
>). Oba skrypty posiadaj± te same
	    opcje: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku firewalla. Je¶li nie ustawiono, zostanie stworzony konfig dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>iptables_binary (ipchains_binary)</P
><P
>Lokalizacja programu iptables (ipchains). Domy¶lnie: /usr/sbin/iptables (/usr/sbin/ipchains)</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>script_file</P
><P
>Plik, do którego zapisujemy regu³y firwalla. Domy¶lnie: /etc/rc.d/rc.masq</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_file = /etc/rc.d/rc.firewall</SAMP
></P
></LI
><LI
><P
>pre_script</P
><P
>Plik wykonywany PO wyczyszczeniu regu³ek, ale PRZED ustawieniem nowych. 
		    Domy¶lnie: niezdefiniowany.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>pre_script = /etc/rc.d/rc.masq-pre</SAMP
></P
></LI
><LI
><P
>post_script</P
><P
>Plik wykonywany PO ustawieniu regu³ek. Domy¶lnie: niezdefiniowany.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>post_script = /etc/rc.d/rc.masq-post</SAMP
></P
></LI
><LI
><P
>forward_to</P
><P
>Lista sieci, dla których w³±czamy forwarding. Mo¿liwe warto¶ci: "" - pe³ny forward, 
		    "dowolny ci±g" - wy³±cz forward, "siec1 siec2" - lista sieci z w³±czonym forwardingiem.  
		    Domy¶lnie: pe³ny forward.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>forward_to = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
><LI
><P
>snat_address</P
><P
>Adres SNAT. Je¶li nie ustawiono, dla hostów z adresami publicznymi bêdzie
		    u¿yte "-j MASQUERADE". Je¶li ustawiono zostanie u¿yte "-j SNAT --to xxx.xxx.xxx.xxx".
		    Dotyczy lms-makeiptables. Domy¶lnie: nie ustawiony.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>snat_address = 123.123.123.123</SAMP
></P
></LI
><LI
><P
>tcp_redirect_ports (udp_redirect_ports)</P
><P
>Konfiguracja przekierowañ w formie port_¼ród³owy:port_docelowy dla
		    przekierowañ na lokaln± maszynê dla po³±czeñ wychodz±cych. Dotyczy lms-makeipchains.
		    Domy¶lnie: nie ustawione.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>tcp_redirect_ports = 80:3128 25:25</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-ETHERDESC"
>4.3.9. lms-etherdesc</A
></H2
><P
>Skrypt s³u¿±cy do generowania pliku zawieraj±cego MAC adresy oraz
	    nazwy hostów pobierane z bazy lms'a. Adresy zapisywane s± w formacie 'stripped mac',
	    czyli bez ":". Tego typu plik wykorzystywany jest przez pakiet <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>iptraf</I
></SPAN
>.
	    </P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[ethers]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony konfig dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>etherdesc_owneruid</P
><P
>UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>etherdesc_owneruid = 0</SAMP
></P
></LI
><LI
><P
>etherdesc_file</P
><P
>Lokalizacja pliku. Domy¶lnie: /var/lib/iptraf/ethernet.desc.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>etherdesc_file = /etc/ethernet.desc</SAMP
></P
></LI
><LI
><P
>etherdesc_ownergid</P
><P
>GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>etherdesc_ownergid = 0</SAMP
></P
></LI
><LI
><P
>etherdesc_permission</P
><P
>Uprawnienia pliku skryptu. Domy¶lnie: 600 (rw-------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>etherdesc_permission = 600</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-SENDINVOICES"
>4.3.10. lms-sendinvoices</A
></H2
><P
>Skrypt s³u¿y do wysy³ania poczt± elektroniczn± faktur, jako za³±czników
	do wiadomo¶ci. Faktury generowane s± na podstawie szablonu dostêpnego w lms-ui,
	dlatego wymagane jest podanie klienta i has³a do interfejsu www lms-ui.</P
><P
>W odró¿nieniu od pozosta³ych skrytpów ten wymaga dodatkowych modu³ów perla:
	LWP::UserAgent, MIME::Entity.</P
><P
>Konfiguracjê nale¿y umie¶ciæ w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[sendinvoices]</I
></SPAN
>:
	    <UL
><LI
><P
>lms_url</P
><P
>Adres do lms-ui. Domy¶lnie: http://localhost/lms/</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>lms_url = http://lms.mynet.pl</SAMP
></P
></LI
><LI
><P
>lms_user</P
><P
>Login u¿ytkownika. Domy¶lnie: pusty</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>lms_user = admin</SAMP
></P
></LI
><LI
><P
>lms_password</P
><P
>Has³o do lms-ui. Domy¶lnie: puste</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>lms_password = moje_has³o</SAMP
></P
></LI
><LI
><P
>debug_email</P
><P
>Konto pocztowe do testów. Domy¶lnie: niezdefiniowane.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>debug_email = admin@mynet.pl</SAMP
></P
></LI
><LI
><P
>sender_name</P
><P
>Nadawca listu. Domy¶lnie: niezdefiniowany.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>sender_name = ASK MyNet</SAMP
></P
></LI
><LI
><P
>sender_email</P
><P
>Adres nadawcy listu. Domy¶lnie: niezdefiniowany.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>sender_email = admin@mynet.pl</SAMP
></P
></LI
><LI
><P
>mail_subject</P
><P
>Temat wiadomo¶ci. Mo¿na u¿yæ zmiennej %invoice zastêpowanej numerem faktury. 
		    Domy¶lnie: 'Invoice No. %invoice'.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mail_subject = 'Nowa faktura'</SAMP
></P
></LI
><LI
><P
>mail_body</P
><P
>Tre¶æ wiadomo¶ci. Mo¿na u¿yæ zmiennej %invoice, która zostanie zast±piona numerem faktury. 
		    Domy¶lnie: 'Attached file with Invoice No. %invoice'.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mail_body = ''</SAMP
></P
></LI
></UL
>
	 Ponadto mamy do dyspozycji jeden przydatny parametr wiersza poleceñ
	 <SAMP
CLASS="PROMPT"
>--fakedate</SAMP
> (<SAMP
CLASS="PROMPT"
>-f</SAMP
>). Przy jego u¿yciu mo¿na 
	 sprawiæ, aby skrypt dzia³a³ z podmienion± dat± systemow± (w formacie YYYY/MM/DD),
	 na przyk³ad <SAMP
CLASS="PROMPT"
>--fakedate=2004/10/10</SAMP
>.
	 </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEMACS"
>4.3.11. lms-makemacs</A
></H2
><P
>Skrypt s³u¿±cy do generowania pliku zawieraj±cego regu³y netfiltra filtruj±ce ruch
	    klientów na bazie testu adresu ¼ród³owego MAC. Dla ka¿dego komputera generowana jest
	    jedna regu³a dla tablicy nat, zadanego ³añcucha, testuj±ca adres ¼ród³owy IP pakietu oraz adres
	    ¼ród³owy MAC ramki. Je¶li testy zakoñcz± siê pozytywnie nastêpuje powrót do ³añcucha nadrzêdnego
	    za pomoc± decyzji RETURN. Na koñcu listy regu³ dodawane s± 2 regu³y przekierowuj±ce ruch http
	    oraz webcache na podany w konfiguracji adres IP oraz port (z wykorzystaniem decyzji DNAT).
	    Przekierowanie mo¿e odbywaæ siê na wirtualny host www z zawiadomieniem klienta
	    o zaleg³o¶ciach finansowych bez mo¿liwo¶ci wy³±czenia zawiadomienia. Na koñcu dodawana jest 
	    regu³a blokuj±ca jakikolwiek inny ruch.
	    </P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[macs]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>Lista nazw grup klientów (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich grup klientów.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>usergroups = osiedle1 osiedle2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Lokalizacja programu iptables. Domy¶lnie: /sbin/iptables</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Lokalizacja pliku. Domy¶lnie: /etc/rc.d/rc.macs.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.macs</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>£añuch do którego bêd± dodawane generowane regu³y. Domy¶lnie: MACS.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>chain = TESTY_MACOW</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>Adres IP + port na który bêdzie przekierowywany niesklasyfikowany ruch http i webcache. Domy¶lnie: 127.0.0.1:80.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3000</SAMP
></P
></LI
><LI
><P
>lock_noaccess</P
><P
>Czy generowaæ regu³ki testuj±ce z decyzj± RETURN dla komputerów, które s± od³±czone. Domy¶lnie: 0 (regu³y s± generowane)</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>lock_noaccess = 1</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEHOSTS"
>4.3.12. lms-makehosts</A
></H2
><P
>Skrypt s³u¿±cy do generowania pliku /etc/hosts zawieraj±cego odwzorowania nazw komputerów
	    na adresy IP.
	    </P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[hosts]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>Lista nazw grup klientów (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich grup klientów.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>usergroups = osiedle1 osiedle2</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Lokalizacja pliku. Domy¶lnie: /etc/hosts.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_file = /etc/hosts</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Uprawnienia pliku skryptu. Domy¶lnie: 644 (rw-r--r--).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_permission = 600</SAMP
></P
></LI
><LI
><P
>config_header</P
><P
>Pierwsza linia w pliku /etc/hosts. Domy¶lnie: 127.0.0.1 localhost localhost.localdomain.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_header = 192.168.1.1 serwer serwer.nasza-siec</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEWARNINGS"
>4.3.13. lms-makewarnings</A
></H2
><P
>Skrypt s³u¿±cy do generowania pliku zawieraj±cego regu³y netfiltra przekierowuj±ce ruch http i webcache
	    klientów o saldzie mniejszym lub równym od zadanego na zadany adres IP i port (wykorzystywana
	    jest tablica nat, testy adresów ¼ród³owych IP oraz decyzja DNAT).
	    </P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[warnings]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>Lista nazw grup klientów (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich grup klientów.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>usergroups = osiedle1 osiedle2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Lokalizacja programu iptables. Domy¶lnie: /sbin/iptables</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Lokalizacja pliku. Domy¶lnie: /etc/rc.d/rc.warnings.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.warnings</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>£añuch do którego bêd± dodawane generowane regu³y. Domy¶lnie: WARNINGS.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>chain = OSTRZEZENIA</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>Adres IP + port na który bêdzie przekierowywany ruch http i webcache pochodz±cy z hostów dla których ma byæ w³±czone ostrze¿enie o zaleg³o¶ciach finansowych. Domy¶lnie: 127.0.0.1:80.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3001</SAMP
></P
></LI
><LI
><P
>limit</P
><P
>Saldo klienta przy którym dla wszystkich komputerów klienta generowane s± regu³ki przekierowuj±ce ruch. Domy¶lnie: 0 </P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>limit = -85</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEMESSAGES"
>4.3.14. lms-makemessages</A
></H2
><P
>Skrypt s³u¿±cy do generowania pliku zawieraj±cego regu³y netfiltra przekierowuj±ce ruch http i webcache
	    klientów dla których zosta³o w³±czone przekazywanie wiadomo¶ci administracyjnej (ostrze¿enia) na zadany adres IP i port (wykorzystywana
	    jest tablica nat, testy adresów ¼ród³owych IP oraz decyzja DNAT).
	    </P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[messages]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich sieci.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>Lista nazw grup klientów (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas generowania
		    pliku. Je¶li nie ustawiono, zostanie stworzony plik konfiguracyjny dla wszystkich grup klientów.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>usergroups = osiedle1 osiedle2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Lokalizacja programu iptables. Domy¶lnie: /sbin/iptables</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Lokalizacja pliku. Domy¶lnie: /etc/rc.d/rc.messages.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.messages</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>£añuch do którego bêd± dodawane generowane regu³y. Domy¶lnie: MESSAGES.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>chain = WIADOMOSCI</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>Adres IP + port na który bêdzie przekierowywany ruch http i webcache pochodz±cy z hostów dla których ma byæ w³±czona wiadomo¶æ administracyjna. Domy¶lnie: 127.0.0.1:80.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3002</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-FPING"
>4.3.15. lms-fping</A
></H2
><P
>Skrypt zapisuje do bazy informacje o aktywno¶ci komputerów. 
	    Do skanowania wykorzystywany jest szybki program fping (z opcjami -ar1). 
	    Najpierw tworzona jest lista hostów, a nastêpnie, po wywo³aniu fping'a, 
	    komputerom w³±czonym zostaje przypisana data i czas skanowania. Dziêki temu 
	    mamy w bazie informacje kiedy dany komputer by³ ostatnio w³±czony.</P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[fping]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>networks </P
><P
>Lista nazw sieci (oddzielonych spacjami), które maj± byæ uwzglêdnione podczas skanowania.
		    Je¶li nie ustawiono przeskanowane zostan± wszystkie komputery.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>fping_binary</P
><P
>Lokalizacja programu fping. Domy¶lnie: /usr/sbin/fping</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>fping_binary = /usr/local/sbin/fping</SAMP
></P
></LI
><LI
><P
>temp_file</P
><P
>Lokalizacja pliku tymczasowego na listê hostów, który
		    po wykonaniu skryptu zostaje usuniêty. Domy¶lnie: /tmp/fping_hosts.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>temp_file = /tmp/hosts</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-REMINDER"
>4.3.16. lms-reminder</A
></H2
><P
>Skrypt s³u¿y do przypominania klientom o zaplanowanych na dany dzieñ 
	  zadaniach. Lista zdarzeñ przypisanych w Terminarzu danemu klientowi w bie¿±cym
	  dniu zostaje wys³ana na jego adres e-mail.</P
><P
>Konfiguracjê dla lms-reminder umieszcza siê w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
> 
	  w sekcji <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[reminder]</I
></SPAN
>. Mo¿esz tam ustawiæ nastêpuj±ce parametry:</P
><UL
><LI
><P
>mailsubject (wymagany)</P
><P
>Pozwala na ustalenie tematu e-maila wysy³anego do klienta. Domy¶lnie: nie ustawione.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailsubject = 'Terminarz z LMSa'</SAMP
></P
></LI
><LI
><P
>mailfrom</P
><P
>Adres e-mail z którego zostanie wys³any e-mail. Proszê pamiêtaæ, ¿e na 
	     niektórych MTA (np. exim) konto to musi istnieæ w systemie. 
	     Domy¶lnie nieustawione.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailfrom = staff@domain.pl</SAMP
></P
></LI
><LI
><P
>mailfname</P
><P
>Nazwa nadawcy maila.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mailfname = LMS</SAMP
></P
></LI
><LI
><P
>smtp_server</P
><P
>Serwer SMTP, przez który ma zostaæ wys³ana wiadomo¶æ. Domy¶lnie: 127.0.0.1.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>smtp_server = smtp.mydomain.pl</SAMP
></P
></LI
><LI
><P
>debug_email (opcjonalny)</P
><P
>Adres e-mail do debugowania. Gdy ustawiony, ca³a poczta zostaje 
	     wys³ana na dany email zamiast do klientów. Przydatne do debugowania 
	     i sprawdzania czy wszystko dzia³a OK. Domy¶lnie: nie ustawiony.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>debug_email = alec@domain.pl</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-RTPARSER"
>4.3.17. lms-rtparser</A
></H2
><P
>Jest to tzw. backend dla systemu Helpdesk, czyli scrypt który wspó³pracuj±c
	    z serwerem pocztowym zapisuje do bazy danych wszystkie wiadomo¶ci skierowane na
	    adresy Helpdesk'a. Skrypt pobiera z wej¶cia wiadomo¶æ pocztow±, parsuje zawarto¶æ
	    i umieszcza zg³oszenie w kolejce, wysy³aj±c do zg³aszaj±cych
	    potwierdzenie przyjêcia wiadomo¶ci. W temacie potwierdzenia znajduje siê symbol
	    zg³oszenia. Podczas parsowania wiadomo¶ci nastêpuje, na 
	    podstawie tematu wiadomo¶ci, próba rozpoznania czy wiadomo¶æ nie jest odpowiedzi± na inn± wiadomo¶æ z ju¿
	    przypisanym numerem zg³oszenia. Od wiadomo¶ci zostaj± od³±czone za³±czniki
	    i umieszczone w katalogu zdefiniowanym w opcji <TT
CLASS="FILENAME"
>mail_dir</TT
>.</P
><P
>Oprócz modu³ów Perla standardowo wymaganych przez resztê skryptów, nale¿y 
	    zainstalowaæ tak¿e modu³y <TT
CLASS="FILENAME"
>MIME::Parser</TT
> i <TT
CLASS="FILENAME"
>MIME::Words</TT
> z 
	    pakietu MIME-Tools oraz <TT
CLASS="FILENAME"
>Net::SMTP</TT
> i <TT
CLASS="FILENAME"
>Text::Iconv</TT
>.</P
><P
>Skrypt mo¿na uruchamiaæ na wiele sposobów. Jednym z nich jest
	    stworzenie skryptu pow³oki, który odczytuj±c skrzynkê pocztow± wywo³a lms-rtparser
	    dla ka¿dego maila. Wygodniejszym zastosowaniem jest jednak zintegrowanie
	    go z serwerem pocztowym. Poni¿ej przedstawiono sposób pod³±czenia go do
	    postfixa przy u¿yciu opcji header_checks.
<PRE
CLASS="SCREEN"
># plik main.cf:
header_checks = regexp:/etc/postfix/header_checks

# plik header_checks
/^To:.*adres@domena.*/ FILTER filter:dummy

# plik master.cf:
filter unix - n n - 10 pipe
      -flags=Rq user=nobody argv=/path/to/lms-rtparser</PRE
>
	    Powy¿szy sposób dzia³a dla postfixa w wersjach nowszych od 2.0.
	    Wcze¶niejsze wersje nie obs³uguj± FILTER w header_checks. Z tym
	    problemem mo¿na sobie poradziæ u¿ywaj±c procmaila:
<PRE
CLASS="SCREEN"
># plik main.cf
mailbox_command = /usr/bin/procmail

# w katalogu domowym klienta, którego maile maj± byæ obs³ugiwane przez HelpDesk:
# plik .forward
"|IFS=' ' &#38;&#38; exec /usr/bin/procmail -f - || exit 75 #YOUR_USERNAME"

# plik .procmailrc
:0 c
   * ^To.*adres@domena
   | /bin/lms-rtparser

:0 A
$DEFAULT</PRE
></P
><P
>Kolejny listing to przyk³ad pod³±czenia parsera do Exima 
	    przy u¿yciu filtrów systemowych:
<PRE
CLASS="SCREEN"
># plik exim.conf

system_filter_pipe_transport = address_pipe

# plik system_filter.txt

if $recipients is "adres_kolejki@domena.pl"
then 
     pipe "/sciezka/do/lms-rtparser -q id_kolejki"
endif</PRE
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Notatka"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Je¿eli chcesz aby wiadomo¶ci wprowadzane poprzez <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lms-ui</I
></SPAN
>
	    by³y kierowane do parsera, zamiast bezpo¶rednio zapisywane do bazy, powiniene¶ w³±czyæ
	    opcjê konfiguracyjn± <TT
CLASS="FILENAME"
>helpdesk_backend_mode</TT
> w sekcji
	    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
>.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Konfiguracjê tego skryptu zawiera sekcja <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[rt]</I
></SPAN
>
	    w pliku <TT
CLASS="FILENAME"
>lms.ini</TT
>: </P
><UL
><LI
><P
>default_queue</P
><P
>Numer ID kolejki, do której trafi± zg³oszenia. Je¶li nie
		    podano, Kolejka zostanie odszukana na podstawie adresu odbiorcy maila.
		    Opcja ta mo¿e zostaæ nadpisana przy pomocy parametru -q przy
		    uruchomieniu skryptu. Domy¶lnie: niezdefiniowana.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>default_queue = </SAMP
></P
></LI
><LI
><P
>mail_from</P
><P
>Nadawca potwierdzenia (adres). Je¶li nie zdefiniowano, zostanie u¿yty adres
		    kolejki do której zapisano zg³oszenie. Domy¶lnie: pusty.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mail_from = rt@net.pl</SAMP
></P
></LI
><LI
><P
>mail_from_name</P
><P
>Nadawca potwierdzenia (nazwa). Domy¶lnie: niezdefiniowana.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mail_from_name = 'BOK SuperLAN'</SAMP
></P
></LI
><LI
><P
>autoreply_subject</P
><P
>Temat potwierdzenia. Tu mo¿na korzystaæ ze zmiannych %tid - 
		    identyfikator zg³oszenia i %subject - temat zg³oszenia.
		    Domy¶lnie: "[RT#%tid] Receipt of request '%subject'".</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>autoreply_subject = "[RT#%tid] Potwierdzenie odbioru zg³oszenia o temacie '%subject'"</SAMP
></P
></LI
><LI
><P
>autoreply_body</P
><P
>Tre¶æ potwierdzenia. Tu mo¿na korzystaæ ze zmiannych: %tid - 
		    identyfikator zg³oszenia i %subject - temat zg³oszenia.
		    Domy¶lnie: "Your request was registered in our system.\nTo this request was assigned ticket identifier RT#%tid.\nPlease, place string [RT#%tid] in subject field of any\nmail relating to this request.\n."</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>autoreply_body = "Pañstwa zg³oszenie zosta³o zarejestrowane w naszym systemie.\nZg³oszeniu zosta³ nadany numer: RT#%tid.\nW korespondencji zwi±zanej z tym zg³oszeniem prosimy podawaæ w temacie ci±g znaków [RT#%tid].\n"</SAMP
></P
></LI
><LI
><P
>smtp_server</P
><P
>Serwer SMTP, przez który zostanie wys³ana wiadomo¶æ. Domy¶lnie: localhost.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>smtp_server = smtp.mydomain.pl</SAMP
></P
></LI
><LI
><P
>mail_dir</P
><P
>Katalog w którym zostan± zapisane za³±czniki. Katalog ten powinien byæ
		    dostêpny dla apache'a i klienta uruchamiaj±cego lms-rtparser. Gdy nie ustawiono, 
		    za³±czniki zostan± utracone. Domy¶lnie: niezdefiniowany.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>mail_dir = /usr/local/lms/mail</SAMP
></P
></LI
><LI
><P
>tmp_dir</P
><P
>Katalog tymczasowy. Domy¶lnie zostanie u¿yty katalog 
		    zdefiniowany w zmiennej systemowej lub <TT
CLASS="FILENAME"
>/tmp</TT
>.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>tmp_dir = /home/user/tmp</SAMP
></P
></LI
><LI
><P
>auto_open</P
><P
>W³±czenie tej opcji spowoduje, ¿e w momencie odebrania
		    wiadomo¶ci dotycz±cej zg³oszenia zamkniêtego (lub martwego)
		    zg³oszenie to zostanie otwarte. Domy¶lnie: wy³±czone.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>auto_open = 1</SAMP
></P
></LI
><LI
><P
>newticket_notify</P
><P
>W³±czenie tej opcji spowoduje wysy³anie powiadomieñ o
		    nowych zg³oszeniach do u¿ytkowników którzy maj± prawa do
		    konkretnej kolejki. Domy¶lnie: wy³±czone.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>newticket_notify = 1</SAMP
></P
></LI
><LI
><P
>lms_url</P
><P
>Do powiadomienia o nowym zg³oszeniu zostaje za³±czony link 
		    do tego zg³oszenia w LMS-UI, aby u¿ytkownik móg³ szybko przej¶æ do
		    tego zg³oszenia. Domy¶lnie: http://localhost/lms/.</P
><P
>Przyk³ad:	<SAMP
CLASS="PROMPT"
>lms_url = https://lms.domena.pl/</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="scripts-list.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="mgc.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Lista dostêpnych skryptów</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="scripts.html"
ACCESSKEY="U"
>Pocz&#261;tek rozdzia&#322;u</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Generator plików konfiguracyjnych (lms-mgc)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>