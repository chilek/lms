<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>T-Script</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.11-cvs"
HREF="index.html"><LINK
REL="UP"
TITLE="LMS Daemon"
HREF="daemon.html"><LINK
REL="PREVIOUS"
TITLE="ModuĹy"
HREF="daemon-modules.html"><LINK
REL="NEXT"
TITLE="Dla dociekliwych"
HREF="devel.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.11-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="daemon-modules.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Rozdzia&#322; 6. LMS Daemon</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="devel.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="TSCRIPT"
>6.3. T-Script</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="TSCRIPT-INTRO"
>6.3.1. WstÄp</A
></H2
><P
>GĹĂłwnym przeznaczeniem jÄzyka skryptowego <A
HREF="http://silvercoders.com/index.php?page=T_Script"
TARGET="_top"
>T-Script</A
>,
		jest generowanie plikĂłw tekstowych. MoĹźe byÄ
		uĹźywany do przetwarzania szablonĂłw z danymi pobieranymi z rĂłĹźnych
		ĹşrĂłdeĹ np. baz SQL lub plikĂłw tekstowych.</P
><P
>Przed kompilacjÄ T-Scripta upewnij siÄ, Ĺźe posiadasz w systemie
		pakiety <TT
CLASS="FILENAME"
>bison</TT
> (co najmniej w wersji 1.875) oraz 
		<TT
CLASS="FILENAME"
>flex</TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="TSCRIPT-SYNTAX"
>6.3.2. SkĹadnia</A
></H2
><P
>SkĹadnia jÄzyka T-Script jest podobna do skĹadni innych popularnych
		jÄzykĂłw takich jak C czy JavaScript, ale dokonano pewnych zmian
		majÄcych na celu uĹatwienie tworzenia szablonĂłw. 
		Wszystkie podane polecenia powinny byÄ zapisywane wewnÄtrz klamer { }.
		Dane poza klamrami zostanÄ zapisane do pliku wyjĹciowego (lub jeĹli go
		nie zdefiniowano, pominiÄte). WielkoĹÄ liter ma znaczenie. Do oddzielenia
		poleceĹ sĹuĹźy znak Ĺrednika.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="EXPR"
>6.3.2.1. WyraĹźenia i operatory</A
></H3
><UL
><LI
><P
>CiÄg znakĂłw. ObowiÄzujÄ tutaj zasady jÄzyka C dotyczÄce uĹźycia znakĂłw formatujÄcych (\t, \n, \\). </P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>"jakiĹ ciÄg znakĂłw"</SAMP
></P
></LI
><LI
><P
>Liczba.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>1234</SAMP
></P
></LI
><LI
><P
>WartoĹÄ zmiannej "var".</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>var</SAMP
></P
></LI
><LI
><P
>N-ty element tablicy "var".</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>var[n]</SAMP
></P
></LI
><LI
><P
>Podzmienna "n" zmiennej "var".</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>var.n</SAMP
></P
></LI
><LI
><P
>WartoĹÄ wyraĹźenia w nawiasach.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>( wyraĹźenie )</SAMP
></P
></LI
><LI
><P
>SĹowo kluczowe "null". OkreĹla wartoĹÄ niezdefiniowanÄ.
				Przydatne do sprawdzania, czy jakaĹ zmienna (wartoĹÄ) jest
				zdefiniowana.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>zmienna = null</SAMP
></P
></LI
><LI
><P
>PorĂłwnania. Zwraca wynik logiczny porĂłwnania.</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>wyraĹźenie1 == wyraĹźenie2;
wyraĹźenie1 != wyraĹźenie2;
wyraĹźenie1 &lt; wyraĹźenie2;
wyraĹźenie1 &gt; wyraĹźenie2;
wyraĹźenie1 &lt;= wyraĹźenie2;
wyraĹźenie1 &gt;= wyraĹźenie2;</PRE
></P
></LI
><LI
><P
>Operatory binarne. Suma i iloczyn bitowy.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 | wyraĹźenie2</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 &#38; wyraĹźenie2</SAMP
></P
></LI
><LI
><P
>Operatory logiczne.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 || wyraĹźenie2</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 &#38;&#38; wyraĹźenie2</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>! wyraĹźenie1</SAMP
></P
></LI
><LI
><P
>ĹÄczenie ciÄgĂłw znakĂłw. Gdy oba wyraĹźenia nie sÄ liczbami 
				traktuje je jako ciÄgi znakĂłw i dokonuje ich poĹÄczenia.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 + wyraĹźenie2</SAMP
></P
></LI
><LI
><P
>Operatory arytmetyczne. Zwraca wynik operacji arytmetycznej na dwĂłch wyraĹźeniach.</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>wyraĹźenie1 + wyraĹźenie2;
wyraĹźenie1 - wyraĹźenie2;
wyraĹźenie1 * wyraĹźenie2;
wyraĹźenie1 / wyraĹźenie2;
wyraĹźenie1 % wyraĹźenie2;</PRE
></P
></LI
><LI
><P
>Jednoargumentowe operatory inkrementacji/dekrementacji.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie++</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie--</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>++wyraĹźenie</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>--wyraĹźenie</SAMP
></P
></LI
><LI
><P
>PrzesuniÄcie bitowe.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 &gt;&gt; wyraĹźenie2</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie1 &lt;&lt; wyraĹźenie2</SAMP
></P
></LI
><LI
><P
>PorĂłwnanie ciÄgu do z wyraĹźeniem regularnym. Zwraca 1 gdy <SAMP
CLASS="PROMPT"
>wyraĹźenie</SAMP
>
				pasuje do wzorca po prawej stronie, w przeciwnym wypadku zwraca 0.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>wyraĹźenie =~ wzorzec</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="COMMENTS"
>6.3.2.2. Komentarze</A
></H3
><UL
><LI
><P
>Komentarz w stylu jÄzyka C.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>/* to jest komentarz - moĹźe byÄ wieloliniowy */</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="COMMANDS"
>6.3.2.3. Polecenia</A
></H3
><UL
><LI
><P
>Przypisanie. Przypisanie wartoĹci wyraĹźenia do podanej zmiennej.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>zmienna = wyraĹźenie</SAMP
></P
></LI
><LI
><P
>WyraĹźenie warunkowe. Wykonanie polecenia tylko wtedy gry wyraĹźenie jest prawdÄ. 
					Druga forma wykonuje polecenie1 gdy wyraĹźenie jest prawdÄ lub polecenie2
					gdy jest faĹszem.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>if ( wyraĹźenie ) polecenia /if
if ( wyraĹźenie ) polecenie1 else polecenie2 /if</PRE
></P
><P
>Tekst miÄdzy blokami jest traktowany jako polecenia
				    	dlatego nastÄpujÄcy przykĹad jest prawidĹowy: <PRE
CLASS="SCREEN"
>JakiĹ tekst
{if (a==1)} 
a rĂłwne jest 1
{else} 
a nie jest rĂłwne 1
{/if} </PRE
>
					MoĹźna wstawiÄ backslash (\) pomiÄdzy poleceniem a koĹcem wiersza aby
					pozbyÄ siÄ znaku koĹca linii i zachowaÄ normalny (bez zaĹamania linii w tym miejscu)
					przepĹyw tekstu. Na przykĹad: <PRE
CLASS="SCREEN"
>JakiĹ tekst
{if (a==1)}\ 
a rĂłwna siÄ 1 
{else}\ 
a nie rĂłwna siÄ 1 
{/if}\</PRE
></P
></LI
><LI
><P
>PÄtla iteracyjna. Wykonuje wyraĹźenie <SAMP
CLASS="PROMPT"
>wyraĹźenie1</SAMP
> jako
					polecenie inicjalizujÄce pÄtlÄ. NastÄpnie wykonywane jest 
					<SAMP
CLASS="PROMPT"
>wyraĹźenie3</SAMP
> i <SAMP
CLASS="PROMPT"
>polecenie</SAMP
> dopĂłki 
					<SAMP
CLASS="PROMPT"
>wyraĹźenie2</SAMP
> jest prawdziwe.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>for ( wyraĹźenie1 ; wyraĹźenie2 ; wyraĹźenie3 ) polecenie /for</PRE
></P
></LI
><LI
><P
>Konstrukcja <SAMP
CLASS="PROMPT"
>foreach</SAMP
>. Pozwala na iteracjÄ po wszystkich
					elementach danej tablicy. Wykunuje <SAMP
CLASS="PROMPT"
>polecenia</SAMP
> tyle razy ile 
					jest w tablicy elementĂłw podstawiajÄc za kaĹźdym razem wartoĹÄ odpowiedniego 
					elementu tablicy pod <SAMP
CLASS="PROMPT"
>element</SAMP
>.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>foreach ( element in tablica ) polecenia /foreach</PRE
></P
></LI
><LI
><P
>PÄtla <SAMP
CLASS="PROMPT"
>while</SAMP
>. Wykonanuje <SAMP
CLASS="PROMPT"
>polecenie</SAMP
>
					tak dĹugo jak dĹugo <SAMP
CLASS="PROMPT"
>wyraĹźenie</SAMP
>  jest prawdziwe. WartoĹÄ wyraĹźenia
					jest sprawdzana za kaĹźdym razem na poczÄtku pÄtli, wiÄc nawet gdy wartoĹÄ 
					ta zmieni siÄ podczas wykonywania poleceĹ, wykonywanie pÄtli nie zostanie 
					przerwane aĹź do jej zakoĹczenia.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>while ( wyraĹźenie ) polecenie /while</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>break</SAMP
>. Polecenie to koĹczy wykonywanie
					aktualnej instrukcji pÄtli.</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>{for (i = 0; i &lt; 10; i++)}\
{if (i == 5)}{break}{/if}\
: {i}
{/for}\</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>continue</SAMP
>. Polecenie <SAMP
CLASS="PROMPT"
>continue</SAMP
>
					uĹźywane jest wewnÄtrz instrukcji pÄtli do przerwania wykonania
					danej iteracji pÄtli i rozpoczÄcia kolejnej iteracji.</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>{for (i = 0; i &lt; 10; i++)}\
{if (i == 5)}{continue}{/if}\
: {i}
{/for}\</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>exit</SAMP
>. Polecenie to sĹuĹźy po prostu do
					przerwania wykonywania skryptu.</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>{if (zmienna &gt; 0)
    exit;
/if}</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="FUNCTIONS"
>6.3.2.4. Funkcje</A
></H3
><P
>Funkcje mogÄ byÄ uĹźywane zarĂłwno w skĹadni z nawiasem
			(<SAMP
CLASS="PROMPT"
>{funkcja(zmienna)}</SAMP
>) jak i bez nawiasu 
			(<SAMP
CLASS="PROMPT"
>{funkcja {zmienna}}</SAMP
>).
			<UL
><LI
><P
><SAMP
CLASS="PROMPT"
>string(liczba)</SAMP
></P
><P
>Zamiana wartoĹci liczbowej na ciÄg znakĂłw.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>string(zmienna)</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>number(ciÄg_znakĂłw)</SAMP
></P
><P
>Zamiana ciÄgu znakĂłw na liczbÄ. Dla tablic zwraca iloĹÄ elementĂłw w tablicy.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>number("123")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>typeof(zmienna)</SAMP
></P
><P
>Sprawdzenie typu. Zwraca nazwÄ typu zmiennej np.string, 
					number, array, null.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>typeof(zmienna)</SAMP
></P
></LI
></UL
>
			W skrypcie powyĹźsze funkcje mogÄ byÄ uĹźyte w nastÄpujÄcy sposĂłb:
<PRE
CLASS="SCREEN"
>{x = 5}x = {x}
{var = "3"}var = {var}
x + var = {x + var}
x + var = {number(var) + x}
x + var = {string(x) + var}
x jest typu {typeof(x)}
var jest typu {typeof(var)}</PRE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="EXTENSIONS"
>6.3.3. Rozszerzenia</A
></H2
><P
>Rozszerzenia (extensions) to dodatki do biblioteki <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>tscript</I
></SPAN
>. SÄ to funkcje i predefiniowane 
		zmienne (staĹe), ktĂłre moĹźna stosowaÄ w skryptach.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="EXEC"
>6.3.3.1. Exec</A
></H3
><P
>Wykonywanie poleceĹ powĹoki umoĹźliwia funkcja 
			<SAMP
CLASS="PROMPT"
>exec()</SAMP
>.
			MoĹźliwe jest wykonanie wielu poleceĹ oddzielonych Ĺrednikami
			w jednym wywoĹaniu tej funkcji.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>exec(polecenie)</SAMP
></P
><P
>Wykonywanie poleceĹ powĹoki.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>exec("rm -f /")</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="STRING"
>6.3.3.2. String</A
></H3
><P
><SAMP
CLASS="PROMPT"
>String</SAMP
> zawiera podstawowe funkcje do operowania
			na ciÄgach znakĂłw.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>trim(ciÄg_znakĂłw)</SAMP
></P
><P
>UsuniÄcie "biaĹych" znakĂłw z poczÄtku i koĹca 
					ciÄgu znakĂłw.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>trim("   aaa   ")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>len(ciÄg_znakĂłw)</SAMP
></P
><P
>Zwraca dĹugoĹÄ ciÄgu (odpowiednik funkcji strlen() z jÄzyka C).</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>length = len(string)</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>replace(wzorzec, zamiennik, ciÄg_znakĂłw)</SAMP
></P
><P
>Funkcja przeszukuje ciÄg_znakĂłw w poszukiwaniu fragmentĂłw pasujÄcych
					do wzorca i wstawia w jego miejsce zamiennik. Wzorzec moĹźe byÄ
					wyraĹźeniem regularnym zgodnym z POSIX.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>replace(":", "-", mac)</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>replace("[a-z]", "-", "teksty")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>explode(separator, ciÄg_znakĂłw)</SAMP
></P
><P
>Zwraca tablicÄ ciÄgĂłw, powstaĹych z podziaĹu ciÄgu_znakĂłw
					wg okreĹlonego separatora. Separator moĹźe byÄ POSIX'owym wyraĹźeniem
					regularnym.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>explode(":", "aaa:bbb:ccc")</SAMP
></P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>explode("[ ]+", "aaa bbb ccc")</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="SYSINFO"
>6.3.3.3. Sysinfo</A
></H3
><P
>Rozszerzenie o nazwie <SAMP
CLASS="PROMPT"
>Sysinfo</SAMP
> zawiera 
			funkcje pobierajÄce dane z systemu.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>date([ciÄg_formatujÄcy])</SAMP
></P
><P
>BieĹźÄca data i czas wg zadanego formatu.
					DomyĹlnie funkcja zwraca datÄ w formacie %Y/%m/%d. 
					Znaczenie poszczegĂłlnych specyfikatorĂłw konwersji moĹźna
					znaleĹşÄ w <SAMP
CLASS="PROMPT"
>`man strftime`</SAMP
>.</P
><P
>Zwracany obiekt zawiera predefiniowane podzmienne
					<SAMP
CLASS="PROMPT"
>year</SAMP
>, <SAMP
CLASS="PROMPT"
>month</SAMP
>, <SAMP
CLASS="PROMPT"
>day</SAMP
>, 
					<SAMP
CLASS="PROMPT"
>hour</SAMP
>, <SAMP
CLASS="PROMPT"
>minute</SAMP
>, <SAMP
CLASS="PROMPT"
>second</SAMP
></P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>{date("%s") / zwraca bieĹźÄcy czas w formacie unix timestamp */}
{a = date()}
{a.month /* zwraca numer bieĹźÄcego miesiÄca */ }</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>systype</SAMP
></P
><P
>Typ systemu. StaĹa zwracajÄca "unix" lub "win32" 
					w zaleĹźnoĹci od systemu na jakim dziaĹa program.</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>{if (systype == "unix")}\
{exec echo wykonujemy polecenie powĹoki}\
{else}\
tu nie mamy powĹoki
{/if}\</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="FILE"
>6.3.3.4. File</A
></H3
><P
>To rozszerzenie udostÄpnia podstawowe operacje na plikach.
			<UL
><LI
><P
><SAMP
CLASS="PROMPT"
>file(nazwa_pliku)</SAMP
></P
><P
>Przekierowanie wyjĹcia. Dane zostanÄ dopisane
					do podanego pliku.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>{file nazwa_pliku} polecenia {/file}</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>fileexists(nazwa_pliku)</SAMP
></P
><P
>JeĹli plik istnieje zwraca 1, w przeciwnym wypadku 0.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>{if fileexists(plik)}{deletefile(plik)}{/if}</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>deletefile(nazwa_pliku)</SAMP
></P
><P
>UsuniÄcie pliku.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>deletefile("/tmp/plik.txt")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>readfile(nazwa_pliku)</SAMP
></P
><P
>Zapisuje w tablicy zawartoĹÄ pliku tak, Ĺźe kaĹźda
					linia pliku to osobny element tablicy.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>readfile("/tmp/plik.txt")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>getfile(nazwa_pliku)</SAMP
></P
><P
>Zwraca caĹÄ zawartoĹÄ pliku.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>getfile("/tmp/plik.txt")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>listdir(katalog)</SAMP
></P
><P
>Zwraca listÄ plikĂłw (i podkatalogĂłw) w tablicy. KaĹźdy
					element tablicy zawiera podzmiennÄ 'size', w ktĂłrej zapisany
					jest rozmiar pliku w bajtach.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>listdir("/home/alec")</SAMP
></P
></LI
></UL
>
			PoniĹźszy listing prezentuje przykĹadowy skrypt z uĹźyciem wszystkich funkcji
			rozszerzenia <SAMP
CLASS="PROMPT"
>File</SAMP
>.
<PRE
CLASS="SCREEN"
>{list = listdir("/home/alec/lms/doc")}
{for (x = 0; x &lt; number(list); x++) }\
{list[x]}--{list[x].size}
{/for}\
{file "/home/alec/plik.txt"}
Linia 1
Linia 2
{/file}\
{f = readfile /home/alec/plik.txt}\
{for (i = 0; i &lt; number(f); i++) }\
linia {i}: {f[i]}\
{/for}\
{f = getfile /home/alec/plik.txt}\
{f}
{deletefile /home/alec/plik.txt}\</PRE
></P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="SYSLOG"
>6.3.3.5. Syslog</A
></H3
><P
>Rozszerzenie o nazwie <SAMP
CLASS="PROMPT"
>Syslog</SAMP
> zawiera 
			funkcjÄ pozwalajÄcÄ na zapisywanie komunikatĂłw do logĂłw systemowych.
			Wprowadza rĂłznieĹź definicje poziomĂłw waĹźnoĹci komunikatĂłw.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>syslog(ciÄg [, poziom])</SAMP
></P
><P
>Funkcja zapisuje do logĂłw systemowych komunikat
					okreĹlony przez argument <SAMP
CLASS="PROMPT"
>ciÄg</SAMP
>. Drugi 
					argument funkcji jest opcjonalny i definiuje poziom
					waĹźnoĹci komunikatu, ktĂłry domyĹlnie ustawiony jest 
					na <SAMP
CLASS="PROMPT"
>LOG_INFO</SAMP
>
					(patrz <SAMP
CLASS="PROMPT"
>man 3 syslog</SAMP
>).</P
><P
>PrzykĹad: 
<PRE
CLASS="SCREEN"
>syslog("Komunikat", LOG_ERR);
syslog("Komunikat");</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="NET"
>6.3.3.6. Net</A
></H3
><P
>W tym rozszerzeniu zawarte sÄ funkcje (nazwy pisane maĹymi literami)
				przeznaczone do operowania na adresach IP i maskach. Jest to rozszerzenie
				dodane w LMS.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>mask2prefix(ciÄg_znakĂłw)</SAMP
></P
><P
>Zamiana maski sieciowej w formacie xxx.xxx.xxx.xxx
						na liczbÄ (bitĂłw).</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>mask2prefix("255.255.255.0")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>ip2long(ciÄg_znakĂłw)</SAMP
></P
><P
>Zamiana adresu IP w formacie 4-oktetowym na
						liczbÄ.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>ip2long("192.168.0.1")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>long2ip(liczba)</SAMP
></P
><P
>Zamiana adresu IP podanego jako liczba
						na format xxx.xxx.xxx.xxx.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>long2ip(zmienna)</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>broadcast(adres, maska)</SAMP
></P
><P
>Obliczenie adresu broadcast dla podanego
					adresu IP oraz maski (format maski dowolny).</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>broadcast("192.168.0.1", "255.255.255.0")</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="SQL"
>6.3.3.7. SQL</A
></H3
><P
>Rozszerzenie SQL udostÄpnia podstawowe funkcje zwiÄzane
			z obsĹugÄ bazy danych. Pozwala na wykonywanie poleceĹ SQL.</P
><UL
><LI
><P
>Polecenia SQL: <SAMP
CLASS="PROMPT"
>SELECT</SAMP
>, <SAMP
CLASS="PROMPT"
>INSERT</SAMP
>,
					<SAMP
CLASS="PROMPT"
>DELETE</SAMP
>, <SAMP
CLASS="PROMPT"
>UPDATE</SAMP
>, <SAMP
CLASS="PROMPT"
>CREATE</SAMP
>, 
					<SAMP
CLASS="PROMPT"
>DROP</SAMP
>.</P
><P
>PrzykĹad: <PRE
CLASS="SCREEN"
>{SELECT * FROM tabela}
{INSERT INTO tabela VALUES(1)}
{DELETE FROM tabela}
{UPDATE tabela SET kolumna=1}
{CREATE TABLE foo (bar integer)}
{DROP TABLE foo}</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>rows(zapytanie)</SAMP
></P
><P
>Liczba wierszy, ktĂłrych dotyczy zapytanie.</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>rows("SELECT * FROM tabela")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>escape(ciÄg_znakĂłw)</SAMP
></P
><P
>Zabezpieczenie znakĂłw specjalnych w celu uĹźycia
					w zapytaniu SQL. W szczegĂłlnoĹci chodzi o apostrofy 
					i backslashe. JeĹli nie znasz zawartoĹci zmiennej
					powinieneĹ jÄ przepuĹciÄ przez escape().</P
><P
>PrzykĹad: <SAMP
CLASS="PROMPT"
>SELECT * FROM tabela WHERE name={escape(zmienna)}</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="CONSTS"
>6.3.3.8. StaĹe</A
></H3
><P
>Rozszerzenie ĹciĹle zwiÄzane z LMS-em. UmoĹźliwia
			tworzenie skryptĂłw bez znajomoĹci struktury bazy danych.
			Zawiera predefiniowane staĹe, ktĂłre zawierajÄ dane z bazy.
			Zdefiniowane w programie zapytanie jest wykonywane w momencie
			pierwszego uĹźycia staĹej. Nazwy staĹych naleĹźy pisaÄ
			duĹźymi literami. KaĹźda staĹa to tablica zawierajÄca wiersze
			numerowane od zera, a kaĹźdy wiersz posiada podzmienne dostÄpne
			poprzez nazwÄ (pisanÄ maĹymi literami).</P
><UL
><LI
><P
>CUSTOMERS - lista klientĂłw:
					<TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - ID klienta</TD
></TR
><TR
><TD
>lastname - nazwa/nazwisko klienta</TD
></TR
><TR
><TD
>name - imiÄ klienta</TD
></TR
><TR
><TD
>status - status</TD
></TR
><TR
><TD
>address - adres klienta</TD
></TR
><TR
><TD
>zip - kod pocztowy</TD
></TR
><TR
><TD
>city - miasto</TD
></TR
><TR
><TD
>email - adres e-mail</TD
></TR
><TR
><TD
>ten - numer NIP</TD
></TR
><TR
><TD
>ssn - numer PESEL</TD
></TR
><TR
><TD
>regon - numer REGON</TD
></TR
><TR
><TD
>icn - numer dowodu osobistego</TD
></TR
><TR
><TD
>rbe - numer EDG/KRS</TD
></TR
><TR
><TD
>info - informacje o kliencie</TD
></TR
><TR
><TD
>message - treĹÄ ostrzeĹźenia</TD
></TR
><TR
><TD
>warning - status ostrzeĹźenia (suma statusĂłw wszystkich komputerĂłw klienta)</TD
></TR
><TR
><TD
>access - status dostÄpnoĹci (suma statusĂłw wszystkich komputerĂłw klienta)</TD
></TR
><TR
><TD
>balance - bilans klienta</TD
></TR
></TBODY
></TABLE
>
					</P
></LI
><LI
><P
>NODES - lista komputerĂłw (i adresĂłw urzÄdzeĹ sieciowych):
					<TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - ID komputera</TD
></TR
><TR
><TD
>owner - nazwa/nazwisko i imiÄ 	klienta</TD
></TR
><TR
><TD
>ownerid - ID klienta ('0' w przypadku urzÄdzeĹ)</TD
></TR
><TR
><TD
>name - nazwa komputera (adresu urzÄdzenia)</TD
></TR
><TR
><TD
>access - status: wĹÄczony/wyĹÄczony (1/0)</TD
></TR
><TR
><TD
>warning - status ostrzeĹźeĹ: wĹÄczone/wyĹÄczone (1/0)</TD
></TR
><TR
><TD
>netdev - ID urzÄdzenia, do ktĂłrego jest podĹÄczony</TD
></TR
><TR
><TD
>lastonline - czas ostatniej aktywnoĹci</TD
></TR
><TR
><TD
>info - dodatkowe 	informacje</TD
></TR
><TR
><TD
>message - treĹÄ ostrzeĹźenia</TD
></TR
><TR
><TD
>mac - adres MAC</TD
></TR
><TR
><TD
>passwd - hasĹo</TD
></TR
><TR
><TD
>ip - adres IP</TD
></TR
><TR
><TD
>ip_pub - publiczny adres IP</TD
></TR
><TR
><TD
>linktype - typ poĹÄczenia (0-kabel, 1-radio)</TD
></TR
><TR
><TD
>port - numer portu urzÄdzenia, do ktĂłrego podĹÄczony jest komputer</TD
></TR
><TR
><TD
>chkmac - sprawdzanie MAC'a: wĹÄczone/wyĹÄczone (1/0)</TD
></TR
><TR
><TD
>halfduplex - rodzaj komunikacji (0-full, 1-half)</TD
></TR
></TBODY
></TABLE
>
					</P
></LI
><LI
><P
>NETWORKS - lista sieci:
					<TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - ID sieci</TD
></TR
><TR
><TD
>name - nazwa sieci</TD
></TR
><TR
><TD
>address - adres IP</TD
></TR
><TR
><TD
>mask - maska 	(xxx.xxx.xxx.xxx)</TD
></TR
><TR
><TD
>prefix - liczba jedynek w masce</TD
></TR
><TR
><TD
>size - rozmiar sieci (iloĹÄ adresĂłw)</TD
></TR
><TR
><TD
>interface - nazwa interfejsu</TD
></TR
><TR
><TD
>gateway - adres bramy</TD
></TR
><TR
><TD
>dns - adres pierwszego serwera DNS</TD
></TR
><TR
><TD
>dns2 - adres drugiego serwera DNS</TD
></TR
><TR
><TD
>wins - adres WINS</TD
></TR
><TR
><TD
>domain - nazwa domenowa</TD
></TR
><TR
><TD
>dhcpstart - poczÄtek zakresu DHCP</TD
></TR
><TR
><TD
>dhcpend - koniec zakresu DHCP</TD
></TR
></TBODY
></TABLE
>
					</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="EXAMPLES"
>6.3.4. PrzykĹadowe skrypty</A
></H2
><P
>Zacznijmy od bardzo prostego skryptu, ktĂłry tworzy plik
		<TT
CLASS="FILENAME"
>/etc/hosts</TT
> z listÄ adresĂłw i nazw komputerĂłw 
		(oraz urzÄdzeĹ).
		<DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-HOSTS"
></A
><P
><B
>Przyk&#322;ad 6-1. Parser: Tworzenie pliku /etc/hosts</B
></P
><PRE
CLASS="SCREEN"
>{result = SELECT name, inet_ntoa(ipaddr) AS ip FROM nodes}\
127.0.0.1    localhost
{for (r=0; r&lt;number(result); r++)}\
{result[r].name}{"\t"}{result[r].ip}
{/for}\</PRE
></DIV
></P
><P
>Utworzenie listy dĹuĹźnikĂłw jest bardzo proste, zwĹaszcza
		gdy zastosujemy jednÄ z predefiniowanych staĹych.
		<DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-DEBTORS"
></A
><P
><B
>Przyk&#322;ad 6-2. Parser: Lista dĹuĹźnikĂłw</B
></P
><PRE
CLASS="SCREEN"
>{
for (r=0; r&lt;number(CUSTOMERS); r++)
    if (CUSTOMERS[r].balance &#60; 0)
}\
{CUSTOMERS[r].lastname} {CUSTOMERS[r].name}{"\t"}{CUSTOMERS[r].balance}
{
    /if
/for}\</PRE
></DIV
></P
><P
>Utworzenie listy z opisami komputerĂłw dla programu iptraf. Charakterystyczne dla tego
		programu jest to, Ĺźe adresy MAC komputerĂłw muszÄ byÄ zapisane bez dwukropkĂłw oddzielajÄcych
		poszczegĂłlne czĹony adresu.
		<DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-IPTRAF"
></A
><P
><B
>Przyk&#322;ad 6-3. Parser: Opisy komputerĂłw dla iptrafa.</B
></P
><PRE
CLASS="SCREEN"
>{list = SELECT LOWER(mac) AS mac, UPPER(name) AS name, inet_ntoa(ipaddr) AS ip from nodes}\
{for(i=0; i&lt;number(list); i++)}\
{replace(":","",list[i].mac)}:{list[i].name} {list[i].ip}
{/for}</PRE
></DIV
></P
><P
>W nastÄpnym przykĹadzie tworzymy plik z przypisanymi adresami IP do adresĂłw sprzÄtowych
		hostĂłw, uĹźywany przez program <TT
CLASS="FILENAME"
>arp</TT
>. Hostom z wyĹÄczonym dostÄpem
		zostanÄ przypisane "puste" MACi.
		<DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-ETHERS"
></A
><P
><B
>Przyk&#322;ad 6-4. Parser: Plik "ethers" dla programu arp.</B
></P
><PRE
CLASS="SCREEN"
>{if (number(NODES))
       if (fileexists("/etc/ethers"))
               deletefile("/etc/ethers");
       /if; 
       for (i=0; i&lt;number(NODES); i++)
               if (number(NODES[i].access))
                      }{NODES[i].mac}{"\t"}{NODES[i].ip}{"\n"}{
               else
                      }00:00:00:00:00:00{"\t"}{NODES[i].ip}{"\n"}{
               /if;
      /for;
/if}\</PRE
></DIV
>
		</P
><P
>Kolejny trochÄ dĹuĹźszy przykĹad, w ktĂłrym wykorzystujemy gĹĂłwnie
		<SAMP
CLASS="PROMPT"
>exec</SAMP
>. Skrypt wysyĹa wiadomoĹci do klientĂłw z bilansem niĹźszym od
		zadanego limitu.
		<DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-NOTIFY"
></A
><P
><B
>Przyk&#322;ad 6-5. Parser: Zamiennik moduĹu notify</B
></P
><PRE
CLASS="SCREEN"
>{limit = 0;
dt = date();
customers = SELECT customers.id AS id, email, pin, name, lastname,
        SUM((type * -2 +7) * cash.value) AS balance
        FROM customers
        LEFT JOIN cash ON customers.id = cash.customerid AND (cash.type = 3 OR cash.type = 4)
        WHERE deleted = 0 AND email!=''
        GROUP BY customers.id, name, lastname, email, pin
        HAVING SUM((type * -2 +7) * cash.value) &lt; {limit}
}
{for(i=0; i&lt;number(customers); i++)}

    {exec echo "UWAGA: Niniejsza wiadomoĹÄ zostaĹa wygenerowana automatycznie.

Uprzejmie informujemy, iĹź na Pani/Pana koncie figuruje zalegĹoĹÄ w opĹatach za 
Internet w kwocie {customers[i].balance*-1} zĹ.

JeĹźeli naleĹźnoĹÄ za bieĹźÄcy miesiÄc, to jest {dt.month}-{dt.year}, zostaĹa juĹź
uregulowana prosimy zignorowaÄ tÄ wiadomoĹÄ.

W przypadku gdy uwaĹźa Pani/Pan, Ĺźe zalegĹoĹÄ ta jest nieporozumieniem
prosimy o jak najszybszy kontakt z Biurem ObsĹugi Klienta.

WiÄcej informacji na temat pĹatnoĹci moĹźna uzyskaÄ pod adresem:
http://naszasiec.pl/mojekonto/

W celu uregulowania naleĹźnoĹci prosimy o kontakt:

Nasz Siec ASK - Biuro ObsĹugi Klienta
Gwidon MniejwaĹźny
telefon: 0-606031337
e-mail: gwidonm@naszasiec.pl

PS. PoniĹźej zaĹÄczamy ostatnie 10 operacji na PaĹstwa koncie.
--------------+--------------+-----------------------------
     Data     |    Kwota     |           Komentarz
--------------+--------------+-----------------------------" &gt; /tmp/mail}

    {last10 = SELECT comment, time, CASE WHEN type=4 THEN value*-1 ELSE value END AS value
            FROM cash WHERE customerid = {customers[i].id}
            ORDER BY time DESC LIMIT 10}
    
    {for(j=0; j&lt;number(last10); j++)}
    
        {exec echo "{last10[j].time}|{"\t"}{last10[j].value}|{"\t"}{last10[j].comment}" &gt;&gt; /tmp/mail}
    
    {/for}

    {exec mail -s "Powiadomienie o zaleglosciach" -r lms@domain.tld {customers[i].email} &lt; /tmp/mail}

{/for}</PRE
></DIV
>
		</P
><P
>Kolejny rozbudowany przykĹad to odpowiednik moduĹu traffic.
		Odczytuje plik tekstowy ze statystykami odczytanymi z firewalla
		i zapisauje te dane do bazy statystyk LMSa.
		<DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-TRAFFIC"
></A
><P
><B
>Przyk&#322;ad 6-6. Parser: Statystyki.</B
></P
><PRE
CLASS="SCREEN"
>{
log = "/var/log/traffic.log";
nodes = SELECT id, INET_NTOA(ipaddr) AS ip, INET_NTOA(ipaddr_pub) AS ip_pub FROM nodes;
if(! fileexists(log))
    exit;
/if;
lines = readfile(log);
n = number(nodes);
for (i=0; i&lt;number(lines); i++)
    line = explode("[[:blank:]]+", lines[i]); /* file format: IP upload download */
    if ( number(line) == 3  &#38;&#38; (line[1] &gt; 0 || line[2] &gt; 0) )
        for (x=0; x&lt;n; x++)
            if (nodes[x].ip == line[0] || nodes[x].ip_pub == line[0] )
                id = nodes[x].id;
                break;
            /if;
        /for;
        if (x &lt; n)
            INSERT INTO stats (nodeid, dt, download, upload) VALUES ({id}, %NOW%, {line[2]}, {line[1]});
        /if;
    /if;
/for;
}	</PRE
></DIV
>
		</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="daemon-modules.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="devel.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ModuĹy</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="daemon.html"
ACCESSKEY="U"
>Pocz&#261;tek rozdzia&#322;u</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dla dociekliwych</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>