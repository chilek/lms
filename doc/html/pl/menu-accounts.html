<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Konta</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.9-cvs"
HREF="index.html"><LINK
REL="UP"
TITLE="Interfejs U¿ytkownika (LMS-UI)"
HREF="user.html"><LINK
REL="PREVIOUS"
TITLE="Dokumenty"
HREF="menu-documents.html"><LINK
REL="NEXT"
TITLE="Mailing"
HREF="menu-mailing.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-2"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.9-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="menu-documents.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Rozdzia&#322; 3. Interfejs U¿ytkownika (LMS-UI)</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="menu-mailing.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="MENU-ACCOUNTS"
>3.9. Konta</A
></H1
><P
>Zarz±dzanie kontami ró¿nych us³ug na serwerze jest teraz
	mo¿liwe. Funkcjonalno¶æ ta jest przeznaczona dla zaawansowanych 
	u¿ytkowników. Wymaga znajomo¶ci tych us³ug i ich konfiguracji
	w celu korzystania z bazy danych.</P
><P
>W LMSie mo¿na utworzyæ piêæ rodzajów kont: shell (1), poczta (2),
	www (4), ftp (8) i sql (16). W nawiasach podano numeryczne wewnêtrzne oznaczenie
	typu konta w bazie. Konta mog± byæ wielotypowe. Przyk³adowo, je¶li 
	zdefiniujesz konto shell+poczta+ftp w bazie zostanie zapisana cyfra 11.
	Oznacza to, ¿e do rozpoznawania typu konta w warunkach WHERE zapytañ
	SQL nale¿y stosowaæ sumowanie binarne (jak na przyk³adach w dalszej
	czê¶ci rozdzia³u).</P
><P
>Masz tak¿e mo¿liwo¶æ definiowania domen i aliasów.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-ACCOUNTS"
>3.9.1. Konta</A
></H2
><P
>Na li¶cie przedstawione s± podstawowe informacje o kontach.
	    Mo¿liwe jest dowolne sortowanie listy poprzez klikniêcie nazwy
	    kolumny oraz filtrowanie wg zadanych kryteriów. Przej¶cie do edycji 
	    danych konta nastêpuje po wybraniu ikony [Edytuj]. U¿ytkownik ma 
	    tak¿e prawo do zmiany has³a.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-NEW"
>3.9.2. Nowe konto</A
></H2
><P
>Definiuj±c dane konto musisz podaæ login, has³o i
	    wybraæ typ konta oraz przypisaæ klienta (lub utworzyæ tzw. konto
	    systemowe). Nazwa domeny jest wymagana tylko dla kont mailowych. Data 
	    wa¿no¶ci konta jest opcjonalna. Pozostawienie pustego pola z dat± 
	    oznacza, ¿e konto nigdy nie wygasa.</P
><P
>Masz mo¿liwo¶æ zdefiniowaæ dowolny katalog domowy u¿ytkownika (konta).
	    Opcja konfiguracyjna <TT
CLASS="FILENAME"
>homedir_prefix</TT
> w sekcji 
	    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
> zawiera prefix katalogu domowego, domy¶lnie
	    ustawiony na warto¶æ "/home/".</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-ALIASES"
>3.9.3. Aliasy</A
></H2
><P
>Konta (g³ównie mailowe) mog± posiadaæ dowoln± ilo¶æ aliasów.
	    Administrator serwera pocztowego mo¿e przekierowaæ (lokalnie) pocztê
	    z wszystkich aliasów do jednego kota. Na li¶cie aliasów przedstawione 
	    s± podstawowe informacje o nich i o kontach na które aliasy te wskazuj±.
	    Mo¿liwe jest dowolne sortowanie listy poprzez klikniêcie nazwy
	    kolumny oraz filtrowanie wg zadanych kryteriów. Nie ma mo¿liwo¶ci
	    edycji aliasu, nale¿y go usun±æ i utworzyæ nowy.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-DOMAINS"
>3.9.4. Domeny</A
></H2
><P
>Na li¶cie przedstawione s± podstawowe informacje o zdefiniowanych
	    domenach. Mo¿liwe jest dowolne sortowanie listy poprzez klikniêcie nazwy
	    kolumny. Mo¿liwa jest edycja danych domeny po wybraniu ikony [Edytuj].</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ACCOUNTS-EXAMPLES"
>3.9.5. Przyk³ady</A
></H2
><P
>Poni¿szy listing zawiera istotne fragmenty pliku konfiguracyjnego
	    demona proftpd (w wersji 1.2.10) umo¿liwiaj±cy przechowywanie danych
	    o kontach ftp w bazie LMSa. Przyk³ad zawiera konfiguracjê dla bazy
	    danych PostgreSQL, w komentarzach podano rozwi±zania dla MySQLa:
	    <DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E1"
></A
><P
><B
>Przyk&#322;ad 3-1. Konta. Konfiguracja proftpd.</B
></P
><PRE
CLASS="SCREEN"
>  ServerName	"LMS FTP Server"
  
  #nazwa_bazy@host:port klient has³o
  SQLConnectInfo lms@localhost:5432 lms mypassword
  
  SQLAuthTypes Crypt Plaintext
  SQLUserInfo passwd login password uid NULL home NULL
  RequireValidShell off
  SQLAuthenticate users
  
  # utworzenie katalogu domowego gdy nie istnieje
  SQLHomedirOnDemand on
  
  # komunikat przy logowaniu
  SQLShowInfo PASS "230" "Last login: %{getlastlogin}"
  SQLLog PASS setlastlogin
  
  # SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE FROM_UNIXTIME(lastlogin) END FROM passwd WHERE login='%u'"
  # SQLNamedQuery setlastlogin UPDATE "lastlogin=UNIX_TIMESTAMP() WHERE login='%u'" passwd 
  SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE lastlogin::abstime::timestamp::text END FROM passwd WHERE login='%u'"
  SQLNamedQuery setlastlogin UPDATE "lastlogin=EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)) WHERE login='%u'" passwd
  
  # Sprawdzamy datê wa¿no¶ci konta oraz ograniczamy szukanie do kont ftp
  # SQLUserWhereClause "type &#38; 8 = 8 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())"
  SQLUserWhereClause "type &#38; 8 = 8 AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))"</PRE
></DIV
></P
><P
>W kolejnym przyk³adzie przedstawimy jak skonfigurowaæ serwer
	    Postfix 2.1.1 oraz Cyrus-SASL 2.1.19, Courier-IMAP/POP3 3.0.4, aby korzysta³y
	    z bazy danych LMSa. LMS'owe konta bêd± kontami wirtualnymi, a poczta
	    przechowywana bêdzie w formacie Maildir.</P
><P
>Poniewa¿ has³a w LMS'ie s± szyfrowane, wymagane jest zainstalowanie
	    SASL'a z ³at± pozwalaj±c± na to. W komentarzach podano warto¶ci opcji
	    charakterystycznych dla bazy MySQL. Listing zawiera tylko opcje bezpo¶rednio
	    zwi±zane z baz± danych:
	    <DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E2"
></A
><P
><B
>Przyk&#322;ad 3-2. Konta. Konfiguracja serwera pocztowego (postfix+sasl+courier).</B
></P
><PRE
CLASS="SCREEN"
># Plik smtpd.conf (Cyrus-SASL):

pwcheck_method: auxprop
#sql_engine: mysql
sql_engine: pgsql
sql_user: lms
sql_passwd: has³o
sql_hostnames: localhost
sql_database: lms
#sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
#       AND login='%u' AND domains.name ='%r' AND type &#38; 2 = 2 
#	AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
	AND login='%u' AND domains.name ='%r' AND type &#38; 2 = 2 
	AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))
password_format: crypt
mech_list: login plain

# authpgsqlrc (lub authmysqlrc) (Courier):

# u¿ytkownik postfix (w³a¶ciciel katalogu z poczt±)
#MYSQL_UID_FIELD '1004'
PGSQL_UID_FIELD '1004'
# grupa postfix (w³a¶ciciel katalogu z poczt±)
#MYSQL_GID_FIELD '1004'
PGSQL_GID_FIELD '1004'
#MYSQL_PORT		3306
PGSQL_PORT		5432
#MYSQL_USERNAME		lms
PGSQL_USERNAME		lms
#MYSQL_PASSWORD		has³o
PGSQL_PASSWORD		has³o
#MYSQL_DATABASE		lms
PGSQL_DATABASE		lms
#MYSQL_SELECT_CLAUSE SELECT login, \
#       password, '', 104, 104, '/var/spool/mail/virtual', \
#       CONCAT(domains.name,'/',login,'/'), '', login, '' \
#       FROM passwd, domains WHERE domainid = domains.id \
#       AND login = '$(local_part)' AND domains.name = '$(domain)' \
#       AND type &#38; 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
PGSQL_SELECT_CLAUSE SELECT login, \
        password, '', 104, 104, '/var/spool/mail/virtual', \
        domains.name || '/' || login ||'/', '', login, '' \
        FROM passwd, domains WHERE domainid = domains.id 
        AND login = '$(local_part)' AND domains.name = '$(domain)' \
        AND type &#38; 2 = 2 \
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# main.cf (Postfix):

virtual_mailbox_base = /var/spool/mail/virtual
virtual_mailbox_domains = pgsql:/etc/postfix/pgsql_virtual_domains_maps.cf
virtual_mailbox_maps = pgsql:/etc/postfix/pgsql_virtual_mailbox_maps.cf
virtual_alias_maps = pgsql:/etc/postfix/pgsql_virtual_alias_maps.cf

# pgsql_virtual_domains_maps.cf (Postfix):

user = lms
password = has³o
hosts = localhost
dbname = lms
#MySQL nie obs³uguje opcji query, dlatego budujemy zapytanie w inny sposób
#select_field = name
#table = domains
#where_field = name
query = SELECT name FROM domains WHERE name = '%s'

# pgsql_virtual_mailbox_maps.cf (Postfix):

user = lms
password = has³o
hosts = localhost
dbname = lms
#table = passwd, domains
#select_field = CONCAT(domains.name,'/',login,'/')
#where_field = CONCAT(login,'@',domains.name)
additional_conditions = AND domainid = domains.id 
#       AND type &#38; 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
query = SELECT domains.name || '/' || login || '/' 
	FROM passwd, domains WHERE domainid = domains.id
        AND login = '%u' AND domains.name = '%d' 
        AND type &#38; 2 = 2 
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# pgsql_virtual_alias_maps.cf (Postfix):

user = lms
password = has³o
hosts = localhost
dbname = lms
#table = passwd, domains, aliases
#select_field = CONCAT(passwd.login,'@',domains.name)
#where_field = CONCAT(aliases.login,'@',domains.name)
#additional_conditions = AND  passwd.domainid = domains.id AND passwd.id = aliases.accountid
query = SELECT passwd.login || '@' || domains.name FROM passwd, domains, aliases 
        WHERE passwd.domainid = domains.id AND passwd.id = aliases.accountid
        AND aliases.login = '%u' AND domains.name = '%d' </PRE
></DIV
></P
><P
>Nastêpny przyk³ad podes³any przez bart'a przedstawia instalacjê i konfiguracjê
		serwera pure-ftpd w dystrybucji Gentoo z wykorzystaniem bazy danych MySQL.
		<DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E3"
></A
><P
><B
>Przyk&#322;ad 3-3. Konta. Konfiguracja pure-ftpd.</B
></P
><P
>No to zaczynamy od instalacji serwera pure-ftpd. Pod Gentoo wygl±da to tak:
<PRE
CLASS="SCREEN"
>bart # emerge pure-ftpd -av
These are the packages that I would merge, in order:
Calculating dependencies ...done!
[ebuild   R   ] net-ftp/pure-ftpd-1.0.20-r1  -caps -ldap +mysql +pam -postgres +ssl +vchroot 459 kB
Total size of downloads: 459 kB</PRE
>
			Co do innych systemów to ka¿dy chyba wie jak siê instaluje pakiety w
			swoim systemie, a je¿eli nie to pozostaje kompilacja ze ¼róde³.
			Po zainstalowaniu przechodzimy do stworzenia pliku, który bêdzie
			odpowiada³ za ³±czenie siê z baz± LMS'a.
			Tworzymy plik <TT
CLASS="FILENAME"
>/etc/pureftpd-mysql.conf</TT
>, który to 
			powinien zawieraæ minimum:
<PRE
CLASS="SCREEN"
>MYSQLServer     localhost (adres serwera bazy danych - domy¶lnie 'localhost')
MYSQLPort       3306 (port na którym dzia³a serwer MySql - domy¶lnie '3306')
MYSQLSocket     /var/run/mysqld/mysqld.sock (
MYSQLUser       lms (nazwa usera z dostêpem do bazy)
MYSQLPassword   has³o (tutaj nale¿y podaæ has³o)
MYSQLDatabase   lms (nazwa bazy danych)
MYSQLCrypt      crypt (sposób przechowywania hase³)
MYSQLGetPW      SELECT password FROM passwd WHERE login="\L" (pobieranie has³a dla usera)
MYSQLGetUID     SELECT uid FROM passwd WHERE login="\L" (pobieranie uid dla usera)
MYSQLGetGID     SELECT gid FROM passwd WHERE login="\L" (pobieranie gid dla usera)
MYSQLGetDir     SELECT home FROM passwd WHERE login="\L" (pobieranie nazwy katalogu domowego dla usera)
MySQLGetQTASZ   SELECT quota_ftp FROM passwd WHERE login="\L" (quota czyli pojemno¶æ konta w MB - podaj±c w lms-ui 10 oznacza to pojemno¶æ 10MB)</PRE
>
			Teraz pozostaje nam ju¿ tylko konfiguracja serwera pure-ftpd. (w gentoo
			plik konfiguracyjny mie¶ci siê w <TT
CLASS="FILENAME"
>/etc/conf.d/pure-ftpd</TT
>) 
			a wiêc:
<PRE
CLASS="SCREEN"
>## Najpierw odkomentujmy tê liniê, poniewa¿ inaczej serwer nie bêdzie chcia³ wystartowaæ
IS_CONFIGURED="yes"
## Tutaj podajemy adres naszego serwera i port na którym ma nas³uchiwaæ
SERVER="-S www.nasza.domena.pl,21"
## Okre¶lamy ilo¶æ jednoczesnych po³±czeñ do serwera oraz ilo¶æ po³±czeñ z tego samego IP
## To ju¿ chyba ka¿dy wed³ug potrzeb
MAX_CONN="-c 50"
MAX_CONN_IP="-C 2"
## Startujemy daemona w tle
DAEMON="-B"
## Ustalamy procentow± zajêto¶æ dysku/partycji kiedy serwer powinien przestaæ zezwalaæ na przyjmowanie danych
DISK_FULL="-k 90%"
## Je¿eli serwer jest za NATem odkomentuj tê liniê
#USE_NAT="-N"
## Autoryzacja ma byæ pobierana z bazy LMS'a - podajemy ¶cie¿kê do stworzonego przez nas wcze¶niej pliku
AUTH="-l mysql:/etc/pureftpd-mysql.conf"
## Pozosta³e opcje w moim wypadku s± takie
MISC_OTHER="-A -x -j"</PRE
></P
></DIV
></P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="menu-documents.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="menu-mailing.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Dokumenty</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="user.html"
ACCESSKEY="U"
>Pocz&#261;tek rozdzia&#322;u</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Mailing</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>