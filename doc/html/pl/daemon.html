<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>LMS Daemon</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.9-cvs"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Przyk³ad zastosowania lms-mgc"
HREF="mgc-example.html"><LINK
REL="NEXT"
TITLE="Modu³y"
HREF="daemon-modules.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-2"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.9-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="DAEMON"
></A
>Rozdzia&#322; 6. LMS Daemon</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Spis tre&#347;ci</B
></DT
><DT
>6.1. <A
HREF="daemon.html#DAEMON-INTRO"
>Informacje podstawowe</A
></DT
><DD
><DL
><DT
>6.1.1. <A
HREF="daemon.html#DAEMON-REQUIREMENTS"
>Wymagania</A
></DT
><DT
>6.1.2. <A
HREF="daemon.html#DAEMON-INSTALL"
>Instalacja</A
></DT
><DT
>6.1.3. <A
HREF="daemon.html#DAEMON-CONFIG"
>Konfiguracja</A
></DT
><DT
>6.1.4. <A
HREF="daemon.html#DAEMON-RUN"
>Uruchomienie</A
></DT
></DL
></DD
><DT
>6.2. <A
HREF="daemon-modules.html"
>Modu³y</A
></DT
><DD
><DL
><DT
>6.2.1. <A
HREF="daemon-modules.html#DAEMON-MODULESLIST"
>Lista dostêpnych modu³ów</A
></DT
><DT
>6.2.2. <A
HREF="daemon-modules.html#DAEMON-SYSTEM"
>System</A
></DT
><DT
>6.2.3. <A
HREF="daemon-modules.html#DAEMON-PAYMENTS"
>Payments</A
></DT
><DT
>6.2.4. <A
HREF="daemon-modules.html#DAEMON-NOTIFY"
>Notify</A
></DT
><DT
>6.2.5. <A
HREF="daemon-modules.html#DAEMON-GGNOTIFY"
>Ggnotify</A
></DT
><DT
>6.2.6. <A
HREF="daemon-modules.html#DAEMON-CUTOFF"
>Cutoff</A
></DT
><DT
>6.2.7. <A
HREF="daemon-modules.html#DAEMON-DHCP"
>Dhcp</A
></DT
><DT
>6.2.8. <A
HREF="daemon-modules.html#DAEMON-HOSTFILE"
>Hostfile</A
></DT
><DT
>6.2.9. <A
HREF="daemon-modules.html#DAEMON-TRAFFIC"
>Traffic</A
></DT
><DT
>6.2.10. <A
HREF="daemon-modules.html#DAEMON-TC"
>Tc (HTB)</A
></DT
><DT
>6.2.11. <A
HREF="daemon-modules.html#DAEMON-DNS"
>Dns</A
></DT
><DT
>6.2.12. <A
HREF="daemon-modules.html#DAEMON-ETHERS"
>Ethers</A
></DT
><DT
>6.2.13. <A
HREF="daemon-modules.html#DAEMON-OIDENT"
>Oident</A
></DT
><DT
>6.2.14. <A
HREF="daemon-modules.html#DAEMON-PINGER"
>Pinger</A
></DT
><DT
>6.2.15. <A
HREF="daemon-modules.html#DAEMON-PARSER"
>Parser</A
></DT
></DL
></DD
><DT
>6.3. <A
HREF="tscript.html"
>T-Script</A
></DT
><DD
><DL
><DT
>6.3.1. <A
HREF="tscript.html#TSCRIPT-INTRO"
>Wstêp</A
></DT
><DT
>6.3.2. <A
HREF="tscript.html#TSCRIPT-SYNTAX"
>Sk³adnia</A
></DT
><DT
>6.3.3. <A
HREF="tscript.html#EXTENSIONS"
>Rozszerzenia</A
></DT
><DT
>6.3.4. <A
HREF="tscript.html#EXAMPLES"
>Przyk³adowe skrypty</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DAEMON-INTRO"
>6.1. Informacje podstawowe</A
></H1
><P
>Napisany w jêzyku C program ma u³atwiaæ zarz±dzanie us³ugami. Sam demon odpowiada
	za uruchamianie odpowiednich modu³ów na ¿±danie u¿ytkownika. Modu³y
	natomiast, s³u¿± do tworzenia plików konfiguracyjnych na podstawie 
	danych z bazy LMS'a oraz restartowania odpowiednich us³ug na serwerze.
	Spe³niaj± tak¿e inne funkcje np. zbieranie statystyk, badanie aktywno¶ci
	hostów, naliczanie op³at, powiadamianie o zaleg³o¶ciach.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-REQUIREMENTS"
>6.1.1. Wymagania</A
></H2
><P
>Oto lista rzeczy, które <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> potrzebuje ju¿ na etapie kompilacji:
			<UL
><LI
><P
>interfejs u¿ytkownika <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
></P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libmysqlclient</TT
> (tj. pe³nej instalacji MySQL'a lub odpowiedniego 
				pakietu) lub <TT
CLASS="FILENAME"
>libpq</TT
> w przypadku bazy PostgreSQL</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libdl</TT
> (to w ka¿dej dzisiejszej dystrybucji jest)</P
></LI
><LI
><P
>kompilator jêzyka C (testowany na gcc-2.95.x i nowszych)</P
></LI
><LI
><P
>modu³ <TT
CLASS="FILENAME"
>ggnotify</TT
> wymaga biblioteki <TT
CLASS="FILENAME"
>libgadu</TT
>
				i jej plików nag³ówkowych</P
></LI
><LI
><P
>modu³ <TT
CLASS="FILENAME"
>parser</TT
> wymaga pakietu bison w wersji 1.875 lub nowszej 
				oraz pakietu flex</P
></LI
></UL
>
      			</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-INSTALL"
>6.1.2. Instalacja</A
></H2
><P
>Przed kompilacj± nale¿y przy pomocy skryptu <TT
CLASS="FILENAME"
>./configure</TT
>
			ustaliæ opcje przedstawione na poni¿szym listingu (w nawiasach podano
			warto¶ci domy¶lne opcji):
<PRE
CLASS="SCREEN"
>  --help                pomoc
  --enable-debug0       logowanie zapytañ SQL (wy³±czone)
  --enable-debug1       logowanie zdarzeñ (wy³±czone)
  --with-pgsql          gdy korzystasz z bazy PostgreSQL (wy³±czone)
  --with-mysql          gdy korzystasz z bazy MySQL (w³±czone)
  --prefix=PREFIX       katalog instalacyjny demona i modu³ów (/usr/local)
  --libdir=DIR          lokalizacja bibliotek bazy danych (/usr/lib)
  --incdir=DIR          lokalizacja plików nag³ówkowych bazy danych (/usr/include)
  --inifile=FILE        plik konfiguracyjny - wy³±cza konfiguracjê przez UI</PRE
>
			Zatem wymagane jest okre¶lenie bazy z jakiej bêdziemy korzystaæ (-with-mysql 
			lub -with-pgsql) oraz po³o¿enia bibliotek dostarczanych wraz z baz± (--incdir, 
			--libdir). Mo¿liwe jest zmuszenie demona do korzystania
			z plików konfiguracyjnych zamiast bazy danych. Nie jest
			mo¿liwe u¿ywanie obu sposobów przechowywania konfiguracji,
			dlatego nale¿y o tym zdecydowaæ przed kompilacj±.
<PRE
CLASS="SCREEN"
># ./configure --with-pgsql --libdir=/usr/local/pgsql/lib --incdir=/usr/local/pgsql/include</PRE
>
    			Nastêpnie kompilacja i instalacja (umieszczenie demona w katalogu
			okre¶lonym zmienn± --prefix):
<PRE
CLASS="SCREEN"
># make &#38;&#38; make install</PRE
>
			Skompilowane modu³y (pliki z rozszerzeniem <TT
CLASS="FILENAME"
>.so</TT
>),
			znajduj±ce siê w katalogu <TT
CLASS="FILENAME"
>modules/nazwa_modu³u</TT
> zostaj± 
			umieszczone w katalogu PREFIX/lms/lib, a g³ówny program (lmsd) w katalogu
			PREFIX/lms/bin.
			</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-CONFIG"
>6.1.3. Konfiguracja</A
></H2
><P
>Ca³± konfiguracjê demona i modu³ów przeprowadza siê przy pomocy
			<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> w menu Konfiguracja -&#62; Demon.
			Konfiguracjê modu³ów omówiono w osobnych rozdzia³ach ich dotycz±cych.
			Podstawowe parametry pracy demona i dane do po³±czenia z baz± danych
			podaje siê jako opcje linii komend, zgodnie z poni¿szym listingiem:
<PRE
CLASS="SCREEN"
>--dbhost -h host[:port]    host na którym zainstalowana jest baza danych (domy¶lnie: 'localhost')
--dbname -d nazwa_bazy     nazwa bazy danych (domy¶lnie: 'lms')
--dbuser -u u¿ytkownik     nazwa u¿ytkownika bazy danych (domy¶lnie: 'lms')
--dbpass -p has³o          has³o do bazy danych (domy¶lnie: puste)
--hostname -H nazwa_hosta  host, na którym dzia³a demon. Domy¶lnie przyjmowana jest nazwa
                           zwracana przez komendê hostname, ale mo¿na j± nadpisaæ. Nazwa
                           ta musi zgadzaæ siê z nazw± hosta podan± w konfiguracji hostów
--command -c polecenie     polecenie pow³oki do wykonania przed ka¿dym po³±czeniem z baz± 
                           tzn. co minutê (domy¶lnie: puste)
--instance -i "instancja[ ...]" lista instancji (modu³ów) do prze³adowania. Wszystkie pozosta³e 
                           zostan± pominiête
--reload -q                wykonuje prze³adowanie i koñczy pracê
--reload-all -r            wykonuje prze³adowanie wszystkich instancji (tak¿e tych, które maj±
                           zdefiniowany crontab) i koñczy pracê
--foreground -f            dzia³a na pierwszym planie (nie forkuje siê) 
--version -v               wy¶wietla wersjê i prawa licencyjne</PRE
>
			Opcje dostêpu do bazy s± tak¿e odczytywane ze zmiennych pow³oki:
			LMSDBPASS, LMSDBNAME, LMSDBUSER, LMSDBHOST, LMSDBPORT.
			<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Notatka"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Lista instancji sk³ada siê z nazw instancji oddzielonych 
			spacj±.</P
></TD
></TR
></TABLE
></DIV
>
			</P
><P
>Konfiguracja demona jest podzielona na hosty (umo¿liwiaj±c
			osobne konfigurowanie i prze³adowywanie demonów zainstalowanych
			na ró¿nych komputerach/routerach) oraz sekcje konfiguracyjne 
			nazwane instancjami.</P
><P
>Instancja oprócz parametrów konfiguracyjnych wybranego modu³u
			zawiera opcje podstawowe, takie jak:
			<UL
><LI
><P
>Nazwa</P
><P
>Nazwa instancji unikalna w obrêbie jednego hosta.</P
><P
>Przyk³ad: system</P
></LI
><LI
><P
>Priorytet</P
><P
>Liczba okre¶laj±ca priorytet, czyli kolejno¶æ wykonania instancji. Instancja o najni¿szym numerze zostanie wykonana jako pierwsza.</P
><P
>Przyk³ad: 10</P
></LI
><LI
><P
>Modu³</P
><P
>Nazwa pliku modu³u (z rozszerzeniem lub bez). Je¶li nie podano
				¶cie¿ki demon bêdzie szuka³ modu³u w katalogu PREFIX/lms/lib, do
				którego trafiaj± modu³y podczas "make install".</P
><P
>Przyk³ad: /usr/lib/system.so</P
></LI
><LI
><P
>Crontab</P
><P
>Czas wykonania modu³u okre¶lany w sposób podobny do u¿ywanego w programie crontab. Wszystkie dane musz± byæ numeryczne.
				Podany przyk³ad spowoduje wykonywanie wybranej instancji co 5 minut, w godzinach od 8 do 18. Gdy opcja ta jest pusta instancja 
				zostanie wykonana wy³±cznie podczas prze³adowania. Domy¶lnie: pusta.</P
><P
>Przyk³ad: */5 8-18 * * *</P
></LI
></UL
>
			</P
><P
>Jakakolwiek zmiana w konfiguracji nie wymaga restartu demona.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-RUN"
>6.1.4. Uruchomienie</A
></H2
><P
>Program domy¶lnie dzia³a w trybie demona. Wtedy 
			prze³adowanie konfiguracji i us³ug jest dokonywane na ¿±danie, przy u¿yciu menu 
			'Prze³adowanie' w <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>. Sprawdzenie ¿±dania prze³adowania
			oraz odczyt konfiguracji (w szczególno¶ci listy instancji i ich konfiguracji)
			nastêpuje co minutê. Gdy demon wykryje ¿±danie wykonania reloadu, wywo³a 
			wszystkie w³±czone instancje. Instancje z podan± opcj± 'crontab' zostan±
			wykonane o okre¶lonym t± opcj± czasie.</P
><P
>Innym sposobem uruchomienia jest jednorazowy reload z wykorzystaniem
			opcji -q. Ten sposób najczê¶ciej u¿ywany jest w celach testowych, a w po³±czeniu
			z opcj± -i pozwala na wykonanie dowolnych instancji z pominiêciem pozosta³ych
			zapisanych w bazie oraz bez wzglêdu na warto¶æ opcji 'crontab' tych 
			instancji.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Przyk³ad zastosowania lms-mgc</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Modu³y</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>