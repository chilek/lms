<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>A.L.E.C's LMS Daemon</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.5-cvs"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Przyk³ad zastosowania lms-mgc"
HREF="mgc-example.html"><LINK
REL="NEXT"
TITLE="Modu³y"
HREF="daemon-modules.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-2"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.5-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="DAEMON"
></A
>Rozdzia&#322; 6. A.L.E.C's LMS Daemon</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Spis tre&#347;ci</B
></DT
><DT
>6.1. <A
HREF="daemon.html#DAEMON-INTRO"
>Informacje podstawowe</A
></DT
><DD
><DL
><DT
>6.1.1. <A
HREF="daemon.html#DAEMON-REQUIREMENTS"
>Wymagania</A
></DT
><DT
>6.1.2. <A
HREF="daemon.html#DAEMON-INSTALL"
>Instalacja</A
></DT
><DT
>6.1.3. <A
HREF="daemon.html#DAEMON-CONFIG"
>Konfiguracja</A
></DT
><DT
>6.1.4. <A
HREF="daemon.html#DAEMON-RUN"
>Uruchomienie</A
></DT
></DL
></DD
><DT
>6.2. <A
HREF="daemon-modules.html"
>Modu³y</A
></DT
><DD
><DL
><DT
>6.2.1. <A
HREF="daemon-modules.html#DAEMON-MODULESLIST"
>Lista dostêpnych modu³ów</A
></DT
><DT
>6.2.2. <A
HREF="daemon-modules.html#DAEMON-SYSTEM"
>System</A
></DT
><DT
>6.2.3. <A
HREF="daemon-modules.html#DAEMON-PAYMENTS"
>Payments</A
></DT
><DT
>6.2.4. <A
HREF="daemon-modules.html#DAEMON-NOTIFY"
>Notify</A
></DT
><DT
>6.2.5. <A
HREF="daemon-modules.html#DAEMON-GGNOTIFY"
>Ggnotify</A
></DT
><DT
>6.2.6. <A
HREF="daemon-modules.html#DAEMON-CUTOFF"
>Cutoff</A
></DT
><DT
>6.2.7. <A
HREF="daemon-modules.html#DAEMON-DHCP"
>Dhcp</A
></DT
><DT
>6.2.8. <A
HREF="daemon-modules.html#DAEMON-HOSTFILE"
>Hostfile</A
></DT
><DT
>6.2.9. <A
HREF="daemon-modules.html#DAEMON-TRAFFIC"
>Traffic</A
></DT
><DT
>6.2.10. <A
HREF="daemon-modules.html#DAEMON-TC"
>Tc (HTB)</A
></DT
><DT
>6.2.11. <A
HREF="daemon-modules.html#DAEMON-DNS"
>Dns</A
></DT
><DT
>6.2.12. <A
HREF="daemon-modules.html#DAEMON-ETHERS"
>Ethers</A
></DT
><DT
>6.2.13. <A
HREF="daemon-modules.html#DAEMON-OIDENT"
>Oident</A
></DT
><DT
>6.2.14. <A
HREF="daemon-modules.html#DAEMON-PINGER"
>Pinger</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DAEMON-INTRO"
>6.1. Informacje podstawowe</A
></H1
><P
>Napisany w jêzyku C program ma u³atwiaæ zarz±dzanie us³ugami. Sam demon odpowiada
    	za uruchamianie odpowiednich modu³ów na ¿±danie u¿ytkownika. Modu³y
    	natomiast, s³u¿± do tworzenia plików konfiguracyjnych na podstawie 
    	danych z bazy LMS'a oraz restartowania odpowiednich us³ug na serwerze.
    	</P
><P
>Dlaczego taka nazwa? Wiêkszo¶æ kodu demona napisa³ jeden z developerów - Aleksander 
	'A.L.E.C' Machniak, niemniej nale¿y tak¿e podkre¶liæ udzia³ Marcina 'Lexx' Króla. Program zawiera
	fragmenty kodu autorstwa Mateusza 'mteg' Golicza oraz korzysta z biblioteki
	iniparser Nicolasa Devillarda. Je¶li Ty masz ochotê napisaæ jaki¶ modu³ lub poprawiæ 
	funkcjonalno¶æ demona jak najbardziej do tego zachêcam.
	</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-REQUIREMENTS"
>6.1.1. Wymagania</A
></H2
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>A.L.E.C's LMS Daemon</I
></SPAN
> potrzebuje:
      			<UL
><LI
><P
>instalacji interfejsu u¿ytkownika <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
></P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libmysqlclient</TT
> (tj. pe³nej instalacji MySQL'a lub odpowiedniego 
				pakietu) lub <TT
CLASS="FILENAME"
>libpq</TT
> w przypadku bazy PostgreSQL</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libdl</TT
> (to w ka¿dej dzisiejszej dystrybucji jest)</P
></LI
><LI
><P
>kompilatora jêzyka C </P
></LI
></UL
>
      			</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-INSTALL"
>6.1.2. Instalacja</A
></H2
><P
>Przed kompilacj± nale¿y przy pomocy skryptu <TT
CLASS="FILENAME"
>./configure</TT
>
			ustaliæ opcje przedstawione na poni¿szym listingu (w nawiasach podano
			warto¶ci domy¶lne opcji):
<PRE
CLASS="SCREEN"
>  --help                pomoc
  --enable-debug0       logowanie zapytañ SQL (wy³±czone)
  --enable-debug1       logowanie zdarzeñ (wy³±czone)
  --with-sqlite		gdy korzystasz z bazy SQLite (wy³±czone)
  --with-pgsql          gdy korzystasz z bazy PostgreSQL (wy³±czone)
  --with-mysql          gdy korzystasz z bazy MySQL (w³±czone)
  --prefix=DIR          katalog instalacyjny demona (/usr/local/bin)
  --libdir=DIR          lokalizacja bibliotek bazy danych (/usr/lib)
  --incdir=DIR          lokalizacja plików nag³ówkowych bazy danych (/usr/include)</PRE
>
			Zatem wymagane jest okre¶lenie bazy z jakiej bêdziemy korzystaæ (-with-mysql 
			lub -with-pgsql) oraz po³o¿enia bibliotek dostarczanych wraz z baz± (--incdir, --libdir).
<PRE
CLASS="SCREEN"
># ./configure --with-pgsql --libdir=/usr/local/pgsql/lib --incdir=/usr/local/pgsql/include</PRE
>
    			Nastêpnie kompilacja i instalacja (umieszczenie demona w katalogu
			okre¶lonym zmienn± --prefix):
<PRE
CLASS="SCREEN"
># make &#38;&#38; make install</PRE
>
			Na koniec skompilowane modu³y (pliki z rozszerzeniem <TT
CLASS="FILENAME"
>.so</TT
>),
			znajduj±ce siê w katalogu <TT
CLASS="FILENAME"
>modules/nazwa_modu³u</TT
> przenie¶ 
			do dowolnego katalogu. Ich lokalizacjê bêdziesz okre¶la³ w pliku konfiguracyjnym.
			</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-CONFIG"
>6.1.3. Konfiguracja</A
></H2
><P
>Przyk³adowy konfig demona i modu³ów zawarto w pliku <TT
CLASS="FILENAME"
>lms.ini.sample</TT
>.
			Poni¿szy listing przedstawia podstawowe opcje dla demona (konfiguracjê modu³ów omówiono w 
			osobnych rozdzia³ach ich dotycz±cych):
<PRE
CLASS="SCREEN"
>[database]
host            = localhost     # nazwa lub ip hosta, domy¶lnie: localhost
user            = lms           # nazwa u¿ytkownika, domy¶lnie: lms
password        = mypasswd      # has³o do bazy, domy¶lnie: puste
database        = lms           # nazwa bazy, domy¶lnie: lms
port            = 0             # numer portu, domy¶lnie: 0

[lmsd]
sleeptime       = 30            # okre¶la odstêp czasu (w sekundach) jak czêsto ma
                                # byæ sprawdzane ¿±danie reloadu, domy¶lnie: 30
instances       = hosts oident firewall       # lista instancji modu³ów
command         = 'echo "³±czê siê z baz±"'   # polecenie wykonywane przed ka¿dym po³±czeniem z baz±	</PRE
>
			<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Notatka"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Lista instancji sk³ada siê z nazw instancji oddzielonych 
			spacj±. Instancja to nazwa sekcji w pliku konfiguracyjnym.</P
></TD
></TR
></TABLE
></DIV
>
			</P
><P
>W sekcji dotycz±cej instancji, oprócz parametrów konfiguracji
			modu³ów, umieszcza siê opcje podstawowe, jak na poni¿szym listingu:
<PRE
CLASS="SCREEN"
>[nazwa_instancji]
module = /¶cie¿ka/nazwa_modu³u.so
info = "Opcjonalny opis modu³u"</PRE
>		
			</P
><P
>Zmiana opcji 'instances' oraz dowolnej opcji w sekcjach
			instancji, w odró¿nieniu od pozosta³ych opcji globalnych,
			nie wymaga restartu demona.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-RUN"
>6.1.4. Uruchomienie</A
></H2
><P
>Program mo¿esz uruchamiaæ jako demona pracuj±cego w tle (opcja '-b'). Wtedy 
			prze³adowanie konfiguracji i us³ug jest dokonywane na ¿±danie, przy u¿yciu menu 
			'Prze³adowanie' w <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>. Opcja 'sleeptime' (-s) okre¶la okres miêdzy
			odczytami bazy. Gdy demon wykryje ¿±danie wykonania reloadu, wywo³a 
			modu³y okre¶lone opcj± 'instances' z <TT
CLASS="FILENAME"
>lms.ini</TT
>.
			Na przyk³ad:
<PRE
CLASS="SCREEN"
># almsd -b</PRE
>			
			</P
><P
>Innym sposobem uruchomienia jest jednorazowy reload w wykorzystaniem
			crona. Z tego sposobu nale¿y korzystaæ uruchamiaj±c modu³y takie jak 'payments'
			'notify', 'traffic', czy 'pinger'. W tym wypadku mo¿esz okre¶liæ listê 
			instancji do wykonania za pomoc± opcji '-i'.
			Przyk³adowy wpis do crontab'a wygl±da nastêpuj±co:
<PRE
CLASS="SCREEN"
>  1 0 * * *    /usr/local/bin/almsd -qi "payments notify"</PRE
>
			</P
><P
>Poni¿szy listing przedstawia dostêpne opcje linii poleceñ programu:
<PRE
CLASS="SCREEN"
>  -c	¶cie¿ka do pliku konfiguracyjnego (domy¶lnie: /etc/lms/lms.ini)
  -i	lista instancji (oddzielonych spacj±) do prze³adowania
  -b	uruchomienie w tle
  -s	czas w sek. miêdzy odczytami tabeli 'reload' (domy¶lnie: 30)
  -q 	wykonaj reload i zakoñcz
  -h 	wy¶wietla opcje linii poleceñ</PRE
>
			</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Przyk³ad zastosowania lms-mgc</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Modu³y</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>