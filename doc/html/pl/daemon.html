<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>LMS Daemon</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.11-cvs"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PrzykĹad zastosowania lms-mgc"
HREF="mgc-example.html"><LINK
REL="NEXT"
TITLE="ModuĹy"
HREF="daemon-modules.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.11-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="DAEMON"
></A
>Rozdzia&#322; 6. LMS Daemon</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Spis tre&#347;ci</B
></DT
><DT
>6.1. <A
HREF="daemon.html#DAEMON-INTRO"
>Informacje podstawowe</A
></DT
><DD
><DL
><DT
>6.1.1. <A
HREF="daemon.html#DAEMON-REQUIREMENTS"
>Wymagania</A
></DT
><DT
>6.1.2. <A
HREF="daemon.html#DAEMON-INSTALL"
>Instalacja</A
></DT
><DT
>6.1.3. <A
HREF="daemon.html#DAEMON-CONFIG"
>Konfiguracja</A
></DT
><DT
>6.1.4. <A
HREF="daemon.html#DAEMON-RUN"
>Uruchomienie</A
></DT
></DL
></DD
><DT
>6.2. <A
HREF="daemon-modules.html"
>ModuĹy</A
></DT
><DD
><DL
><DT
>6.2.1. <A
HREF="daemon-modules.html#DAEMON-MODULESLIST"
>Lista dostÄpnych moduĹĂłw</A
></DT
><DT
>6.2.2. <A
HREF="daemon-modules.html#DAEMON-SYSTEM"
>System</A
></DT
><DT
>6.2.3. <A
HREF="daemon-modules.html#DAEMON-PAYMENTS"
>Payments</A
></DT
><DT
>6.2.4. <A
HREF="daemon-modules.html#DAEMON-NOTIFY"
>Notify</A
></DT
><DT
>6.2.5. <A
HREF="daemon-modules.html#DAEMON-GGNOTIFY"
>Ggnotify</A
></DT
><DT
>6.2.6. <A
HREF="daemon-modules.html#DAEMON-CUTOFF"
>Cutoff</A
></DT
><DT
>6.2.7. <A
HREF="daemon-modules.html#DAEMON-DHCP"
>Dhcp</A
></DT
><DT
>6.2.8. <A
HREF="daemon-modules.html#DAEMON-HOSTFILE"
>Hostfile</A
></DT
><DT
>6.2.9. <A
HREF="daemon-modules.html#DAEMON-TRAFFIC"
>Traffic</A
></DT
><DT
>6.2.10. <A
HREF="daemon-modules.html#DAEMON-TC"
>Tc (HTB)</A
></DT
><DT
>6.2.11. <A
HREF="daemon-modules.html#DAEMON-TC-NEW"
>Tc-new (HTB)</A
></DT
><DT
>6.2.12. <A
HREF="daemon-modules.html#DAEMON-DNS"
>Dns</A
></DT
><DT
>6.2.13. <A
HREF="daemon-modules.html#DAEMON-ETHERS"
>Ethers</A
></DT
><DT
>6.2.14. <A
HREF="daemon-modules.html#DAEMON-OIDENT"
>Oident</A
></DT
><DT
>6.2.15. <A
HREF="daemon-modules.html#DAEMON-PINGER"
>Pinger</A
></DT
><DT
>6.2.16. <A
HREF="daemon-modules.html#DAEMON-PARSER"
>Parser</A
></DT
><DT
>6.2.17. <A
HREF="daemon-modules.html#DAEMON-EWX-PT"
>Ewx-pt</A
></DT
><DT
>6.2.18. <A
HREF="daemon-modules.html#DAEMON-EWX-STM"
>Ewx-stm</A
></DT
></DL
></DD
><DT
>6.3. <A
HREF="tscript.html"
>T-Script</A
></DT
><DD
><DL
><DT
>6.3.1. <A
HREF="tscript.html#TSCRIPT-INTRO"
>WstÄp</A
></DT
><DT
>6.3.2. <A
HREF="tscript.html#TSCRIPT-SYNTAX"
>SkĹadnia</A
></DT
><DT
>6.3.3. <A
HREF="tscript.html#EXTENSIONS"
>Rozszerzenia</A
></DT
><DT
>6.3.4. <A
HREF="tscript.html#EXAMPLES"
>PrzykĹadowe skrypty</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DAEMON-INTRO"
>6.1. Informacje podstawowe</A
></H1
><P
>Napisany w jÄzyku C program ma uĹatwiaÄ zarzÄdzanie usĹugami. Sam demon odpowiada
	za uruchamianie odpowiednich moduĹĂłw na ĹźÄdanie uĹźytkownika. ModuĹy
	natomiast, sĹuĹźÄ do tworzenia plikĂłw konfiguracyjnych na podstawie 
	danych z bazy LMS'a oraz restartowania odpowiednich usĹug na serwerze.
	SpeĹniajÄ takĹźe inne funkcje np. zbieranie statystyk, badanie aktywnoĹci
	hostĂłw, naliczanie opĹat, powiadamianie o zalegĹoĹciach.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-REQUIREMENTS"
>6.1.1. Wymagania</A
></H2
><P
>Oto lista rzeczy, ktĂłre <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> potrzebuje juĹź na etapie kompilacji:
			<UL
><LI
><P
>interfejs uĹźytkownika <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
></P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libmysqlclient</TT
> (tj. peĹnej instalacji MySQL'a lub odpowiedniego 
				pakietu) lub <TT
CLASS="FILENAME"
>libpq</TT
> w przypadku bazy PostgreSQL</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libdl</TT
> (to w kaĹźdej dzisiejszej dystrybucji jest)</P
></LI
><LI
><P
>kompilator jÄzyka C (testowany na gcc-2.95.x i nowszych)</P
></LI
><LI
><P
>moduĹ <TT
CLASS="FILENAME"
>ggnotify</TT
> wymaga biblioteki <TT
CLASS="FILENAME"
>libgadu</TT
>
				i jej plikĂłw nagĹĂłwkowych</P
></LI
><LI
><P
>moduĹ <TT
CLASS="FILENAME"
>parser</TT
> wymaga pakietu bison w wersji 1.875 lub nowszej 
				oraz pakietu flex</P
></LI
><LI
><P
>moduĹy <TT
CLASS="FILENAME"
>ewx-*</TT
> wymagajÄ biblioteki net-snmp i jej plikĂłw nagĹĂłwkowych.</P
></LI
></UL
>
      			</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-INSTALL"
>6.1.2. Instalacja</A
></H2
><P
>Przed kompilacjÄ naleĹźy przy pomocy skryptu <TT
CLASS="FILENAME"
>./configure</TT
>
			ustaliÄ opcje przedstawione na poniĹźszym listingu (w nawiasach podano
			wartoĹci domyĹlne opcji):
<PRE
CLASS="SCREEN"
>  --help                pomoc
  --enable-debug0       logowanie zapytaĹ SQL (wyĹÄczone)
  --enable-debug1       logowanie zdarzeĹ (wyĹÄczone)
  --with-pgsql          gdy korzystasz z bazy PostgreSQL (wyĹÄczone)
  --with-mysql          gdy korzystasz z bazy MySQL (wĹÄczone)
  --prefix=PREFIX       docelowy katalog instalacyjny demona i moduĹĂłw (/usr/local)
  --lmsbindir=DIR       docelowa lokalizacja binarki lmsd (PREFIX/lms/bin)
  --lmslibdir=DIR       docelowa lokalizacja moduĹĂłw lmsd (PREFIX/lms/lib)
  --libdir=DIR          lokalizacja bibliotek bazy danych (/usr/lib)
  --incdir=DIR          lokalizacja plikĂłw nagĹĂłwkowych bazy danych (/usr/include)
  --inifile=FILE        plik konfiguracyjny - wyĹÄcza konfiguracjÄ przez UI</PRE
>
			Zatem wymagane jest okreĹlenie bazy z jakiej bÄdziemy korzystaÄ (-with-mysql 
			lub -with-pgsql) oraz poĹoĹźenia bibliotek dostarczanych wraz z bazÄ (--incdir, 
			--libdir). MoĹźliwe jest zmuszenie demona do korzystania
			z plikĂłw konfiguracyjnych zamiast bazy danych. Nie jest
			moĹźliwe uĹźywanie obu sposobĂłw przechowywania konfiguracji,
			dlatego naleĹźy o tym zdecydowaÄ przed kompilacjÄ.
<PRE
CLASS="SCREEN"
># ./configure --with-pgsql --libdir=/usr/local/pgsql/lib --incdir=/usr/local/pgsql/include</PRE
>
    			NastÄpnie kompilacja i instalacja (umieszczenie demona w katalogu
			okreĹlonym zmiennÄ --prefix):
<PRE
CLASS="SCREEN"
># make &#38;&#38; make install</PRE
>
			Skompilowane moduĹy (pliki z rozszerzeniem <TT
CLASS="FILENAME"
>.so</TT
>),
			znajdujÄce siÄ w katalogu <TT
CLASS="FILENAME"
>modules/nazwa_moduĹu</TT
> zostajÄ 
			umieszczone w katalogu PREFIX/lms/lib, a gĹĂłwny program (lmsd) w katalogu
			PREFIX/lms/bin.
			</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-CONFIG"
>6.1.3. Konfiguracja</A
></H2
><P
>CaĹÄ konfiguracjÄ demona i moduĹĂłw przeprowadza siÄ przy pomocy
			<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> w menu Konfiguracja -&#62; Demon.
			KonfiguracjÄ moduĹĂłw omĂłwiono w osobnych rozdziaĹach ich dotyczÄcych.
			Podstawowe parametry pracy demona i dane do poĹÄczenia z bazÄ danych
			podaje siÄ jako opcje linii komend, zgodnie z poniĹźszym listingiem:
<PRE
CLASS="SCREEN"
>--dbhost -h host[:port]    host na ktĂłrym zainstalowana jest baza danych (domyĹlnie: 'localhost')
--dbname -d nazwa_bazy     nazwa bazy danych (domyĹlnie: 'lms')
--dbuser -u uĹźytkownik     nazwa uĹźytkownika bazy danych (domyĹlnie: 'lms')
--dbpass -p hasĹo          hasĹo do bazy danych (domyĹlnie: puste)
--hostname -H nazwa_hosta  host, na ktĂłrym dziaĹa demon. DomyĹlnie przyjmowana jest nazwa
                           zwracana przez komendÄ hostname, ale moĹźna jÄ nadpisaÄ. Nazwa
                           ta musi zgadzaÄ siÄ z nazwÄ hosta podanÄ w konfiguracji hostĂłw
--pidfile -P pid_file      pidfile where daemon write pid (default: none)
--ssl -s                   wymusza bezpieczne poĹÄczenie z bazÄ danych (domyĹlnie: wyĹÄczone)
--command -c polecenie     polecenie powĹoki do wykonania przed kaĹźdym poĹÄczeniem z bazÄ 
                           tzn. co minutÄ (domyĹlnie: puste)
--instance -i "instancja[ ...]" lista instancji (moduĹĂłw) do przeĹadowania. Wszystkie pozostaĹe 
                           zostanÄ pominiÄte
--reload -q                wykonuje przeĹadowanie i koĹczy pracÄ
--reload-all -r            wykonuje przeĹadowanie wszystkich instancji (takĹźe tych, ktĂłre majÄ
                           zdefiniowany crontab) i koĹczy pracÄ
--foreground -f            dziaĹa na pierwszym planie (nie forkuje siÄ) 
--version -v               wyĹwietla wersjÄ i prawa licencyjne</PRE
>
			Opcje dostÄpu do bazy sÄ takĹźe odczytywane ze zmiennych powĹoki:
			LMSDBPASS, LMSDBNAME, LMSDBUSER, LMSDBHOST, LMSDBPORT.
			<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Notatka"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Lista instancji skĹada siÄ z nazw instancji oddzielonych 
			spacjÄ. W nazwach instancji zawierajÄcych spacje naleĹźy zamieniÄ je
			na znaki '\s', np. <SAMP
CLASS="PROMPT"
>lmsd -i "moja\sinstancja"</SAMP
>.
			</P
></TD
></TR
></TABLE
></DIV
>
			</P
><P
>Konfiguracja demona jest podzielona na hosty (umoĹźliwiajÄc
			osobne konfigurowanie i przeĹadowywanie demonĂłw zainstalowanych
			na rĂłĹźnych komputerach/routerach) oraz sekcje konfiguracyjne 
			nazwane instancjami.</P
><P
>Instancja oprĂłcz parametrĂłw konfiguracyjnych wybranego moduĹu
			zawiera opcje podstawowe, takie jak:
			<UL
><LI
><P
>Nazwa</P
><P
>Nazwa instancji unikalna w obrÄbie jednego hosta.</P
><P
>PrzykĹad: system</P
></LI
><LI
><P
>Priorytet</P
><P
>Liczba okreĹlajÄca priorytet, czyli kolejnoĹÄ wykonania instancji. Instancja o najniĹźszym numerze zostanie wykonana jako pierwsza.</P
><P
>PrzykĹad: 10</P
></LI
><LI
><P
>ModuĹ</P
><P
>Nazwa pliku moduĹu (z rozszerzeniem lub bez). JeĹli nie podano
				ĹcieĹźki demon bÄdzie szukaĹ moduĹu w katalogu PREFIX/lms/lib, do
				ktĂłrego trafiajÄ moduĹy podczas "make install".</P
><P
>PrzykĹad: /usr/lib/system.so</P
></LI
><LI
><P
>Crontab</P
><P
>Czas wykonania moduĹu okreĹlany w sposĂłb podobny do uĹźywanego w programie crontab. Wszystkie dane muszÄ byÄ numeryczne.
				Podany przykĹad spowoduje wykonywanie wybranej instancji co 5 minut, w godzinach od 8 do 18. Gdy opcja ta jest pusta instancja 
				zostanie wykonana wyĹÄcznie podczas przeĹadowania. DomyĹlnie: pusta.</P
><P
>PrzykĹad: */5 8-18 * * *</P
></LI
></UL
>
			</P
><P
>Jakakolwiek zmiana w konfiguracji nie wymaga restartu demona.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-RUN"
>6.1.4. Uruchomienie</A
></H2
><P
>Program domyĹlnie dziaĹa w trybie demona. Wtedy 
			przeĹadowanie konfiguracji i usĹug jest dokonywane na ĹźÄdanie, przy uĹźyciu menu 
			'PrzeĹadowanie' w <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>. Sprawdzenie ĹźÄdania przeĹadowania
			oraz odczyt konfiguracji (w szczegĂłlnoĹci listy instancji i ich konfiguracji)
			nastÄpuje co minutÄ. Gdy demon wykryje ĹźÄdanie wykonania reloadu, wywoĹa 
			wszystkie wĹÄczone instancje. Instancje z podanÄ opcjÄ 'crontab' zostanÄ
			wykonane o okreĹlonym tÄ opcjÄ czasie.</P
><P
>Innym sposobem uruchomienia jest jednorazowy reload z wykorzystaniem
			opcji -q. Ten sposĂłb najczÄĹciej uĹźywany jest w celach testowych, a w poĹÄczeniu
			z opcjÄ -i pozwala na wykonanie dowolnych instancji z pominiÄciem pozostaĹych
			zapisanych w bazie oraz bez wzglÄdu na wartoĹÄ opcji 'crontab' tych 
			instancji.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PrzykĹad zastosowania lms-mgc</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>ModuĹy</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>