<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Parser</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.7-cvs"
HREF="index.html"><LINK
REL="UP"
TITLE="LMS Daemon"
HREF="daemon.html"><LINK
REL="PREVIOUS"
TITLE="Modu³y"
HREF="daemon-modules.html"><LINK
REL="NEXT"
TITLE="Dla dociekliwych"
HREF="devel.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-2"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.7-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="daemon-modules.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Rozdzia&#322; 6. LMS Daemon</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="devel.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DAEMON-PARSER"
>6.3. Parser</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-PARSER-INTRO"
>6.3.1. Wstêp</A
></H2
><P
>Modu³ parser jest oparty na skryptowym jêzyku
	    <A
HREF="http://silvercoders.com/index.php?page=T_Script"
TARGET="_top"
>T-Script</A
>,
	    którego g³ównym zadaniem jest generowanie plików tekstowych. Mo¿e byæ
	    u¿ywany do przetwarzania szablonów z danymi pobieranymi z ró¿nych
	    ¼róde³ np. baz SQL lub plików tekstowych. W naszym przypadku tre¶æ
	    skryptu (szablon) jest przechowywany w bazie danych, dlatego istnieje
	    mo¿liwo¶æ jego edycji poprzez <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>.
	    W przysz³o¶ci modu³ parser mo¿e zast±piæ wiêkszo¶æ modu³ów demona.</P
><P
>Przed kompilacj± modu³u upewnij siê, ¿e posiadasz w systemie
	    pakiety <TT
CLASS="FILENAME"
>bison</TT
> (co najmniej w wersji 1.875) oraz 
	    <TT
CLASS="FILENAME"
>flex</TT
>.
	    </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-PARSER-CONFIG"
>6.3.2. Konfiguracja</A
></H2
><P
>Parser posiada nastêpuj±ce opcje:</P
><UL
><LI
><P
>script</P
><P
>Zawarto¶æ skryptu (szablonu). Domy¶lnie: pusta.</P
><P
>Przyk³ad: <SAMP
CLASS="PROMPT"
>script = '{var=1}zmienna var={var}'</SAMP
></P
></LI
><LI
><P
>file</P
><P
>Lokalizacja pliku wynikowego. Domy¶lnie: pusta</P
><P
>Przyk³ad: <SAMP
CLASS="PROMPT"
>file = /tmp/parser.out</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Polecenie pow³oki do wykonania po kompilacji skryptu. Domy¶lnie: pusta</P
><P
>Przyk³ad: <SAMP
CLASS="PROMPT"
>command = "sh /tmp/parser.out"</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-PARSER-SYNTAX"
>6.3.3. Sk³adnia</A
></H2
><P
>Sk³adnia jêzyka T-Script jest podobna do sk³adni innych popularnych
	    jêzyków takich jak C czy JavaScript, ale dokonano pewnych zmian
	    maj±cych na celu u³atwienie tworzenia szablonów. 
	    Wszystkie podane polecenia powinny byæ zapisywane wewn±trz klamer { }.
	    Dane poza klamrami zostan± zapisane do pliku wyj¶ciowego (lub je¶li go
	    nie zdefiniowano, pominiête). Wielko¶æ liter ma znaczenie.</P
><P
>Wyra¿enia:
	    <UL
><LI
><P
>Ci±g znaków.</P
><P
><PRE
CLASS="SCREEN"
>"jaki¶ ci±g znaków"</PRE
></P
></LI
><LI
><P
>Liczba.</P
><P
><PRE
CLASS="SCREEN"
>1234</PRE
></P
></LI
><LI
><P
>Warto¶æ zmiannej "var".</P
><P
><PRE
CLASS="SCREEN"
>var</PRE
></P
></LI
><LI
><P
>N-ty element tablicy "var".</P
><P
><PRE
CLASS="SCREEN"
>var[n]</PRE
></P
></LI
><LI
><P
>Podzmienna "n" zmiennej "var".</P
><P
><PRE
CLASS="SCREEN"
>var.n</PRE
></P
></LI
><LI
><P
>Warto¶æ wyra¿enia w nawiasach.</P
><P
><PRE
CLASS="SCREEN"
>( &lt;wyra¿enie&gt; )</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy wyra¿enie nie jest prawd±, w przeciwnym wypadku 0.</P
><P
><PRE
CLASS="SCREEN"
>! &lt;wyra¿enie&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy warto¶æ wyra¿enie1 jest identyczna z warto¶ci± wyra¿enie2 
		    lub 0 gdy s± ró¿ne.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; == &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy wyra¿enia s± ró¿ne lub 0 gdy s± takie same.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; != &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy wyra¿enie1 jest mniejsze od warto¶ci wyra¿enia wyra¿enie2.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; &lt; &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy warto¶æ wyra¿enie1 jest wiêksza od warto¶ci wyra¿enie2.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; &gt; &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy jedno z wyra¿eñ jest prawd±.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; || &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy wyra¿enie1 i wyra¿enie2 s± prawdziwe.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; &#38;&#38; &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Gdy oba wyra¿enia s± liczbami zwraca wynik operacji
		    arytmetycznej. W innym przypadku traktuje wyra¿enia jako ci±gi
		    znaków i dokonuje ich po³±czenia.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; + &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca wynik operacji arytmetycznej na dwóch wyra¿eniach.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie1&gt; - &lt;wyra¿enie2&gt;
&lt;wyra¿enie1&gt; * &lt;wyra¿enie2&gt;
&lt;wyra¿enie1&gt; / &lt;wyra¿enie2&gt;
&lt;wyra¿enie1&gt; % &lt;wyra¿enie2&gt;</PRE
></P
></LI
><LI
><P
>Zwraca 1 gdy wyra¿enie pasuje do wzorca po prawej stronie,
		    w przeciwnym wypadku zwraca 0.</P
><P
><PRE
CLASS="SCREEN"
>&lt;wyra¿enie&gt; =~ &lt;wzorzec&gt;</PRE
></P
></LI
></UL
>
	    </P
><P
>Komentarze:
	    <UL
><LI
><P
>Komentarz w stylu jêzyka C.</P
><P
>		    <PRE
CLASS="SCREEN"
>{/* to jest komentarz - mo¿e byæ wieloliniowy */}</PRE
></P
></LI
></UL
>
	    </P
><P
>Podstawowe polecenia:
	    <UL
><LI
><P
>Przypisanie warto¶ci wyra¿enia do podanej zmiennej.</P
><P
>		    <PRE
CLASS="SCREEN"
>{&lt;nazwa_zmiennej&gt; = &lt;wyra¿enie&gt;}</PRE
></P
></LI
><LI
><P
>Wykonanie polecenia tylko wtedy gry wyra¿enie jest prawd±. 
		    Druga forma wykonuje polecenie1 gdy wyra¿enie jest prawd± lub polecenie2
		    gdy jest fa³szem.</P
><P
><PRE
CLASS="SCREEN"
>{if ( &lt;wyra¿enie&gt; )} &lt;polecenia&gt; {/if}
{if ( &lt;wyra¿enie&gt; )} &lt;polecenie1&gt; {else} &lt;polecenie2&gt; {/if}</PRE
></P
><P
>Tekst miêdzy blokami jest traktowany jako polecenia
		    dlatego nastêpuj±cy przyk³ad jest prawid³owy:
<PRE
CLASS="SCREEN"
>Jaki¶ tekst
{if (a==1)} 
a równe jest 1
{else} 
a nie jest równe 1
{/if} </PRE
>
Mo¿na wstawiæ backslash (\) pomiêdzy poleceniem a koñcem wiersza aby
pozbyæ siê znaku koñca linii i zachowaæ normalny (bez za³amania linii w tym miejscu)
przep³yw tekstu. Na przyk³ad: 
<PRE
CLASS="SCREEN"
>Jaki¶ tekst
{if (a==1)}\ 
a równa siê 1 
{else}\ 
a nie równa siê 1 
{/if}\</PRE
></P
></LI
><LI
><P
>Wykonanie polecenie1 jako polecenia inicjalizuj±cego pêtlê. Nastêpnie
		    wykonywane jest polecenie i polecenie2, dopóki wyra¿enie jest prawdziwe.</P
><P
><PRE
CLASS="SCREEN"
>{for ( &lt;polecenie1&gt; ; &lt;wyra¿enie&gt; ; &lt;polecenie2&gt; )} &lt;polecenia&gt; {/for}</PRE
></P
></LI
><LI
><P
>Przekierowanie wyj¶cia do pliku. Dane zostan± dopisane
		    do pliku.</P
><P
><PRE
CLASS="SCREEN"
>{file &lt;nazwa_pliku&gt;} &lt;polecenia&gt; {/file}</PRE
></P
></LI
></UL
>
	    </P
><P
>Podstawowe funkcje:
	    <UL
><LI
><P
>Zamiana warto¶ci liczbowej na ci±g znaków.</P
><P
><PRE
CLASS="SCREEN"
>{string(&lt;zmienna&gt;)}</PRE
></P
></LI
><LI
><P
>Zamiana ci±gu znaków na liczbê. Dla tablic zwraca ilo¶æ elementów w tablicy.</P
><P
><PRE
CLASS="SCREEN"
>{number(&lt;zmienna&gt;)}</PRE
></P
></LI
></UL
>
	    </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-PARSER-EXT"
>6.3.4. Rozszerzenia</A
></H2
><P
>Rozszerzenia to dodatki do biblioteki <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>tscript</I
></SPAN
>. 
		S± to funkcje i sta³e, które mo¿na u¿ywaæ w skryptach. Poni¿ej przedstawiono
		rozszerzenia udostêpnione w <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
>.
		<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Notatka"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Funkcje mog± byæ u¿ywane zarówno w sk³adni z nawiasem
		(<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>{funkcja(zmienna)}</I
></SPAN
>) jak i bez nawiasu 
		(<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>{funkcja {zmienna}}</I
></SPAN
>).</P
></TD
></TR
></TABLE
></DIV
>
		</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="EXEC"
>6.3.4.1. Exec</A
></H3
><P
>Wykonywanie poleceñ pow³oki umo¿liwia funkcja exec(). 
		Mo¿liwe jest wykonanie wielu poleceñ oddzielonych ¶rednikami
		w jednym wywo³aniu tej funkcji.</P
><UL
><LI
><P
>Wykonywanie poleceñ pow³oki.</P
><P
><PRE
CLASS="SCREEN"
>{exec &lt;polecenie&gt;}</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="STRING"
>6.3.4.2. String</A
></H3
><P
>'String' zawiera podstawowe funkcje do operowania
		na ci±gach znaków.</P
><UL
><LI
><P
>Usuniêcie "bia³ych" znaków z pocz±tku i koñca 
			ci±gu znaków.</P
><P
><PRE
CLASS="SCREEN"
>{trim &lt;ci±g_znaków&gt;}</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="SQL"
>6.3.4.3. SQL</A
></H3
><P
>Rozszerzenie SQL udostêpnia podstawowe funkcje zwi±zane
		z obs³ug± bazy danych. Pozwala na wykonywanie poleceñ SQL.</P
><UL
><LI
><P
>Polecenia SQL</P
><P
><PRE
CLASS="SCREEN"
>{SELECT &lt;dalszy_ci±g_zapytania&gt;}
{INSERT &lt;dalszy_ci±g_zapytania&gt;}
{DELETE &lt;dalszy_ci±g_zapytania&gt;}
{UPDATE &lt;dalszy_ci±g_zapytania&gt;}
{CREATE &lt;dalszy_ci±g_zapytania&gt;}
{DROP &lt;dalszy_ci±g_zapytania&gt;}</PRE
></P
></LI
><LI
><P
>Liczba wierszy, których dotyczy zapytanie.</P
><P
><PRE
CLASS="SCREEN"
>{rows(&lt;zapytanie_sql&gt;)}</PRE
></P
></LI
><LI
><P
>Zabezpieczenie znaków specjalnych w celu u¿ycia
			w zapytaniu SQL. W szczególno¶ci chodzi o apostrofy 
			i backslashe. Je¶li nie znasz zawarto¶ci zmiennej
			powiniene¶ j± przepu¶ciæ przez escape().</P
><P
><PRE
CLASS="SCREEN"
>{escape(&lt;zmienna&gt;)}</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="CONSTS"
>6.3.4.4. Consts</A
></H3
><P
>Rozszerzenie ¶ci¶le zwi±zane z LMS-em. Umo¿liwia
		tworzenie skryptów bez znajomo¶ci struktury bazy danych.
		Zawiera predefiniowane sta³e, które zawieraj± dane z bazy.
		Zdefiniowane w programie zapytanie jest wykonywane w momencie
		pierwszego u¿ycia sta³ej. Nazwy sta³ych nale¿y pisaæ
		du¿ymi literami. Ka¿da sta³a to tablica zawieraj±ca wiersze
		numerowane od zera, a ka¿dy wiersz posiada podzmienne dostêpne
		poprzez nazwê (pisan± ma³ymi literami).</P
><UL
><LI
><P
>CUSTOMERS - lista klientów:
			    <TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - ID klienta</TD
></TR
><TR
><TD
>lastname - nazwa/nazwisko klienta</TD
></TR
><TR
><TD
>name - imiê klienta</TD
></TR
><TR
><TD
>status - status</TD
></TR
><TR
><TD
>address - adres klienta</TD
></TR
><TR
><TD
>zip - kod pocztowy</TD
></TR
><TR
><TD
>city - miasto</TD
></TR
><TR
><TD
>email - adres e-mail</TD
></TR
><TR
><TD
>phone1, phone2, phone3 - telefony</TD
></TR
><TR
><TD
>ten - NIP</TD
></TR
><TR
><TD
>ssn - PESEL</TD
></TR
><TR
><TD
>info - informacje o kliencie</TD
></TR
><TR
><TD
>message - tre¶æ ostrze¿enia</TD
></TR
><TR
><TD
>warning - status ostrze¿enia (suma statusów wszystkich komputerów klienta)</TD
></TR
><TR
><TD
>access - status dostêpno¶ci (suma statusów wszystkich komputerów klienta)</TD
></TR
><TR
><TD
>balance - bilans klienta</TD
></TR
></TBODY
></TABLE
>
			</P
></LI
><LI
><P
>NODES - lista komputerów (i adresów urz±dzeñ sieciowych):
			    <TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - ID komputera</TD
></TR
><TR
><TD
>owner - nazwa/nazwisko i imiê klienta</TD
></TR
><TR
><TD
>ownerid - ID klienta ('0' w przypadku urz±dzeñ)</TD
></TR
><TR
><TD
>name - nazwa komputera (adresu urz±dzenia)</TD
></TR
><TR
><TD
>access - status: w³±czony/wy³±czony (1/0)</TD
></TR
><TR
><TD
>warning - status ostrze¿eñ: w³±czone/wy³±czone (1/0)</TD
></TR
><TR
><TD
>netdev - ID urz±dzenia, do którego jest pod³±czony</TD
></TR
><TR
><TD
>lastonline - czas ostatniej aktywno¶ci</TD
></TR
><TR
><TD
>info - dodatkowe informacje</TD
></TR
><TR
><TD
>message - tre¶æ ostrze¿enia</TD
></TR
><TR
><TD
>mac - adres MAC</TD
></TR
><TR
><TD
>passwd - has³o</TD
></TR
><TR
><TD
>ip - adres IP</TD
></TR
><TR
><TD
>ip_pub - publiczny adres IP</TD
></TR
><TR
><TD
>linktype - typ po³±czenia (0-kabel, 1-radio)</TD
></TR
></TBODY
></TABLE
>
			</P
></LI
><LI
><P
>NETWORKS - lista sieci:
			    <TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - ID sieci</TD
></TR
><TR
><TD
>name - nazwa sieci</TD
></TR
><TR
><TD
>address - adres IP</TD
></TR
><TR
><TD
>mask - maska (xxx.xxx.xxx.xxx)</TD
></TR
><TR
><TD
>prefix - liczba jedynek w masce</TD
></TR
><TR
><TD
>size - rozmiar sieci (ilo¶æ adresów)</TD
></TR
><TR
><TD
>interface - nazwa interfejsu</TD
></TR
><TR
><TD
>gateway - adres bramy</TD
></TR
><TR
><TD
>dns - adres pierwszego serwera DNS</TD
></TR
><TR
><TD
>dns2 - adres drugiego serwera DNS</TD
></TR
><TR
><TD
>wins - adres WINS</TD
></TR
><TR
><TD
>domain - nazwa domenowa</TD
></TR
><TR
><TD
>dhcpstart - pocz±tek zakresu DHCP</TD
></TR
><TR
><TD
>dhcpend - koniec zakresu DHCP</TD
></TR
></TBODY
></TABLE
>
			</P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="NET"
>6.3.4.5. Net</A
></H3
><P
>W tym rozszerzeniu zawarte s± funkcje (nazwy pisane ma³ymi literami)
		przeznaczone do operowania na adresach IP i maskach.</P
><UL
><LI
><P
>Zamiana maski sieciowej w formacie xxx.xxx.xxx.xxx
			na liczbê (bitów).</P
><P
><PRE
CLASS="SCREEN"
>mask2prefix(&lt;maska&gt;)</PRE
></P
></LI
><LI
><P
>Zamiana adresu IP w formacie 4-oktetowym na
			liczbê.</P
><P
><PRE
CLASS="SCREEN"
>ip2long(&lt;adres&gt;)</PRE
></P
></LI
><LI
><P
>Zamiana adresu IP podanego jako liczba
			na format xxx.xxx.xxx.xxx.</P
><P
><PRE
CLASS="SCREEN"
>long2ip(&lt;adres&gt;)</PRE
></P
></LI
><LI
><P
>Obliczenie adresu broadcast dla podanego
			adresu IP oraz maski (format maski dowolny).</P
><P
><PRE
CLASS="SCREEN"
>broadcast(&lt;adres/maska&gt;)</PRE
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-PARSER-EXAMPLES"
>6.3.5. Przyk³adowe skrypty</A
></H2
><P
>Zacznijmy od bardzo prostego skryptu, który tworzy plik
	    <TT
CLASS="FILENAME"
>/etc/hosts</TT
> z list± adresów i nazw komputerów 
	    (oraz urz±dzeñ).
	    <DIV
CLASS="EXAMPLE"
><A
NAME="PARSER-E1"
></A
><P
><B
>Przyk&#322;ad 6-1. Parser: Tworzenie pliku /etc/hosts</B
></P
><PRE
CLASS="SCREEN"
>{result = SELECT name, inet_ntoa(ipaddr) AS ip FROM nodes}\
127.0.0.1    localhost
{for (r=0; r&lt;number(result); r++)}\
{result[r].name}\t{result[r].ip}
{/for}\</PRE
></DIV
></P
><P
>Utworzenie listy d³u¿ników jest bardzo proste, zw³aszcza
	    gdy zastosujemy jedn± z predefiniowanych sta³ych.
	    <DIV
CLASS="EXAMPLE"
><A
NAME="PARSER-E2"
></A
><P
><B
>Przyk&#322;ad 6-2. Parser: Lista d³u¿ników</B
></P
><PRE
CLASS="SCREEN"
>{for (r=0; r&lt;number(CUSTOMERS); r++)}\
    {if (CUSTOMERS[r].balance &#60; 0)}\
{CUSTOMERS[r].lastname} {CUSTOMERS[r].name}\t{CUSTOMERS[r].balance}
    {/if}
{/for}\</PRE
></DIV
></P
><P
>Kolejny trochê d³u¿szy przyk³ad, w którym wykorzystujemy g³ównie
	    'exec'. Skrypt wysy³a wiadomo¶ci do klientów z bilansem ni¿szym od
	    zadanego limitu.
	    <DIV
CLASS="EXAMPLE"
><A
NAME="PARSER-E3"
></A
><P
><B
>Przyk&#322;ad 6-3. Parser: Zamiennik modu³u notify</B
></P
><PRE
CLASS="SCREEN"
>{limit = 0}
{month = exec date +%B}
{year = exec date +%Y}
{customers = SELECT customers.id AS id, email, pin, name, lastname,
        SUM((type * -2 +7) * cash.value) AS balance
        FROM customers
        LEFT JOIN cash ON customers.id = cash.customerid AND (cash.type = 3 OR cash.type = 4)
        WHERE deleted = 0 AND email!=''
        GROUP BY customers.id, name, lastname, email, pin
        HAVING SUM((type * -2 +7) * cash.value) &lt; {limit}}

{for(i=0; i&lt;number(customers); i++)}

    {exec echo "UWAGA: Niniejsza wiadomo¶æ zosta³a wygenerowana automatycznie.

Uprzejmie informujemy, i¿ na Pani/Pana koncie figuruje zaleg³o¶æ w op³atach za 
Internet w kwocie {customers[i].balance*-1} z³.

Je¿eli nale¿no¶æ za bie¿±cy miesi±c, to jest {trim(month)} {trim(year)}, zosta³a ju¿
uregulowana prosimy zignorowaæ tê wiadomo¶æ.

W przypadku gdy uwa¿a Pani/Pan, ¿e zaleg³o¶æ ta jest nieporozumieniem
prosimy o jak najszybszy kontakt z Biurem Obs³ugi Klienta.

Wiêcej informacji na temat p³atno¶ci mo¿na uzyskaæ pod adresem:
http://naszasiec.pl/mojekonto/

W celu uregulowania nale¿no¶ci prosimy o kontakt:

Nasz Siec ASK - Biuro Obs³ugi Klienta
Gwidon Mniejwa¿ny
telefon: 0-606031337
e-mail: gwidonm@naszasiec.pl

PS. Poni¿ej za³±czamy ostatnie 10 operacji na Pañstwa koncie.
--------------+--------------+-----------------------------
     Data     |    Kwota     |           Komentarz
--------------+--------------+-----------------------------" &gt; /tmp/mail}

    {last10 = SELECT comment, time, CASE WHEN type=4 THEN value*-1 ELSE value END AS value
            FROM cash WHERE customerid = {customers[i].id}
            ORDER BY time DESC LIMIT 10}
    
    {for(j=0; j&lt;number(last10); j++)}
    
        {exec echo "{last10[j].time}|\t{last10[j].value}|\t{last10[j].comment}" &gt;&gt; /tmp/mail}
    
    {/for}

    {exec mail -s "Powiadomienie o zaleglosciach" -r lms@domain.tld {customers[i].email} &lt; /tmp/mail}

{/for}</PRE
></DIV
>
	    </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="daemon-modules.html"
ACCESSKEY="P"
>Poprzedni</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Spis tre&#347;ci</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="devel.html"
ACCESSKEY="N"
>Nast&#281;pny</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Modu³y</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="daemon.html"
ACCESSKEY="U"
>Pocz&#261;tek rozdzia&#322;u</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dla dociekliwych</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>