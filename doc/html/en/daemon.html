<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>A.L.E.C's LMS Daemon</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.5-cvs"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Examples of use"
HREF="mgc-example.html"><LINK
REL="NEXT"
TITLE="Modules"
HREF="daemon-modules.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.5-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="DAEMON"
></A
>Chapter 6. A.L.E.C's LMS Daemon</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>6.1. <A
HREF="daemon.html#DAEMON-INTRO"
>Basics</A
></DT
><DD
><DL
><DT
>6.1.1. <A
HREF="daemon.html#DAEMON-REQUIREMENTS"
>Requirements</A
></DT
><DT
>6.1.2. <A
HREF="daemon.html#DAEMON-INSTALL"
>Installation</A
></DT
><DT
>6.1.3. <A
HREF="daemon.html#DAEMON-CONFIG"
>Configuration</A
></DT
><DT
>6.1.4. <A
HREF="daemon.html#DAEMON-RUN"
>Starting</A
></DT
></DL
></DD
><DT
>6.2. <A
HREF="daemon-modules.html"
>Modules</A
></DT
><DD
><DL
><DT
>6.2.1. <A
HREF="daemon-modules.html#DAEMON-MODULESLIST"
>Modules list</A
></DT
><DT
>6.2.2. <A
HREF="daemon-modules.html#DAEMON-SYSTEM"
>System</A
></DT
><DT
>6.2.3. <A
HREF="daemon-modules.html#DAEMON-PAYMENTS"
>Payments</A
></DT
><DT
>6.2.4. <A
HREF="daemon-modules.html#DAEMON-NOTIFY"
>Notify</A
></DT
><DT
>6.2.5. <A
HREF="daemon-modules.html#DAEMON-GGNOTIFY"
>Ggnotify</A
></DT
><DT
>6.2.6. <A
HREF="daemon-modules.html#DAEMON-CUTOFF"
>Cutoff</A
></DT
><DT
>6.2.7. <A
HREF="daemon-modules.html#DAEMON-DHCP"
>DHCP</A
></DT
><DT
>6.2.8. <A
HREF="daemon-modules.html#DAEMON-HOSTFILE"
>Hostfile</A
></DT
><DT
>6.2.9. <A
HREF="daemon-modules.html#DAEMON-TRAFFIC"
>Traffic</A
></DT
><DT
>6.2.10. <A
HREF="daemon-modules.html#DAEMON-TC"
>Tc (HTB)</A
></DT
><DT
>6.2.11. <A
HREF="daemon-modules.html#DAEMON-DNS"
>Dns</A
></DT
><DT
>6.2.12. <A
HREF="daemon-modules.html#DAEMON-ETHERS"
>Ethers</A
></DT
><DT
>6.2.13. <A
HREF="daemon-modules.html#DAEMON-OIDENT"
>Oident</A
></DT
><DT
>6.2.14. <A
HREF="daemon-modules.html#DAEMON-PINGER"
>Pinger</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DAEMON-INTRO"
>6.1. Basics</A
></H1
><P
>This C daemon was developed to aid management of your services. It's responsible for
     starting appropriate modules, each performing specific task. You have to select modules that
     you intend to use before starting the daemon. Each module makes configuration files based on
     its template and data from LMS database and manages (restarting) selected services on a server.
     </P
><P
>Why such name? The majority of daemon code has been written by one of developers -
     Aleksander 'A.L.E.C' Machniak. Nevertheless we must emphasize contributions done by Marcin 'Lexx'
     Krol. It also includes fragments of code of Mateusz 'mteg' Golicz old daemon and use Nicolas
     Devillard iniparser library. </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-REQUIREMENTS"
>6.1.1. Requirements</A
></H2
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>A.L.E.C's LMS Daemon</I
></SPAN
> requires:
                     <UL
><LI
><P
>LMS user interface installation</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libmysqlclient</TT
> shared library (included in full MySQL
                    installation or respective "devel" package) or <TT
CLASS="FILENAME"
>libpq</TT
> shared
                    library in case of PostgreSQL database use or <TT
CLASS="FILENAME"
>sqlite</TT
> shared
                    library</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libdl</TT
> shared library (present in every modern
                    distribution)</P
></LI
><LI
><P
>C compiler (gcc)</P
></LI
></UL
>
                     </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-INSTALL"
>6.1.2. Installation</A
></H2
><P
>You have to setup some configure options prior to compilation, that can be
               listed with --help flag of <TT
CLASS="FILENAME"
>./configure</TT
> script (default values
               shown in brackets):
<PRE
CLASS="SCREEN"
>  --help                help
  --enable-debug0       SQL queries logging (disabled)
  --enable-debug1       events logging (disabled)
  --with-pgsql          enables using of PostgreSQL database (disabled)
  --with-mysql          enables using of MySQL database (enabled)
  --with-sqlite         enables using of SQLite database (disabled)
  --prefix=DIR          program install directory (/usr/local/bin)
  --libdir=DIR          location of database libraries (/usr/lib)
  --incdir=DIR          location of database header files (/usr/include)</PRE
>
               It's required to choose one database which you will use (--with-mysql or --with-pgsql
               or --with-sqlite) and location of libraries supplied with database (--incdir,
               --libdir). You can use only one database. If you will change database, you have to
               recompile your daemon.
<PRE
CLASS="SCREEN"
># ./configure --with-pgsql --libdir=/usr/local/pgsql/lib --incdir=/usr/local/pgsql/include</PRE
>
               After that you can compile and install (put daemon in directory
               given with --prefix option):
<PRE
CLASS="SCREEN"
># make &#38;&#38; make install</PRE
>
               Finally, compiled modules (files with <TT
CLASS="FILENAME"
>.so</TT
> extension), found in
               directory <TT
CLASS="FILENAME"
>modules/module_name</TT
> should be moved to some directory.
               Their location will be set in configuration file.
               </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-CONFIG"
>6.1.3. Configuration</A
></H2
><P
>You can find example daemon configuration in
               <TT
CLASS="FILENAME"
>lms.ini.sample</TT
> file. The following listing describes basic
               options for the daemon (modules configuration is described later, in separate
               chapters concerning each module):
<PRE
CLASS="SCREEN"
>[database]
host            = localhost     # host name or IP, default: localhost
user            = lms           # user name, default: lms
password        = mypasswd      # database password, default: empty
database        = lms           # database name, default: lms
port            = 0             # port number, default: 0

[lmsd]
sleeptime       = 30            # time interval (in seconds) how often to
                                # check for reload order, default: 30
instances       = hosts oident firewall       # selected (active) modules list
command         = 'echo Connecting...'        # shell command that run before each database connection </PRE
>
               <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>List of instances contains modules names separated with spaces. Instance
               is a name of section below in this configuration file.</P
></TD
></TR
></TABLE
></DIV
> </P
><P
>Instance section, beside config modules params, must contain primary options,
               as on following listing:
<PRE
CLASS="SCREEN"
>[instance_name]
module = /path/to/module.so
info = "Additional description of module"</PRE
>          
               </P
><P
>Change of 'instances' or any option in instance sections do not require daemon
               restart. For other global options restart is required.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DAEMON-RUN"
>6.1.4. Starting</A
></H2
><P
>You can run this program as a daemon, detached to background with option '-b'.
               While running configuration and services reload is performed on demand using 'Reload'
               menu in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>. Sleep time runtime option (-s) specify interval
               between database checks. When daemon detects reload order, it runs modules defined by
               'instances' option in <TT
CLASS="FILENAME"
>lms.ini</TT
>.
               For example:
<PRE
CLASS="SCREEN"
># almsd -b</PRE
>               
               </P
><P
>Other way to run is periodical execution with cron. You have to use this mode
               for running modules like 'payments' 'notify' or 'traffic'. In those cases you can
               specify instances to reload with use of option '-i'. Example crontab entry:
<PRE
CLASS="SCREEN"
>  1 0 * * *    /usr/local/bin/almsd -qi "payments notify"</PRE
>
               </P
><P
>Following listing describes all program command line options:
<PRE
CLASS="SCREEN"
>  -c     path to config (default: /etc/lms/lms.ini)
  -i     list of instances (separated by spaces) to reload
  -b     run in background (daemon mode)
  -s     database checks interval in sec. (default: 30)
  -q     reload and quit
  -h     prints command line options</PRE
>
               </P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="mgc-example.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="daemon-modules.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Examples of use</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Modules</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>