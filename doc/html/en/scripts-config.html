<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Description and configuration</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="LMS - LAN Management System 1.11-cvs"
HREF="index.html"><LINK
REL="UP"
TITLE="Scripts"
HREF="scripts.html"><LINK
REL="PREVIOUS"
TITLE="List of available scripts"
HREF="scripts-list.html"><LINK
REL="NEXT"
TITLE="Configuration file generator (lms-mgc)"
HREF="mgc.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>LMS - LAN Management System 1.11-cvs</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="scripts-list.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 4. Scripts</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="mgc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SCRIPTS-CONFIG"
>4.3. Description and configuration</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-NOTIFY"
>4.3.1. lms-notify</A
></H2
><P
>lms-notify it's a perfect tool to remind your customers that they are actually the ones who
    		cover all your network and WAN links costs. It makes you possible to create numerous text templates
		for various occasions and use them for mailing your customers. For SMTP connection Mail::Sender 
		module is used.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LMS-NOTIFY-TEMPLATES"
>4.3.1.1. Templates</A
></H3
><P
>You can use following variables in your templates:</P
><UL
><LI
><P
>%date-m - will be substituted with current month in numerical form with leading zero, eg. 02</P
></LI
><LI
><P
>%date-y - will be substituted with current year, eg. 2003</P
></LI
><LI
><P
>%date_month_name - will be substituted with current month name, eg. March</P
></LI
><LI
><P
>%saldo - will be substituted with current customer balance, eg. 535</P
></LI
><LI
><P
>%abonament - will be substituted with customer's subscription fee, eg. 107</P
></LI
><LI
><P
>%b - customer balance with opposite sign, eg. 107</P
></LI
><LI
><P
>%B - customer balance with real sign, eg. -107</P
></LI
><LI
><P
>%pin - PIN code of the customer</P
></LI
><LI
><P
>%cid - customer ID</P
></LI
><LI
><P
>%number - document number (invoices, debit notes and deadline notifies only)</P
></LI
><LI
><P
>%value - invoice value (invoices and deadline notifies only)</P
></LI
><LI
><P
>%last_10_in_a_table - list of last 10 operations on customer's account, eg.</P
></LI
></UL
><DIV
CLASS="EXAMPLE"
><A
NAME="NOTIFY-EXAMPLE"
></A
><P
><B
>Example 4-1. Lms-notify: example of last 10 customer's operations</B
></P
><PRE
CLASS="SCREEN"
>-----------+------------------------------------------------------+---------
2003-02-02 | Subscription for month 2003/02                       |  107.00
2003-02-01 | Payment                                              | -107.00
2003-02-01 | Subscription for month 2003/02                       |  107.00
2003-02-01 | Payment                                              | -321.00
2003-01-31 | Subscription for month 2003/01                       |  107.00
2003-01-31 | Subscription for month 2003/01                       |  107.00
2003-01-31 | Subscription for month 2003/01                       |  107.00
-----------+------------------------------------------------------+---------</PRE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="NOTIFY-TEMPLATE"
></A
><P
><B
>Example 4-2. Lms-notify: example of mailing template</B
></P
><PRE
CLASS="SCREEN"
>NOTE: This message has been generated automatically.

We kindly remind that you have debt on your internet service provide account 
for the amount of $ %B.

If you have already regulated your subscription fees for current month, that
is %date-m %date-y, please just skip this message.

If you think this message was sent to you in error, please contact our
customer service representative.

All information about payments could be also found at:
http://bigpro.com/myAccount/

If you want to regulate your account status, please contact our accountant:

Aldfert Rule
phone: 0-509031337
e-mail: alde@staff.bigpro.com

Garmund Cooper
phone: 0-606666666
e-mail: gcooper@free.bigpro.com

PS. Last 10 operations on your account has been attached below for your
convenience.

Date       | Description                                          | Amount
%last_10_in_a_table

--
Big and Professional Internet Provider, BigPro ISP
http://www.bigpro.com/</PRE
></DIV
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LMS-NOTIFY-CONFIG"
>4.3.1.2. Configuration</A
></H3
><P
>Configuration of lms-notify should be set in
			<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[notify]</I
></SPAN
> section.
			Following parameters are valid (also in <A
HREF="scripts-config.html#LMS-NOTIFY-SMS"
>lms-notify-sms</A
>):</P
><UL
><LI
><P
>debtors_template</P
><P
>Lets you setup message template which will be sent to debted customers. Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>debtors_template = /etc/lms/debtors_template.txt</SAMP
></P
></LI
><LI
><P
>debtors_subject</P
><P
>Lets you set subject of message to debtors. Default: 'Debtors notification'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>debtors_subject = Debt information</SAMP
></P
></LI
><LI
><P
>invoices_template</P
><P
>The message template which will be sent to customers if new invoice is created
					(in last 24 hours). Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>invoices_template = /etc/lms/invoices_template.txt</SAMP
></P
></LI
><LI
><P
>invoices_subject</P
><P
>Subject of 'invoices' message. Default: 'New invoice notification'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>invoices_subject = Invoice information</SAMP
></P
></LI
><LI
><P
>notes_template</P
><P
>The message template which will be sent to customers if new debit note is created
					(in last 24 hours). Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>notes_template = /etc/lms/notes_template.txt</SAMP
></P
></LI
><LI
><P
>notes_subject</P
><P
>Subject of 'notes' message. Default: 'New debit note notification'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>notes_subject = Debit note information</SAMP
></P
></LI
><LI
><P
>deadline_template</P
><P
>Lets you setup message template which will be sent to debted customers
					when (not payed) invoice reaches paytime. Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>deadline_template = /etc/lms/deadline_template.txt</SAMP
></P
></LI
><LI
><P
>deadline_subject</P
><P
>Subject of 'deadline' message. Default: 'Invoice deadline notification'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>deadline_subject = Deadline information</SAMP
></P
></LI
><LI
><P
>limit</P
><P
>Lets you setup limit of customer debt. The message will be sent if
					customer balance is below that value. Default: limit = 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
></UL
><P
>And list of options for mailing only:</P
><UL
><LI
><P
>mailfrom (mandatory)</P
><P
>Lets you setup email of the sender. Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailfrom = staff@bigpro.com</SAMP
></P
></LI
><LI
><P
>mailfname</P
><P
>Sender name. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailfname = Administrators</SAMP
></P
></LI
><LI
><P
>smtp_host</P
><P
>SMTP server to be used when sending emails. Default: localhost</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_host = smtp.bigpro.com</SAMP
></P
></LI
><LI
><P
>smtp_auth</P
><P
>SMTP authorization type. Allowed values: 
					LOGIN, PLAIN, CRAM-MD5, NTLM. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_auth = LOGIN</SAMP
></P
></LI
><LI
><P
>smtp_user</P
><P
>Login for SMTP authorization. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_user = admin</SAMP
></P
></LI
><LI
><P
>smtp_pass</P
><P
>Password for SMTP authorization. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_pass = password</SAMP
></P
></LI
><LI
><P
>debug_email (optional)</P
><P
>Email address for debugging. All email will be sent to this address instead of sending to real customers. Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>debug_email = lexx@domain.pl</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-NOTIFY-SMS"
>4.3.2. lms-notify-sms</A
></H2
><P
>lms-notify-sms it's a <A
HREF="scripts-config.html#LMS-NOTIFY"
>lms-notify</A
> equivalent, but it's intended to
		send reminders via SMS. Actually it supports smstools and gnokii services.
		Use <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[sms]</I
></SPAN
> section for SMS Service configuration.</P
><P
>Configuration of lms-notify-sms should be set in
		<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[notify-sms]</I
></SPAN
> section.
		Here you can use all <A
HREF="scripts-config.html#LMS-NOTIFY"
>lms-notify</A
> options plus:</P
><UL
><LI
><P
>service</P
><P
>Allows you to overwrite SMS service option from <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[sms]</I
></SPAN
> section.
				Default: empty</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>service = smstools</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-CUTOFF"
>4.3.3. lms-cutoff</A
></H2
><P
>This script allows to cutoff (actually mark as cutoff in
	database and cutting off should be performed by one of firewall rules creation
	script) customers whose debt is below some defined value.</P
><P
>Configuration of lms-cutoff should be set in
	<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[cutoff]</I
></SPAN
> section.
	Following parameters are valid:</P
><UL
><LI
><P
>limit (optional)</P
><P
>Lets you setup limit of customer debt. Customer will be marked as disconnected below that value. Default: 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>message (optional)</P
><P
>If not empty, that message will be written to warning message field in customer record 
	   after cutting him off.  You can use %now variable - it will be replaced by current date, and 
	   %b and %B like in lms-notify script.
	   Default: 'Automatic cutoff caused by exceeding of liabilities limit on %now'</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>message = ''</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-PAYMENTS"
>4.3.4. lms-payments</A
></H2
><P
>This script is being used to calculate and account subscription
and solid (fixed) fees. It also accounts your company liabilities and makes
invoices. You should allow it to run daily if you want it to make it work done
well.</P
><P
>This scripts may be configured with two options related to
invoices in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[payments]</I
></SPAN
> section of
<TT
CLASS="FILENAME"
>lms.ini</TT
> file:</P
><UL
><LI
><P
>deadline (optional)</P
><P
>Payment deadline in days. Default: 14</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>deadline = 7</SAMP
></P
></LI
><LI
><P
>paytype (optional)</P
><P
>Payment type identifier (1-cash, 2-transfer, 3-transfer/cash,
	        4-card, 5-compensation, 6-barter, 7-contract). Default: 2</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>paytype = 1</SAMP
></P
></LI
><LI
><P
>suspension_description (optional)</P
><P
>Suspension description for suspended liabilities added at the end of comment. 
	   Default: ''</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>suspension_description = '(suspension)'</SAMP
></P
></LI
><LI
><P
>comment (optional)</P
><P
>Description on invoice attached to every periodical assigment</P
><P
>Default: '%tariff subscription for period %period'</P
><P
>Some keywords are substitiuted:</P
><P
>%tariff - subscription name</P
><P
>%period - period (counted from current day to the last in cycle, in YYYY/MM/DD format)</P
><P
>%current_month - period form 1st day of current month to the last day</P
><P
>%current_period - current month in MM/YYYY format</P
><P
>%next_period - next month in MM/YYYY format</P
><P
>%prev_period - previous month in MM/YYYY format</P
><P
>%desc - tariff description</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>comment = 'Subscription for %current_month'</SAMP
></P
></LI
><LI
><P
>settlement_comment (optional)</P
><P
>Description of settlement.</P
><P
>Default set to <SAMP
CLASS="PROMPT"
>comment</SAMP
> option contents.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>settlement_comment = 'Settlement for %period'</SAMP
></P
></LI
></UL
><P
>Script has also one useful command line parameter: <SAMP
CLASS="PROMPT"
>--fakedate</SAMP
>
         (<SAMP
CLASS="PROMPT"
>-f</SAMP
>). With this option you can make that script will execute
         with system date (in format YYYY/MM/DD) other that current, eg.
         <SAMP
CLASS="PROMPT"
>--fakedate=2004/10/10</SAMP
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-TRAFFIC"
>4.3.5. lms-traffic</A
></H2
><P
>This script is an interface between your application and LMS
database and is intended to gather bandwidth usage statistics. You should
provide number of bytes received and sent by each computer, which will be
stored in LMS DB next to computer id and current timestamp. It's up to you how
often this configuration will be refreshed, just remember to set your
application to refresh its data in similar interval. Best sources of data are
iptables or ipchains. You can also use external program, eg. ipfm.</P
><P
>Browsing gathered statistics with several filtering capabilities is
available in LMS-UI in main menu, menu 'Statistics'.
    </P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LMS-TRAFFIC-CONFIG"
>4.3.5.1. Installation</A
></H3
><P
>Before you can run lms-traffic you need to create data file
which will be read in. Format of the file should be as follows:</P
><PRE
CLASS="SCREEN"
>&lt;IP_address&gt; &lt;n_of_spaces&gt; &lt;upload_bytes&gt; &lt;n_of_spaces&gt; &lt;download_bytes&gt;
&lt;IP_address&gt; &lt;n_of_spaces&gt; &lt;upload_bytes&gt; &lt;n_of_spaces&gt; &lt;download_bytes&gt;
...</PRE
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Example script utilizing iptables might be found
in <TT
CLASS="FILENAME"
>sample/traffic_ipt.pl</TT
> file.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Next you should install lms-traffic script and your custom
script into crontab. Among standard options you can use define location with
created data file.
	    <PRE
CLASS="SCREEN"
>-f=/file 	location and name of data file, default: /var/log/traffic.log</PRE
>
	    <DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Frequency checks should be set not higher than 10
minutes, due that each execution will write new database record for each
computer. Thus, statistics database might grow fast and it might take longer
to generate desired statistics.</P
></TD
></TR
></TABLE
></DIV
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-TRAFFIC-LOGIPTABLES"
>4.3.6. lms-traffic-logiptables</A
></H2
><P
>This script uses iptables to gather received and sent data
statistics for each computer. Data is being read from firewall rules, which
are created on-the-fly. Thus, you are not responsible for setting appropriate
rules or running custom statistics collector (eg.
<TT
CLASS="FILENAME"
>lms-traffic</TT
>).
	</P
><P
>Configuration of lms-traffic-logiptables should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[traffic-logiptables]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>outfile</P
><P
>Location of file with iptables rules. Default: /etc/rc.d/rc.stat</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>outfile = /etc/rc.d/rc.stat</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /usr/sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>wan_interfaces</P
><P
>Interface(s) name(s) that should be considered.  Default: not defined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>wan_interfaces = eth0</SAMP
></P
></LI
><LI
><P
>local_ports</P
><P
>List of source/destination ports for packet counting. Default: not defined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>local_ports = 80</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID of 'outfile' script owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID of 'outfile' script owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Permissions of 'outfile' script. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of (space separated) networks, that should be
		    considered while creating configuration file. If unset, configuration will
		    include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEDHCPCONF"
>4.3.7. lms-makedhcpconf</A
></H2
><P
>This module creates DHCP configuration script - dhcpd.conf.</P
><P
>Configuration of lms-makedhcpconf should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[dhcp]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>config_file</P
><P
>Output file location. Default: /etc/dhcpd.conf</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /tmp/dhcpd.conf</SAMP
></P
></LI
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>customergroups</P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all customer groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>customergroups = group1 group2</SAMP
></P
></LI
><LI
><P
>default_lease_time</P
><P
>Default lease time. Default: 86400.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>default_lease_time = 43200</SAMP
></P
></LI
><LI
><P
>max_lease_time</P
><P
>Maximal lease time. Default: 86400.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>max_lease_time = 43200</SAMP
></P
></LI
><LI
><P
>ignore_ddns</P
><P
>Don't put 'ddns-update-style none;' at the beginning of
		    file. Useful for older (2.2) versions of DHCP. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>ignore_ddns = 1</SAMP
></P
></LI
><LI
><P
>log_facility</P
><P
>Logging options for DHCP daemon. Default is applied
		    if not specified.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>log_facility = 7</SAMP
></P
></LI
><LI
><P
>authoritative</P
><P
>Add 'authoritative;' entry at the beginning of
		    file. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>authoritative = 1</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID of 'config_file' config owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID of 'config_file' config owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Permissions of 'config_file' file. Default: 600 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
></UL
><P
>You can setup leases time on per-host basis by creating
<SAMP
CLASS="PROMPT"
>[dhcp:network_name]</SAMP
> section (in lowercase), eg.
<PRE
CLASS="SCREEN"
>[dhcp:public-custa] # network name, must be lowercase!!!
default_lease_time = 3600
max_lease_time     = 3600</PRE
>

You can also specify gateway, dns servers, domains name and wins server for
individual host by creating <SAMP
CLASS="PROMPT"
>[dhcp:ip_address]</SAMP
> section, eg.
<PRE
CLASS="SCREEN"
>[dhcp:213.25.209.216]
domain  = anotherdomain.com
gateway = 213.25.209.251
dns     = 213.25.209.8
wins    = 213.25.209.10</PRE
>
	</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEIPTABLES"
>4.3.8. lms-makeiptables, lms-makeipchains</A
></H2
><P
>This pair of script is being used to generate files with firewall 
rules inside. You can prepend this file with previously written header (ie.
containing network-wide rules or NAT rules) and set some fixed permissions to
it. Those scripts does not run generated files.</P
><P
>Configuration of those scripts should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[iptables]</I
></SPAN
> or
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[ipchains]</I
></SPAN
> section.  Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>iptables_binary (ipchains_binary)</P
><P
>Location of iptables (ipchains) binary. Default: /usr/sbin/iptables (/usr/sbin/ipchains)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>script_file</P
><P
>Output file with rules. Default: /etc/rc.d/rc.masq</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_file = /etc/rc.d/rc.firewall</SAMP
></P
></LI
><LI
><P
>pre_script</P
><P
>File appended after cleaning existing rules and before
adding new. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>pre_script = /etc/rc.d/rc.masq-pre</SAMP
></P
></LI
><LI
><P
>post_script</P
><P
>File appended after adding rules. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>post_script = /etc/rc.d/rc.masq-post</SAMP
></P
></LI
><LI
><P
>forward_to</P
><P
>List of networks for which NAT should be set. Possible
values: "" - full forward, "any string" - forward off, "net1 net2" - forward
active for selected networks. Default: full forward.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>forward_to = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Permissions for the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
><LI
><P
>snat_address</P
><P
>SNAT public address. If unset, for hosts with private
addresses assigned "-j MASQUERADE" rule will be used. If set "-j SNAT --to
123.123.123.123" (with your IP here) will be used. Only with lms-makeiptables.
Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>snat_address = 123.123.123.123</SAMP
></P
></LI
><LI
><P
>tcp_redirect_ports (udp_redirect_ports)</P
><P
>List of port forwardings in source_port:dest_port
format. Can be used to map ports of your firewalled machines to the ones on your
router. Only with lms-makeipchains. Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>tcp_redirect_ports = 80:3128 25:25</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-ETHERDESC"
>4.3.9. lms-etherdesc</A
></H2
><P
>This script is intended to create file including MAC and IP
address pairs from LMS DB. MACs are being fetched in 'stripped' format, such is,
without colon separators. This type of file might be used with
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>iptraf</I
></SPAN
> tools.</P
><P
>Configuration of lms-etherdesc should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[ether]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>etherdesc_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_owneruid = 0</SAMP
></P
></LI
><LI
><P
>etherdesc_file</P
><P
>File location. Default: /var/lib/iptraf/ethernet.desc.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_file = /etc/ethernet.desc</SAMP
></P
></LI
><LI
><P
>etherdesc_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_ownergid = 0</SAMP
></P
></LI
><LI
><P
>etherdesc_permission</P
><P
>Permissions for the file. Default: 600 (rw-------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_permission = 600</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-SENDINVOICES"
>4.3.10. lms-sendinvoices</A
></H2
><P
>This script make you possible to automatically send invoices by
email, as email attachments. Invoices are being created in accordance to
template used in LMS-UI, thus, you need to provide username and password to
interface for this module to work.</P
><P
>This module, unlike the others, needs some extra Perl modules to
work: LWP::UserAgent, MIME::QuotedPrint and Mail::Sender.</P
><P
>Configuration of lms-sendinvoices should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[sendinvoices]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>lms_url</P
><P
>URL for your LMS installation. Default: http://localhost/lms/</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_url = http://lms.mynet.pl</SAMP
></P
></LI
><LI
><P
>lms_user</P
><P
>LMS user login name. Default: empty</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_user = admin</SAMP
></P
></LI
><LI
><P
>lms_password</P
><P
>LMS user password. Default: empty</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_password = my_secret</SAMP
></P
></LI
><LI
><P
>debug_email</P
><P
>Email address to test (mail will be redirected here).
		    Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>debug_email = admin@mynet.pl</SAMP
></P
></LI
><LI
><P
>sender_name</P
><P
>Email sender name. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>sender_name = ASK MyNet</SAMP
></P
></LI
><LI
><P
>sender_email</P
><P
>Email sender address. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>sender_email = admin@mynet.pl</SAMP
></P
></LI
><LI
><P
>mail_subject</P
><P
>Email subject. %invoice variable will be replaced by invoice number. 
		    Default: 'Invoice No. %invoice'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_subject = 'New invoice'</SAMP
></P
></LI
><LI
><P
>mail_body</P
><P
>Email body. %invoice variable will be replaced by invoice number. 
		    Default: 'Attached file with Invoice No. %invoice'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_body = ''</SAMP
></P
></LI
><LI
><P
>customergroups</P
><P
>List of (space separated) customer groups, that should be
		    considered while sending invoices. Default: unset - all customers.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>customergroups = group1 group2</SAMP
></P
></LI
><LI
><P
>smtp_host</P
><P
>SMTP server to be used when sending emails. Default: localhost</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_host = smtp.bigpro.com</SAMP
></P
></LI
><LI
><P
>smtp_auth</P
><P
>SMTP authorization type. Allowed values: 
	    	    LOGIN, PLAIN, CRAM-MD5, NTLM. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_auth = LOGIN</SAMP
></P
></LI
><LI
><P
>smtp_user</P
><P
>Login for SMTP authorization. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_user = admin</SAMP
></P
></LI
><LI
><P
>smtp_pass</P
><P
>Password for SMTP authorization. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_pass = password</SAMP
></P
></LI
></UL
><P
>Script has also one useful command line parameter: <SAMP
CLASS="PROMPT"
>--fakedate</SAMP
> 
	 (<SAMP
CLASS="PROMPT"
>-f</SAMP
>). With this option you can make that script will execute 
	 with system date (in format YYYY/MM/DD) other that current, eg. 
	 <SAMP
CLASS="PROMPT"
>--fakedate=2004/10/10</SAMP
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEMACS"
>4.3.11. lms-makemacs</A
></H2
><P
>This script is capable of making netfilter rules to filter
traffic based on MAC address of the sender. For each computer one rule for
configured chain is created, which makes test on sender IP and MAC addresses. If
it returns success, it returns to parent chain with RETURN target. On the end of
tests two rules are appended, which redirects all http and webcache traffic to
given host and port. This is intended to inform customer about his debt, by running
specialized server on this host:port which returns administration message to
each request. At last, the rule which blocks all traffic is added.
	    </P
><P
>Configuration of lms-makemacs should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[macs]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>customergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>customergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the output file. Default: /etc/rc.d/rc.macs</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.macs</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>Chain name to use (if non-standard, it will be
created). Default: MACS.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>chain = CHECKMAC</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>Address and port, where unmatched traffic for http and
webcache will be redirected, in address:port format. Default: 127.0.0.1:80.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3000</SAMP
></P
></LI
><LI
><P
>lock_noaccess</P
><P
>Should RETURN rule be used for disconnected (cutoff)
nodes. Default: 0 (rules are being generated)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lock_noaccess = 1</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEHOSTS"
>4.3.12. lms-makehosts</A
></H2
><P
>This script generates /etc/hosts file, with IP address to name
mappings.
	    </P
><P
>Configuration of lms-makehosts should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[hosts]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>customergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>customergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the file. Default: /etc/hosts.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/hosts</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 644 (rw-r--r--).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 600</SAMP
></P
></LI
><LI
><P
>config_header</P
><P
>First line in /etc/hosts. Default: 127.0.0.1 localhost localhost.localdomain.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_header = 192.168.1.1 ourserver ourserver.ournetwork</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEWARNINGS"
>4.3.13. lms-makewarnings</A
></H2
><P
>This script may be used to create file including netfiler
rules redirecting http and webcache traffic to configured IP and port, for customers
in debt. It uses nat table, tests source IPs and makes use of DNAT target.
	    </P
><P
>Configuration of lms-makewarnings should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[warnings]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>customergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>customergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the file. Default: /etc/rc.d/rc.warnings.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.warnings</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>Custom chain to which rules will be added. Default:
WARNINGS.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>chain = WARN</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>IP address and port, to which all http and webcache
traffic will be redirected, for hosts to which warning was enabled in LMS-UI.
Default: 127.0.0.1:80.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3001</SAMP
></P
></LI
><LI
><P
>limit</P
><P
>Rules are being triggered if customer balance is below
this limit. Default: 0 </P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -85</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-MAKEMESSAGES"
>4.3.14. lms-makemessages</A
></H2
><P
>This script is being used to create file with netfilter rules
to redirect all http and webcache traffic for customers, who has administration
messages enabled (aka warnings) to configured IP address and port. It uses nat
table, tests source IPs and makes use of DNAT target.
	    </P
><P
>Configuration of lms-makemessages should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[messages]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>customergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>customergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the file. Default: /etc/rc.d/rc.messages.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.messages</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>Custom chain to which rules will be added. Default: MESSAGES.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>chain = MESG</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>IP address and port, to which all http and webcache
traffic will be redirected, for hosts to which warning was enabled in LMS-UI.
Default: 127.0.0.1:80.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3002</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-FPING"
>4.3.15. lms-fping</A
></H2
><P
>This script probes nodes activity and writes its status to
database. Fast program fping is being used to scan, with "-ar1" parameters.
First, list of nodes is prepares, and then fping is executed. For returned hosts
date and time will be stored into DB, so availability can be visualized in
interface.</P
><P
>Configuration of lms-fping should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[fping]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>fping_binary</P
><P
>Location of fping binary. Default: /usr/sbin/fping</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>fping_binary = /usr/local/sbin/fping</SAMP
></P
></LI
><LI
><P
>temp_file</P
><P
>Location of temporary file, where list of hosts for
fping will be stored. After script execution, this file is removed. Default: /tmp/fping_hosts.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>temp_file = /tmp/hosts</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="LMS-RTPARSER"
>4.3.16. lms-rtparser</A
></H2
><P
>This script is a backend to Helpdesk system, which should be
integrated into your mail server configuration. It intercepts emails sent to
queue (as defined in email address field of queue configuration), parses its
content and puts ticket into database, confirming this operation in email to
reporter. In subject of confirmation ticket ID will be placed. If email with
this ID is received again, it will be placed in existing ticket history,
otherwise new ticket number will be created. Any files in the message will be
detached and stored in directory defined with <TT
CLASS="FILENAME"
>mail_dir</TT
>
option.</P
><P
>Unlike other Perl modules, this one additionally requires:
<TT
CLASS="FILENAME"
>MIME::Parser</TT
> and <TT
CLASS="FILENAME"
>MIME::Words</TT
> from
MIME-Tools package along with <TT
CLASS="FILENAME"
>Mail::Sender</TT
> and
<TT
CLASS="FILENAME"
>Text::Iconv</TT
>.</P
><P
>This script might be installed in several ways. One way is to
create shell script which reads content of users' mailboxes and calls
lms-rtparser for each mail (can be done with formail). But more elegant, faster
and convenient method is to integrate it with your mail server. Below you can
find example on how to setup Postfix using header_checks.
<PRE
CLASS="SCREEN"
># main.cf file:
header_checks = regexp:/etc/postfix/header_checks

# header_checks file:
/^To:.*address@domain.*/ FILTER filter:dummy

# master.cf file:
filter unix - n n - 10 pipe
      -flags=Rq user=nobody argv=/path/to/lms-rtparser</PRE
>
            Above method is valid for Postfix version equal or newer than 2.0.
Earlier versions doesn't support FILTER in header_checks. You can work around
this by using procmail:
<PRE
CLASS="SCREEN"
># main.cf file:
mailbox_command = /usr/bin/procmail

# in user directory (for whom mails should be routed via helpdesk);
# .forward file:
"|IFS=' ' &#38;&#38; exec /usr/bin/procmail -f - || exit 75 #YOUR_USERNAME"

# .procmailrc file:
:0 c
   * ^To.*address@domain
   | /bin/lms-rtparser

:0 A
$DEFAULT</PRE
></P
><P
>Next example shows how to connect parser to Exim, using system
filter:
<PRE
CLASS="SCREEN"
># exim.conf file:

system_filter_pipe_transport = address_pipe

# system_filter.txt file:

if $recipients is "queue_email@domena.pl"
then 
     pipe "/path/to/lms-rtparser -q queue id"
endif</PRE
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Messages create in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lms-ui</I
></SPAN
> may
be directed to parser, instead of just being written to database. If you prefer
this behavior turn on <TT
CLASS="FILENAME"
>helpdesk_backend_mode</TT
> option in
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
> section of <TT
CLASS="FILENAME"
>lms.ini</TT
>
file.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Configuration of lms-rtparser should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[rt]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>default_queue</P
><P
>ID of the queue, to which requests should be sent if
		    not specified on command line. If not set queue will be guessed according to
		    recipient address. Command line -q will override this option. Default:
		    undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>default_queue = </SAMP
></P
></LI
><LI
><P
>mail_from</P
><P
>Sender address for confirmations. If undefined, queue
		    address will be used, to which ticket was assigned. Default: empty.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_from = rt@net.pl</SAMP
></P
></LI
><LI
><P
>mail_from_name</P
><P
>Sender name for confirmations. Default:
		    undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_from_name = 'BOK SuperLAN'</SAMP
></P
></LI
><LI
><P
>autoreply_subject</P
><P
>Confirmation subject. You can use replacement variables here: %tid - 
		    ticket id and %subject - request subject.
		    Default: "[RT#%tid] Receipt of request '%subject'".</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>autoreply_subject = '[RT#%tid] Helpdesk confirmation'</SAMP
></P
></LI
><LI
><P
>autoreply_body</P
><P
>Confirmation body. You can use replacement variables here; %tid - 
		    ticket id and %subject - request subject.
		    Default: 'Your request was registered in our system.\nTicket identifier RT#%tid has been assigned to this request.\nPlease, place string [RT#%tid] in subject field of any\nfurther mail relating to this request.\n.'</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>autoreply_body = ''</SAMP
></P
></LI
><LI
><P
>smtp_host</P
><P
>SMTP server to be used when sending emails. Default: localhost</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_host = smtp.bigpro.com</SAMP
></P
></LI
><LI
><P
>smtp_auth</P
><P
>SMTP authorization type. Allowed values: 
	    	    LOGIN, PLAIN, CRAM-MD5, NTLM. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_auth = LOGIN</SAMP
></P
></LI
><LI
><P
>smtp_user</P
><P
>Login for SMTP authorization. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_user = admin</SAMP
></P
></LI
><LI
><P
>smtp_pass</P
><P
>Password for SMTP authorization. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_pass = password</SAMP
></P
></LI
><LI
><P
>mail_dir</P
><P
>Directory where attachments should be saved. This
		    directory will be accessed for read/write both by rtparser user and your Web
		    Server user. If undefined attachments won't be recorded. Default:
		    undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_dir = /usr/local/lms/mail</SAMP
></P
></LI
><LI
><P
>tmp_dir</P
><P
>Temp directory. By default it will be taken from
		    environment or set to <TT
CLASS="FILENAME"
>/tmp</TT
>.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>tmp_dir = /home/user/tmp</SAMP
></P
></LI
><LI
><P
>auto_open</P
><P
>This will force reopening closed/dead ticket if
		    request is sent to it's ID. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>auto_open = 1</SAMP
></P
></LI
><LI
><P
>newticket_notify</P
><P
>If enabled script will send notification about new ticket
		    to all users with rights for current queue. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>newticket_notify = 1</SAMP
></P
></LI
><LI
><P
>lms_url</P
><P
>This link, pointing to corresponding ticket page in UI is appended 
		    to the notification about new ticket. Default: http://localhost/lms/.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_url = https://lms.domain.pl/</SAMP
></P
></LI
><LI
><P
>include_customerinfo</P
><P
>Adds basic customer information in new ticket notification footnote.
		    Default: On.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>include_customerinfo = 0</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="scripts-list.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="mgc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>List of available scripts</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="scripts.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Configuration file generator (lms-mgc)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>