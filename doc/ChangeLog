$Id$

wersja 1.1.4 (??/??/2003):

  - lista taryf zlicza³a tak¿e u¿ytkowników usuniêtych (lukasz)
  - do listy sieci dodane nowe pole: interfejs - bardzo przydatne przy
    budowaniu skryptów iptables/ipchains/htb gdy mamy sieci adresowe na
    ró¿nych interfejsach, dostêpne w lms-mgc jako %IFACE, %DIFACE i %NIFACE,
    co jak zwykle niesie upgrade formatu bazy (lukasz):
    MySQL:
        ALTER TABLE networks ADD interface VARCHAR(8) AFTER mask;
    PostgreSQL:
    	ALTER TABLE networks ADD interface VARCHAR(8);
  - usuniêta ma³a literówka powoduj±ca to i¿ driver od MySQL'a nie dostawa³
    informacji o ho¶cie do bazy danych z lms.ini, a co za tym idzie zawsze
    próbowa³ siê ³±czyæ z localhost'em (lukasz)    
  - reload.php uzywa³ sqlTSfmt() który jest obsolete (lexx/lukasz)
  - nowo dodawany komputer domy¶lnie nie mia³ dostêpu (lukasz)
  - ilo¶æ sieci w podsumowaniu by³a zwiêkszana o 2 (lukasz)
  - kosmetyka kodu (s/this->ADB->/this->DB->/g) (lukasz)
  - b³êdy s± wy¶wietlane na dole strony, a nie wci¶niête gdzie siê tylko da do
    tabelek z formularzami (lukasz)
  - dodany (przeniesiony z contrib) modu³ traffic-stats, do korzystania
    z niego wymagane jest utworzenie tabeli 'stats' w bazie danych 
    (patrz lms.mysql/lms.pgsql) i bin/lms-traffic (alec)
  - nowa dokumentacja (sgml/html) (alec)
  - poprawiony bug pozwalaj±cy na zapisanie mac adresu ze znakiem '-' podczas
    edycji danych komputera - teraz podobnie jak podczas dodawania - zamienia
    wszystkie '-' na ':' (lukasz)
  - ma³a zmiana filozofii tablicy tariffs - 'NULL' to nie ustawiony limit, '0'
    to brak limitu - dlaczego? dowiecie siê lada dzieñ ;-) (lukasz):
    ALTER TABLE tariffs CHANGE uprate uprate INT(11), CHANGE downrate downrate INT(11) 
  - 'ma³a' rewolucja w finansach, a co za tym idzie 'du¿y' upgrade bazy, ale
    mam nadziejê ¿e sobie poradzicie (lukasz):
    
    0) Wykonaj BEZWZGLÊDNIE backup bazy danych.
    
    1) Stwórz tabelê 'assignments':

    DROP TABLE IF EXISTS assignments;
    CREATE TABLE assignments (
    	id int(11) NOT NULL auto_increment,
	tariffid int(11) NOT NULL default '0',
	userid int(11) NOT NULL default '0',
	period int(11) NOT NULL default '0',
	at int(11) NOT NULL default '0',
	PRIMARY KEY  (id),
	UNIQUE KEY id (id),
	KEY id_2 (id)
    ) TYPE=MyISAM

    2) Uruchom modu³ 'upgrade01' - czyli po zalogowaniu sie do LMS'a
    wpiszcie w url na koñcu '?m=upgrade01', np.
    'http://serwer.pl/lms/?m=upgrade01'. UWAGA! Modu³ ten nale¿y uruchomiæ
    TYLKO RAZ! Jak go uruchomisz wiêcej ni¿ raz, popsujesz sobie ca³± bazê
    danych.

    3) Teraz mo¿na usun±æ nieu¿ywane pola z bazy danych:

    ALTER TABLE users DROP tariff, DROP payday;

    4) Dopiszcie do crona lms-payments tak aby by³ uruchamiany codziennie o
       godzinie 0:00.

    5) Voila.

  - nowy skrypt w bin: lms-traffic-logiptables, loguje transfery do loga
    akceptowalnego przez lms-traffic alec'a, wiêcej info w sample/lms.ini
    (lukasz)
  - optymalizacja kodu w wielu miejscach (lukasz)
		    
wersja 1.1.3 (29/08/2003):

  - zmieniona filozofia u¿ytkowników - teraz usuniêcie u¿ytkownika tak
    naprawdê go nie usuwa, a jedynie ukrywa - tj. mo¿na dobraæ siê do
    u¿ytkownika po jego ID, mo¿na go wyszukaæ, ale nie mo¿na mu dodaæ
    komputerów i nie widaæ go na li¶cie u¿ytkowników, natomiast w informacji o
    nim jest informacja o tym ¿e u¿ytkownik jest usuniêty, co oczywi¶cie
    wymaga modyfikacji bazy danych: (lukasz)
    MySQL:
	ALTER TABLE users ADD deleted BOOL DEFAULT '0' NOT NULL;
    PostgreSQL:
	ALTER TABLE users ADD deleted int2;
	UPDATE users SET deleted=0;
	ALTER TABLE users ALTER COLUMN deleted SET DEFAULT 0;
	ALTER TABLE users ALTER COLUMN deleted SET NOT NULL;
    (dla tych co zd±¿yli zrobiæ to na ENUM
    MySQL:
 	ALTER TABLE users CHANGE deleted deleted CHAR(1) DEFAULT 'N' NOT NULL;
	UPDATE users SET deleted=1 WHERE deleted='Y';
	UPDATE users SET deleted=0 WHERE deleted='N';
	ALTER TABLE users CHANGE deleted deleted BOOL DEFAULT '0' NOT NULL;
    PostgreSQL: metoda taka sama jak z polem access w tabeli nodes, patrz ni¿ej;
    )
  - zmienione 'op³ata ab' na bardziej intuicyjne 'obci±¿enie' (lukasz)
  - zmiana formatu zapisu adresu IP w bazie danych, wymagane upgrejdy bazy
    (lukasz):
    MySQL:
        UPDATE nodes SET ipaddr=INET_ATON(ipaddr);
	ALTER TABLE nodes CHANGE ipaddr ipaddr INT(16) UNSIGNED NOT NULL;
    PostgreSQL:
	UPDATE nodes SET ipaddr=(split_part(ipaddr,'.',1)::int4*(256^3)+
				split_part(ipaddr,'.',2)::int4*(256^2)+
				split_part(ipaddr,'.',3)::int4*256+
				split_part(ipaddr,'.',4)::int4);
	ALTER TABLE nodes ADD ipaddr2 BIGINT;
	UPDATE nodes SET ipaddr2 = ipaddr::text::int8; 
	ALTER TABLE nodes DROP COLUMN ipaddr;
	ALTER TABLE nodes RENAME COLUMN ipaddr2 to ipaddr;
	ALTER TABLE nodes ALTER COLUMN ipaddr set NOT NULL;

  - zmiana formatu zapisu czy komputer ma dostêp czy te¿ nie - teraz nie ma
    jakiego¶ g³upiego chara ale jest boolean (znaczy siê stary MySQL udaje ¿e
    to boolean i daje tinyint), a co za tym idzie kolejny upgrade (lukasz):
	UPDATE nodes SET access='1' WHERE access='Y';
	UPDATE nodes SET access='0' WHERE access='N';
	ALTER TABLE nodes CHANGE access access BOOL NOT NULL DEFAULT '1';
    a w PostgreSQL pola s± typu int2 :
	UPDATE nodes SET access= CASE access WHEN 'Y' THEN '1' ELSE '0' END;
	ALTER TABLE nodes ADD access2 int2; 
	UPDATE nodes SET access2 = access::text::int2; 
	ALTER TABLE nodes DROP COLUMN access;
	ALTER TABLE nodes RENAME COLUMN access2 TO access;
	ALTER TABLE nodes ALTER COLUMN access SET NOT NULL;
	ALTER TABLE nodes ALTER COLUMN access SET DEFAULT 0;
    dodatkowe operacje poprawiaj±ce bazê (zalecane):
    MySQL:
	ALTER TABLE nodes CHANGE ownerid ownerid INT(11) DEFAULT '0' NOT NULL;
	ALTER TABLE nodes CHANGE mac mac VARCHAR(20) NOT NULL;
    PostgreSQL:
	ALTER TABLE nodes ALTER COLUMN ownerid SET DEFAULT '0'; 
	ALTER TABLE nodes ALTER COLUMN mac SET NOT NULL;
	
  - zoptymalizowany kod do wy¶wietlania du¿ych sieci (lukasz)
  - podawanie dnia naliczania op³aty podczas dodawania usera nic dawa³o
    (lukasz)
  - w³±czone z powrotem transakcje przy ³adowaniu backupu bazy danych
    (lukasz)
  
wersja 1.1.2 (24/08/2003):

  - mo¿liwo¶æ wystawiania faktur (Lexx)
  - Dodatkowa opcja %date_month_name w szablonach mailingu, rozwi±zywana do
    nazwy aktualnego miesi±ca (w/g LC_NUMERIC? hunter)
  - pewne zmiany w dokumentacji dot. postgresa, aktualizacja lms.pgsql (alec)
  - zrobione po ludzku wykrywanie pustej tabeli admins - w tym momencie LMS
    przy pustej tablicy bêdzie dozwala³ dostêp do modu³u adminadd (lukasz)
  - lms-mgc nie uwzglêdnia adresu sieci i broadcasta przy generowaniu regu³
    (lukasz)
  - podczas wyboru MAC'a ignorowane s± wpisy '00:00:00:00:00:00' i
    'FF:FF:FF:FF:FF:FF' (lukasz)
  - nowa zabawka w contrib/ - bandlogger+htblimiter - w oparciu o HTB oraz
    iptables (lukasz)
  - i stalo siê - LMS nie wymaga ju¿ ADOdb - ma w³asne biblioteki do obs³ugi
    mysql'a i postgresa (lukasz)
  - zamienione wszystkie '<?' (krótkie tagi PHP) na '<?php' - w sumie tak
    powinno byæ od pocz±tku, ale kto by na to wpad³, co nie? (lukasz)

wersja 1.1.1 (09/08/2003):

  - mo¿liwo¶æ wydruku osób które s± zad³u¿one (MichalZ)
  - dodane %TID (id taryfy) i %TVAL (warto¶æ taryfy) do lms-mgc (lukasz)
  - poprawione problemy ze zmian± kolejno¶ci sortowania na li¶cie osób
    od³±czonych b±d¼ zad³u¿onych (lukasz)
  - naprawiony bug z oper± (zamiana exit(0) na die) (lukasz)
  - wprowadzono mo¿liwo¶æ ustawienia dnia zap³aty, konieczne zmiany w SQL to:
    MySQL: ALTER TABLE `users` ADD `payday` INT DEFAULT '5' NOT NULL;
    PostgreSQL: ALTER TABLE users ADD payday integer;
		ALTER TABLE users ALTER COLUMN payday SET DEFAULT 0;
		ALTER TABLE users ALTER COLUMN payday SET NOT NULL;
    gdzie zamiast '5', mo¿emy podaæ domy¶lny dzieñ zap³aty, tj. je¿eli teraz
    op³aty w Twojej sieci s± naliczane ka¿dego pi±tego dnia miesi±ca, to
    wtedy spowoduje to przypisanie ka¿demu u¿ytkownikowi takiego dnia
    p³atno¶ci (lukasz)
  - w zwi±zku z powy¿sz± innowacj±, nie istnieje lms-eachmonth, a
    lms-payments, który powinien byæ odpalany z crona codziennie! (lukasz)
  - cleanup kodu (wywalenie g³ównie ¶mieci i trochê poprawnego kodowania...)
    (lukasz)

wersja 1.1.0 (23/06/2003):

  - support do drugiego serwera dns (w lms-mgc jako %DNS2)
    wymagany upgrade:
    MySQL: ALTER TABLE `networks` ADD `dns2` VARCHAR( 16 ) AFTER `dns`
    PostgreSQL: ALTER TABLE networks ADD dns2 VARCHAR(16);
- je¿eli w tym samym katalogu co index.php znajduje siê plik, LMS wykorzysta
    go zamiast /etc/lms/lms.ini
  - mo¿na ustawiæ domy¶lne warto¶ci dla adresu, miasta i kodu pocztowego
    nowego u¿ytkownika;
  - w zwi±zku z ci±g³ymi sprzeczkami nt. wprowadzenia nazwy klienta zmieni³em
    teksty (dla przyk³adu) 'Nazwisko i imiê' na 'Nazwisko/nazwa i imiê'. Brzmi
    durnie ale kompromis niez³y (lukasz)
  - dodany ChangeLog.en (warden)
  - usuniêta nieu¿ywana tabela 'options' i wygenerowany od nowa lms.mysql
    (lukasz)
			
wersja 1.0.0 (18/05/2003):

  - poprawione ikonki (wiem, s± obrzydliwe, ale nikt nie zrobi³ ³adniejszych)
  - dosyæ rozbudowana dokumentacja (niestety nadal uboga, ale lepszy rydz ni¿
    grzybki atomowe)
  - uff...

wersja 1.0.0rc1 (17/05/2003):

  - przymiarki do dokumentacji (Lexx)
  - porz±dki w LMS.class.php (lukasz)
  - contrib/customers - prosta strona dla ciekawych u¿ytkowników - w zwi±zku z
    czym znikn±³ obskurny button ze strony logowania z napisem 'Stan konta'
    (lukasz)
  - zrobione wstêpnie ró¿ne poziomy dostêpu (lukasz)
  - poprawione lms-notify (lukasz)
  - dodane 'u¿yteczne linki' do strony powitalnej (lukasz)
  - poprawione wydruki: listing wed³ug aktualnego sortowania oraz filtra (warden)
  - dodane 'skanuj' przy dodawaniu komputera - wyszukuje hosty przy u¿yciu
    programu nbtscan (kennyGRV/lukasz)
  - dodana informacja o producencie karty sieciowej w nodeinfobox (lukasz)
  - poprawione byki z wy¶wietlaniem ostatnich 10 operacji finansowych
    u¿ytkownika (lukasz)
  - wymieniona czê¶æ ikon (lukasz)
  - poprawki powrotnych redirectów (lukasz)
  - zabezpieczenie przed por±banymi przegl±darkami które majstruj± z refererem
    podczas wylogowywania siê (lukasz)
  - dodane info o ho¶cie na górze obok logo (warden & lukasz)
  - powróci³y lms-scripts do katalogu bin/ (lexx & lukasz)
  - na stronie tytu³owej zamiast ID zalogowanego admina jest teraz wersja PHP
  - finalnie poprawione lms-notify
  - poprawiony template maila (byko/lukasz)
  - poprawione sprawdzanie adresu email (repcio/lukasz)
  - sporo porz±dków
  
wersja 1.0pre10 (15/04/2003):

  - poprawki zgodno¶ci ze Smarty-2.5.0 (niestety, automatycznie 2.5.0 jest
    wymagane przez LMS'a)
  - usuniête zbêdne title w li¶cie userów
  - poprawione wy¶wietlanie nazwiska usera w popupie od usuwania usera
  - na stronie powitalnej trochê statystyk
  - usuniêty dosyæ powa¿ny b³±d w lib/Session.class.php
  - jak zwykle kosmetyka (literówki i tym podobne)
  - logosy by Pierzak

wersja 1.0pre9 'CVS-Has-Been-Crashed-Edition' (13/04/2003):
  
  - wymaga Smarty-2.4.2
  - tooltips
  - force ssl
  - przy dodawaniu usera domy¶lna taryfa to nie ta najdro¿sza, a ta
    najczê¶ciej u¿ywana
  - nazwa sieci mo¿e ju¿ zawieraæ kropkê
  - nazwa komputera mo¿e zawieraæ _ (podkre¶lenie)
  - sporo kosmetyki (popupy i opisy pól formularzy)
  - logosy by Pierzak

wersja 1.0pre8 (30/03/2003):

  - poprawiony bug z edycj± u¿ytkownika i traceniem zawarto¶ci pola z
    komentarzem
  - przeniesiony formularz dodawania sieci do oddzielnej strony
  - poprawione kilka innych bugów	

wersja 1.0pre7 (24/03/2003):

  - poprawiony powa¿ny bug w lms-mgc powoduj±cy traktowanie jako
    prywatnej sieci tylko 192.168.1.0/24 a nie 192.168.0.0/16
  - zrobiona lista u¿ytkowników od³±czonych i zad³u¿onych
  - poprawione dodawanie userów (nie dodawali siê lub imiê nie zostawa³o
    zapisywane (BTS: 0000019)
  - w przypadku odrzucenia danych do dodania u¿ytkownika gubi³o siê miasto w
    fromularzu
  - poprawione templejty tak by LMS by³ zgodny ze Smarty'm 2.4.2

wersja 1.0pre6 (17/03/2003):

  - mo¿liwo¶æ edycji imienia i nazwiska u¿ytkownika
  - sporo kosmetyki, poprawek w sortowaniu i nie tylko
  - SetBalanceZERO w LMS.class.php zeruje saldo
  - %abonament zmienia siê w kwotê abo zapisan± w tariffs.value
  - usuniête polskie locales, sprawia³o to wiêcej problemów
    ni¿ po¿ytku
  - ma³y update dokumentacji
  - dodany katalog contrib z ró¿nymi dodatkami do LMS
  - dodano lms.spec do contrib/ zgodnego ze specyfikacj± PLD
  - ³atka usprawniaj±ca odpalenie LMS w PLD
  - support do pustych hase³
  - zrobiony usersearch, nodesearch i parê innych rzeczy ;)
  - sprawdzenie stanu konta przez usera
  - czê¶ciowo wydruki
  - dodane ³adne cacu¶ne i s³odkie README
  - poprawiony pagelimiter w li¶cie u¿ytkowników
  - opcja w³±czaj±ca sharing mac-addr
  - automagiczna instalacja domy¶lnego admina z poziomu pliku lms.mysql
  - pole "Imiê" mo¿e byæ puste

wersja 1.0pre5 (26/01/2003):
 
  - PLIKI KONFIGURACYJNE PRZENIESIONE DO KATALOGU /etc/lms/ !!!
  - podzia³ listy u¿ytkowników na strony
  - poprawiony bug przy dodawaniu nowego usera
  - Pamiêtanie ostatniej wybranej podsieci i ostatniego wpisanego 
    komentarza do wp³at
  - przyk³adowe configi przeniesione do sample
  - utworzony katalog ze skryptami perlowymi - bin - znadjduj± siê
    tam niektóre skrypty z modu³u lms-scripts
  - oddzielny formularz do dodawania nowych operacji finansowych
  - informacje o taryfie i mo¿liwo¶æ jej edycji wreszcie.
  - poprawione parsowanie wprowadzanych danych w niektórych miejscach
    poprzez u¿ycie regexpów (dziêki mteg za podsuniêcie pomys³u)
  - dodano nowe pola w tablicy z u¿ytkownikami, aby je wykorzystaæ i
    bezproblemowo móc ich u¿ywaæ nale¿y wykonaæ nastêpuj±ce komendy z
    poziomu klienta mysql:

    ALTER TABLE `users` ADD `gguin` INT AFTER `phone3`;
    ALTER TABLE `users` ADD `zip` VARCHAR(6) AFTER `address` ,
    ADD `city` VARCHAR(32) AFTER `zip`, ADD `nip` varchar(16) AFTER `city`;
  - dodano opcjê do lms-notify:
      -D, --template-file=/etc/lms/another.template.txt
    uruchamia ona alternatywny plik template, przydatne przy wysy³aniu
    upomnienia, etc.
  - Teraz %b we wzorcu wiadomo¶ci rozwija siê do - (saldo) (czyli jest to
    kwota do zap³aty, ksiêgowi nie znaj± liczb ujemnych :)
    %date-y %date-m %desc rozwijaj± siê odpowiednio do: aktualnego roku,
    nazwy miesi±ca (set LANG=pl ?) i opisu pakietu z tariffs.
    %last_10_in_a_table zmienia siê w maksymalnie 10 ostatnich operacji na
    koncie.
	  
wersja 1.0pre4 (21/01/2003):

  - pe³ne przeportowanie obs³ugi SQL'a na ADODB
  - support do MySQL i PostgreSQL
  - pola uprate i downrate w taryfach. upgrade:
  
    ALTER TABLE tariffs ADD uprate INT DEFAULT '0' NOT NULL AFTER
    value , ADD downrate INT DEFAULT '0' NOT NULL AFTER uprate;

  - poprawka kolumny table na tablename w timestamps. upgrade:

    ALTER TABLE `timestamps` CHANGE `table` `tablename` VARCHAR( 255 ) 
    NOT NULL

  - lista u¿ytkowników: dodana kwota abonamentu miesiêcznego poni¿ej
    aktualnego salda u¿ytkownika (Goblin)
  - lista u¿ytkowników: u¿ytkownik którego komputery s± od³±czone
    jest pokazywany na szaro
  - wyszukiwanie u¿ytkowników;
  - oddzielny formularz dodawania u¿ytkowników;
  - wyszukiwanie u¿ytkowników;
  - mo¿liwo¶æ zdefiniowania sposobu reloadu (albo via sql, albo exec
    jakiej¶ komendy);
  - poprawki w dodawaniu taryf;
  
wersja 1.0pre3 (27/12/2002):

  - poprawione pobieranie hostname i uptime (Marcoos)
  - zmiana typu kolumny value w tabeli cash z float na double
  - zmiana typu kolumny value w tabeli tariffs z float na double
  - dodane blokowanie dostêpu do aplikacji poza okre¶lonymi hostami
    lub klasami adresowymi
  - poprawka parsowania ¶cie¿ek do katalogów z configa

wersja 1.0pre2 (25/12/2002):

  - parsowanie configa nie zapisuje odrazu zmiennych odczytanych
    z ini jako globalnych, a do tablicy $_CONFIG (nie mo¿na napisaæ 
    niczego poprzez plik ini)
  - dodane sprawdzanie czy istniej± katalogi backups i templates_c 
    oraz czy mo¿na do nich zapisywaæ
  - naprawiony modu³ od dodawania taryf
  - posprz±tane w niektórych plikach
  - poprawiony plik doc/lms.mysql i doc/INSTALL

wersja 1.0pre1 (24/12/2002):

   - przepisane obiektowo
   - napisane z wykorzystaniem engine'u template'owego Smarty
   - dodana opcja mailingu
   - bardzo fajne sortowanie (tm) :-)
   - wprowadzone cacheowanie wyników (nawala, ale co¶ tam dzia³a)

wersja 0.4:

   - napisana od nowa, ca³kowicie z wykorzystaniem sesji, oraz
     paru u³atwieñ je¿eli chodzi o SQL'a
   - dodana mo¿liwo¶æ definicji podsieci, nie ma ju¿
     konieczno¶ci d³ubania w ¼ród³ach aby zmieniæ ustawienia
     podsieci
   - serwer jest konfigurowany poprzez demona w perlu, s³uchaj±cego
     na sockecie TCP/IP
   - rozbudowane sortowanie
   - dane administratorów s± trzymane w bazie danych i nie trzeba
     rêcznie ustawiaæ hase³ w pliku .htpasswd
