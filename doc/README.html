<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>LMS - LAN Management System 1.7-cvs</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="../images/style.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="BOOK"
BGCOLOR="#EBE4D6"
TEXT="#000000"
><DIV
CLASS="BOOK"
><A
NAME="AEN1"
></A
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>LMS - LAN Management System 1.7-cvs</A
></H1
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="../images/logo-small.png"></P
></DIV
><H3
CLASS="CORPAUTHOR"
> LMS Developers</H3
><P
CLASS="COPYRIGHT"
>Copyright &copy; 2001-2005  LMS Developers</P
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="#INTRO"
>Intro</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#ABOUT-LMS"
>About LMS</A
></DT
><DT
>1.2. <A
HREF="#AUTHORS"
>Authors</A
></DT
><DT
>1.3. <A
HREF="#LEGALNOTICE"
>Legal Notice</A
></DT
><DT
>1.4. <A
HREF="#MOREINFO"
>Other Information</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#INSTALL"
>Installation and configuration</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#INSTALL-INTRO"
>Intro</A
></DT
><DT
>2.2. <A
HREF="#INSTALL-REQUIREMENTS"
>Requirements</A
></DT
><DT
>2.3. <A
HREF="#INSTALL-INSTALL"
>LMS Installation</A
></DT
><DT
>2.4. <A
HREF="#INSTALL-LOCALE"
>Localization</A
></DT
><DT
>2.5. <A
HREF="#INSTALL-DB"
>Database Server Installation</A
></DT
><DT
>2.6. <A
HREF="#INSTALL-CONFIG"
>Basic Configuration</A
></DT
><DT
>2.7. <A
HREF="#INSTALL-RIGHTS"
>Access rights</A
></DT
><DT
>2.8. <A
HREF="#INSTALL-UPGRADE"
>Upgrade</A
></DT
><DT
>2.9. <A
HREF="#INSTALL-DOCUMENTS"
>Documents</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#USER"
>User Interface (LMS-UI)</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#USER-LOGIN"
>Login</A
></DT
><DT
>3.2. <A
HREF="#MENU-ADMINISTRATION"
>Administration</A
></DT
><DT
>3.3. <A
HREF="#MENU-CUSTOMERS"
>Customers</A
></DT
><DT
>3.4. <A
HREF="#MENU-NODES"
>Nodes</A
></DT
><DT
>3.5. <A
HREF="#MENU-NETDEVICES"
>Net Devices</A
></DT
><DT
>3.6. <A
HREF="#MENU-NETWORKS"
>IP Networks</A
></DT
><DT
>3.7. <A
HREF="#MENU-FINANCES"
>Finances</A
></DT
><DT
>3.8. <A
HREF="#MENU-ACCOUNTS"
>Accounts</A
></DT
><DT
>3.9. <A
HREF="#MENU-MAILING"
>Mailing</A
></DT
><DT
>3.10. <A
HREF="#MENU-RELOAD"
>Reload</A
></DT
><DT
>3.11. <A
HREF="#MENU-STATS"
>Stats</A
></DT
><DT
>3.12. <A
HREF="#MENU-HELPDESK"
>Helpdesk</A
></DT
><DT
>3.13. <A
HREF="#MENU-TIMETABLE"
>Timetable</A
></DT
><DT
>3.14. <A
HREF="#MENU-CONFIGURATION"
>Configuration</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#SCRIPTS"
>Scripts</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#SCRIPTS-INSTALL"
>Installation</A
></DT
><DT
>4.2. <A
HREF="#SCRIPTS-LIST"
>List of available scripts</A
></DT
><DT
>4.3. <A
HREF="#SCRIPTS-CONFIG"
>Description and configuration</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#MGC"
>Configuration file generator (lms-mgc)</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="#MGC-INSTALL"
>Installation</A
></DT
><DT
>5.2. <A
HREF="#MGC-CONFIG"
>Configuration</A
></DT
><DT
>5.3. <A
HREF="#MGC-EXAMPLE"
>Examples of use</A
></DT
></DL
></DD
><DT
>6. <A
HREF="#DAEMON"
>LMS Daemon</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="#DAEMON-INTRO"
>Basics</A
></DT
><DT
>6.2. <A
HREF="#DAEMON-MODULES"
>Modules</A
></DT
><DT
>6.3. <A
HREF="#TSCRIPT"
>T-Script</A
></DT
></DL
></DD
><DT
>7. <A
HREF="#DEVEL"
>For curious</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="#DEVEL-CATALOGS"
>Directory tree</A
></DT
><DT
>7.2. <A
HREF="#DEVEL-DB"
>Database structure</A
></DT
><DT
>7.3. <A
HREF="#DEVEL-INI"
>Configuration file format</A
></DT
><DT
>7.4. <A
HREF="#DEVEL-GENFAKE"
>Filling DB with random data</A
></DT
><DT
>7.5. <A
HREF="#DEVEL-RIGHTS"
>Access levels</A
></DT
><DT
>7.6. <A
HREF="#DEVEL-LIMITS"
>Restrictions</A
></DT
></DL
></DD
><DT
>8. <A
HREF="#CONTRIB"
>Extensions</A
></DT
><DD
><DL
><DT
>8.1. <A
HREF="#CONTRIB-CUSTOMER"
>Customer account</A
></DT
><DT
>8.2. <A
HREF="#CONTRIB-CUSTOMER2"
>Customer account 2</A
></DT
><DT
>8.3. <A
HREF="#CONTRIB-SQLPANEL"
>SQL Panel</A
></DT
><DT
>8.4. <A
HREF="#CONTRIB-SQUID"
>Squid redirector</A
></DT
></DL
></DD
><DT
>9. <A
HREF="#FAQ"
>FAQ</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Tables</B
></DT
><DT
>4-1. <A
HREF="#SCRIPTS-TABLE"
>Executable scripts list</A
></DT
><DT
>6-1. <A
HREF="#MODULES-LIST"
>List of all lmsd modules</A
></DT
><DT
>7-1. <A
HREF="#CATALOG-TREE"
>LMS directory tree</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Examples</B
></DT
><DT
>3-1. <A
HREF="#ACCOUNTS-E1"
>Accounts. Proftpd configuration.</A
></DT
><DT
>3-2. <A
HREF="#ACCOUNTS-E2"
>Accounts. Mail server configuration (postfix+sasl+courier).</A
></DT
><DT
>4-1. <A
HREF="#NOTIFY-EXAMPLE"
>Lms-notify: example of last 10 customer's operations</A
></DT
><DT
>4-2. <A
HREF="#NOTIFY-TEMPLATE"
>Lms-notify: example of mailing template</A
></DT
><DT
>5-1. <A
HREF="#INSTANCE-EXAMPLE"
>Lms-mgc: Example instance</A
></DT
><DT
>6-1. <A
HREF="#TSCRIPT-EXAMPLE-HOSTS"
>Parser: Creating /etc/hosts file</A
></DT
><DT
>6-2. <A
HREF="#TSCRIPT-EXAMPLE-DEBTORS"
>Parser: Debtors list</A
></DT
><DT
>6-3. <A
HREF="#TSCRIPT-EXAMPLE-ETHERS"
>Parser: Ethers file for arp</A
></DT
><DT
>6-4. <A
HREF="#TSCRIPT-EXAMPLE-NOTIFY"
>Parser: Notify module replacement</A
></DT
><DT
>7-1. <A
HREF="#CONFIG-FORMAT"
>Format of configuration options</A
></DT
></DL
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="INTRO"
></A
>Chapter 1. Intro</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="ABOUT-LMS"
>1.1. About LMS</A
></H2
><P
>LMS (LAN Management System) is a package of applications for managing LAN
          networks. Its main goal is to provide the best service to customers, as seen in large ISP
          companies. LMS is written in PHP, Perl and C and can use MySQL or PostgreSQL as
          its database backends. The following functionalities are provided at the time:</P
><UL
><LI
><P
>customer database (names, addresses, phones, comments, etc),</P
></LI
><LI
><P
>computers inventory (IP, MAC),</P
></LI
><LI
><P
>simple financial system suited for network operations,</P
></LI
><LI
><P
>financial balances and invoices,</P
></LI
><LI
><P
>email warnings to users,</P
></LI
><LI
><P
>automatic billing schedule,</P
></LI
><LI
><P
>ability to generate (almost) any kind of config file (ie.
               ipchains/iptables firewall scripts, DHCP daemon configuration,
               zones for bind, /etc/ethers entries, oident, htb and more...),</P
></LI
><LI
><P
>visualization of bandwidth consumption per host,</P
></LI
><LI
><P
>request tracker system (Helpdesk),</P
></LI
><LI
><P
>timetable (Organizer).</P
></LI
></UL
><P
>Initial components of this software were invented to aid administration of <A
HREF="http://www.netx.waw.pl/"
TARGET="_top"
>ASK NetX</A
> (amateur computer network) and it's still
          developed and tested here.</P
><P
>LMS won't replace administration skills. If you can't handle installation and
          configuration of your system, you likely won't manage to adjust LMS for your system. In
          short - administration of UNIX systems is needed to operate this software.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AUTHORS"
>1.2. Authors</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="LMS"
>1.2.1. LMS Developers</A
></H3
><UL
><LI
><P
>PHP Code:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://www.baseciq.org"
TARGET="_top"
>Lukasz 'Baseciq' Mozer</A
></TD
></TR
><TR
><TD
>Michal 'DziQs' Zapalski</TD
></TR
><TR
><TD
><A
HREF="http://debian.black.pl"
TARGET="_top"
>Radoslaw 'Warden' Antoniuk</A
></TD
></TR
><TR
><TD
>Krzysztof 'hunter' Drewicz</TD
></TR
><TR
><TD
><A
HREF="http://www.lexx.w.pl"
TARGET="_top"
>Marcin 'Lexx' Krol</A
></TD
></TR
><TR
><TD
><A
HREF="http://alec.pl"
TARGET="_top"
>Aleksander 'A.L.E.C' Machniak</A
></TD
></TR
><TR
><TD
><A
HREF="http://kondi.net"
TARGET="_top"
>Konrad 'kondi' Rzentarzewski</A
></TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>C Code:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://alec.pl"
TARGET="_top"
>Aleksander 'A.L.E.C' Machniak</A
></TD
></TR
><TR
><TD
><A
HREF="http://www.lexx.w.pl"
TARGET="_top"
>Marcin 'Lexx' Krol</A
></TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>Perl Code:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://wwww.baseciq.org"
TARGET="_top"
>Lukasz 'Baseciq' Mozer</A
></TD
></TR
><TR
><TD
>Michal 'DziQs' Zapalski</TD
></TR
><TR
><TD
>Maciej 'agaran' Pijanka</TD
></TR
><TR
><TD
>Krzysztof 'hunter' Drewicz</TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>Design:
              <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://wwww.baseciq.org"
TARGET="_top"
>Lukasz 'Baseciq' Mozer</A
></TD
></TR
></TBODY
></TABLE
>
              </P
></LI
><LI
><P
>HTML, JavaScript, CSS:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://wwww.baseciq.org"
TARGET="_top"
>Lukasz 'Baseciq' Mozer</A
></TD
></TR
><TR
><TD
><A
HREF="http://plug.atn.pl/~bober/"
TARGET="_top"
>Pawel 'Bob_R' Czerski</A
></TD
></TR
><TR
><TD
><A
HREF="http://gamechannel.int.pl"
TARGET="_top"
>Pawel 'sickone' Kisiela</A
></TD
></TR
><TR
><TD
><A
HREF="http://kondi.net"
TARGET="_top"
>Konrad 'kondi' Rzentarzewski</A
></TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>Images:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://pierzak.melanz.org"
TARGET="_top"
>Piotr 'Pierzak' M.</A
></TD
></TR
><TR
><TD
><A
HREF="http://byko.pawlacz.net"
TARGET="_top"
>Grzegorz 'byko' Cichowski</A
></TD
></TR
><TR
><TD
><A
HREF="http://www.kflis.net"
TARGET="_top"
>Kuba 'kflis' Flis</A
></TD
></TR
><TR
><TD
><A
HREF="http://wwww.baseciq.org"
TARGET="_top"
>Lukasz 'Baseciq' Mozer</A
></TD
></TR
><TR
><TD
><A
HREF="http://jimmac.musichall.cz"
TARGET="_top"
>Jakub 'Jimmac' Steiner</A
></TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>MySQL Support:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://s.atn.pl"
TARGET="_top"
>Kuba 'shasta' Jankowski</A
></TD
></TR
><TR
><TD
><A
HREF="http://debian.black.pl"
TARGET="_top"
>Radoslaw 'Warden' Antoniuk</A
></TD
></TR
><TR
><TD
>Przemyslaw Babinski</TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>PostgreSQL Support:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://alec.pl"
TARGET="_top"
>Aleksander 'A.L.E.C' Machniak</A
></TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>Web Page &#38; Documentation:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://alec.pl"
TARGET="_top"
>Aleksander 'A.L.E.C' Machniak</A
></TD
></TR
><TR
><TD
><A
HREF="http://s.atn.pl"
TARGET="_top"
>Kuba 'shasta' Jankowski</A
></TD
></TR
><TR
><TD
><A
HREF="http://www.rednet.krakow.pl/~jabbas/"
TARGET="_top"
>Grzegorz 'JaBBaS' Dziegielewski</A
></TD
></TR
><TR
><TD
><A
HREF="http://wwww.baseciq.org"
TARGET="_top"
>Lukasz 'Baseciq' Mozer</A
></TD
></TR
><TR
><TD
><A
HREF="http://www.lexx.w.pl"
TARGET="_top"
>Marcin 'Lexx' Krol</A
></TD
></TR
><TR
><TD
><A
HREF="http://kondi.net"
TARGET="_top"
>Konrad 'kondi' Rzentarzewski</A
></TD
></TR
></TBODY
></TABLE
>
               </P
></LI
><LI
><P
>Beta testing:
               <TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://byko.pawlacz.net"
TARGET="_top"
>Grzegorz 'byko' Cichowski</A
></TD
></TR
><TR
><TD
><A
HREF="http://debian.black.pl"
TARGET="_top"
>Radoslaw 'Warden' Antoniuk</A
></TD
></TR
><TR
><TD
>Tomasz 'dzwonek' Dzwonkowski</TD
></TR
><TR
><TD
>Sebastian 'Victus' Frasunkiewicz</TD
></TR
><TR
><TD
><A
HREF="http://www.kflis.net"
TARGET="_top"
>Kuba 'kflis' Flis</A
></TD
></TR
><TR
><TD
>Krystian 'UFOczek' Kochanowski</TD
></TR
><TR
><TD
><A
HREF="http://www.rednet.krakow.pl/~jabbas/"
TARGET="_top"
>Grzegorz 'JaBBaS' Dziegielewski</A
></TD
></TR
><TR
><TD
>Andrzej 'chsh' Gradziel</TD
></TR
></TBODY
></TABLE
>
               </P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="OTHERS"
>1.2.2. Others</A
></H3
><P
>LMS uses elements of other software: 
          <A
HREF="http://phpwizard.net/projects/phpMyAdmin/"
TARGET="_top"
>phpMyAdmin</A
>,
          <A
HREF="phpsysinfo.sourceforge.net"
TARGET="_top"
>phpsysinfo</A
>, 
          <A
HREF="florian-amrhein.de/newsportal/index-anglish.php3"
TARGET="_top"
>NewsPortal</A
>, 
          <A
HREF="www.bosrup.com/web/overlib/"
TARGET="_top"
>overLIB</A
>, 
          <A
HREF="www.ros.co.nz/pdf/"
TARGET="_top"
>ezpdf</A
>, 
          <A
HREF="www.softcomplex.com/products/tigra_calendar/"
TARGET="_top"
>Tigra Calendar</A
>,
          Piotr Kleban's number-to-words conversion procedures and
          code examples from <A
HREF="http://www.php.net/manual/"
TARGET="_top"
>          PHP manual</A
>.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="LEGALNOTICE"
>1.3. Legal Notice</A
></H2
><P
>This program is free software; you can redistribute it and/or modify it 
         under the terms of the GNU General Public License as published by the 
         Free Software Foundation; either version 2 of the License, or (at you option) 
         any later version.</P
><P
>This program is distributed in the hope that it will be useful, but 
         WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
         or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License 
         for more details.</P
><P
>You should have received a copy of the GNU General Public License along 
         with this program; if not, write to the Free Software Foundation, Inc., 
         59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</P
><P
>Text of License is <A
HREF="../../COPYING"
TARGET="_top"
>here</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MOREINFO"
>1.4. Other Information</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="CONTACT"
>1.4.1. Contact</A
></H3
><P
>Preferably via a mailing list, which you can subscribe by sending
               empty e-mail with subject "subscribe lms-en" to address 
               <A
HREF="mailto: ecartis@lists.rulez.pl"
TARGET="_top"
>ecartis@lists.rulez.pl</A
>.
               Further emails should be sent to address lms-en@lists.rulez.pl.
               </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="BUGS"
>1.4.2. Ideas and Bugs Reports</A
></H3
><P
>In order to effectively report bugs or new ideas, it's recommended to
               subscribe mailing list, where you can get quickest response for your problems from
               either LMS users or developers team. There's also Bug Tracking System available, when
               you can report bugs upon registration. Reports from BTS are also forwarded to mailing
               list, so the best practice is to subscribe to list, report via BTS and send link to
               mailing list and finally wait as your report will evolve. BTS address is <A
HREF="http://bts.rulez.pl"
TARGET="_top"
>bts.rulez.pl</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LATEST"
>1.4.3. Newest version</A
></H3
><P
>Newest version of LMS can be downloaded from CVS repository
               utilizing WWW interface at <A
HREF="http://cvs.rulez.pl/viewcvs.cgi/lms/lms.tar.gz?tarball=1"
TARGET="_top"
>cvs.rulez.pl</A
>,
               or with CVS tools (anonymous access, empty password):</P
><PRE
CLASS="SCREEN"
>cvs -d :pserver:cvs@cvs.rulez.pl:/home/cvsroot login
cvs -d :pserver:cvs@cvs.rulez.pl:/home/cvsroot co lms
cvs -d :pserver:cvs@cvs.rulez.pl:/home/cvsroot logout</PRE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="HISTORY"
>1.4.4. Changelog</A
></H3
><P
>Informations about changes and version history of LMS is included in 
               <A
HREF="../../ChangeLog"
TARGET="_top"
>Changelog</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="COMERCIAL-SUPPORT"
>1.4.5. Commercial Support</A
></H3
><P
>				There are questions appearing periodically on lms mailing lists about adding some funtions to LMS.
				Matter of payment for support is very difficult. Note, that there is no company behind LMS,
				so any commercial adoption or support should be discussed directly between You and involved developer.  
				You are reading english version of documentation, it's likely that you are not from Poland, which makes even simple things like issuing invoice or money transfer complex.
			 The most experienced developer in that matter is Alec. You can see details on support on his page: <A
HREF="http://lms.alec.pl/index.php?lang=en"
TARGET="_top"
>http://lms.alec.pl/index.php?lang=en</A
></P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="INSTALL"
></A
>Chapter 2. Installation and configuration</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="INSTALL-INTRO"
>2.1. Intro</A
></H2
><P
>LMS consist a few modules. <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> is user interface, which is
     responsible for all interactions with user, entirely written in PHP and it uses SQL database to
     store all data, thus PHP script interpreter and SQL engine of your choice (MySQL or Postgresql).
     </P
><P
>LMS also contains a set of Perl scripts, responsible for various operations, ie.
     periodically applying subscription fees or sending reminders to users who are in debt. It
     also contains <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-MGC</I
></SPAN
>, which may be configured to generate virtually
     any configuration file or script and manage your server. Note that some of the scripts might
     need additional Perl modules to function.</P
><P
>At the end there is also <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS Daemon</I
></SPAN
>, written in C, which is
     being used (its plugins in fact) as a drop-in replacement for <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-MGC</I
></SPAN
> - to
     configure and manage (ie. restart) your services. It's main advantage is that it responds for
     all <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> changes in realtime.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-REQUIREMENTS"
>2.2. Requirements</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-WWW"
>2.2.1. Web Server</A
></H3
><P
>Because <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> is written in PHP,
            it needs Web server to work. Apache is preferred (<A
HREF="http://www.apache.org"
TARGET="_top"
>www.apache.org</A
>).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-PHP"
>2.2.2. PHP Interpreter</A
></H3
><P
>Interpreter version should be 4.2.x or higher, but it also works fine with 4.1.x
           (but due that developers use 4.2.3 or higher, we can't guarantee correct work with older
           versions. PHP can be downloaded from <A
HREF="http://www.php.net"
TARGET="_top"
>www.php.net</A
>.
           At least following PHP modules needs to be installed (look for "extension" in
           php.ini or in output of phpinfo function): pcre, posix (for systems info), zlib (for
           compressed backups), gd or ming (for graphical map) and mysql or pgsql (for db
           support). PEAR::Mail is being used for mailing (which require Net_SMTP and Net_Sockets from 
        PEAR package).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-DB"
>2.2.3. Database Server</A
></H3
><P
>MySQL server in version 3.23.xx and higher is supported. LMS won't work correctly
           with older versions.</P
><P
>PostgreSQL in version 7.3.x or higher is supported.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-SMARTY"
>2.2.4. Smarty Library</A
></H3
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> requires Smarty library (<A
HREF="http://smarty.php.net"
TARGET="_top"
>http://smarty.php.net</A
>) in version 2.6.0
            or higher (don't use 2.6.4 version). Newer versions of Smarty requires that
            you have not enabled "magic_quotes_runtime" (set to Off) option in <A
HREF="http://www.php.net/manual/en/configuration.php"
TARGET="_top"
>PHP configuration</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-PERL"
>2.2.5. Perl</A
></H3
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-MGC</I
></SPAN
> and the rest of Perl scripts requires 
          also Perl interpreter and some modules:
       <UL
><LI
><P
>Perl and its basic modules (POSIX, GetOpt::Long),</P
></LI
><LI
><P
>Config::IniFiles,</P
></LI
><LI
><P
>DBI,</P
></LI
><LI
><P
>DBD-mysql (if you use MySQL),</P
></LI
><LI
><P
>DBD-Pg (if you use Postgres),</P
></LI
></UL
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-C"
>2.2.6. C Compiler</A
></H3
><P
>If you intend to run <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS Daemon</I
></SPAN
> you will need
       working C compiler, because daemon will be provided in source code form only.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-REQ-BROWSER"
>2.2.7. Web Browser</A
></H3
><P
>LMS has web user interface, so you'll need web browser with javascript and
           cookies enabled. Our exparience says that Mozilla Firefox 1.x will be a good 
           choice.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-INSTALL"
>2.3. LMS Installation</A
></H2
><P
>LMS in tarball (.tar.gz) archive can be downloaded from project 
          home page (<A
HREF="http://lms.rulez.pl"
TARGET="_top"
>lms.rulez.pl</A
>),
          which should be extracted and placed in chosen directory (i.e. <TT
CLASS="FILENAME"
>/var/www/lms</TT
>) 
          and made available for Web Server (ie. with Alias /lms/ /var/www/lms):
<PRE
CLASS="SCREEN"
>$ cd /var/www
$ wget http://lms.rulez.pl/download/stable/lms-x.x.x.tar.gz
$ tar zxf lms-x.x.x.tar.gz</PRE
>
          </P
><P
>Two kind of LMS packets are available - the one with Smarty library included
          (<TT
CLASS="FILENAME"
>lms-x.x.x+libs.tar.gz</TT
>) and without this library. If you have
          installed version without library you have to get Smarty yourself (eg. using PEAR) and
          place it in <TT
CLASS="FILENAME"
>lib</TT
> subdirectory.
<PRE
CLASS="SCREEN"
>$ cd /var/www/lms/lib
$ wget http://smarty.php.net/distributions/Smarty-2.6.0.tar.gz
$ tar zxf Smarty-2.6.0.tar.gz
$ mv Smarty-2.6.0/libs Smarty</PRE
>
          </P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Location of all directories can be set in
          <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[directories]</I
></SPAN
> section in <TT
CLASS="FILENAME"
>lms.ini</TT
> configuration
          file.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Configuration files (<TT
CLASS="FILENAME"
>sample/lms.ini</TT
>
          and <TT
CLASS="FILENAME"
> sample/lms-mgc.ini</TT
>) should be placed in
          <TT
CLASS="FILENAME"
>/etc/lms</TT
> directory. </P
><P
>Scripts from <TT
CLASS="FILENAME"
>bin</TT
> directory should be moved to
          <TT
CLASS="FILENAME"
>/usr/sbin</TT
> directory, so you can execute it directly without giving
          path. </P
><P
><DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Web Server must have read permission on <TT
CLASS="FILENAME"
>lms.ini</TT
>
          file and write permission on <TT
CLASS="FILENAME"
>backup</TT
> directory. Please
          consider security implications: you might want to protect backup directory with
          <TT
CLASS="FILENAME"
>.htaccess</TT
> and place your lms.ini outside Web Server's DocumentRoot
          (LMS allows you to place it in its home directory, but then it's possible to read it
          with http://yourserver/lms.ini, and it contains valuable information such as database
          password!).</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-LOCALE"
>2.4. Localization</A
></H2
><P
>Default language of user interface is English, and national characters
     are encoded in UTF-8. For proper display of national characters in other languages
     you must define appropriate locales. E.g. for polish language it's achieved by running
     the following command:
<PRE
CLASS="SCREEN"
># localedef -v -c -i pl_PL -f UTF-8 /usr/share/locale/pl_PL.UTF-8</PRE
>
     Instructions about database encoding settings in follow-up of this chapter.
     </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-DB"
>2.5. Database Server Installation</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="INSTALL-MYSQL"
>2.5.1. MySQL</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="INSTALL-MYSQL-INTRO"
>2.5.1.1. Intro</A
></H4
><P
>That very popular database server is available with majority of Linux
               distributions. If, however, you have to install it yourself, start with downloading
               its sources from <A
HREF="http://www.mysql.com"
TARGET="_top"
>www.mysql.com</A
>.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-MYSQL-SERVER"
>2.5.1.2. MySQL Server Installation</A
></H4
><P
>After extracting, go to directory with MySQL and type this sequence
               of commands:
               <PRE
CLASS="SCREEN"
>$ ./configure --prefix=/usr/local/mysql
$ make
$ make install
$ /usr/local/mysql/bin/mysql_install_db
$ chown mysql -R /usr/local/mysql/var
$ /usr/local/mysql/bin/safe_mysqld &#38;
$ /usr/local/mysql/bin/mysqladmin -u root password new_password</PRE
>
          </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-MYSQL-DBCREATE"
>2.5.1.3. Create Database</A
></H4
><P
>You have to create database if you run LMS for the first time. If you are
               upgrading from older version, look into Changelog for appropriate notes about
               database changes. In order to create database and load it with schema go to LMS
               directory and run:
<PRE
CLASS="SCREEN"
>mysql -u[user name with database creation rights] -p
Enter password:[just enter password :)]
mysql&#62; create database lms;
mysql&#62; grant usage on lms.* to lms@localhost;
mysql&#62; grant select,insert,update,delete,create,alter,drop on lms.* to lms@localhost identified by '[your_password]';
mysql&#62; flush privileges;
mysql&#62; use lms;
mysql&#62; source doc/lms.mysql;</PRE
>
          </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-MYSQL-LMS"
>2.5.1.4. LMS Configuration (lms.ini)</A
></H4
><P
>Because MySQL is default database for LMS, configuration is limited to
               [database] section setup. Thus you need to edit /etc/lms/lms.ini and fill in password
               and user's name:
               <PRE
CLASS="SCREEN"
>user     = lms
password = your_password</PRE
>
              </P
><P
>After this step you should be able to enter your system without any problems.
               Just write an URL for your LMS installation. If there's no user account (first run),
               you'll be prompted with form to add username and some personal data. When you enter
               correct admin personal details LMS will move you to login page, where you can use
               newly created account.</P
><P
>Let's stop here and add some stuff to cron, for peace of mind:
               <PRE
CLASS="SCREEN"
>12 4 3,10,17,21,28 * * /usr/bin/mysqldump -u lms --password=your-super-secret-password \
              --add-drop-table --add-locks lms &#62; backups/lms-auto-"$(date +%s)".sql</PRE
>
               </P
><P
>That will create mysql database backup automagically each 3, 10, 17, 21 and 28
               day of month at 4:12 at night.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-PGSQL"
>2.5.2. PostgreSQL</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="INSTALL-PGSQL-INTRO"
>2.5.2.1. Intro</A
></H4
><P
>LMS is tested on PostgreSQL 7.3.4 and higher, but because none of special
               features of the engine are ever used, there should be no problems with its later
               versions. If you have not installed PostgreSQL server, best solution is to compile
               it yourself from sources available on <A
HREF="http://www.postgresql.org"
TARGET="_top"
>               www.postgresql.org</A
>.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-PGSQL-SERVER"
>2.5.2.2. Installation</A
></H4
><P
>That is a short version of installation procedure, more info can be found in
               Postgres documentation. After you download and extract sources go to main directory
               and run following commands:
               <PRE
CLASS="SCREEN"
>$ ./configure --enable-locale
$ gmake
$ su
$ gmake install
$ adduser postgres
$ mkdir /usr/local/pgsql/data
$ chown postgres /usr/local/pgsql/data
$ su - postgres
$ /usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data --locale=pl_PL.UTF-8
$ /usr/local/pgsql/bin/postmaster -D /usr/local/pgsql/data &#62;logfile 2&#62;&#38;1 &#38;</PRE
>
               </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-PGSQL-DBCREATE"
>2.5.2.3. Database Creation</A
></H4
><P
>While server is running you can start with adding database and its owner, both
               named 'lms' and loading database schema:
               <PRE
CLASS="SCREEN"
>$ /usr/local/pgsql/bin/createuser -d -A -P lms
$ /usr/local/pgsql/bin/createdb -E UNICODE -U lms lms
$ /usr/local/pgsql/bin/psql -d lms -U lms -f /lms/doc/lms.pgsql</PRE
>
          </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-PGSQL-LMS"
>2.5.2.4. LMS Configuration (lms.ini)</A
></H4
><P
>For LMS default database server is MySQL so you have to set following options
               in [database] section of /etc/lms/lms.ini file:
                  <PRE
CLASS="SCREEN"
>type     = postgres
user     = lms
password = password_entered_with_lms_user_creation</PRE
>
              </P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>The need for password actually depends
               on Postgres users authentication configuration found in
               <TT
CLASS="FILENAME"
>/usr/local/pgsql/data/pg_hba.conf</TT
> (refer to <A
HREF="http://www.postgresql.org/docs/8.0/interactive/client-authentication.html#EXAMPLE-PG-HBA.CONF"
TARGET="_top"
>               Postgresql documentation</A
>). By default password is not
               required and you can comment it with semicolon.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>After this step you should be able to enter your system without any problems.
               Just write an URL for your LMS installation. If there's no user account (first run),
               you'll be prompted with form to add username and some personal data. When you enter
               correct admin personal details LMS will move you to login page, where you can use
               newly created account.</P
><P
>Let's stop here and add some stuff to cron, for peace of mind:
               <PRE
CLASS="SCREEN"
>12 4 3,10,17,21,28 * * /usr/bin/pg_dump -U lms --clean --create --column-inserts  \
            --format=p lms -- file backups/lms-auto-"$(date +%s)".sql</PRE
>
         </P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-CONFIG"
>2.6. Basic Configuration</A
></H2
><P
>Main configuration file of LMS is <TT
CLASS="FILENAME"
>lms.ini</TT
>, which must be placed
         in directory <TT
CLASS="FILENAME"
>/etc/lms</TT
> or in LMS root directory (not recommended, see
         <A
HREF="#INSTALL-INSTALL"
>Section 2.3</A
>!!!). It contains configuration options for <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>
         and for all scripts with exception of <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-MGC</I
></SPAN
>.</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Remember to remove semicolons (comments sign) from beginning of line with
         parameter that you set.</P
></TD
></TR
></TABLE
></DIV
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>As of version 1.6 and later storing config 
	 in <TT
CLASS="FILENAME"
>lms.ini</TT
> is beeing treaded as obsolete. 
	 The only required values there are from [database] and [directories]
	 sections. Settings are stored in database and could be changed by 
	 userinterface.</P
></TD
></TR
></TABLE
></DIV
></P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-CONFIG-DB"
>2.6.1. Section [database] - Database Settings</A
></H3
><P
>            <UL
><LI
><P
>type</P
><P
>Database type. Currently in 100% are supported 'mysql' 
		    and 'postgres'. Default: mysql</P
><P
>Example: <SAMP
CLASS="PROMPT"
>type = mysql</SAMP
></P
></LI
><LI
><P
>host</P
><P
>Host where database is running. Usually 'localhost', but you can set anything here     
	            (IP, domain or path to socket in 'localhost:/path/to/socket' format).                       
	            Default: localhost</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>host = localhost</SAMP
></P
></LI
><LI
><P
>user</P
><P
>Database user account name. In many cases (if you follow this documentation) that will
	            be 'lms'. If you want to use privileged account, you can enter 'root' (MySQL on most of
	            *nixes), 'mysql' (on PLD) or 'postgres' (PostgreSQL). Default: mysql</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>user = lms</SAMP
></P
></LI
><LI
><P
>password</P
><P
>Database user password. Default: empty.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>password = password</SAMP
></P
></LI
><LI
><P
>database</P
><P
>Database name. Default: lms</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>database = lms</SAMP
></P
></LI
><LI
><P
>server_encoding</P
><P
>Database encoding. Use if your database encoding is not Unicode. Postgres is
	            performing conversion automatically, but if you use MySQL PHP and iconv in LMS DB drivers is
	            used. Default: unicode</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>server_encoding = latin2</SAMP
></P
></LI
></UL
>
    	    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-CONFIG-DIR"
>2.6.2. Section [directories] - Directories Settings</A
></H3
><P
>        
     <UL
><LI
><P
>sys_dir</P
><P
>System directory. It is a place where the entire content of LMS UI is placed, that
        means index.php, graphics, templates and the rest. By default index.php tries to guess where
        is it located using getcwd(), but it's better to say it where it is:</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>sys_dir = /var/www/htdocs/lms/</SAMP
></P
></LI
><LI
><P
>modules_dir</P
><P
>Directory with LMS "modules". That is content of /modules directory. By default it is
        <TT
CLASS="FILENAME"
>modules</TT
> subdirectory of sys_dir.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>modules_dir = /usr/share/lms/modules/</SAMP
></P
></LI
><LI
><P
>lib_dir</P
><P
>Directory with LMS "libraries". That is content of /lib directory. By default it is
        <TT
CLASS="FILENAME"
>lib</TT
> subdirectory of sys_dir.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>lib_dir = /usr/share/lms/lib/</SAMP
></P
></LI
><LI
><P
>backup_dir</P
><P
>Directory for database backup files - it's a place where LMS can write its database
        snapshots. By default it is <TT
CLASS="FILENAME"
>backups</TT
> subdirectory of sys_dir.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>backup_dir = /var/backup/lms/</SAMP
></P
><P
><DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>If directory with backups is accessible from WWW
        level (within Web Server DocumentRoot), anybody can access them without
        authentication.</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>doc_dir</P
><P
>Directory for documents archive - it's a place where LMS can write uploaded files.
        By default it is <TT
CLASS="FILENAME"
>documents</TT
> subdirectory of sys_dir.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>doc_dir = /usr/share/lms/docs/</SAMP
></P
><P
><DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>If that directory is accessible from WWW
        level (within Web Server DocumentRoot), anybody can access them without
        authentication.</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>smarty_dir</P
><P
>Directory with Smarty library - By default <TT
CLASS="FILENAME"
>Smarty</TT
> subdirectory of lib_dir.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>smarty_dir = /usr/lib/php/Smarty</SAMP
></P
></LI
><LI
><P
>smarty_compile_dir</P
><P
>Compilation directory for Smarty. It's a place where Smarty compile its templates. By
        default it is <TT
CLASS="FILENAME"
>templates_c</TT
> subdirectory of sys_dir.</P
><P
>Example:      <SAMP
CLASS="PROMPT"
>smarty_compile_dir = /var/smarty/compile/lms</SAMP
></P
></LI
><LI
><P
>smarty_templates_dir</P
><P
>Directory with templates for Smarty. By default it is <TT
CLASS="FILENAME"
>templates</TT
>
        subdirectory of sys_dir.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>smarty_templates_dir = /usr/share/lms/templates</SAMP
></P
></LI
></UL
>
     </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-CONFIG-FINANCES"
>2.6.3. Section [finances] - Finances Settings</A
></H3
><P
>This section consist options for financial system and for payment
        forms. You can read more about that in chapter 'Documents'.
        <UL
><LI
><P
>suspension_percentage (optional)</P
><P
>Percentage for suspended liabilities. Default: '0'</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>suspension_percentage = '50'</SAMP
></P
></LI
></UL
>
        </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-RIGHTS"
>2.7. Access rights</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="INSTALL-RIGHTS-IDEA"
>2.7.1. Idea</A
></H3
><P
>In LMS you may define up to 256 rules to access the system. 
      Each can permit or deny access to defined modules. 
      Each user can have any combination of access rules assigned to his account.</P
><P
>By default following access rules list is defined:
       <UL
><LI
><P
>full access</P
></LI
><LI
><P
>read only (excluding Helpdesk)</P
></LI
><LI
><P
>nodes connection/disconnection</P
></LI
><LI
><P
>finances management</P
></LI
><LI
><P
>configuration reload</P
></LI
><LI
><P
>customers management</P
></LI
><LI
><P
>nodes management</P
></LI
><LI
><P
>stats access</P
></LI
><LI
><P
>mailing access</P
></LI
><LI
><P
>Helpdesk (RT) administration</P
></LI
><LI
><P
>Helpdesk (RT) operation</P
></LI
><LI
><P
>accounts management</P
></LI
><LI
><P
>configuration</P
></LI
><LI
><P
>networks and devices management</P
></LI
><LI
><P
>timetable management</P
></LI
><LI
><P
>daemon management and configuration</P
></LI
><LI
><P
>users edition and addition forbidden</P
></LI
><LI
><P
>no access</P
></LI
></UL
>
      Most of them grant access to modules and two denies. Modules that user
      has always access are: welcome, copyrights, logout, chpasswd 
      (chpasswd can change only own password), access to all others is defined by rules.</P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>If you don't define any access rule for user, then LMS defines
      0 rule for him, which mean: full access.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-RIGHTS-HOW"
>2.7.2. How does it work?</A
></H3
><P
> Algorithm that decides whether user has access to given module or not is as following:
          <TABLE
BORDER="0"
><TBODY
><TR
><TD
>-  First of all: checking list of modules that user always has access.</TD
></TR
><TR
><TD
>-  Next: checking if module match rules in each levels user has access to.</TD
></TR
><TR
><TD
>-  Finally: Decision if user is permitted to access modules. If module 
          match to any level that denies access then access will be forbidden even if user has
          level that permits access to module. For example, if someone has full access and no access 
          to "add computer" module, then he won't able to access module.
          If module  matches level that permits access to module, then LMS will grant access to module, 
          but if module does not match at any level then no-access-message also will be printed.</TD
></TR
></TBODY
></TABLE
>
          </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-RIGHTS-USER"
>2.7.3. User-defined access rules</A
></H3
><P
>Advanced users can define any additional access rules
          or redefine existing ones.  In order to do that you must make
          PHP script based on file <TT
CLASS="FILENAME"
>lib/accesstable.php</TT
>
          and place it in LMS's <TT
CLASS="FILENAME"
>lib</TT
> directory. Then 
          set option <TT
CLASS="FILENAME"
>custom_accesstable</TT
> in [phpui]
          section to created file name.</P
><P
>In that way it's possible to define your own rules to allow
          or deny access for any modules. Module is a name of PHP file
          in <TT
CLASS="FILENAME"
>modules</TT
> directory, given without extension 
          in access rules. For example, it's possible to define
          rule for invoices display (e.g. for lms-sendinvoices script) 
          in the following way:
<PRE
CLASS="SCREEN"
>&lt;?php
$access['table'][100]['name']      = 'invoices display';
$access['table'][100]['allow_reg'] = '^invoice$';
?&gt;</PRE
>
          </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-UPGRADE"
>2.8. Upgrade</A
></H2
><P
>Since version 1.5.4 LMS was released in polish language only. If you are upgrading
      read polish documentation for upgrade description. In newest versions upgrade is very easy.
      That process has two stages. First, overwrite old files with new ones and remove contents of
      <TT
CLASS="FILENAME"
>templates_c</TT
> directory (or better create new LMS directory tree). Second
      stage is a database structure change - it's self-executing process acting upon first login to
      the UI.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL-DOCUMENTS"
>2.9. Documents</A
></H2
><P
>LMS makes possible to generate and to store various documents
	    i.e. invoices, receipts and non-financial documents i.e. contracts,
	    protocols and others. Documents can be numbered with numbering plans 
	    (patterns) defined in menu Configuration - Numbering Plans.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-INVOICES"
>2.9.1. Invoices</A
></H3
><P
>It's possible to issue invoices in either automatic or manual way. Manual
                invoices creation is possible in 'New Invoice' module from 'Finances' menu.
                Automatic issue might be helpful while you have legal contracts with your users.
                In this case invoices are created by <TT
CLASS="FILENAME"
>lms-payments</TT
> script or
                <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon.</P
><P
>For proper work of printouts you need to setup custom options in
                <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[invoices]</I
></SPAN
> section of <TT
CLASS="FILENAME"
>lms.ini</TT
>:
          <UL
><LI
><P
>header</P
><P
>Seller. Can use string "\n" for lines separation. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>header = "SuperNet ISP\nNew Street 15\n12-000 City\n"</SAMP
></P
></LI
><LI
><P
>footer</P
><P
>Invoice footer - e.g. contact information about seller. Footer will be placed at bottom
                of an invoice, using small font. Like in header option use "\n" to separate lines. Default:
                empty</P
><P
>Example: <SAMP
CLASS="PROMPT"
>footer = "Internet Service Provider K-27, phone 555-23-23, etc."</SAMP
></P
></LI
><LI
><P
>default_author</P
><P
>Invoice issuer name. Default: empty</P
><P
>Example: <SAMP
CLASS="PROMPT"
>default_author = "invoicing expert"</SAMP
></P
></LI
><LI
><P
>cplace</P
><P
>Invoice issue location (city). Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>cplace = Warsaw</SAMP
></P
></LI
></UL
>
          Generated invoices can be viewed in two ways: by clicking on printer icon, in balance sheet page
          or by clicking 'Invoices List' in 'Finances' menu. In second case, is also possible to 
          filter invoices for printing.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-INVOICES-HTML"
>2.9.1.1. HTML</A
></H4
><P
>Invoices are printed in html format by default
          using provided template. In <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[invoices]</I
></SPAN
> section
          you can also configure:
          <UL
><LI
><P
>template_file</P
><P
>Invoice template, which should be placed in 
               <TT
CLASS="FILENAME"
>templates</TT
> directory. Default: invoice.html.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>template_file = invoice-mynet.html</SAMP
></P
></LI
><LI
><P
>content_type</P
><P
>Invoice content-type. If you enter here 'application/octet-stream'
               then browser will ask to save file on disk, instead of displaying it.
               It's useful if you use your own template which generate eg. rtf or xls file.
               Default: 'text/html'</P
><P
>Example: <SAMP
CLASS="PROMPT"
>content_type = application/octet-stream</SAMP
></P
></LI
><LI
><P
>attachment_name</P
><P
>File name for saving finished invoice printout. WARNING: Setting attachment_name 
               with default content_type will (in case of MSIE) print invoice + prompt for save on 
               disk + bonus browser crash (6.0SP1 on WInXP).
               Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>attachment_name = invoice.xls</SAMP
></P
></LI
></UL
>
          Generated invoice in HTML format consist of originals and copies, which are separated
          by CSS page-break markups, so every modern browser that supports CSS 
          should print many-page invoices correctly. This behavior was tested on
          Microsoft Internet Explorer 6.0, Opera 7.02 and Mozilla 1.3.</P
><P
>               <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Almost every internet browser has printing 
               configuration, where functions like header and footer or URL 
               printing can be disabled.</P
></TD
></TR
></TABLE
></DIV
>
          </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-INVOICES-PDF"
>2.9.1.2. PDF</A
></H4
><P
>It's possible to create invoices as PDF files. Setting option <TT
CLASS="FILENAME"
>type</TT
> in
                 <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[invoices]</I
></SPAN
> section to 'pdf' will force invoice being created in PDF instead
                 of html. Option <TT
CLASS="FILENAME"
>template_file</TT
> has the same meaning, with one difference,
                 that it might take predefined values: 'standard' - basic invoice (invoice.html equivalent) and
                 'FT-0100' - invoice adjusted for printing on <A
HREF="http://www.polarnet.org/produkty/ft-0100/"
TARGET="_top"
>FT-0100</A
> paper including payment form. You can set
                 <TT
CLASS="FILENAME"
>template_file</TT
> option for php file name, but this feature is meant for
                 advanced users as it requires you to create more complicated php file than the one used with html
                 invoices Smarty template.</P
><P
>Data for payment form printouts is stored in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[finances]</I
></SPAN
>
          section of <TT
CLASS="FILENAME"
>lms.ini</TT
> file. That is:
          <TABLE
BORDER="0"
><TBODY
><TR
><TD
>name - seller name</TD
></TR
><TR
><TD
>shortname - short seller name</TD
></TR
><TR
><TD
>address - seller address</TD
></TR
><TR
><TD
>zip - seller postal code</TD
></TR
><TR
><TD
>city - seller city</TD
></TR
><TR
><TD
>account - banking account number</TD
></TR
></TBODY
></TABLE
>
          </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-INVOICES-CNOTE"
>2.9.1.3. Credit Notes</A
></H4
><P
>Credit notes uses invoices settings from 
	  <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[invoices]</I
></SPAN
> section.
	  Default invoice template include also credit notes contents, but
	  you have possibility to define different template for credit notes
	  (the rest of options is common for both invoices and credit notes):
          <UL
><LI
><P
>cnote_template_file</P
><P
>Credit note template, which should be placed in 
               <TT
CLASS="FILENAME"
>templates</TT
> directory. Default: invoice.html.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>cnote_template_file = invoice-mynet.html</SAMP
></P
></LI
></UL
>
          </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-RECEIPTS"
>2.9.2. Cash Receipts</A
></H3
><P
></P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="INSTALL-RECEIPTS-HTML"
>2.9.2.1. HTML</A
></H4
><P
>Receipts are printed in html format by default
          using provided template. In <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[receipts]</I
></SPAN
> section
          you can also configure:
          <UL
><LI
><P
>template_file</P
><P
>Cash receipt template, which should be placed in 
               <TT
CLASS="FILENAME"
>templates</TT
> directory. Default: receipt.html.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>template_file = /mytemplates/receipt.html</SAMP
></P
></LI
><LI
><P
>content_type</P
><P
>Printout content-type. If you enter here 'application/octet-stream'
               then browser will ask to save file on disk, instead of displaying it.
               It's useful if you use your own template which generate eg. rtf or xls file.
               Default: 'text/html'</P
><P
>Example: <SAMP
CLASS="PROMPT"
>content_type = application/octet-stream</SAMP
></P
></LI
><LI
><P
>attachment_name</P
><P
>File name for saving receipt printout. WARNING: Setting attachment_name 
               with default content_type will (in case of MSIE) print document + prompt for save on 
               disk + bonus browser crash (6.0SP1 on WinXP).
               Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>attachment_name = receipt.xls</SAMP
></P
></LI
></UL
>
          </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-DOCUMENTS-OTHER"
>2.9.3. Other documents</A
></H3
><P
>Documents support is not limited to invoices. You might store 
	    virtually any documents you want in LMS, such as contracts, protocols, 
	    annexes and others. You can assign any number of documents to each 
	    customer in 'Customer documents' tab in 'Customer information' panel. 
	    Each document should have defined title, type and additionally you 
	    might define it's time span (time until when it's valid) and description.
	    Document files are being stored outside of database (which should be kept
	    in mind while doing backups!) in directory defined with <TT
CLASS="FILENAME"
>doc_dir</TT
>
	    in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[directories]</I
></SPAN
> section of config file.</P
><P
>Documents can be uploaded to system as prepared files, but also 
		generated from templates with use of defined wizards. Here system gives
		great configuration possibilities. In directory 
		<TT
CLASS="FILENAME"
>documents/templates/default</TT
> you can find
		default document wizard (template and engine). You can create unlimited 
		number of own documents wizards, which must be placed in  
		<TT
CLASS="FILENAME"
>documents/templates/</TT
> directory.</P
><P
>Each wizard must have file <TT
CLASS="FILENAME"
>info.php</TT
> with
		specified structure:
<PRE
CLASS="SCREEN"
>&lt;?php
$engine = array(
    'name' =&#62; 'default', 	// wizard (directory) name, lower case letters and numbers
    'engine' =&#62; 'default', 	// engine directory (engine.php)
    'template' =&#62; 'template.html', 		// template file (in 'name' directory)
    'title' =&#62; trans('Default document'), 	// description for LMS-UI
    'content_type' =&#62; 'text/html', 		// output file type
    'output' =&#62; 'default.html', 			// output file name
)
?&gt;</PRE
>
		File <TT
CLASS="FILENAME"
>info.php</TT
> define wizard and is required.
		To generate document is needed engine (file with name <TT
CLASS="FILENAME"
>engine.php</TT
>). 
		You can create own engine or use other by setting 'engine' variable to
		appropriate wizard name. So, there is no need to create engine for
		each new wizard. Is enough to make 'template' template and file
		<TT
CLASS="FILENAME"
>info.php</TT
>.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="USER"
></A
>Chapter 3. User Interface (LMS-UI)</H1
><P
>LMS User Interface is basically administration panel available via Web
 interface that can be used to create and manage customer and computers (nodes)
 data and containing numerous features such as: You're able to bind computer data to your customers and assign it to given
 network. You're also able to define users liabilities and manage your network
 finances. You can search in user and computer data quickly, send mass mailing
 to specific user groups, define access to this UI for selected users and with
 fine grained access rights. Additionally you can track your bandwidth usability
 statistics, create backups of your database online and configuration and
 management of your services. Those are only selected features of
 <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>, so read on to find description of all features.
 </P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="USER-LOGIN"
>3.1. Login</A
></H2
><P
>After you enter LMS installation URL in your Web browser, you'll
        be prompted with login screen, where you need to enter correct username
        and password. All passwords in database are stored in encrypted form.
        </P
><P
>If it's your first session with LMS, and you don't have any
        account created yet, you'll be redirected to new user account screen.
        At this moment you have only access to this one module, so that you can
        create your initial account.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-ADMINISTRATION"
>3.2. Administration</A
></H2
><P
>After successful login to the system you'll have administration
        menu presented on the left side, while content of selected module will be
        displayed on the right side. Initially, you can read some useful information
        about system here. In administration menu, you're able to manage other users
        accounts and create or restore database backups.</P
><P
>You can select any module to work with on the left panel. There
        are also buttons allowing you to change your password, logout or do a quick
        search for customers/computers/helpdesk. You can search by name or id, but also
        additionally by computer name, surname, fragment of address, phone, email, IP or
        MAC. If there are more than one matching record for your search you'll get only
        first result.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ADMINISTRATION-INFO"
>3.2.1. Info</A
></H3
><P
>This is where all basic information about system that is
            running LMS are displayed. It lists the following information:
            LMS core and components versions, copyright notice, uptime and
            kernel version of your server, customers and nodes totals, computer
            activity totals and financial balance. Additionally all LMS links
            are gathered here.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ADMINISTRATION-USERS"
>3.2.2. Users</A
></H3
><P
>'Users' panel is designed for LMS users (ie. network
            administrators) management. You can create or modify any account here, change
            assigned passwords and access rights.</P
><P
>For more information on access rights, see <A
HREF="#INSTALL-RIGHTS"
>Section 2.7</A
>.</P
><P
>Initially after selecting 'Users', you'll get list of all
            users with last login time and host information. When you click on the account,
            you're able to see it's details, including defined access rights.
	    You can modify data any time by clicking 'Edit' link. To create new user 
	    use left panel and click 'New user'.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ADMINISTRATION-NEWUSER"
>3.2.3. New user</A
></H3
><P
>In order to create new user, you need to provide at least
            login name and non empty password. Name and email fields are optional. 
	    Allowed hosts is a coma separated list of host or network IP addresses
	    in 'allow_from' configuration option style. If that list is empty,
	    hosts checking is skipped. Below you can mark specific system access 
	    rights. If you leave all those fields unchecked
            (default), user will be granted with 'full access'.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ADMINISTRATION-DB"
>3.2.4. Backups</A
></H3
><P
>You can manage your database backup copies here. Database copy
            is plain text file with SQL statements needed to reconstruct all tables and it's
            data, which is saved in directory defined with <SAMP
CLASS="PROMPT"
>backup_dir</SAMP
>
            variable in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[directories]</I
></SPAN
>
            section of <TT
CLASS="FILENAME"
>lms.ini</TT
>.</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>By default your backups will be placed in
            <TT
CLASS="FILENAME"
>lms/backups</TT
> directory, which could be accessed with your
            browser, without any authentication, so it's wise to move it above your Web
            Server DocumentRoot.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>All copies can be viewed, removed or downloaded to your
            computer at any time. By clicking on 'recover' icon your current database will
            be deleted and replaced by the one in backup copy. For your safety, before such
            operation current database backup is performed automatically.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-CUSTOMERS"
>3.3. Customers</A
></H2
><P
>This is your customers control center, where you can store and
        manage their data, their finances and also their computers. You can even cut all
        customer computers off with single mouse click.
	<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Automatic cutoff of computers which owners are in debt is
        performed by lms-cutoff Perl script.</P
></TD
></TR
></TABLE
></DIV
></P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-LIST"
>3.3.1. List</A
></H3
><P
>After you select 'List' you'll see list of your users, that
            can be filtered based on selected criteria (customer status, group or network) or
            sort by any highlighted column. Warning triangle on the right side of the record
            shows if any warnings are active for the customer. Computer icon next to triangle
            informs you about computers status (connected of cutoff). Clicking of any of 
            those two symbols toggles status for all computers of the given customer. </P
><P
>Records of customers with negative balance will have 'payback' icon
            (stack of coins), which allows you to account instant payment for the customer,
            which value will reset his debt.</P
><P
>When you click on selected customer you'll get screen with details
            for the customer, divided in several panels: customer details, computer details,
            liabilities details and customer account details. You can also select to edit
            any of the panels on this screen, define customer liabilities, payoff or charge the
            customer.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-NEW"
>3.3.2. New Customer</A
></H3
><P
>This option will let you enter data for new customer record.
            You can enter his last and first name here, or if your customer is
also legal company, enter company name in "Name" and company representative in
"Forename" field. You should also fill customers phone (up to 3) and address (you
can enter additional address for correspondence) and his status (connected,
waiting in queue, prospect).
	    <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Wrong capitalization (uppercase) of customer's last name is
one of most frequent bug reports. Uppercase is implemented via SQL functions and
thus you should seek for solution in your DB engine configuration.</P
></TD
></TR
></TABLE
></DIV
>
	    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-SEARCH"
>3.3.3. Search</A
></H3
><P
>You're able to search customers (including deleted customers), using
various criteria. This module is more powerful than appropriate quick search
box in left panel, as you can specify exact field names to search and if many
customers are found, the list of records will be returned, not only the first one.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-GROUPS"
>3.3.4. Groups</A
></H3
><P
>This is a place where it's possible to divide your customers into
groups. After you click 'Groups' you'll see list of all defined groups with some
basic information. Clicking on selected group will give you details view, where
you are able to edit this group properties, and view/add/remove group members.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-NEWGROPUP"
>3.3.5. New Group</A
></H3
><P
>You can define new group here, providing its name is unique,
and it only contains letters, digits and underscore and minus signs. Groups are
being used in scripts configuration, and for this reason group names cannot
contain spaces.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-WARNINGS"
>3.3.6. Messages</A
></H3
><P
>In this module, you're able to write administrative message which
            will appear on customers Web browser screen and assign it massively to all
            or majority of your customers (just pick them using selection box on the left).
            It's also possible here to deselect administrative messages massively here.
            </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-CUSTOMERS-PRINTS"
>3.3.7. Printing</A
></H3
><P
>Set of modules to provide printer-friendly version of your
            records:
	    <UL
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Customer list</I
></SPAN
> with filter and sort abilities, </P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Liability report</I
></SPAN
> for any range of customer(s), for specified date,</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Customer balance</I
></SPAN
> for selected period</P
></LI
></UL
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-NODES"
>3.4. Nodes</A
></H2
><P
>This panel is designed to manage your computer records, namely:
view computer list (with sorting), search, add new or delete existing computers
from database and editing capabilities.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NODES-LIST"
>3.4.1. List</A
></H3
><P
>List of computers will appear after you select 'List' link.
You can sort it by clicking on any highlighted column name. You have several icons on
each computer record: light bulb for connecting and cutting off selected
computer, warning triangle for warning screen toggle, eraser for computer
removal, pencil for editing details and file icon for viewing it. The last
module (computer/owner view) might be also accessed simply by clicking on
selected record.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NODES-NEW"
>3.4.2. New Node</A
></H3
><P
>You can add new computer here. First select good name for it
(it may contain letters, digits, underscore or minus sign), then it's owner. IP
and MAC addresses may be entered manually, or - by clicking arrow signs on the
right - you may select them from pool which is read from database and ARP daemon. After
you finish - click 'Save'. If you need to enter more computers it's
helpful to activate 'Display this form again' checkbox.
	    <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>To search computer addresses in your network you can use
nbtscan program. If it's available in system, you can click 'Scan' to get all
data about computers that are online.</P
></TD
></TR
></TABLE
></DIV
>
	    <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You need to create customer and network first, so you can
assign new computer to it.</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NODES-SEARCH"
>3.4.3. Search</A
></H3
><P
>You can search for computers here by any given criteria. You
can enter whole IP, MAC or computer name, or just its fragment and search will
guess for you.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NODES-WARNINGS"
>3.4.4. Messages</A
></H3
><P
>You can write administration message here and it will
appear on customer's Web browser screen. In this module you can select majority or
all computers and assign them common message. Just choose computers using
selectbox on the left (computers with message already on will be displayed in
red). If you only want to assign a message to customer, but don't want to turn it
on, just write a message and don't select any of 'Enable/Disable message' boxes.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NODES-PRINT"
>3.4.5. Printing</A
></H3
><P
>You can get printer friendly list of your computers here.
It's possible to use same filter and sorting capabilities as on 'List'.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-NETDEVICES"
>3.5. Net Devices</A
></H2
><P
>In this panel you're able to keep all your network inventory and
define connections between your equipment and customer nodes. Each device
(switch, hub, router, server) might have also IP address(es) assigned.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NETDEVICES-LIST"
>3.5.1. List</A
></H3
><P
>List of devices might include its names, symbols, physical
and logical location, description and number of available connection ports. You
might sort its output by any highlighted column. To see device details or define
all options and manage connected devices just click on selected record. It's
also possible to interchange two connections between devices on this
screen.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NETDEVICES-NEW"
>3.5.2. New device</A
></H3
><P
>Network device should have unique name, all other
parameters (manufacturer, model, serial number, ports, location and description)
are optional.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NETDEVICES-MAP"
>3.5.3. Map</A
></H3
><P
>Selection of 'Map' option draws graphical map of entire
		network. You can define root device, which will appear on top of the map and all
		other devices will be drawn relative to it.
		<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You need GD or Ming library compiled in PHP 
		to be able to use graphical map.</P
></TD
></TR
></TABLE
></DIV
>
		Use <TT
CLASS="FILENAME"
>'map_type'</TT
> option in section <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
> 
		section to specify type of map. Set it to "flash" if you've
		got Ming library or "gd" for graphic images. By default (option
		not set) LMS will try to generate flash map, and when this fails, 
		t will fallback to GD.
		</P
><P
>Device status is shown on the map - computers in black are
offline. Question mark on device icon means that its status is unknown (device 
has not been scanned yet). To use this functionality you need to setup scanning
script in crontab. Computer is marked as online if computer was online on last
successful scan and period since last scan is lesser than defined in
configuration (Default: 600 seconds). This parameter can be set with
<TT
CLASS="FILENAME"
>lastonline_limit</TT
> in [phpui] section of configuration file.
Above feature applies both to computers and devices, but in case of devices all
its ports (IPs) must be up for device to appear online. Computers status is also
available on nodes list in 'Nodes' panel. 
		<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You can use lms-fping Perl script or lmsd daemon to
probe hosts availability.</P
></TD
></TR
></TABLE
></DIV
>
		</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-NETWORKS"
>3.6. IP Networks</A
></H2
><P
>You can define all your networks here. Network is IP address class
with parameters such as domain, DNSes, default gateway and DHCP pool. If you use
LMS to manage numerous networks or you use numerous address classes, it's
possible to define them here.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NETWORKS-LIST"
>3.6.1. List</A
></H3
><P
>Among basic data about network, each record contains
information about address space conservation - you can see summary of assigned
and free addresses. You're able to modify network properties after you click on
selected network or by clicking 'Edit' icon.</P
><P
>During edit you are able to browse list of nodes connected to
this network, node name will appear instead of IP number if that number is
occupied. If you click on free IP address, without any computer assigned to it,
new computer form will appear. There are also other features available for your
convenience: <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Put in order</I
></SPAN
> will readdress computers so that
there's no gap in the list and <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Reassign the network</I
></SPAN
> to move
all nodes from one network to another.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NETWORKS-NEW"
>3.6.2. New Network</A
></H3
><P
>Defines a new network. Network needs to have unique name and
address class, defined by its IP address and netmask. All other data is
optional.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-FINANCES"
>3.7. Finances</A
></H2
><P
>This is actually the whole collection of modules, that gives you
possibility to efficiently manage finances of your network. You can define
periodical liabilities here (subscriptions), solid liabilities (orders),
perform accounting operations, check each account history and draw invoices
and balance sheets.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-TARIFFS-LIST"
>3.7.1. Tariffs List</A
></H3
><P
>When you enter 'Tariffs List' panel you'll be able to see list of
liabilities (Tariffs) that might be assigned to your customers, with basic
informations about it. When you select and click on liability you'll move to
'Tariff' module where you're able to edit its parameters and exchange customers
between available liabilities. In 'Number of customers'  field you can read
number of customers who are assigned to it and two numbers in parenthesis: total
number of assignments and number of active assignments, considered by its
activity periods.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-TARIFFS-NEW"
>3.7.2. New Tariff</A
></H3
><P
>When defining new tariff you need to enter unique name, amount
	    and tax rate.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-PAYMENTS-LIST"
>3.7.3. Payments list</A
></H3
><P
>This is a list of your company payments. Among standard fields
	    you'll find 'Account this payment' icon,
	    where you're able to charge your account. Periodical charges
	    might be done with 'lms-payments' Perl script, or appropriate module of lmsd
	    daemon. Select and click on chosen payment to view 'Payment Info' module, where
	    you're able to edit its parameters or account given payment to financial
	    database.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-PAYMENTS-NEW"
>3.7.4. New payment</A
></H3
><P
>You have to assign unique name, amount and pay date for each
	    new payment you setup.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-BALANCE"
>3.7.5. Balance sheet</A
></H3
><P
>This is history of your financial operations with total
incomes, expenditures, payments and customers liabilities. Printer icon allows
you to print invoice for corresponding record.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-NEWBALANCE"
>3.7.6. New Balance</A
></H3
><P
>You can add new financial operation with this module. It's
possible to account the same operation for multiple customers at the same
time.</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>It's best to use lms-payments Perl script or
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon to automate periodical operations, such as
subscription fees. Those modules are also able to write out appropriate
invoices.</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-INVOICES-LIST"
>3.7.7. Invoices list</A
></H3
><P
>List of invoices that has been already written out. You're
		able to print (by selecting 'Print' icon) and check as accounted selected
		invoices.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-INVOICES-NEW"
>3.7.8. New Invoice</A
></H3
><P
>Allows you to issue an invoice for selected customer manually.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-RECEIPTS-LIST"
>3.7.9. Cash Receipts List</A
></H3
><P
>Cash receipt it's a proof of customer payment in cash.
		Receipts list can be sorted in any order and filtered like the
		invoices list. You've got also print selected receipts.</P
><P
>From list you can go to receipt edition. Making changes in
		created documents needs special care, because submitting changes
		will delete old receipt and linked operations and insert 
		new ones.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-RECEIPTS-NEW"
>3.7.10. New Receipt</A
></H3
><P
>To create new proof of payment in first place you must to
		select customer from list, set date and number (better to leave
		values proposed by system) Then click 'Submit' to affirm choice.
		After that you can add any number of positions with value and
		description or select them from list of unpaid customer covenants
		placed at bottom. 'Save and Print' will finish and save receipt
		and payments in system and display receipt's printout in new window.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-IMPORT"
>3.7.11. Import</A
></H3
><P
>If you use homebanking, and you're able to get a list of
		financial operations (ie. from bank www or email that they send
		you), Import module can be used to (semi)automatically load it
		into LMS accounting database and assign to respective customers.
		You should write (or use, if it's already in distribution) a
		parser script, which loads data to the cashimport table. Please,
		check example script lms-cashimport-ingbs to see how this is
		being done. After you run it, you should get a list of pending
		financial operations, in Import module, where you can correct
		them and accept into LMS accounting database.</P
><P
>You can also load previously prepared text file using this
		module. It will be read line by line and parsed using setup
		regular expressions to get needed data types (ie. customer id,
		amount, etc). After file is loaded, you will be presented with
		the same corrections/acceptance screen as above.</P
><P
>To setup regular expressions, which suit to your input
		files you should create PHP script which location you must set in
		<TT
CLASS="FILENAME"
>import_config</TT
> option in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
>
		section. Example values and parameters descriptions are placed in
		<TT
CLASS="FILENAME"
>modules/cashimportcfg.php</TT
>.
		Default configuration assumes that input data will be in 
		the following format (tab separated):
<PRE
CLASS="SCREEN"
>23.02.2004	Machniak Aleksander	123,45	Internet subscription - 04/2004 ID:0013
15.02.2004	Pain Joseph	123,45	Invoice paid - LMS/34/2004</PRE
>
		</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-FINANCES-PRINT"
>3.7.12. Printing</A
></H3
><P
>There are several options for balance sheet printouts:
	    <UL
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Balance sheet for your network</I
></SPAN
>
including financial operations for given period, signed by selected LMS
user.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Total invoiceless income</I
></SPAN
> for
given period.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Liability report</I
></SPAN
> for given day,
for all or selected user.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Sale Registry</I
></SPAN
>, which consists of
invoices for given period.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Customer balance sheet</I
></SPAN
> for given
period.</P
></LI
></UL
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-ACCOUNTS"
>3.8. Accounts</A
></H2
><P
>It's now possible to manage accounts from your services using LMS.
This functionality is provided for advanced system administrators, because it
requires in-depth knowledge of services running on server in order to configure
them to use LMS database.</P
><P
>You can create four types of accounts now: shell (1), email (2),
www (4) and ftp (8). Decimal values for internal representation of those accounts
are given in parenthesis. This approach enables to provide multi-type accounts,
eg. if you define shell+email+ftp account it will be given number 11 in
database. This means that for recognition of account type you should use binary
sums in WHERE clauses of your SQL queries (few examples are written
below).</P
><P
>You have also possibility to define domains and aliases.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ACCOUNTS-ACCOUNTS"
>3.8.1. Accounts</A
></H3
><P
>Account list contains basic information about your customer
accounts. It's possible to sort it by any highlighted column title and to filter
it for given criteria. You can edit any account clicking 'Edit' icon.
Administrator (LMS user) is also able to change account passwords.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ACCOUNTS-NEW"
>3.8.2. New Account</A
></H3
><P
>To create new account you have to provide its login, password,
	    choose at least one account type and assign customer to it. Domain name is
	    optional and you'll need it only if you want to support email accounts.
	    Expiration date is also optional, leave it empty to make new account valid
	    forever.</P
><P
>You can define any home directory for account. Option
	    <TT
CLASS="FILENAME"
>homedir_prefix</TT
> from section <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
>
	    consists default prefix "/home/".</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ACCOUNTS-ALIASES"
>3.8.3. Aliases</A
></H3
><P
>Every account (email type mainly) might have any number of
aliases that is needed. Mail server administrator might redirect mail locally
from all those aliases to one physical existing account. Basic information about
alias and accompanying account is provided on the list. It's possible to sort
this list by any highlighted column name and to filter list for given criteria.
It's not possible to edit an alias - if it's not desirable anymore you have to
erase (remove) it and create new if needed. Add new aliases at the bottom of the
list.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ACCOUNTS-DOMAINS"
>3.8.4. Domains</A
></H3
><P
>You're able to see basic informations about domains on the
list. It's possible to sort
this list by any highlighted column name and to filter list for given criteria.
You can edit domain data by clicking 'Edit' icon. Add new domain at the bottom
of the list.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ACCOUNTS-EXAMPLES"
>3.8.5. Examples</A
></H3
><P
>The following section contains fragments of proftpd daemon
configuration (version 1.2.10) relevant to process of authentication with using
data available in LMS database. This example contains Postgres configuration and
optional MySQL configuration in comments, followed by pound (hash) sign.
	    <DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E1"
></A
><P
><B
>Example 3-1. Accounts. Proftpd configuration.</B
></P
><PRE
CLASS="SCREEN"
>  ServerName	"LMS FTP Server"
  
  #dbname@host:port dbuser dbpass
  SQLConnectInfo lms@localhost:5432 lms mypassword
  
  SQLAuthTypes Crypt Plaintext
  SQLUserInfo passwd login password uid NULL home NULL
  RequireValidShell off
  SQLAuthenticate users
  
  # create user home directory if it doesn't exists yet
  SQLHomedirOnDemand on
  
  # login message
  SQLShowInfo PASS "230" "Last login: %{getlastlogin}"
  SQLLog PASS setlastlogin
  
  # SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE FROM_UNIXTIME(lastlogin) END FROM passwd WHERE login='%u'"
  # SQLNamedQuery setlastlogin UPDATE "lastlogin=UNIX_TIMESTAMP() WHERE login='%u'" passwd 
  SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE lastlogin::abstime::timestamp::text END FROM passwd WHERE login='%u'"
  SQLNamedQuery setlastlogin UPDATE "lastlogin=EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)) WHERE login='%u'" passwd
  
  # We limit access to valid (not expired) accounts with ftp type
  # SQLUserWhereClause "type &#38; 8 = 8 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())"
  SQLUserWhereClause "type &#38; 8 = 8 AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))"</PRE
></DIV
></P
><P
>Next example will show us how to configure Postfix 2.1.1 mail
server with Cyrus-SASL 2.1.19 and Courier-IMAP/POP3 3.0.4, so that they use LMS
database. LMS accounts will be virtual, which means that they will be all
maintained by one uid on server with mail stored in Maildir format.</P
><P
>You'll need to patch your SASL for encrypted passwords,
because LMS database contains them only in this form. In comments we have
provided MySQL specific options. Only fragments relevant to database setup are
shown below:
	    <DIV
CLASS="EXAMPLE"
><A
NAME="ACCOUNTS-E2"
></A
><P
><B
>Example 3-2. Accounts. Mail server configuration (postfix+sasl+courier).</B
></P
><PRE
CLASS="SCREEN"
># smtpd.conf file (Cyrus-SASL):

pwcheck_method: auxprop
#sql_engine: mysql
sql_engine: pgsql
sql_user: lms
sql_passwd: dbpass
sql_hostnames: localhost
sql_database: lms
#sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
#       AND login='%u' AND domains.name ='%r' AND type &#38; 2 = 2 
#	AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
	AND login='%u' AND domains.name ='%r' AND type &#38; 2 = 2 
	AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))
password_format: crypt
mech_list: login plain

# authpgsqlrc (or authmysqlrc) (Courier):

# user postfix (owner of mail directory)
#MYSQL_UID_FIELD '1004'
PGSQL_UID_FIELD '1004'
# group postfix (owner of mail directory)
#MYSQL_GID_FIELD '1004'
PGSQL_GID_FIELD '1004'
#MYSQL_PORT		3306
PGSQL_PORT		5432
#MYSQL_USERNAME		lms
PGSQL_USERNAME		lms
#MYSQL_PASSWORD		dbpass
PGSQL_PASSWORD		dbpass
#MYSQL_DATABASE		lms
PGSQL_DATABASE		lms
#MYSQL_SELECT_CLAUSE SELECT login, \
#       password, '', 104, 104, '/var/spool/mail/virtual', \
#       CONCAT(login,'/'), '', login, '' \
#       FROM passwd, domains WHERE domainid = domains.id \
#       AND login = '$(local_part)' AND domains.name = '$(domain)' \
#       AND type &#38; 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
PGSQL_SELECT_CLAUSE SELECT login, \
        password, '', 104, 104, '/var/spool/mail/virtual', \
        login ||'/', '', login, '' \
        FROM passwd, domains WHERE domainid = domains.id 
        AND login = '$(local_part)' AND domains.name = '$(domain)' \
        AND type &#38; 2 = 2 \
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# main.cf (Postfix):

virtual_mailbox_base = /var/spool/mail/virtual
virtual_mailbox_domains = pgsql:/etc/postfix/pgsql_virtual_domains_maps.cf
virtual_mailbox_maps = pgsql:/etc/postfix/pgsql_virtual_mailbox_maps.cf
virtual_alias_maps = pgsql:/etc/postfix/pgsql_virtual_alias_maps.cf

# pgsql_virtual_domains_maps.cf (Postfix):

user = lms
password = dbpass
hosts = localhost
dbname = lms
#MySQL plugin doesn't support query option, thus we build query differently
#select_field = name
#table = domains
#where_field = name
query = SELECT name FROM domains WHERE name = '%s'

# pgsql_virtual_mailbox_maps.cf (Postfix):

user = lms
password = dbpass
hosts = localhost
dbname = lms
#table = passwd, domains
#select_field = CONCAT(login,'/')
#where_field = CONCAT(login,'@',domains.name)
additional_conditions = AND domainid = domains.id 
#       AND type &#38; 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
query = SELECT login || '/' FROM passwd, domains WHERE domainid = domains.id
        AND login = '%u' AND domains.name = '%d' 
        AND type &#38; 2 = 2 
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# pgsql_virtual_alias_maps.cf (Postfix):

user = lms
password = dbpass
hosts = localhost
dbname = lms
#table = passwd, domains, aliases
#select_field = CONCAT(passwd.login,'@',domains.name)
#where_field = CONCAT(aliases.login,'@',domains.name)
#additional_conditions = AND  passwd.domainid = domains.id AND passwd.id = aliases.accountid
query = SELECT passwd.login || '@' || domains.name FROM passwd, domains, aliases 
        WHERE passwd.domainid = domains.id AND passwd.id = aliases.accountid
        AND aliases.login = '%u' AND domains.name = '%d' </PRE
></DIV
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-MAILING"
>3.9. Mailing</A
></H2
><P
>Mailing is component where you can spam groups of your customers
	if you have to communicate something to them. Obviously you need to specify
	sender name and address, write your message in text box and select appropriate
	group of recipients. Your attendance can be grouped by status, network or customer
	groups. If you use mail server on remote host, you will need to set options
	smtp_host, smtp_port, smtp_username, smtp_password in [phpui] section.</P
><P
>In message body you can use variables, which will be replaced by
	customer data:
	<TABLE
BORDER="0"
><TBODY
><TR
><TD
><SAMP
CLASS="PROMPT"
>%customer</SAMP
> - name/lastname and forename</TD
></TR
><TR
><TD
><SAMP
CLASS="PROMPT"
>%balance</SAMP
> - balance value (with sign)</TD
></TR
><TR
><TD
><SAMP
CLASS="PROMPT"
>%cid</SAMP
> - customer ID</TD
></TR
><TR
><TD
><SAMP
CLASS="PROMPT"
>%pin</SAMP
> - customer PIN</TD
></TR
><TR
><TD
><SAMP
CLASS="PROMPT"
>%last_10_in_a_table</SAMP
> - last 10 operations on customer account</TD
></TR
></TBODY
></TABLE
>
	</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Your server has to support PEAR::Mail for this to
work.</P
></TD
></TR
></TABLE
></DIV
>
	<DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>It's best to use lms-notify Perl script or notify
module of <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon to send emails
automatically whenever customer is in debt.</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-RELOAD"
>3.10. Reload</A
></H2
><P
>Click on 'Reload' and reload request or command should execute.
	If you did configure hosts, you will see list of hosts for
	selection to reload configuration on selected hosts.
	What services and how they're updated is configured in
	<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-MGC</I
></SPAN
> or <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon. You'll find
	needed information about configuration in appropriate chapters of this
	documentation.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-STATS"
>3.11. Stats</A
></H2
><P
>This is interface to view bandwidth consumption per host
statistics enclosed in bar graphs. Statistics contains data about sent and
received bytes for given interface for each node. Using drop down menu you can
quickly generate statistics for given time periods: last hour, day, 30 days or
year.
	    <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You need working lms-traffic Perl script or
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon running to collect statistics.</P
></TD
></TR
></TABLE
></DIV
>
	</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-STATS-FILTER"
>3.11.1. Filter</A
></H3
><P
>Before you can see graphs you can define parameters to limit
period or network (if you have many), top number of computers considered and
sort output as you like (ie. by top download).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-STATS-COMPACT"
>3.11.2. Compacting</A
></H3
><P
>Depending on chosen update frequency amount of database data
used for statistics might grow fast, which will lead to extension of time needed
to generate statistics. For that reason in 'Compacting' menu you're able to
shrink your database size without data loss. This module will compact data using
following logic:
		<UL
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Low precision</I
></SPAN
>: data
from previous date and older will be approximated to one day. If you save data
each 10 minutes 6*24 records will be compacted to one.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Medium precision</I
></SPAN
>: data
older than month will be approximated to one day.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>High precision</I
></SPAN
>: data
older than month will be approximated to one hour.</P
></LI
></UL
>
	    <DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Data approximation is irreversible.</P
></TD
></TR
></TABLE
></DIV
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-HELPDESK"
>3.12. Helpdesk</A
></H2
><P
>Helpdesk (or Request Tracker) is customer request management
system. It's possible to keep history of all requests and questions here, both reported by
customers and users not registered in LMS database. Reports can be grouped in
queues (categories) and you're able to search them for a given criteria. It's possible to
define access rights for LMS users to each queue.</P
><P
>You have quick search box in left (menu) panel, which may be
used to jump to appropriate ticket giving ticket id or reporter name. Searching
by reporter name will give a list of all tickets available for this user.</P
><P
>Each ticket includes history built on messages sent by
administrators (LMS users) and customers. Administrator may send his message to
customer specifying recipient name and clicking 'Submit/Send', email will be
sent with queue address as sender, or - if it's empty - LMS user address. All
messages, including those sent, are recorder in ticket history. Each ticket may
be in one of the states: new, opened, resolved or dead.</P
><P
>Please look at <A
HREF="#LMS-RTPARSER"
>lms-rtparser</A
> script which has been developed to
support incoming requests and outgoing comments by your mail server.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-HELPDESK-LIST"
>3.12.1. Queues List</A
></H3
><P
>Basic informations and request statistics are available on
queues list. Select and click on chosen queue to display all tickets belonging
to it. You can also go to detailed view (including permissions) about queue or
remove given queue. Removing queue will also remove all belonging tickets from
database.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-HELPDESK-NEWQUEUE"
>3.12.2. New queue</A
></H3
><P
>Queue (category) contains a name, optional description and
optional email address, used in correspondence. 'Permissions' table defines LMS
users access to this queue, which overrides those set in 'Administration', which
means, that the user who has 'full access' permissions won't be able to see
queue and tickets placed in it until he's given access to that queue.
Enabling 'write' (tickets and comments edit ability) to user automatically gives
him 'read' access. 'Notices' privilege is used to notify users about new tickets.
If 'newticket_notify' option is enabled all users with this privilege will get 
notifications by email.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-HELPDESK-SEARCH"
>3.12.3. Searching</A
></H3
><P
>Tickets are searchable by all given criteria (AND not OR). You
can provide subject, owner, queue, status and reporter for your search.
Customers may be selected from drop-down list, unregistered users may be
searched by name or email address.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MENU-HELPDESK-NEWTICKET"
>3.12.4. New ticket</A
></H3
><P
>For each new ticket you need to provide subject, content,
queue and reporter. Unregistered users (not in customers database) should be
recorded using 'Submitter' fields. You can provide email address (in both
registered/unregistered cases) if ticket will be running via email.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-TIMETABLE"
>3.13. Timetable</A
></H2
><P
>Timetable is your time scheduler, where each user may setup his own 
	calendar. Events or tasks being put here may be also visible for other
	users and consist a list of assigned clients, which make this tool usable
	for service crew management.</P
><P
>There is an additional <TT
CLASS="FILENAME"
>lms-reminder</TT
> script,
	which may be executed periodically to remind users about their pending
	tasks.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TIMETABLE-LIST"
>3.13.1. Timetable (Task list)</A
></H3
><P
>Main timetable shows list of days starting from day which is 
	    selected from calendar popup. A number of days displayed depends on
	    <TT
CLASS="FILENAME"
>timetable_days_forward</TT
> lms.ini option and
	    defaults to 7 days. From task list you might print a day plan or go to
	    event edit screen.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TIMETABLE-NEW"
>3.13.2. New event</A
></H3
><P
>You can add new task to the Timetable by selecting short title
	    and start date and time (or time span). All other fields are optional.
	    By selecting 'private' option you can hide current event from the
	    other users, so that it will be visible only for event creator. This
	    feature allows you to run your own, private calendar.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TIMETABLE-SEARCH"
>3.13.3. Search</A
></H3
><P
>You can search in Timetable by the following criteria: time span
	    (start and end date), client affected, client or fragment of text in
	    title, event description or its notes. List of results will include
	    events that match all entered criteria.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MENU-CONFIGURATION"
>3.14. Configuration</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="CONFIG-UI"
>3.14.1. User Interface</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="CONFIG-BASIC"
>3.14.1.1. Basics</A
></H4
><P
>Since LMS 1.5.3 you're able to configure all UI-related
    	        options directly via <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>, instead of editing
        	<TT
CLASS="FILENAME"
>lms.ini</TT
>. Those options are stored in database and you first
                need to import them from your config file (even if you haven't edited anything
	        yet, default values will be imported). This can be done by clicking
    	        on the link presented on empty list.</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Options setup with <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>
                have higher priority than those in configuration file. With options setup in UI,
	        the configuration will be still imported from file but values will be then
    	        overwritten by those found in DB.</P
></TD
></TR
></TABLE
></DIV
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Daemon read some options other than its configuration from
    		database only, so it's preferred to store configuration in database.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>In order to manually add new option click 'Add option' on the
	        bottom of the list. To edit option value, click on its record. You'll be given
    		with edit form, where you are also able to remove this option. Changing option
    		status allows you to turn it on and off instantly. When an option is off,
    	        default value will be used (if it posses any).</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="CONFIG-OPTIONS"
>3.14.1.2. Configuration Options List</A
></H4
><P
>Here we've got the list of UI configuration options. Those options
	    should be placed in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
> section. The rest of options
	    is described in appropriate chapters.
    	    <UL
><LI
><P
>allow_from  (optional)</P
><P
>List of networks or IP addresses, which have access to LMS. If empty, every IP
    		address is permitted. You can write here list of addresses or address classes and LMS
            	will dismiss every unwanted user with HTTP 403 error.</P
><P
>Example:          <SAMP
CLASS="PROMPT"
>allow_from = 192.168.0.0/16, 213.25.209.224/27, 213.241.77.29</SAMP
></P
></LI
><LI
><P
>lang</P
><P
>User interface language code (ISO). IF not set, language will be based on HTML
    		browser settings. Default: en</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>lang = pl</SAMP
></P
></LI
><LI
><P
>timeout</P
><P
>Timeout for WWW session. User will be log out if he won't perform any action in such
    		number of seconds. Default: 600</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>timeout = 900</SAMP
></P
><P
><DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>It's not possible to not to have any timeout. If you set this value to
    		zero, you won't be able to use LMS at all!</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>customerlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of customers list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>customerlist_pagelimit = 10</SAMP
></P
></LI
><LI
><P
>nodelist_pagelimit</P
><P
>Limit of records that can be displayed on one page of nodes list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>nodelist_pagelimit = 10</SAMP
></P
></LI
><LI
><P
>balancelist_pagelimit</P
><P
>Limit of records that can be displayed on one page of customer balance. Default: 100.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>balancelist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>invoicelist_pagelimit</P
><P
>Limit of records that can be displayed on one page of invoices list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>invoicelist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>ticketlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of ticket (requests) list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>ticketlist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>networkhosts_pagelimit</P
><P
>Limit of records that can be displayed on one page of nodes with network information.
        	Default: 256</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>networkhosts_pagelimit = 1024</SAMP
></P
></LI
><LI
><P
>accountlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of customer accounts. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>accountlist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>domainlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of system domains. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>domainlist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>aliaslist_pagelimit</P
><P
>Limit of records that can be displayed on one page of user aliases. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>aliaslist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>configlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of UI configuration list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>configlist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>taxratelist_pagelimit</P
><P
>Limit of records that can be displayed on one page of tax rates list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>taxratelist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>numberplanlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of numbering plans list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>numberplanlist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>documentlist_pagelimit</P
><P
>Limit of records that can be displayed on one page of documents list. Default: 100</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>documentlist_pagelimit = 50</SAMP
></P
></LI
><LI
><P
>reload_type</P
><P
>Reload type. Allowed values:</P
><P
>exec - execute some command (usually with sudo, script or something
        	else, configurable below)</P
><P
>sql  - doing SQL writes (can be also set to custom query)</P
><P
>Default: sql.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>reload_type = exec</SAMP
></P
></LI
><LI
><P
>reload_execcmd</P
><P
>Command to run during reload, if reload_type is set to 'exec'. By default
        	<TT
CLASS="FILENAME"
>/bin/true</TT
>. This string is send to system() command, so make sure that
        	you know what you're doing. :) Besides, semicolons should be parsed by bash, but LMS splits
        	that string and execute commands separately.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>reload_execcmd = "sudo /usr/bin/reload_lms.sh"</SAMP
></P
></LI
><LI
><P
>reload_sqlquery</P
><P
>SQL query executed while reload, if <SAMP
CLASS="PROMPT"
>reload_type = sql</SAMP
>. By default,
        	query does inserts into table 'timestamps' with '_force' value. You can use '%TIME%'
        	template in your query which will be substituted with current UNIX timestamp. WARNING!
        	Semicolon is handled as query separator, which means that you can enter couple of SQL
        	queries separated by semicolon sign.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>reload_sqlquery = "INSERT INTO reload VALUES ('1','%TIME%')"</SAMP
></P
></LI
><LI
><P
>force_ssl</P
><P
>Enforce SSL for all connections. Setting this option to 1 will
        	turn LMS into enforcing SSL connections by applying redirect to
        	'https://'.$_SERVER[HTTP_HOST].$_SERVER[REQUEST_URI] at every access without SSL. Default:
        	0 (off).</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>force_ssl = 1</SAMP
></P
></LI
><LI
><P
>allow_mac_sharing</P
><P
>Allows for node addition even if its MAC address is not unique (not checking that
        	some computer have that MAC yet). Default: 0 (off)</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>allow_mac_sharing = 1</SAMP
></P
></LI
><LI
><P
>smarty_debug</P
><P
>Enable Smarty debug console. Useful for tracking values passed from PHP to Smarty.
        	Default: 0 (off).</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>smarty_debug = 1</SAMP
></P
></LI
><LI
><P
>lang_debug</P
><P
>Enable LMS language console. Useful for tracking missing translation strings.
        	Default: 0 (off).</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>lang_debug = 1</SAMP
></P
></LI
><LI
><P
>debug_email</P
><P
>E-mail address for debugging - messages sent from module 'Mailing' will be delivered
        	to this address instead of sending them to real users. </P
><P
>Example:     <SAMP
CLASS="PROMPT"
>debug_email = root@localhost</SAMP
></P
></LI
><LI
><P
>default_zip, default_city, default_address</P
><P
>Default zip code, city and street used on "new user" form. Useful when we have many
        	users on the same street.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>default_zip = 39-300</SAMP
></P
></LI
><LI
><P
>use_current_payday</P
><P
>Forces to use current day of month as a payment day instead of most often used day.
        	Default: 0 (off).</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>use_current_payday = 1</SAMP
></P
></LI
><LI
><P
>lastonline_limit</P
><P
>Specify time (in seconds), after which node will be marked offline. It should match
        	frequency of execution for script responsible for checking nodes activity (i.e. lms-fping).
        	Default: 600.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>lastonline_limit = 300</SAMP
></P
></LI
><LI
><P
>timetable_days_forward</P
><P
>Specify number of days (including current day) visible on timetable.
        	Default: 7.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>timetable_days_forward = 2</SAMP
></P
></LI
><LI
><P
>arpd_servers</P
><P
>List of arpd servers for reading MAC addresses from remote networks.
        	That list should include IP[:port] items separated with spaces.
        	Default: empty.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>arpd_servers = 192.168.1.1 192.168.2.1</SAMP
></P
></LI
><LI
><P
>helpdesk_backend_mode</P
><P
>When enabled, all messages in helpdesk system (except those sent to ticket reporter)
        	will be sent to mail server to the appropriate queue address. Mail server should run
        	lms-rtparser script, which will write messages to database. Default: disabled.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>helpdesk_backend_mode = On</SAMP
></P
></LI
><LI
><P
>helpdesk_sender_name</P
><P
>Name of message sender or predefined values: 'queue' - ticket's queue name,
    		'user' - name of logged user (sender). Default: empty.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>helpdesk_sender_name = Helpdesk</SAMP
></P
></LI
><LI
><P
>newticket_notify</P
><P
>If enabled, after new ticket addition system will send notification
        	emails to all users with rights to the queue. Default: disabled.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>newticket_notify = On</SAMP
></P
></LI
><LI
><P
>to_words_short_format</P
><P
>Specify format of verbal amounts representation (on invoices). For value "1"
        	verbal expand of 123,15 will be "one two thr 15/100". Default: 0.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>to_words_short_format = 1</SAMP
></P
></LI
><LI
><P
>nodepassword_length</P
><P
>Length of (auto-generated) node password. Max.32. Default: 16.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>nodepassword_length = 8</SAMP
></P
></LI
><LI
><P
>smtp_host, smtp_port, smtp_username, smtp_password</P
><P
>Parameters for smtp authorization in mailing. Default: 127.0.0.1:25.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>smtp_host = mail.domain.pl</SAMP
></P
></LI
><LI
><P
>smtp_auth_type</P
><P
>Smtp authorization method in mailing. By default LMS (exactly PEAR::Net_SMTP) 
    		will use the best supported method. Default: none.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>smtp_auth_type = DIGEST-MD5</SAMP
></P
></LI
><LI
><P
>gd_translate_to</P
><P
>Charset of data that GD library expects (useful if GD need ISO-8859-2 instead of UTF-8 to feed imagetext() function. Default: ISO-8859-2.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>gd_translate_to = </SAMP
></P
></LI
><LI
><P
>check_for_updates_period</P
><P
>How often to check for LMS updates (in seconds). Default: 86400.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>check_for_updates_period = 604800</SAMP
></P
></LI
><LI
><P
>default_taxrate</P
><P
>Specify value (not label) of tax rate which will be selected 
		on drop-down lists by default. Default: 22.</P
><P
>Example:     <SAMP
CLASS="PROMPT"
>default_taxrate = 22.0</SAMP
></P
></LI
></UL
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CONFIG-TAXES"
>3.14.2. Tax Rates</A
></H3
><P
>Before you have to begin with financial system you will need
		to define tax rates which you will use. On the list are place all 
		rates data. It's possible to edit tax rate, but system will not
		allow to change value of rate that was used in the past. Also isn't
		possible to delete that rate.</P
><P
>Link 'Add tax rate' moves you to the form, where you can define 
		a new rate. Tax rate label is displayed on select lists and invoice
		printout. Value of tax rate is a number from 0 to 100 with two 
		decimal places precision. Taxing status is used for tax-free rate, that 
		means the rest of defined tax rates should have taxing enabled.</P
><P
>Tax rate which will be selected by default on lists is defined
		by <TT
CLASS="FILENAME"
>default_taxrate</TT
> option in section 
		<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CONFIG-NUMBERPLANS"
>3.14.3. Number plans</A
></H3
><P
>This feature allows you to add unique numbering plan
	        (numbering sequence) for each type of documents created in LMS.
		It's also possible to define different sequences within one type of 
		documents. For each document type you might define default
		sequence (important, ie. when you're issuing invoices
		automatically, as perl scripts or daemon will use this default
		scheme when creating new document).</P
><P
>For each sequence you should also define time span, that is
		period in which sequence numbers will be unique. When time span
		selected will reach its end, sequence will be zeroed. You are able
		to set period to one of: daily, weekly (Monday to Sunday), monthly, 
		quarterly or annually.</P
><P
>Numbering plans list consist of all its identifying
		information included, followed by example number generated using
		this plan plus number of documents created with this plan. You
		might select 'Add plan' to enter new sequence. Editing is possible by 
		clicking the field that you want to change. Deletion of plan is
		only possible when no documents has been created with that
		yet.</P
><P
>Sequence template might be any string, which consist some of
		symbols (specifiers) known from PHP strftime function. Detailed
		information and list of all symbols can be find in <A
HREF="http://www.php.net/manual/pl/function.strftime.php"
TARGET="_top"
>PHP
		Manual</A
>. The most important and the only required symbol in
		sequence template is '%N', which will be substituted with
		incremented document number. All other symbols will expand to
		document's date of issue. Below you can find most popular ones:
		<UL
><LI
><P
>%N - integer number, uniquely identifying document</P
></LI
><LI
><P
>%[1-9]N - as above, but with leading zeroes, ie.  '%4N' will return '0012' for 12</P
></LI
><LI
><P
>%Y - year as a 4 digit number</P
></LI
><LI
><P
>%y - year as a 2 digit number</P
></LI
><LI
><P
>%m - month number with leading zero (01 to 12)</P
></LI
><LI
><P
>%b - short month name (according to system locales)</P
></LI
></UL
>
		</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>If you have no numbering plans defined, each document will 
		take default number as of '%N/LMS/%Y' with annual time span.</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CONFIG-HOSTS"
>3.14.4. Hosts</A
></H3
><P
>This section defines host names of those machines 
	    (routers, servers) that read its configuration from LMS database 
	    and where scripts or <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon will be 
	    setup. </P
><P
>Each host name should be unique and it's recommended to 
	    be machine's real name, which could be obtained by running 
	    <SAMP
CLASS="PROMPT"
>hostname</SAMP
> command on each of them 
	    (assuming they're all u*ix hosts).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CONFIG-DAEMON"
>3.14.5. Daemon</A
></H3
><P
>When you create hosts list, you will be able to configure
	    daemon <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
>. Daemon configuration is described
	    in appropriate chapter.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="SCRIPTS"
></A
>Chapter 4. Scripts</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="SCRIPTS-INSTALL"
>4.1. Installation</A
></H2
><P
>Configuration of each Perl script should be enclosed in appropriate section of
<TT
CLASS="FILENAME"
>lms.ini</TT
> file. Scripts should be taken from <TT
CLASS="FILENAME"
>lms/bin/</TT
>
directory and placed in <TT
CLASS="FILENAME"
>/usr/sbin</TT
>. After the move, you have to include them in
your crontab, so that they will be executed automatically, which is probably what you want to
do.</P
><P
>For example crontab entry which will execute lms-payments script each day one minute
after midnight should take a form of:</P
><PRE
CLASS="SCREEN"
>1 0 * * *       /usr/sbin/lms-payments 1 &gt; /dev/null</PRE
><P
>You should read <B
CLASS="COMMAND"
>man crontab</B
> to learn how to exactly schedule your
scripts.</P
><P
>Most LMS scripts have following command line options: </P
><PRE
CLASS="SCREEN"
>-C file     location and name of alternative configuration, default: /etc/lms/lms.ini
-q          run script without any output
-h          help (usually list of valid command line options)
-v          information about script version</PRE
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SCRIPTS-LIST"
>4.2. List of available scripts</A
></H2
><DIV
CLASS="TABLE"
><A
NAME="SCRIPTS-TABLE"
></A
><P
><B
>Table 4-1. Executable scripts list</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="200"
ALIGN="CENTER"><COL
WIDTH="300"
ALIGN="CENTER"><THEAD
><TR
><TH
>Name</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><A
HREF="#LMS-NOTIFY"
>lms-notify</A
></TD
><TD
>Massive mailing for customer notification</TD
></TR
><TR
><TD
><A
HREF="#LMS-NOTIFY-SMS"
>lms-notify-sms</A
></TD
><TD
>Notifies customer about his debt with SMS</TD
></TR
><TR
><TD
><A
HREF="#LMS-CUTOFF"
>lms-cutoff</A
></TD
><TD
>Cutoff of customers who are in debt</TD
></TR
><TR
><TD
><A
HREF="#LMS-ETHERDESC"
>lms-etherdesc</A
></TD
><TD
>MAC address - hostname pair file creation for iptraf</TD
></TR
><TR
><TD
><A
HREF="#LMS-PAYMENTS"
>lms-payments</A
></TD
><TD
>Accounting subscription fees (periodical) with invoice writeouts</TD
></TR
><TR
><TD
><A
HREF="#LMS-TRAFFIC"
>lms-traffic</A
></TD
><TD
>Bandwidth consumption calculation</TD
></TR
><TR
><TD
><A
HREF="#LMS-TRAFFIC-LOGIPTABLES"
>lms-traffic-logiptables</A
></TD
><TD
>Bandwidth probe with iptables</TD
></TR
><TR
><TD
>lms-makearp</TD
><TD
>ARP table (/etc/ethers) creation</TD
></TR
><TR
><TD
><A
HREF="#LMS-MAKEDHCPCONF"
>lms-makedhcpconf</A
></TD
><TD
>DHCP server configuration (dhcpd.conf)</TD
></TR
><TR
><TD
><A
HREF="#LMS-MAKEIPTABLES"
>lms-makeiptables</A
></TD
><TD
>Configuration of iptables firewall rules</TD
></TR
><TR
><TD
>lms-makeipchains</TD
><TD
>Configuration of ipchains firewall rules</TD
></TR
><TR
><TD
>lms-makeopenbsdpf</TD
><TD
>Configuration of OpenBSD packet filter rules</TD
></TR
><TR
><TD
>lms-makeoidentconf</TD
><TD
>Configuration of oident</TD
></TR
><TR
><TD
><A
HREF="#LMS-SENDINVOICES"
>lms-sendinvoices</A
></TD
><TD
>Distribution of invoices to customers</TD
></TR
><TR
><TD
><A
HREF="#LMS-MAKEMACS"
>lms-makemacs</A
></TD
><TD
>Firewalling with use of source MAC addresses</TD
></TR
><TR
><TD
><A
HREF="#LMS-MAKEHOSTS"
>lms-makehosts</A
></TD
><TD
>/etc/hosts file creation</TD
></TR
><TR
><TD
><A
HREF="#LMS-MAKEWARNINGS"
>lms-makewarnings</A
></TD
><TD
>Redirect rules for customers in debt</TD
></TR
><TR
><TD
><A
HREF="#LMS-MAKEMESSAGES"
>lms-makemessages</A
></TD
><TD
>Redirect rules for customers in debt with warning message</TD
></TR
><TR
><TD
><A
HREF="#LMS-FPING"
>lms-fping</A
></TD
><TD
>Online nodes scan</TD
></TR
><TR
><TD
><A
HREF="#LMS-RTPARSER"
>lms-rtparser</A
></TD
><TD
>Helpdesk backend for MUA</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SCRIPTS-CONFIG"
>4.3. Description and configuration</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="LMS-NOTIFY"
>4.3.1. lms-notify</A
></H3
><P
>lms-notify is perfect tool to remind your customers that they are actually the ones who
	    cover all your network and WAN links costs. It makes you possible to create numerous text templates
	    for various occasions and use them for mailing your customers.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="LMS-NOTIFY-TEMPLATES"
>4.3.1.1. Templates</A
></H4
><P
>You can use following variables in your templates:</P
><UL
><LI
><P
>%date-m - will be substituted with current month in numerical form with leading zero, eg. 02</P
></LI
><LI
><P
>%date-y - will be substituted with current year, eg. 2003</P
></LI
><LI
><P
>%date_month_name - will be substituted with current month name, eg. March</P
></LI
><LI
><P
>%saldo - will be substituted with current customer balance, eg. 535</P
></LI
><LI
><P
>%abonament - will be substituted with customer's subscription fee, eg. 107</P
></LI
><LI
><P
>%b - customer balance with opposite sign, eg. 107</P
></LI
><LI
><P
>%B - customer balance with real sign, eg. -107</P
></LI
><LI
><P
>%pin - PIN code of the customer</P
></LI
><LI
><P
>%phone1 - customer's 1st phone number</P
></LI
><LI
><P
>%last_10_in_a_table - list of last 10 operations on customer's account, eg.</P
></LI
></UL
><DIV
CLASS="EXAMPLE"
><A
NAME="NOTIFY-EXAMPLE"
></A
><P
><B
>Example 4-1. Lms-notify: example of last 10 customer's operations</B
></P
><PRE
CLASS="SCREEN"
>-----------+------------------------------------------------------+---------
2003-02-02 | Subscription for month 2003/02                       |  107.00
2003-02-01 | Payment                                              | -107.00
2003-02-01 | Subscription for month 2003/02                       |  107.00
2003-02-01 | Payment                                              | -321.00
2003-01-31 | Subscription for month 2003/01                       |  107.00
2003-01-31 | Subscription for month 2003/01                       |  107.00
2003-01-31 | Subscription for month 2003/01                       |  107.00
-----------+------------------------------------------------------+---------</PRE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="NOTIFY-TEMPLATE"
></A
><P
><B
>Example 4-2. Lms-notify: example of mailing template</B
></P
><PRE
CLASS="SCREEN"
>NOTE: This message has been generated automatically.

We kindly remind that you have debt on your internet service provide account 
for the amount of $ %B.

If you have already regulated your subscription fees for current month, that
is %date-m %date-y, please just skip this message.

If you think this message was sent to you in error, please contact our
customer service representative.

All information about payments could be also found at:
http://bigpro.com/myAccount/

If you want to regulate your account status, please contact our accountant:

Aldfert Rule
phone: 0-509031337
e-mail: alde@staff.bigpro.com

Garmund Cooper
phone: 0-606666666
e-mail: gcooper@free.bigpro.com

PS. Last 10 operations on your account has been attached below for your
convenience.

Date       | Description                                          | Amount
%last_10_in_a_table

--
Big and Professional Internet Provider, BigPro ISP
http://www.bigpro.com/</PRE
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="LMS-NOTIFY-CONFIG"
>4.3.1.2. Configuration</A
></H4
><P
>Configuration of lms-notify should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[notify]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>limit</P
><P
>Lets you setup limit of customer debt. Email will be sent below that value. Default: limit = 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>mailsubject (mandatory)</P
><P
>Lets you setup subject of email sent. You can use following templates, with meanings identical to those set in email template: %B, %b, %date-y, %date-m, %last_10_in_a_table. Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailsubject = Debt information</SAMP
></P
></LI
><LI
><P
>mailtemplate (mandatory)</P
><P
>Lets you setup mail template which will be sent. Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailtemplate = /etc/lms/notifytemplate.txt</SAMP
></P
></LI
><LI
><P
>mailfrom (mandatory)</P
><P
>Lets you setup email of the sender. Default: none.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailfrom = staff@bigpro.com</SAMP
></P
></LI
><LI
><P
>mailfname (mandatory)</P
><P
>Sender name. Default: none</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailfname = Administrators</SAMP
></P
></LI
><LI
><P
>mailcharset</P
><P
>Message character set (Content-Type). Default: UTF-8</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mailcharset = ISO-8859-2</SAMP
></P
></LI
><LI
><P
>smtp_server</P
><P
>SMTP server to be used when sending emails. Default: 127.0.0.1</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_server = smtp.bigpro.com</SAMP
></P
></LI
><LI
><P
>debug_email (optional)</P
><P
>Email address for debugging. All email will be sent to this address instead of sending to real customers. Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>debug_email = lexx@domain.pl</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-NOTIFY-SMS"
>4.3.2. lms-notify-sms</A
></H3
><P
>lms-notify-sms is similar to lms-notify, but it's intended to
send reminders via SMS. You need Nokia cellphone and gnokii software (<A
HREF="http://www.gnokii.org"
TARGET="_top"
>www.gnokii.org</A
>) for this script to
work.</P
><P
>Configuration of lms-notify-sms should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[notify-sms]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>limit</P
><P
>Lets you setup limit of customer debt. SMS will be sent below that value. Default: 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>smstemplate (mandatory)</P
><P
>Message template. Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smstemplate = /etc/lms/smstemplate.txt</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-CUTOFF"
>4.3.3. lms-cutoff</A
></H3
><P
>This script allows to cutoff (actually mark as cutoff in
	database and cutting off should be performed by one of firewall rules creation
	script) customers whose debt is below some defined value.</P
><P
>Configuration of lms-cutoff should be set in
	<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[cutoff]</I
></SPAN
> section.
	Following parameters are valid:</P
><UL
><LI
><P
>limit (optional)</P
><P
>Lets you setup limit of customer debt. Customer will be marked as disconnected below that value. Default: 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>message (optional)</P
><P
>If not empty, that message will be written to warning message field in customer record 
	   after cutting him off.  You can use %now variable, and it will be replaced by current date.
	   Default: 'Automatic cutoff caused by exceeding of liabilities limit on %now'</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>message = ''</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-PAYMENTS"
>4.3.4. lms-payments</A
></H3
><P
>This script is being used to calculate and account subscription
and solid (fixed) fees. It also accounts your company liabilities and makes
invoices. You should allow it to run daily if you want it to make it work done
well.</P
><P
>This scripts may be configured with two options related to
invoices in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[payments]</I
></SPAN
> section of
<TT
CLASS="FILENAME"
>lms.ini</TT
> file:</P
><UL
><LI
><P
>deadline (optional)</P
><P
>Payment deadline in days. Default: 14</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>deadline = 7</SAMP
></P
></LI
><LI
><P
>paytype (optional)</P
><P
>Type of payment. Default: 'TRANSFER'</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>paytype = 'CASH'</SAMP
></P
></LI
><LI
><P
>suspension_description (optional)</P
><P
>Suspension description for suspended liabilities added at the end of comment. 
	   Default: ''</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>paytype = '(suspension)'</SAMP
></P
></LI
><LI
><P
>comment (optional)</P
><P
>Description on invoice attached to every periodical assigment</P
><P
>Default: '%tariff subscription for period %period'</P
><P
>Some keywords are substitiuted:</P
><P
>%tariff - subscription name</P
><P
>%period - period (counted from current day to the last in cycle, in YYYY/MM/DD form)</P
><P
>%current_month - period form 1st day of current month to the last day</P
><P
>%desc - tariff description</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>comment = 'Subscription for %current_month'</SAMP
></P
></LI
></UL
><P
>Script has also one useful command line parameter: <SAMP
CLASS="PROMPT"
>--fakedate</SAMP
>
         (<SAMP
CLASS="PROMPT"
>-f</SAMP
>). With this option you can make that script will execute
         with system date (in format YYYY/MM/DD) other that current, eg.
         <SAMP
CLASS="PROMPT"
>--fakedate=2004/10/10</SAMP
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-TRAFFIC"
>4.3.5. lms-traffic</A
></H3
><P
>This script is an interface between your application and LMS
database and is intended to gather bandwidth usage statistics. You should
provide number of bytes received and sent by each computer, which will be
stored in LMS DB next to computer id and current timestamp. It's up to you how
often this configuration will be refreshed, just remember to set your
application to refresh its data in similar interval. Best sources of data are
iptables or ipchains. You can also use external program, eg. ipfm.</P
><P
>Browsing gathered statistics with several filtering capabilities is
available in LMS-UI in main menu, menu 'Statistics'.
    </P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="LMS-TRAFFIC-CONFIG"
>4.3.5.1. Installation</A
></H4
><P
>Before you can run lms-traffic you need to create data file
which will be read in. Format of the file should be as follows:</P
><PRE
CLASS="SCREEN"
>&lt;IP_address&gt; &lt;n_of_spaces&gt; &lt;upload_bytes&gt; &lt;n_of_spaces&gt; &lt;download_bytes&gt;
&lt;IP_address&gt; &lt;n_of_spaces&gt; &lt;upload_bytes&gt; &lt;n_of_spaces&gt; &lt;download_bytes&gt;
...</PRE
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Example script utilizing iptables might be found
in <TT
CLASS="FILENAME"
>sample/traffic_ipt.pl</TT
> file.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Next you should install lms-traffic script and your custom
script into crontab. Among standard options you can use define location with
created data file.
	    <PRE
CLASS="SCREEN"
>-f=/file 	location and name of data file, default: /var/log/traffic.log</PRE
>
	    <DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Frequency checks should be set not higher than 10
minutes, due that each execution will write new database record for each
computer. Thus, statistics database might grow fast and it might take longer
to generate desired statistics.</P
></TD
></TR
></TABLE
></DIV
>
	    </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-TRAFFIC-LOGIPTABLES"
>4.3.6. lms-traffic-logiptables</A
></H3
><P
>This script uses iptables to gather received and sent data
statistics for each computer. Data is being read from firewall rules, which
are created on-the-fly. Thus, you are not responsible for setting appropriate
rules or running custom statistics collector (eg.
<TT
CLASS="FILENAME"
>lms-traffic</TT
>).
	</P
><P
>Configuration of lms-traffic-logiptables should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[traffic-logiptables]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>outfile</P
><P
>Location of file with iptables rules. Default: /etc/rc.d/rc.stat</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>outfile = /etc/rc.d/rc.stat</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /usr/sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>wan_interfaces</P
><P
>Interface(s) name(s) that should be considered.  Default: not defined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>wan_interfaces = eth0</SAMP
></P
></LI
><LI
><P
>local_ports</P
><P
>List of source/destination ports for packet counting. Default: not defined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>local_ports = 80</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID of 'outfile' script owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID of 'outfile' script owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Permissions of 'outfile' script. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-MAKEDHCPCONF"
>4.3.7. lms-makedhcpconf</A
></H3
><P
>This module creates DHCP configuration script - dhcpd.conf.</P
><P
>Configuration of lms-makedhcpconf should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[dhcp]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>config_file</P
><P
>Output file location. Default: /etc/dhcpd.conf</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /tmp/dhcpd.conf</SAMP
></P
></LI
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all customer groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>usergroups = group1 group2</SAMP
></P
></LI
><LI
><P
>default_lease_time</P
><P
>Default lease time. Default: 86400.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>default_lease_time = 43200</SAMP
></P
></LI
><LI
><P
>max_lease_time</P
><P
>Maximal lease time. Default: 86400.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>max_lease_time = 43200</SAMP
></P
></LI
><LI
><P
>ignore_ddns</P
><P
>Dont put 'ddns-update-style none;' on beginning of
file. Useful for older (2.2) versions of DHCP. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>ignore_ddns = 1</SAMP
></P
></LI
><LI
><P
>log_facility</P
><P
>Logging options for DHCP daemon. Default is applied
if not specified.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>log_facility = 7</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID of 'config_file' config owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID of 'config_file' config owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Permissions of 'config_file' file. Default: 600 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
></UL
><P
>You can setup leases time on per-host basis by creating
<SAMP
CLASS="PROMPT"
>[dhcp:network_name]</SAMP
> section (in lowercase), eg.
<PRE
CLASS="SCREEN"
>[dhcp:public-custa] # network name, must be lowercase!!!
default_lease_time = 3600
max_lease_time     = 3600</PRE
>

You can also specify gateway, dns servers, domains name and wins server for
individual host by creating <SAMP
CLASS="PROMPT"
>[dhcp:ip_address]</SAMP
> section, eg.
<PRE
CLASS="SCREEN"
>[dhcp:213.25.209.216]
domain  = anotherdomain.com
gateway = 213.25.209.251
dns     = 213.25.209.8
wins    = 213.25.209.10</PRE
>
	</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-MAKEIPTABLES"
>4.3.8. lms-makeiptables, lms-makeipchains</A
></H3
><P
>This pair of script is being used to generate files with firewall 
rules inside. You can prepend this file with previously written header (ie.
containing network-wide rules or NAT rules) and set some fixed permissions to
it. Those scripts does not run generated files.</P
><P
>Configuration of those scripts should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[iptables]</I
></SPAN
> or
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[ipchains]</I
></SPAN
> section.  Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>iptables_binary (ipchains_binary)</P
><P
>Location of iptables (ipchains) binary. Default: /usr/sbin/iptables (/usr/sbin/ipchains)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>script_file</P
><P
>Output file with rules. Default: /etc/rc.d/rc.masq</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_file = /etc/rc.d/rc.firewall</SAMP
></P
></LI
><LI
><P
>pre_script</P
><P
>File appended after cleaning existing rules and before
adding new. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>pre_script = /etc/rc.d/rc.masq-pre</SAMP
></P
></LI
><LI
><P
>post_script</P
><P
>File appended after adding rules. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>post_script = /etc/rc.d/rc.masq-post</SAMP
></P
></LI
><LI
><P
>forward_to</P
><P
>List of networks for which NAT should be set. Possible
values: "" - full forward, "any string" - forward off, "net1 net2" - forward
active for selected networks. Default: full forward.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>forward_to = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>script_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_owneruid = 0</SAMP
></P
></LI
><LI
><P
>script_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_ownergid = 0</SAMP
></P
></LI
><LI
><P
>script_permission</P
><P
>Permissions for the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>script_permission = 700</SAMP
></P
></LI
><LI
><P
>snat_address</P
><P
>SNAT public address. If unset, for hosts with private
addresses assigned "-j MASQUERADE" rule will be used. If set "-j SNAT --to
123.123.123.123" (with your IP here) will be used. Only with lms-makeiptables.
Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>snat_address = 123.123.123.123</SAMP
></P
></LI
><LI
><P
>tcp_redirect_ports (udp_redirect_ports)</P
><P
>List of port forwardings in source_port:dest_port
format. Can be used to map ports of your firewalled machines to the ones on your
router. Only with lms-makeipchains. Default: not set.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>tcp_redirect_ports = 80:3128 25:25</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-ETHERDESC"
>4.3.9. lms-etherdesc</A
></H3
><P
>This script is intended to create file including MAC and IP
address pairs from LMS DB. MACs are being fetched in 'stripped' format, such is,
without colon separators. This type of file might be used with
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>iptraf</I
></SPAN
> tools.</P
><P
>Configuration of lms-etherdesc should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[ethers]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>etherdesc_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_owneruid = 0</SAMP
></P
></LI
><LI
><P
>etherdesc_file</P
><P
>File location. Default: /var/lib/iptraf/ethernet.desc.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_file = /etc/ethernet.desc</SAMP
></P
></LI
><LI
><P
>etherdesc_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_ownergid = 0</SAMP
></P
></LI
><LI
><P
>etherdesc_permission</P
><P
>Permissions for the file. Default: 600 (rw-------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>etherdesc_permission = 600</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-SENDINVOICES"
>4.3.10. lms-sendinvoices</A
></H3
><P
>This script make you possible to automatically send invoices by
email, as email attachments. Invoices are being created in accordance to
template used in LMS-UI, thus, you need to provide username and password to
interface for this module to work.</P
><P
>This module, unlike the others, needs some extra Perl modules to
work: Data::Dumper, LWP::UserAgent and MIME::Entity.</P
><P
>Configuration of lms-sendinvoices should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[sendinvoices]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>lms_url</P
><P
>URL for your LMS installation. Default: http://localhost/lms/</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_url = http://lms.mynet.pl</SAMP
></P
></LI
><LI
><P
>lms_user</P
><P
>LMS user login name. Default: empty</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_user = admin</SAMP
></P
></LI
><LI
><P
>lms_password</P
><P
>LMS user password. Default: empty</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_password = my_secret</SAMP
></P
></LI
><LI
><P
>debug_email</P
><P
>Email address to test (mail will be redirected here).
		    Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>debug_email = admin@mynet.pl</SAMP
></P
></LI
><LI
><P
>sender_name</P
><P
>Email sender name. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>sender_name = ASK MyNet</SAMP
></P
></LI
><LI
><P
>sender_email</P
><P
>Email sender address. Default: undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>sender_email = admin@mynet.pl</SAMP
></P
></LI
><LI
><P
>mail_subject</P
><P
>Email subject. %invoice variable will be replaced by invoice number. 
		    Default: 'Invoice No. %invoice'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_subject = 'New invoice'</SAMP
></P
></LI
><LI
><P
>mail_body</P
><P
>Email body. %invoice variable will be replaced by invoice number. 
		    Default: 'Attached file with Invoice No. %invoice'.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_body = ''</SAMP
></P
></LI
></UL
><P
>Script has also one useful command line parameter: <SAMP
CLASS="PROMPT"
>--fakedate</SAMP
> 
	 (<SAMP
CLASS="PROMPT"
>-f</SAMP
>). With this option you can make that script will execute 
	 with system date (in format YYYY/MM/DD) other that current, eg. 
	 <SAMP
CLASS="PROMPT"
>--fakedate=2004/10/10</SAMP
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-MAKEMACS"
>4.3.11. lms-makemacs</A
></H3
><P
>This script is capable of making netfilter rules to filter
traffic based on MAC address of the sender. For each computer one rule for
configured chain is created, which makes test on sender IP and MAC addresses. If
it returns success, it returns to parent chain with RETURN target. On the end of
tests two rules are appended, which redirects all http and webcache traffic to
given host and port. This is intended to inform customer about his debt, by running
specialized server on this host:port which returns administration message to
each request. At last, the rule which blocks all traffic is added.
	    </P
><P
>Configuration of lms-makemacs should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[macs]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>usergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the output file. Default: /etc/rc.d/rc.macs</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.macs</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>Chain name to use (if non-standard, it will be
created). Default: MACS.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>chain = CHECKMAC</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>Address and port, where unmatched traffic for http and
webcache will be redirected, in address:port format. Default: 127.0.0.1:80.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3000</SAMP
></P
></LI
><LI
><P
>lock_noaccess</P
><P
>Should RETURN rule be used for disconnected (cutoff)
nodes. Default: 0 (rules are being generated)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lock_noaccess = 1</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-MAKEHOSTS"
>4.3.12. lms-makehosts</A
></H3
><P
>This script generates /etc/hosts file, with IP address to name
mappings.
	    </P
><P
>Configuration of lms-makehosts should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[hosts]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>usergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the file. Default: /etc/hosts.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/hosts</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 644 (rw-r--r--).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 600</SAMP
></P
></LI
><LI
><P
>config_header</P
><P
>First line in /etc/hosts. Default: 127.0.0.1 localhost localhost.localdomain.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_header = 192.168.1.1 ourserver ourserver.ournetwork</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-MAKEWARNINGS"
>4.3.13. lms-makewarnings</A
></H3
><P
>This script may be used to create file including netfiler
rules redirecting http and webcache traffic to configured IP and port, for customers
in debt. It uses nat table, tests source IPs and makes use of DNAT target.
	    </P
><P
>Configuration of lms-makewarnings should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[warnings]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>usergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the file. Default: /etc/rc.d/rc.warnings.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.warnings</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>Custom chain to which rules will be added. Default:
WARNINGS.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>chain = WARN</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>IP address and port, to which all http and webcache
traffic will be redirected, for hosts to which warning was enabled in LMS-UI.
Default: 127.0.0.1:80.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3001</SAMP
></P
></LI
><LI
><P
>limit</P
><P
>Rules are being triggered if customer balance is below
this limit. Default: 0 </P
><P
>Example:	<SAMP
CLASS="PROMPT"
>limit = -85</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-MAKEMESSAGES"
>4.3.14. lms-makemessages</A
></H3
><P
>This script is being used to create file with netfilter rules
to redirect all http and webcache traffic for customers, who has administration
messages enabled (aka warnings) to configured IP address and port. It uses nat
table, tests source IPs and makes use of DNAT target.
	    </P
><P
>Configuration of lms-makemessages should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[messages]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>usergroups </P
><P
>List of (space separated) customer groups, that should be
considered while creating configuration file. If unset, configuration will
include all groups.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>usergroups = settlement1 settlement2</SAMP
></P
></LI
><LI
><P
>iptables_binary</P
><P
>Location of iptables binary. Default: /sbin/iptables</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>iptables_binary = /usr/local/sbin/iptables</SAMP
></P
></LI
><LI
><P
>config_owneruid</P
><P
>UID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_owneruid = 0</SAMP
></P
></LI
><LI
><P
>config_file</P
><P
>Location of the file. Default: /etc/rc.d/rc.messages.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_file = /etc/conf.d/rc.messages</SAMP
></P
></LI
><LI
><P
>config_ownergid</P
><P
>GID of file owner. Default: 0 (root).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_ownergid = 0</SAMP
></P
></LI
><LI
><P
>config_permission</P
><P
>Permissions of the file. Default: 700 (rwx------).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>config_permission = 700</SAMP
></P
></LI
><LI
><P
>chain</P
><P
>Custom chain to which rules will be added. Default: MESSAGES.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>chain = MESG</SAMP
></P
></LI
><LI
><P
>redirect_address</P
><P
>IP address and port, to which all http and webcache
traffic will be redirected, for hosts to which warning was enabled in LMS-UI.
Default: 127.0.0.1:80.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>redirect_address = 192.168.1.1:3002</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-FPING"
>4.3.15. lms-fping</A
></H3
><P
>This script probes nodes activity and writes its status to
database. Fast program fping is being used to scan, with "-ar1" parameters.
First, list of nodes is prepares, and then fping is executed. For returned hosts
date and time will be stored into DB, so availability can be visualized in
interface.</P
><P
>Configuration of lms-fping should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[fping]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>networks </P
><P
>List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = public-custa public-custb</SAMP
></P
></LI
><LI
><P
>fping_binary</P
><P
>Location of fping binary. Default: /usr/sbin/fping</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>fping_binary = /usr/local/sbin/fping</SAMP
></P
></LI
><LI
><P
>temp_file</P
><P
>Location of temporary file, where list of hosts for
fping will be stored. After script execution, this file is removed. Default: /tmp/fping_hosts.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>temp_file = /tmp/hosts</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="LMS-RTPARSER"
>4.3.16. lms-rtparser</A
></H3
><P
>This script is a backend to Helpdesk system, which should be
integrated into your mail server configuration. It intercepts emails sent to
queue (as defined in email address field of queue configuration), parses its
content and puts ticket into database, confirming this operation in email to
reporter. In subject of confirmation ticket ID will be placed. If email with
this ID is received again, it will be placed in existing ticket history,
otherwise new ticket number will be created. Any files in the message will be
detached and stored in directory defined with <TT
CLASS="FILENAME"
>mail_dir</TT
>
option.</P
><P
>Unlike other Perl modules, this one additionally requires:
<TT
CLASS="FILENAME"
>MIME::Parser</TT
> and <TT
CLASS="FILENAME"
>MIME::Words</TT
> from
MIME-Tools package along with <TT
CLASS="FILENAME"
>Net::SMTP</TT
> and
<TT
CLASS="FILENAME"
>Text::Iconv</TT
>.</P
><P
>This script might be installed in several ways. One way is to
create shell script which reads content of users' mailboxes and calls
lms-rtparser for each mail (can be done with formail). But more elegant, faster
and convenient method is to integrate it with your mail server. Below you can
find example on how to setup Postfix using header_checks.
<PRE
CLASS="SCREEN"
># main.cf file:
header_checks = regexp:/etc/postfix/header_checks

# header_checks file:
/^To:.*address@domain.*/ FILTER filter:dummy

# master.cf file:
filter unix - n n - 10 pipe
      -flags=Rq user=nobody argv=/path/to/lms-rtparser</PRE
>
            Above method is valid for Postfix version equal or newer than 2.0.
Earlier versions doesn't support FILTER in header_checks. You can work around
this by using procmail:
<PRE
CLASS="SCREEN"
># main.cf file:
mailbox_command = /usr/bin/procmail

# in user directory (for whom mails should be routed via helpdesk);
# .forward file:
"|IFS=' ' &#38;&#38; exec /usr/bin/procmail -f - || exit 75 #YOUR_USERNAME"

# .procmailrc file:
:0 c
   * ^To.*address@domain
   | /bin/lms-rtparser

:0 A
$DEFAULT</PRE
></P
><P
>Next example shows how to connect parser to Exim, using system
filter:
<PRE
CLASS="SCREEN"
># exim.conf file:

system_filter_pipe_transport = address_pipe

# system_filter.txt file:

if $recipients is "queue_email@domena.pl"
then 
     pipe "/path/to/lms-rtparser -q queue id"
endif</PRE
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Messages create in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lms-ui</I
></SPAN
> may
be directed to parser, instead of just being written to database. If you prefer
this behavior turn on <TT
CLASS="FILENAME"
>helpdesk_backend_mode</TT
> option in
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
> section of <TT
CLASS="FILENAME"
>lms.ini</TT
>
file.</P
></TD
></TR
></TABLE
></DIV
></P
><P
>Configuration of lms-rtparser should be set in
<TT
CLASS="FILENAME"
>lms.ini</TT
> file, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[rt]</I
></SPAN
> section.
Following parameters are valid:</P
><UL
><LI
><P
>default_queue</P
><P
>ID of the queue, to which requests should be sent if
		    not specified on command line. If not set queue will be guessed according to
		    recipient address. Command line -q will override this option. Default:
		    undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>default_queue = </SAMP
></P
></LI
><LI
><P
>mail_from</P
><P
>Sender address for confirmations. If undefined, queue
		    address will be used, to which ticket was assigned. Default: empty.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_from = rt@net.pl</SAMP
></P
></LI
><LI
><P
>mail_from_name</P
><P
>Sender name for confirmations. Default:
		    undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_from_name = 'BOK SuperLAN'</SAMP
></P
></LI
><LI
><P
>autoreply_subject</P
><P
>Confirmation subject. You can use replacement variables here: %tid - 
		    ticket id and %subject - request subject.
		    Default: "[RT#%tid] Receipt of request '%subject'".</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>autoreply_subject = '[RT#%tid] Helpdesk confirmation'</SAMP
></P
></LI
><LI
><P
>autoreply_body</P
><P
>Confirmation body. You can use replacement variables here; %tid - 
		    ticket id and %subject - request subject.
		    Default: 'Your request was registered in our system.\nTicket identifier RT#%tid has been assigned to this request.\nPlease, place string [RT#%tid] in subject field of any\nfurther mail relating to this request.\n.'</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>autoreply_body = ''</SAMP
></P
></LI
><LI
><P
>smtp_server</P
><P
>SMTP server to be used for sending emails. Default:
		    localhost.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>smtp_server = smtp.bigpro.com</SAMP
></P
></LI
><LI
><P
>mail_dir</P
><P
>Directory where attachments should be saved. This
		    directory will be accessed for read/write both by rtparser user and your Web
		    Server user. If undefined attachments won't be recorded. Default:
		    undefined.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>mail_dir = /usr/local/lms/mail</SAMP
></P
></LI
><LI
><P
>tmp_dir</P
><P
>Temp directory. By default it will be taken from
		    environment or set to <TT
CLASS="FILENAME"
>/tmp</TT
>.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>tmp_dir = /home/user/tmp</SAMP
></P
></LI
><LI
><P
>auto_open</P
><P
>This will force reopening closed/dead ticket if
		    request is sent to it's ID. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>auto_open = 1</SAMP
></P
></LI
><LI
><P
>newticket_notify</P
><P
>If enabled script will send notification about new ticket
		    to all users with rights for current queue. Default: Off.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>newticket_notify = 1</SAMP
></P
></LI
><LI
><P
>lms_url</P
><P
>This link, pointing to corresponding ticket page in UI is appended 
		    to the notification about new ticket. Default: http://localhost/lms/.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>lms_url = https://lms.domain.pl/</SAMP
></P
></LI
></UL
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="MGC"
></A
>Chapter 5. Configuration file generator (lms-mgc)</H1
><P
>LMS-MGC is "magical" configuration file generator. With some efforts, you can create virtually any configuration file using it (ie. zone definition file for BIND)</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MGC-INSTALL"
>5.1. Installation</A
></H2
><P
>LMS-MGC has its own configuration file: <TT
CLASS="FILENAME"
>lms-mgc.ini</TT
>. You should install script by moving it to <TT
CLASS="FILENAME"
>/usr/sbin</TT
> directory. LMS-MGC should be used in two either ways: scheduled from cron (eg. hourly)</P
><PRE
CLASS="SCREEN"
>0 * * * *       /usr/sbin/lms-mgc 1 &gt; /dev/null</PRE
><P
>or called from LMS 'Reload' menu. Second setup requires <TT
CLASS="FILENAME"
>sudo</TT
> to be used. Unfortunately this method requires you to add user to sudo, and set in  [phpui] section of <TT
CLASS="FILENAME"
>lms.ini</TT
>:</P
><P
><SAMP
CLASS="PROMPT"
>reload_type 	= exec</SAMP
></P
><P
><SAMP
CLASS="PROMPT"
>reload_execcmd 	= sudo /usr/sbin/lms-mgc</SAMP
></P
><P
>LMS-MGC has following command line options:
	<PRE
CLASS="SCREEN"
>-C, --config-file=/path/lms-mgc.ini alternative configuration file
                                    (default: /etc/lms/lms-mgc.ini);
-i, --instances=name                instance name (number) to launch, without reading
                                    lms-mgc.ini configuration, ie. -i "name1 name2"
-h, --help                          shows help;
-v, --version                       shows version number;
-q, --quiet                         shows only errors during execution;
-d, --debug                         verbose information for each IP;</PRE
>
	</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MGC-CONFIG"
>5.2. Configuration</A
></H2
><P
>Configuration of LMS-MGC is held in <TT
CLASS="FILENAME"
>lms-mgc.ini</TT
> file.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MGC-CONFIG-DB"
>5.2.1. Section [database] - database setup</A
></H3
><UL
><LI
><P
>type</P
><P
>Database type. Currently only 'mysql' is 100% supported, however there seems to be no significant problems with 'postgres'. Default: mysql</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>type = mysql</SAMP
></P
></LI
><LI
><P
>host</P
><P
>Database host. Usually localhost, but you can set it to anything (IP, domain, path to socket in 'localhost:/path/to/socket' format). Default: localhost</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>host = localhost</SAMP
></P
></LI
><LI
><P
>user</P
><P
>Database user. In most cases (if you followed this documentation) it should be 'lms'. If you want to use privileged account, you should enter 'root' (MySQL on *nices), 'mysql' (on PLD) or 'postgres' (PostgreSQL). Default: root</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>user = mysql</SAMP
></P
></LI
><LI
><P
>password</P
><P
>Database password. Default: empty.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>password = secret_password</SAMP
></P
></LI
><LI
><P
>database</P
><P
>Database name. Default: lms.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>database = lms</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MGC-CONFIG-LMS"
>5.2.2. Section [mgc] - list of instances</A
></H3
><P
>Significant parts of configuration are placed in section <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[mgc]</I
></SPAN
> and its derivative sections. In <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[mgc]</I
></SPAN
> alone you can use the following parameter:
   <UL
><LI
><P
>instances</P
><P
>List of instances (separated by spaces).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>instances = dhcp firewall squid</SAMP
></P
></LI
></UL
>
   <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You can also place <TT
CLASS="FILENAME"
>instances</TT
> variable in any derivative instance section. See below.</P
></TD
></TR
></TABLE
></DIV
>
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MGC-CONFIG-INSTANCES"
>5.2.3. Section [mgc:xxx] - instance configuration</A
></H3
><P
>Each instance has its name and its configuration is created by creating derivative section of name <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[mgc:name]</I
></SPAN
>, eg.
	<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[mgc:mydaemon]</I
></SPAN
></P
><P
>All of those sections may include following configuration options:</P
><UL
><LI
><P
>instances</P
><P
>This variable allows you to group a list of other instances (eg. instances = ins1 ins2 ins3), and then call your mgc with '<SAMP
CLASS="PROMPT"
>lms-mgc -i mydaemon</SAMP
>'  instead of '<SAMP
CLASS="PROMPT"
>lms-mgc -i "ins1 ins2 ins3"</SAMP
>'. If you use this variable all other settings in this section will be ignored.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>instances = dns1 dns2 dns3</SAMP
></P
></LI
><LI
><P
>outfile</P
><P
>Output file, where instance structured dump will be saved (instance will quit instantly if this variable is not set).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>outfile = /etc/somefile</SAMP
></P
></LI
><LI
><P
>append</P
><P
>It allows you to define to not overwrite outfile, but append to its end instead.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>append = 1</SAMP
></P
></LI
><LI
><P
>outfile_perm</P
><P
>Permissions for output file. Default: 600 (-rw-------)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>outfile_perm = 700</SAMP
></P
></LI
><LI
><P
>outfile_owner</P
><P
>UID of output file owner. Default: 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>outfile_owner = 0</SAMP
></P
><P
><DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You have to provide numerical UID, not username!</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>outfile_group</P
><P
>GID of output file owner. Default: 0</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>outfile_group = 0</SAMP
></P
><P
><DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You have to provide numerical GID, not group name!</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>header_file</P
><P
>Filename, that should be prepended at beginning of output file. Default: unset</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>header_file = /etc/lms/myservice_header</SAMP
></P
></LI
><LI
><P
>header</P
><P
>String, which should be put at beginning of output file. Default: unset</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>header = option1 = blah\noption2 = blab-la</SAMP
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You should use \n as line separator. You may omit line separator at the end of last line.</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>networks</P
><P
>&#62;List of (space separated) networks, that should be
considered while creating configuration file. If unset, configuration will
include all networks.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>networks = cust1-publ cust2-publ cust3-priv</SAMP
></P
></LI
></UL
><P
>Mgc script now loops for each network and performs the following tasks:</P
><UL
><LI
><P
>network_header</P
><P
>String, which should be put at beginning of network section. Default: empty</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>network_header = network %ADDR/%MASK { # Config section for %NAME</SAMP
></P
></LI
><LI
><P
>dst_networks</P
><P
>List of destination network names, for which dst_network_header variable (see below) will be used. Default: all</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>dst_networks = main coalloc</SAMP
></P
></LI
><LI
><P
>dst_network_header</P
><P
>Lets you to set destination networks header.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>dst_network_header = \tallow to %DADDR/%DMASK;</SAMP
></P
></LI
><LI
><P
>network_body</P
><P
>This parameter is parsed after network headers and before IP addresses loop.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>network_body = \tnodes {</SAMP
></P
></LI
></UL
><P
>Mgc script now loops into below rules for each IP address for given range. It takes each IP address and checks if a rule is defined for this address, if yes - it executes first rule that matches. Matches are being parsed in specific order, as described below:</P
><UL
><LI
><P
>ignore</P
><P
>Lets you setup list of addresses (in address/prefix or address/netmask form, space separated) which should be skipped.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>ignore = 192.168.0.100/32</SAMP
></P
></LI
><LI
><P
>node(IP)</P
><P
>Allows you to add line for given IP address. IP address should be provided in parenthesis. Each section may have unlimited number of such options.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>node(192.168.0.20) = ??</SAMP
></P
></LI
><LI
><P
>allnodes</P
><P
>Adds line for each non-ignored IP address.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>allnodes = ??</SAMP
></P
></LI
><LI
><P
>allexistnodes</P
><P
>Adds line for each IP address that is 'owner' by a computer in database.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>allexistnodes = ??</SAMP
></P
></LI
><LI
><P
>grantednode_priv</P
><P
>Adds line for each IP address with 'connected' status in database (parsed only for private address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>grantednode_priv = \t\tnode %NAME (%IP/%MAC) unique %ID;</SAMP
></P
></LI
><LI
><P
>grantednode_publ</P
><P
>Adds line for each IP address with 'connected' status in database (parsed only for public address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>grantednode_publ = \t\tnode %NAME (%IP/%MAC) unique %ID;</SAMP
></P
></LI
><LI
><P
>deniednode_priv</P
><P
>Adds line for each IP address with 'disconnected' status in database (parsed only for private address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>deniednode_priv = node %NAME (%IP/%MAC) unique %ID deny;</SAMP
></P
></LI
><LI
><P
>deniednode_publ</P
><P
>Adds line for each IP address with 'disconnected' status in database (parsed only for public address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>deniednode_publ = node %NAME (%IP/%MAC) unique %ID deny;</SAMP
></P
></LI
><LI
><P
>dhcpnode_priv</P
><P
>Adds line for each IP address within DHCP dynamic range (parsed only for private address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>dhcpnode_priv = node unknown (%IP) reject;</SAMP
></P
></LI
><LI
><P
>dhcpnode_publ</P
><P
>Adds line for each IP address within DHCP dynamic range (parsed only for public address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>dhcpnode_publ = node unknown (%IP) reject;</SAMP
></P
></LI
><LI
><P
>freeip_priv</P
><P
>Adds line for each IP address that is not occupied by any computer in database (parsed only for private address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>freeip_priv = node unknown (%IP) lock_as_unused;</SAMP
></P
></LI
><LI
><P
>freeip_publ</P
><P
>Adds line for each IP address that is not occupied by any computer in database (parsed only for public address classes).</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>freeip_publ = node unknown (%IP) lock_as_unused;</SAMP
></P
></LI
><LI
><P
>default_priv</P
><P
>Default line, which is inserted when none of grantednode or deniednode matches for given IP address (parsed only for private address classes)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>default_priv = node unknown (%IP) lock_as_intruder;</SAMP
></P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Mgc automatically detects if given address belongs to private or public network.</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>default_publ</P
><P
>Default line, which is inserted when none of grantednode or deniednode matches for given IP address (parsed only for public address classes)</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>default_publ = node unknown (%IP) lock_as_intruder;</SAMP
></P
></LI
></UL
><P
>Mgc now is ready to append final part of the file and execute system command.</P
><UL
><LI
><P
>network_footer</P
><P
>Adds line for currently processed network.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>network_footer = ??</SAMP
></P
></LI
><LI
><P
>footer_file</P
><P
>Filename, that should be appended at the end of output file. Default: unset</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>footer_file = /etc/lms/myservice_footer</SAMP
></P
></LI
><LI
><P
>footer</P
><P
>String, which should be put at the end of output file. Default: unset</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>footer = # End.</SAMP
></P
></LI
><LI
><P
>post_exec</P
><P
>System command that should be executed after saving output file.</P
><P
>Example:	<SAMP
CLASS="PROMPT"
>post_exec = killall -HUP mydaemon</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MGC-CONFIG-VARS"
>5.2.4. Configuration variables</A
></H3
><P
>You can use the following templates in your configuration variables. They all will be substituted with appropriate data from LMS database.</P
><P
>Computer templates:
   <UL
><LI
><P
>%IP - IP address</P
></LI
><LI
><P
>%PUBIP - second (public) IP address</P
></LI
><LI
><P
>%PIN - PIN of customer who owns node</P
></LI
><LI
><P
>%ID - ID of computer</P
></LI
><LI
><P
>%MAC - MAC address</P
></LI
><LI
><P
>%SMAC - MAC address, in lowercase and without colon separators</P
></LI
><LI
><P
>%OWNER - owner's ID</P
></LI
><LI
><P
>%CUSTOMER - owner's lastname and name</P
></LI
><LI
><P
>%NAME - computer name, in uppercase</P
></LI
><LI
><P
>%name - computer name, in lowercase</P
></LI
><LI
><P
>%INFO - computer description</P
></LI
><LI
><P
>%PASSWD - node password</P
></LI
><LI
><P
>%UPRATE - guaranteed upload rate</P
></LI
><LI
><P
>%DOWNRATE - guaranteed download rate</P
></LI
><LI
><P
>%UPCEIL - maximum upload rate</P
></LI
><LI
><P
>%DOWNCEIL - maximum download rate</P
></LI
><LI
><P
>%CLIMIT - limit of concurrent connections</P
></LI
><LI
><P
>%PLIMIT - maximum number of packets per second</P
></LI
><LI
><P
>%1 %2 %3 %4 - consecutive (left to right) decimal octets of IP address</P
></LI
><LI
><P
>%NID - network ID where computer belongs</P
></LI
><LI
><P
>%NNAME - network name, in uppercase</P
></LI
><LI
><P
>%nname - network name, in lowercase</P
></LI
><LI
><P
>%NADDR - network address</P
></LI
><LI
><P
>%NIFACE - network interface</P
></LI
><LI
><P
>%NMASK - network mask</P
></LI
><LI
><P
>%NGATE - network gateway IP address</P
></LI
><LI
><P
>%NDNS - primary DNS server IP address</P
></LI
><LI
><P
>%NDNS2 - secondary DNS server IP address</P
></LI
><LI
><P
>%NDOMAIN - domain name of the network</P
></LI
><LI
><P
>%NWINS - WINS server IP address</P
></LI
><LI
><P
>%NDHCPS - first IP address of dynamic DHCP range</P
></LI
><LI
><P
>%NDHCPE - last IP address of dynamic DHCP range</P
></LI
></UL
>
    </P
><P
>Network templates (for sections relevant to networks only):
   <UL
><LI
><P
>%ID - network ID</P
></LI
><LI
><P
>%NAME - network name, in uppercase</P
></LI
><LI
><P
>%name - network name, in lowercase</P
></LI
><LI
><P
>%ADDR - network IP address</P
></LI
><LI
><P
>%IFACE - network interface</P
></LI
><LI
><P
>%MASK - network IP mask</P
></LI
><LI
><P
>%GATE - network gateway IP address</P
></LI
><LI
><P
>%DNS - primary DNS server IP address</P
></LI
><LI
><P
>%DNS2 - secondary DNS server IP address</P
></LI
><LI
><P
>%DOMAIN - domain name of the network</P
></LI
><LI
><P
>%WINS - WINS server IP address for the network</P
></LI
><LI
><P
>%DHCPS - first IP address of dynamic DHCP range for the network</P
></LI
><LI
><P
>%DHCPE - last IP address of dynamic DHCP range for the network</P
></LI
></UL
>
    <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Additionally, <SAMP
CLASS="PROMPT"
>dst_network_header</SAMP
> variable may include above templates prepended with D (ie. %DADDR, %dname) to get data relevant to destination networks.</P
></TD
></TR
></TABLE
></DIV
>
   </P
><P
>Templates which can be used everywhere:
   <UL
><LI
><P
>%DATE - date in YYYYMMDD format;</P
></LI
><LI
><P
>%TIME - time in HHMM format;</P
></LI
><LI
><P
>%TIMES - time in HHMMSS format;</P
></LI
><LI
><P
>%UTIME - time in unix timestamp format;</P
></LI
></UL
>
   </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="MGC-EXAMPLE"
>5.3. Examples of use</A
></H2
><P
>Configuration and implementation of lms-mgc might seem quite complex, so we provide small example. Below you can find rules to create and execute quite simple ipchains firewall.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="INSTANCE-EXAMPLE"
></A
><P
><B
>Example 5-1. Lms-mgc: Example instance</B
></P
><P
>You should start with creating new mgc section in <TT
CLASS="FILENAME"
>lms-mgc.ini</TT
>, with relevant name ('ipchains') and put a simple masquerade rules, per IP, inside:
	<PRE
CLASS="SCREEN"
>[mgc:ipchains]
outfile           = /etc/rc.d/rc.masq
outfile_perm      = 700
header            = #!/bin/sh\n/sbin/ipchains -F\n/sbin/ipchains -X\n/sbin/ipchains -P forward DENY
grantednode_priv  = /sbin/ipchains -A forward -s %IP -j MASQ
post_exec         = /etc/rc.d/rc.masq</PRE
>
	You can also add your ipchains subsection to main mgc section, so that it executes it by default:
	<PRE
CLASS="SCREEN"
>[mgc]
instances         = ipchains</PRE
>
	</P
><P
>If you run lms-mgc now, without any arguments, you should have simple script <TT
CLASS="FILENAME"
>/etc/rc.d/rc.masq</TT
> generated and already executed.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="DAEMON"
></A
>Chapter 6. LMS Daemon</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="DAEMON-INTRO"
>6.1. Basics</A
></H2
><P
>This C daemon was developed to aid management of your services. It's responsible for
     starting appropriate modules, each performing specific task. Each module makes configuration 
     files based on its template and data from LMS database and manages (restarting) selected services 
     on a server. Modules can also collect statistics, check hosts activity, account payments or
     notify debtors about their charges.
     </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-REQUIREMENTS"
>6.1.1. Requirements</A
></H3
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS Daemon</I
></SPAN
> requires:
                     <UL
><LI
><P
>LMS user interface installation</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libmysqlclient</TT
> shared library (included in full MySQL
                    installation or respective "devel" package) or <TT
CLASS="FILENAME"
>libpq</TT
> shared
                    library in case of PostgreSQL database use.</P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>libdl</TT
> shared library (present in every modern
                    distribution)</P
></LI
><LI
><P
>C compiler (gcc-2.95.x or higher)</P
></LI
><LI
><P
>ggnotify module needs <TT
CLASS="FILENAME"
>libgadu</TT
> library and header files</P
></LI
><LI
><P
>parser module needs <TT
CLASS="FILENAME"
>flex</TT
> and <TT
CLASS="FILENAME"
>bison</TT
> (version 1.875 or newer).</P
></LI
></UL
>
                     </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-INSTALL"
>6.1.2. Installation</A
></H3
><P
>You have to setup some configure options prior to compilation, that can be
               listed with --help flag of <TT
CLASS="FILENAME"
>./configure</TT
> script (default values
               shown in brackets):
<PRE
CLASS="SCREEN"
>  --help                help
  --enable-debug0       SQL queries logging (disabled)
  --enable-debug1       events logging (disabled)
  --with-pgsql          enables using of PostgreSQL database (disabled)
  --with-mysql          enables using of MySQL database (enabled)
  --prefix=PREFIX       program and modules install directory (/usr/local)
  --libdir=DIR          location of database libraries (/usr/lib)
  --incdir=DIR          location of database header files (/usr/include)
  --inifile=FILE        configuration file - disables online configuration</PRE
>
               It's required to choose one database which you will use (--with-mysql or --with-pgsql) 
	       and location of libraries supplied with database (--incdir,
               --libdir). You can use only one database. If you change database, you have to
               recompile your daemon. It's also possible to force daemon to use
	       configuration files instead of database. It can't use
	       both files and db at the same time, you'll need to choose either before
	       compilation.
<PRE
CLASS="SCREEN"
># ./configure --with-pgsql --libdir=/usr/local/pgsql/lib --incdir=/usr/local/pgsql/include</PRE
>
               After that you can compile and install (put daemon in directory
               given with --prefix option):
<PRE
CLASS="SCREEN"
># make &#38;&#38; make install</PRE
>
               Compiled modules (files with <TT
CLASS="FILENAME"
>.so</TT
> extension), found in
               directory <TT
CLASS="FILENAME"
>modules/module_name</TT
> will be moved to directory
	       PREFIX/lms/lib. Main program goes to PREFIX/lms/bin.
               </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-CONFIG"
>6.1.3. Configuration</A
></H3
><P
>Configuration for daemon and modules configuration can be edited through Reload -&#62; Configuration
	       menu in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>. Modules configuration is described later, in separate
               chapters concerning each module. Basic daemon parameters and data for connection to
	       database should be specified as command line options, according to following listing:
<PRE
CLASS="SCREEN"
>--dbhost -h host           host database is available (default: localhost)
--dbname -d db_name        database name (default: lms)
--dbuser -u user           database username (default: lms)
--dbpass -p password       database password (default: empty)
--hostname -H hostname     host name where daemon runs; name returned by hostname command is taken
                           as default but it can be overwritten; that name must correspond to the
                           one specified in hosts configuration in UI
--command -c command       shell command to execute before every database connection (default: empty)
--instance -i "instance[ ...]" list of instances to reload; other instances will be ignored
--reload -q                do reload and exit
--foreground -f            run in foreground (don't fork)
--version -v               prints version and copyright info</PRE
>
		Database connection options can be also read from enviroment variables:
		LMSDBPASS, LMSDBNAME, LMSDBUSER, LMSDBHOST, LMSDBPORT.
               <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>List of instances should contain instance names separated with spaces.</P
></TD
></TR
></TABLE
></DIV
> 
	       </P
><P
>Daemon configuration is divided into hosts (which makes possible to configure
	       and reload several different daemons installed on numerous hosts/routers) and 
               configuration sections called as instances.</P
><P
>Instance configuration, besides config modules params, have to contain the following primary options:
	       <UL
><LI
><P
>Name</P
><P
>Instance name, unique for each daemon (host where daemon is running).</P
><P
>Example: system</P
></LI
><LI
><P
>Priority</P
><P
>Priority number, which defines instances reload sequence.</P
><P
>Example: 10</P
></LI
><LI
><P
>Module</P
><P
>Module name (with or without .so extension). If path is not specified
			daemon will search module in PREFIX/lms/lib directory, where modules are being
			placed after "make install".</P
><P
>Example: /usr/lib/system.so</P
></LI
><LI
><P
>Crontab</P
><P
>Module execution time specified in crontab style. All data must be numeric.
			Following example executes instance each 5 minutes between 8 and 18 
			hour every day. If crontab is empty, instance will be reloaded only with UI reload. 
			Default: empty.</P
><P
>Example: */5 8-18 * * *</P
></LI
></UL
>
               </P
><P
>Configuration changes does not require restarting daemon.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-RUN"
>6.1.4. Starting</A
></H3
><P
>By default program runs in daemon mode. In this mode
               configuration and services reload is performed on demand using 'Reload'
               menu in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>. Reload order and configuration
	       checks (especially instances list and configuration of them) is done each minute. 
	       When daemon detects reload order, it runs all enabled instances. Instances with 
	       crontab specified will be executed at scheduled time.</P
><P
>Other way to run daemon is disposable reload using '-q' command line option.
	       This is useful for tests, and in conjunction with '-i' option allows to
	       run selected instances regardless of crontab entries for the rest of instances.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="DAEMON-MODULES"
>6.2. Modules</A
></H2
><P
>As we stated before daemon can only run modules and they are doing all the job. 
     Most modules are designed to specific application, only 'hostfile' 
     can be used to create many different configs (and manage numerous services), ie. various firewall types. 
     Module configuration parameters MUST be placed in appropriate instance section.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-MODULESLIST"
>6.2.1. Modules list</A
></H3
><DIV
CLASS="TABLE"
><A
NAME="MODULES-LIST"
></A
><P
><B
>Table 6-1. List of all lmsd modules</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="200"
ALIGN="CENTER"><COL
WIDTH="300"
ALIGN="CENTER"><THEAD
><TR
><TH
>Name</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><A
HREF="#DAEMON-SYSTEM"
>system</A
></TD
><TD
>Shell commands execution</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-PARSER"
>parser</A
></TD
><TD
>Universal T-Script scripts parser</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-DHCP"
>dhcp</A
></TD
><TD
>Configuration of DHCP server</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-CUTOFF"
>cutoff</A
></TD
><TD
>Disconnection of indebted users</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-DNS"
>dns</A
></TD
><TD
>Configuration of DNS server</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-ETHERS"
>ethers</A
></TD
><TD
>/etc/ethers file creation</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-HOSTFILE"
>hostfile</A
></TD
><TD
>Universal module (eg. making iptables rules)</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-NOTIFY"
>notify</A
></TD
><TD
>Email notify about payments</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-GGNOTIFY"
>ggnotify</A
></TD
><TD
>Gadu-Gadu (polish internet messenger) notify about payments</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-PAYMENTS"
>payments</A
></TD
><TD
>Payments accounting</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-OIDENT"
>oident</A
></TD
><TD
>Configuration of oident daemon</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-TC"
>tc</A
></TD
><TD
>Making HTB rules</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-TRAFFIC"
>traffic</A
></TD
><TD
>Internet link usage statistics</TD
></TR
><TR
><TD
><A
HREF="#DAEMON-PINGER"
>pinger</A
></TD
><TD
>Users activity (online) scanning</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-SYSTEM"
>6.2.2. System</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="SYSTEM-DESC"
>6.2.2.1. Description</A
></H4
><P
>This module does only one thing: it runs given 
	      Linux shell command or/and SQL query. It can be useful if you want to 
	      execute some command or run external script while configuration is 
	      being reload, eg. one of scripts in LMS <TT
CLASS="FILENAME"
>/bin</TT
> 
	      directory. SQL command is executed first.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="SYSTEM-CONFIG"
>6.2.2.2. Configuration</A
></H4
><P
>You can define command strings or SQL queries. Commands will be executed via
              shell, separated by semicolons:</P
><UL
><LI
><P
>sql</P
><P
>SQL command. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = 'DELETE FROM stats WHERE dt &#60; %NOW% - 365*86400'</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command(s). Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = 'echo -n "hello "; echo "world"'</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-PAYMENTS"
>6.2.3. Payments</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="PAYMENTS-DESC"
>6.2.3.1. Description</A
></H4
><P
>Module calculates subscription and solid fees for customers, basing on current
               date. It should be executed once a day. Payments are calculated basing on customers
               liabilities and written to database with description filled in 'comment' field. If
               appropriate, invoices are created. Description of solid payment is a combination of liability
               and creditor name. At the end outdated liabilities are being removed from database. </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="PAYMENTS-CONFIG"
>6.2.3.2. Configuration</A
></H4
><P
>You can use following options for this module:</P
><UL
><LI
><P
>comment</P
><P
>Description of operation. '%period' will be replaced by start and end
                   date of subscription, e.g. '2003/10/10 - 2003/11/09', and '%tariff' by name of
                   liability. Default: 'Subscription: '%tariff' for period: %period'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>comment = 'Subscription %tariff' </SAMP
></P
></LI
><LI
><P
>up_payments</P
><P
>How should period in comment be counted - forward or backward relatively to
                   date of write out. Default: yes.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>up_payments = no</SAMP
></P
></LI
><LI
><P
>expiry_days</P
><P
>Defines number of days from date of liability expiration, after which 
                   that liability will be removed from database. When you set '0' data will be
                   removed immediately after date of the write out. Default: 30.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>expiry_days = 365</SAMP
></P
></LI
><LI
><P
>deadline</P
><P
>Payment deadline in days. Default: 14.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>deadline = 21</SAMP
></P
></LI
><LI
><P
>paytype</P
><P
>Payment type. Default: 'TRANSFER'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>paytype = 'CASH'</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-NOTIFY"
>6.2.4. Notify</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="NOTIFY-DESC"
>6.2.4.1. Description</A
></H4
><P
>Module 'notify' is designed to inform customers about their debt using
               electronic mail. Current customer balance is compared to 'limit' option, if it's
               beneath that limit - message will be sent. Message content is taken from template,
               which may include the following variables:
              <UL
><LI
><P
>%saldo - current customer balance (also %b)</P
></LI
><LI
><P
>%B - absolute value of current customer balance</P
></LI
><LI
><P
>%pin - customer PIN</P
></LI
><LI
><P
>%name - customer forename</P
></LI
><LI
><P
>%lastname - company name or customer lastname</P
></LI
><LI
><P
>%last_10_in_a_table - last 10 operations on customer account</P
></LI
></UL
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="NOTIFY-CONFIG"
>6.2.4.2. Configuration</A
></H4
><P
>Configuration options for 'notify' module are presented below:</P
><UL
><LI
><P
>template</P
><P
>Location of message template file. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>template = modules/notify/sample/mailtemplate</SAMP
></P
></LI
><LI
><P
>file</P
><P
>Location of temporary file. Default: /tmp/mail</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /tmp/mail.txt</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command for sending an e-mail. '%address' will be replaced by
                   customer e-mail address. Default: 'mail -s "Liabilities Information" %address
                   &lt; /tmp/mail'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = 'mail -s "You must pay or ..." $address &lt; /tmp/mail.txt'</SAMP
></P
></LI
><LI
><P
>limit</P
><P
>Message is sent when customer balance will decrease below value defined in
                   this option. Default: 0</P
><P
>Example: <SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>debug_mail</P
><P
>If set, all messages goes to this address, instead of sending them to
                   customers. Useful for testing. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>debug_mail = tester@my.net</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-GGNOTIFY"
>6.2.5. Ggnotify</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="GGNOTIFY-DESC"
>6.2.5.1. Description</A
></H4
><P
>Equivalent of 'notify' module developed to send gadu-gadu instant messages.
              Gadu-Gadu is most popular polish internet messenger.</P
><P
>Module require <TT
CLASS="FILENAME"
>libgadu</TT
> shared library and sources
              of <TT
CLASS="FILENAME"
>ekg</TT
> program. Appropriate paths for them must be present in
              <TT
CLASS="FILENAME"
>modules/ggnotify/Makefile</TT
> before module compilation.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="GGNOTIFY-CONFIG"
>6.2.5.2. Configuration</A
></H4
><P
>Options similar to 'notify' module might be also used here:</P
><UL
><LI
><P
>template</P
><P
>Location of message template file. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>template = modules/notify/sample/mailtemplate</SAMP
></P
></LI
><LI
><P
>uin</P
><P
>Gadu-gadu identifier number of message sender. 
                   Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>uin = 1234567</SAMP
></P
></LI
><LI
><P
>password</P
><P
>Password for account specified by 'uin'. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>password = "my_HURD.password"</SAMP
></P
></LI
><LI
><P
>limit</P
><P
>Message is sent when customer balance will decrease below value defined in
                   this option. Default: 0</P
><P
>Example: <SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>debug_uin</P
><P
>If is set, all messages will go to that 'uin'. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>debug_uin = 7654321</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-CUTOFF"
>6.2.6. Cutoff</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="CUTOFF-DESC"
>6.2.6.1. Description</A
></H4
><P
>Cutoff do change nodes status to 'disconnected' and/or enable warnings for
              customers, which have debts greater than specified limit. This module does not doing
              actual blocking of network access.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="CUTOFF-CONFIG"
>6.2.6.2. Configuration</A
></H4
><P
>You can use following options for 'cutoff' module:</P
><UL
><LI
><P
>limit</P
><P
>Disconnection occurs when customer balance decreases below specified value.
                   Default: 0.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>limit = -20</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Specifies system command, that is executed if at least one customer should
                   be disconnected or warning should be enabled.
                   Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = 'lmsd -qi firewall'</SAMP
></P
></LI
><LI
><P
>warning</P
><P
>Enable warning for disconnected customer and write him WWW browser message
                   specified in this option. If empty, warning will be not enabled. Date in
                   message is substituted providing '%time' variable. Default: 'Blocked
                   automatically due to payment deadline override on %time".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>warning = ""</SAMP
></P
></LI
><LI
><P
>warnings_only</P
><P
>Here you can to decide, if you want to use this module only for warnings or
                   to actually cut people off. Default: false.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>warnings_only = true</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-DHCP"
>6.2.7. DHCP</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="DHCP-DESC"
>6.2.7.1. Description</A
></H4
><P
>Module responsible for management of DHCP server, creates configuration file and
              restarts service. It's possible to execute other functions (programs) with 'command'
              option.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="DHCP-CONFIG"
>6.2.7.2. Configuration</A
></H4
><P
>Most of configuration parameters match with parts of DHCP configuration file,
              and in typical environment doesn't need any changes:</P
><UL
><LI
><P
>file</P
><P
>Location of DHCP server configuration file. 
                   Default: /etc/dhcpd.conf.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /etc/dhcp/dhcpd.conf</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command executed after config file creation. 
                   Default: 'killall dhcpd; /usr/sbin/dhcpd'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = '/etc/rc.d/rc.dhcpd restart'</SAMP
></P
></LI
><LI
><P
>begin</P
><P
>File header. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>begin = "authoritative;"</SAMP
></P
></LI
><LI
><P
>end</P
><P
>File footer. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>end = ""</SAMP
></P
></LI
><LI
><P
>subnet_start</P
><P
>Subnet header. '%a' - name, '%m' - mask. Default: "subnet %a netmask %m {\ndefault-lease-time 86400;\nmax-lease-time 86400;".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_start = "subnet %a netmask %m {default-lease-time 3600;"</SAMP
></P
></LI
><LI
><P
>subnet_end</P
><P
>Subnet footer. Default: "}".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_end = '\t}'</SAMP
></P
></LI
><LI
><P
>subnet_gateway</P
><P
>Subnet gateway. '%i' will be changed to IP address. Default: 'option routers %i;'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_gateway = "option routers %i"</SAMP
></P
></LI
><LI
><P
>subnet_dns</P
><P
>Subnet DNS servers. '%i - dns addresses. Default: "option domain-name-servers %i;".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_dns = "option domain-name-servers 192.168.0.1"</SAMP
></P
></LI
><LI
><P
>subnet_domain</P
><P
>Subnet domain name. '%n' - name. Default: "option domain-name %n;".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_domain = "option domain-name test.%n;"</SAMP
></P
></LI
><LI
><P
>subnet_wins</P
><P
>WINS servers. '%i' - server IP address. Default: "option netbios-name-servers %i;".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_wins = ""</SAMP
></P
></LI
><LI
><P
>subnet_range</P
><P
>Subnet address range. '%s' - initial address, '%e' - end of range. Default: "range %s %e;".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>subnet_range = "range %s %e;"</SAMP
></P
></LI
><LI
><P
>host</P
><P
>Hosts parameters, where '%n' - host name, '%m' - MAC, '%i' - IP address. 
                   Default: "\thost %n {\n\t\thardware ethernet %m; fixed-address %i; \n\t}".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>host = "host %n {hardware ethernet %m; fixed-address %i;}"</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of network names that should be included in configuration (case insensitive).
                   Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = "lan1 lan2"</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>List of customers groups that should be included in configuration (case insensitive).
                   Default: empty (all groups).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>usergroups = "group1 group2"</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-HOSTFILE"
>6.2.8. Hostfile</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="HOSTFILE-DESC"
>6.2.8.1. Description</A
></H4
><P
>Module 'hostfile' is a multipurpose tool. It performs loop on all hosts from
              database fetching their status (connected/disconnected), network that they are
              connected to and groups of they owners. Because of that it is possible to create any
              firewall rules, or /etc/hosts file. Data is written to file and after that specified
              shell command is executed.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="HOSTFILE-CONFIG"
>6.2.8.2. Configuration</A
></H4
><P
>The following templates might be used for 'grantedhost', 'deniedhost', 'public_grantedhost'
	      and 'public_deniedhost' options replaced with actual data from database: 
	      <TABLE
BORDER="0"
><TBODY
><TR
><TD
>%i - IP address,</TD
></TR
><TR
><TD
>%ipub - public IP address,</TD
></TR
><TR
><TD
>%id - node ID,</TD
></TR
><TR
><TD
>%m - MAC address,</TD
></TR
><TR
><TD
>%n - host name,</TD
></TR
><TR
><TD
>%p - node (computer) password,</TD
></TR
><TR
><TD
>%info - node description,</TD
></TR
><TR
><TD
>%domain - domain,</TD
></TR
><TR
><TD
>%net - network name,</TD
></TR
><TR
><TD
>%gw - gateway address of network,</TD
></TR
><TR
><TD
>%if - network's interface,</TD
></TR
><TR
><TD
>%mask - network mask,</TD
></TR
><TR
><TD
>%addr - network's address,</TD
></TR
><TR
><TD
>%dns, %dns2 - DNS server addresses,</TD
></TR
><TR
><TD
>%wins - WINS server address,</TD
></TR
></TBODY
></TABLE
>
              This module has following options:</P
><UL
><LI
><P
>file</P
><P
>Location of generated file. Default: /tmp/hostfile</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /etc/rc.d/rc.firewall</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command(s) executed after 'file' creation. Default: empty</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = '/bin/sh /etc/rc.d/rc.firewall'</SAMP
></P
></LI
><LI
><P
>begin</P
><P
>File header. Default: "/usr/sbin/iptables -F FORWARD\n"</P
><P
>Example: <SAMP
CLASS="PROMPT"
>begin = "IPT=/usr/sbin/iptables \n$IPT -F FORWARD\n"</SAMP
></P
></LI
><LI
><P
>end</P
><P
>File footer. Default: "/usr/sbin/iptables -A FORWARD -J REJECT\n"</P
><P
>Example: <SAMP
CLASS="PROMPT"
>end = "$IPT -A FORWARD -J REJECT\n"</SAMP
></P
></LI
><LI
><P
>grantedhost</P
><P
>Line with rule(s) for connected node. Default: "/usr/sbin/iptables -A FORWARD -s %i -m mac --mac-source %m -j ACCEPT\n"</P
><P
>Example: <SAMP
CLASS="PROMPT"
>grantedhost = "$IPT -A FORWARD -s %i -m mac --mac-source %m -j ACCEPT\n"</SAMP
></P
></LI
><LI
><P
>deniedhost</P
><P
>Line with rule(s) for disconnected node. Default: "/usr/sbin/iptables -A FORWARD -s %i -m mac --mac-source %m -j REJECT\n"</P
><P
>Example: <SAMP
CLASS="PROMPT"
>deniedhost = "$IPT -A FORWARD -s %i -m mac --mac-source %m -j REJECT\n"</SAMP
></P
></LI
><LI
><P
>public_grantedhost</P
><P
>Line with rule(s) for connected node with specified public IP.
		    By default rule specified in 'grantedhost' option.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>public_grantedhost = "$IPT -A FORWARD -s %i -m mac --mac-source %m -j ACCEPT\n$IPT -t nat -A PREROUTING -p tcp -d %ipub -j DNAT --to-destination %i\n$IPT -t nat -A POSTROUTING -s %i -j SNAT --to-source %ipub\n"</SAMP
></P
></LI
><LI
><P
>public_deniedhost</P
><P
>Line with rule(s) for disconnected node with specified public IP.
		    By default rule specified in 'deniedhost' option.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>public_deniedhost = ""</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of network names which members should be included in config (case
                   insensitive). Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = "lan1 lan2"</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>List of customer group names which members should be included in config
                   (case insensitive). Default: empty (all groups).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>usergroups = "group1 group2"</SAMP
></P
></LI
><LI
><P
>skip_dev_ips</P
><P
>If enabled (yes, true) network devices (devices that does not belong to
                   customers) will be ignored (omitted). Default: yes</P
><P
>Example: <SAMP
CLASS="PROMPT"
>skip_dev_ips = no</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-TRAFFIC"
>6.2.9. Traffic</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="TRAFFIC-DESC"
>6.2.9.1. Description</A
></H4
><P
>'Traffic' is an equivalent of 'lms-traffic' Perl script,which loads internet
              link stats to database, from file created by user. That file must have format: host_IP upload
              download. More informations (including how to make such file) can be found in chapter with
              lms-traffic description.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="TRAFFIC-CONFIG"
>6.2.9.2. Configuration</A
></H4
><P
>There is only one available option and it's mandatory:</P
><UL
><LI
><P
>file</P
><P
>Location of file with firewall stats. Default: /var/log/traffic.log</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /tmp/log</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-TC"
>6.2.10. Tc (HTB)</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="TC-DESC"
>6.2.10.1. Description</A
></H4
><P
>Generate script containing iptables and tc rules for traffic control ie. band
              and customer connections limits. Rules for nodes can be freely defined and used not only
              for traffic control. Principle of operation of this module is following: First of all
              all customers data is being retrieved. Totals for limitations (uprate, downrate, upceil,
              downceil, connection limit) are being calculated for each customer. Then, loop is performed
              to check networks and groups (if specified). If limit values are not zeroes rules are written
              to file with variables replacement. The following variables can be used in rules: %name - host
              name, %i - IP address, %m - MAC, %uprate, %downrate, %upceil, %downceil, %plimit, %climit,
              and %x - integer counter with initial value of 100 incremented by one for each node.</P
><P
>Default policy for creating HTB class is one class per all nodes belonging to
              each customer. It can be changed with 'one_class_per_host' option.</P
><P
>Default configuration assumes that your system supports HTB and iptables with
              modules limit, connlimit, mark and ipp2p. You can patch kernel or use sources available
              at <A
HREF="http://www.inet.one.pl"
TARGET="_top"
>www.inet.one.pl</A
> (polish project, site in
              PL).</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="TC-CONFIG"
>6.2.10.2. Configuration</A
></H4
><P
>There are basic options like groups of customers, file, command, networks and
              extra options which are define tc and firewall rules available to use. Default config is
              designed for 512/128 kbit limits and 100mbit links.</P
><UL
><LI
><P
>file</P
><P
>Location of file. Default: /etc/rc.d/rc.htb.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /tmp/rc.htb</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command executed after file creation. Default: "sh /etc/rc.d/rc.htb start".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = "chmod 700 /tmp/rc.htb; /tmp/rc.htb start"</SAMP
></P
></LI
><LI
><P
>begin</P
><P
>Script header. Default:
<PRE
CLASS="SCREEN"
>"#!/bin/sh
IPT=/usr/sbin/iptables
TC=/sbin/tc
LAN=eth0
WAN=eth1
BURST="burst 30k"

stop ()
{
$IPT -t mangle -D FORWARD -i $WAN -j LIMITS &#62;/dev/null 2&#62;&#38;1
$IPT -t mangle -D FORWARD -o $WAN -j LIMITS &#62;/dev/null 2&#62;&#38;1
$IPT -t mangle -F LIMITS &#62;/dev/null 2&#62;&#38;1
$IPT -t mangle -X LIMITS &#62;/dev/null 2&#62;&#38;1
$IPT -t mangle -F OUTPUT
$IPT -t filter -F FORWARD
$TC qdisc del dev $LAN root 2&#62; /dev/null
$TC qdisc del dev $WAN root 2&#62; /dev/null
}

start ()
{
stop
$IPT -t mangle -N LIMITS
$IPT -t mangle -I FORWARD -i $WAN -j LIMITS
$IPT -t mangle -I FORWARD -o $WAN -j LIMITS
# incoming traffic
$IPT -t mangle -A OUTPUT -j MARK --set-mark 1
$TC qdisc add dev $LAN root handle 1:0 htb default 3 r2q 1
$TC class add dev $LAN parent 1:0 classid 1:1 htb rate 99000kbit ceil 99000kbit quantum 1500
$TC class add dev $LAN parent 1:1 classid 1:2 htb rate   500kbit ceil   500kbit
$TC class add dev $LAN parent 1:1 classid 1:3 htb rate 98500kbit ceil 98500kbit prio 9 quantum 1500
$TC qdisc add dev $LAN parent 1:3 esfq perturb 10 hash dst
# priorities for ICMP, TOS 0x10 and ports 22 and 53
$TC class add dev $LAN parent 1:2 classid 1:20 htb rate 50kbit ceil 500kbit $BURST prio 1 quantum 1500
$TC qdisc add dev $LAN parent 1:20 esfq perturb 10 hash dst
$TC filter add dev $LAN parent 1:0 protocol ip prio 2 u32 match ip sport 22 0xffff flowid 1:20
$TC filter add dev $LAN parent 1:0 protocol ip prio 2 u32 match ip sport 53 0xffff flowid 1:20
$TC filter add dev $LAN parent 1:0 protocol ip prio 1 u32 match ip tos 0x10 0xff flowid 1:20
$TC filter add dev $LAN parent 1:0 protocol ip prio 1 u32 match ip protocol 1 0xff flowid 1:20
# server -&#62; LAN
$TC filter add dev $LAN parent 1:0 protocol ip prio 4 handle 1 fw flowid 1:3

# outgoing traffic
$TC qdisc add dev $WAN root handle 2:0 htb default 11 r2q 1
$TC class add dev $WAN parent 2:0 classid 2:1 htb rate 120kbit ceil 120kbit
# priorities for ACK, ICMP, TOS 0x10, ports 22 and 53
$TC class add dev $WAN parent 2:1 classid 2:10 htb rate 60kbit ceil 120kbit prio 1 quantum 1500
$TC qdisc add dev $WAN parent 2:10 esfq perturb 10 hash dst
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip protocol 6 0xff \
match u8 0x05 0x0f at 0 match u16 0x0000 0xffc0 at 1 match u8 0x10 0xff at 33 flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip dport 22 0xffff flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip dport 53 0xffff flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip tos 0x10 0xff flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip protocol 1 0xff flowid 2:10
# server -&#62; Internet
$TC class add dev $WAN parent 2:1 classid 2:11 htb rate 30kbit ceil 120kbit prio 2 quantum 1500
$TC qdisc add dev $WAN parent 2:11 esfq perturb 10 hash dst
$TC filter add dev $WAN parent 2:0 protocol ip prio 3 handle 1 fw flowid 2:11
$TC filter add dev $WAN parent 2:0 protocol ip prio 9 u32 match ip dst 0/0 flowid 2:11</PRE
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>begin = "#!/bin/bash\n$TC=/usr/local/sbin/tc\n"</SAMP
></P
></LI
><LI
><P
>end</P
><P
>Script footer. Default:
<PRE
CLASS="SCREEN"
>}

case "$1" in
    'start')
     start
    ;;
    'stop')
     stop
    ;;
    'status')
     echo "WAN Interface"
     echo "============="
     $TC class show dev $WAN | grep root
     $TC class show dev $WAN | grep -v root | sort | nl
     echo "LAN Interface"
     echo "============="
     $TC class show dev $LAN | grep root
     $TC class show dev $LAN | grep -v root | sort | nl
    ;;
    *)
     echo -e "\nUsage: rc.htb start|stop|status"
    ;;
esac</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>end = ""</SAMP
></P
></LI
><LI
><P
>one_class_per_host</P
><P
>Specify htb class creation policy. By default all computers of customer
                   will be placed in one class. Setting it to 'true' will effect in that rules
                   specified in host_htb_up and host_htb_down will be generated for all customer's
                   computers (with different value of '%x'). Rules host_mark_down, host_mark_up,
                   host_plimit and host_climit are generated for each node regardless of this option
                   setting. Default: false</P
><P
>Example: <SAMP
CLASS="PROMPT"
>one_class_per_host = 1</SAMP
></P
></LI
><LI
><P
>host_mark_down</P
><P
>Mark rule for each offline computer. Default:
<PRE
CLASS="SCREEN"
># %n
$IPT -t mangle -A LIMITS -d %i -j MARK --set-mark %x</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>host_mark_down = ""</SAMP
></P
></LI
><LI
><P
>host_mark_up</P
><P
>Mark rule for each computer. Default:
<PRE
CLASS="SCREEN"
>$IPT -t mangle -A LIMITS -s %i -j MARK --set-mark %x</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>host_mark_up = ""</SAMP
></P
></LI
><LI
><P
>host_htb_down</P
><P
>Rules for each computer executed when uprate and downrate value
		   is above zero. Default:
<PRE
CLASS="SCREEN"
>$TC class add dev $LAN parent 1:2 classid 1:%x htb rate %downratekbit ceil %downceilkbit $BURST prio 2 quantum 1500
$TC qdisc add dev $LAN parent 1:%x esfq perturb 10 hash dst
$TC filter add dev $LAN parent 1:0 protocol ip prio 5 handle %x fw flowid 1:%x</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>host_htb_down = ""</SAMP
></P
></LI
><LI
><P
>host_htb_up</P
><P
>Rules for each computer executed when uprate and downrate value
		   is above zero. Default:
<PRE
CLASS="SCREEN"
>$TC class add dev $WAN parent 2:1 classid 2:%x htb rate %upratekbit ceil %upceilkbit $BURST prio 2 quantum 1500
$TC qdisc add dev $WAN parent 2:%x esfq perturb 10 hash dst
$TC filter add dev $WAN parent 2:0 protocol ip prio 5 handle %x fw flowid 2:%x</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>host_htb_up = ""</SAMP
></P
></LI
><LI
><P
>host_climit</P
><P
>Rule with simultaneous TCP connections limit. Executed
                   when climit value is above zero. Default:
<PRE
CLASS="SCREEN"
>$IPT -t filter -I FORWARD -p tcp -s %i -m connlimit --connlimit-above %climit -m ipp2p --ipp2p -j REJECT</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>host_climit = "$IPT -t filter -I FORWARD -p tcp -s %i -m connlimit --connlimit-above -j REJECT"</SAMP
></P
></LI
><LI
><P
>host_plimit</P
><P
>Rule with limiting of packets in time unit (here second). Executed
                   when plimit value is above zero. Default:
<PRE
CLASS="SCREEN"
>$IPT -t filter -I FORWARD -p tcp -d %i -m limit --limit %plimit/s -m ipp2p --ipp2p -j ACCEPT
$IPT -t filter -I FORWARD -p tcp -s %i -m limit --limit %plimit/s -m ipp2p --ipp2p -j ACCEPT</PRE
>
                   </P
><P
>Example: <SAMP
CLASS="PROMPT"
>host_plimit = ""</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of network names that should be included in configuration (case insensitive).
                   Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = "lan1 lan2"</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>List of customer groups that should be included in configuration (case insensitive).
                   Default: empty (all groups).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>usergroups = "group1 group2"</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-DNS"
>6.2.11. Dns</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="DNS-DESC"
>6.2.11.1. Description</A
></H4
><P
>Configuration of named zones. This is one of most complicated modules
              to setup. It creates zone files for each network and zone definition entries
              in named.conf on the basis of template files. Example templates are placed in
              <TT
CLASS="FILENAME"
>/modules/dns/sample</TT
> directory.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="DNS-CONFIG"
>6.2.11.2. Configuration</A
></H4
><P
></P
><UL
><LI
><P
>forward-patterns</P
><P
>Directory with zone templates. Default: forward.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>forward-patterns = /dns/patterns/forward</SAMP
></P
></LI
><LI
><P
>reverse-patterns</P
><P
>Directory with reverse zone templates. Default: reverse.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>reverse-patterns = /dns/patterns/revers</SAMP
></P
></LI
><LI
><P
>generic-forward</P
><P
>Default template. It will be used if directory specified by
                   'forward-patterns' doesn't contain a file with name corresponding to network
                   domain name. Default: modules/dns/sample/forward/generic.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>generic-forward = /dns/patterns/forward</SAMP
></P
></LI
><LI
><P
>generic-reverse</P
><P
>Default template. It will be used if directory specified by
                   'reverse-patterns' doesn't contain a file with name corresponding to network IP
                   address. Default: modules/dns/sample/reverse/generic.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>generic-reverse = /dns/patterns/forward</SAMP
></P
></LI
><LI
><P
>forward-zones</P
><P
>Directory for generated zone files.
                   Default: modules/dns/sample/out/forward.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>forward-zones = /dns/forward</SAMP
></P
></LI
><LI
><P
>reverse-zones</P
><P
>Directory for generated reverse zone files.
                   Default: modules/dns/sample/out/reverse.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>reverse-zones = /dns/reverse</SAMP
></P
></LI
><LI
><P
>host-reverse</P
><P
>Line in reverse zone file for each computer of given network.
                   Default: "%n IN A %i\n".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>host-reverse = "\t %n IN A %i\n"</SAMP
></P
></LI
><LI
><P
>host-forward</P
><P
>Line in zone file for each computer of given network.
                   Default: "%c IN PTR %n.%d.\n".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>host-forward = "\t %c IN PTR %n.%d.\n"</SAMP
></P
></LI
><LI
><P
>conf-pattern</P
><P
>Location of main template for server configuration file.
                   Default: modules/dns/sample/named.conf.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>conf-pattern = /dns/patterns/named.conf</SAMP
></P
></LI
><LI
><P
>conf-output</P
><P
>Location of main configuration file.
                   Default: /tmp/named.conf.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>conf-output = /etc/named.conf</SAMP
></P
></LI
><LI
><P
>conf-forward-entry</P
><P
>Entry for each zone in main configuration file.
		   Default: 'zone "%n" {\ntype master;\n file "forward/%n"; \nnotify yes; \n}; \n'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>conf-forward-entry = 'zone "%n" { \n\ttype master; \n\tfile "forward/%n"; \n\tnotify yes; \n}; \n'</SAMP
></P
></LI
><LI
><P
>conf-reverse-entry</P
><P
>Entry for each reverse zone in main configuration file.
                   Default: 'zone "%c.in-addr.arpa" { \ntype master; \nfile "reverse/%i"; \nnotify yes; \n}; \n'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>conf-revers-entry = 'zone "%c.in-addr.arpa" { \n\ttype master; \n\tfile "reverse/%i"; \n\tnotify yes; \n}; \n'</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command executed after files creation. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = "killall -HUP named"</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of network names that should be included in configuration (case insensitive).
                   Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = "lan1 lan2"</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>List of customer (user) groups that should be included in configuration (case insensitive).
                   Default: empty (all groups).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>usergroups = "group1 group2"</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-ETHERS"
>6.2.12. Ethers</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="ETHERS-DESC"
>6.2.12.1. Description</A
></H4
><P
>This module creates configuration for system ARP table. Setting option
              'dummy_macs' will put mac address 00:00:00:00:00:00 for all disconnected
              computers.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="ETHERS-CONFIG"
>6.2.12.2. Configuration</A
></H4
><P
>Basic options:</P
><UL
><LI
><P
>file</P
><P
>Location of output file. Default: /etc/ethers.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /tmp/ethers</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command to execute after config file creation. Default: 'arp -f /etc/ethers'.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = ""</SAMP
></P
></LI
><LI
><P
>dummy_macs</P
><P
>If you set to 'yes', disconnected computers will get
                   MAC '00:00:00:00:00:00'. Default: "no".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>dummy_macs = yes</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of network names that should be included in configuration (case insensitive).
                   Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = "lan1 lan2"</SAMP
></P
></LI
><LI
><P
>usergroups</P
><P
>List of customer groups names that should be included in configuration (case insensitive).
                   Default: empty (all groups).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>usergroups = "group1 group2"</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-OIDENT"
>6.2.13. Oident</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="OIDENT-DESC"
>6.2.13.1. Description</A
></H4
><P
>Module for oidentd configuration. Basically it can be created
              with hostfile module, but here you have ready-made default settings
	      for this purpose.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="OIDENT-CONFIG"
>6.2.13.2. Configuration</A
></H4
><P
>And here are the options of oident:</P
><UL
><LI
><P
>begin</P
><P
>Text inserted on the beginning of file. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>begin = "#Auto-generated\n"</SAMP
></P
></LI
><LI
><P
>end</P
><P
>Text inserted on the end of file. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>end = ""</SAMP
></P
></LI
><LI
><P
>host</P
><P
>Line of text for each of computers. Default: "%i\t%n\tUNIX".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>host = "%i %n WINDOWS"</SAMP
></P
></LI
><LI
><P
>file</P
><P
>Configuration file. Default: /etc/oidentd.conf.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /tmp/identd.conf</SAMP
></P
></LI
><LI
><P
>networks</P
><P
>List of networks. Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = 'lan1 lan2'</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command(s) to execute after file creation. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = "killall -HUP oidentd"</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-PINGER"
>6.2.14. Pinger</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="PINGER-DESC"
>6.2.14.1. Description</A
></H4
><P
>Module pinger is an equivalent of lms-fping Perl script, however it has some
              fundamental differences. It doesn't need external program to check hosts availability and
              work with use of ARP protocol and thus it can perform network scanning about 2 times faster.
              Also there are no problems with hosts with ping response disabled or firewalled. After
              scanning, last-seen time is set for all online hosts in database used to illustrate hosts
              activity on nodes list and network map.</P
><P
><DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Pinger for work use interface names, so (e.g. if you are
	      using <TT
CLASS="FILENAME"
>ip</TT
> command) you'll need to label interfaces in your system (ip addr add ... label ...). 
	      Also remember, don't use a dots or dashes in interface names (<TT
CLASS="FILENAME"
>ip</TT
> allows that, but
	      such a name is not usable for pinger).</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="PINGER-CONFIG"
>6.2.14.2. Configuration</A
></H4
><P
>Pinger has only one config option:</P
><UL
><LI
><P
>networks</P
><P
>List of network names. Default: empty (all networks).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>networks = 'lan1 lan2'</SAMP
></P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMON-PARSER"
>6.2.15. Parser</A
></H3
><DIV
CLASS="SECT3"
><H4
CLASS="SECT3"
><A
NAME="DAEMON-PARSER-INTRO"
>6.2.15.1. Introduction</A
></H4
><P
>Parser module is based on a scripting language
		<A
HREF="http://silvercoders.com/index.php?page=T_Script"
TARGET="_top"
>T-Script</A
> which 
		primary purpose is to generate text files. It can be useful for processing
		templates with some additional data retrieved from data sources 
		like SQL databases or text files. In lmsd's module contents of scripts
		are stored in database, so they can be edited via <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>.
		In the future parser should replace almost all lmsd modules.</P
><P
>T-Script language is described in section <A
HREF="#TSCRIPT"
>T-Script</A
>.</P
><P
>Before compilation ensure that you have in your system packages
		<TT
CLASS="FILENAME"
>bison</TT
> (at least 1.875 version) and <TT
CLASS="FILENAME"
>flex</TT
>.
		</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="DAEMON-PARSER-CONFIG"
>6.2.15.2. Configuration</A
></H4
><P
>Parser has following options:</P
><UL
><LI
><P
>script</P
><P
>Contents of script. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>script = '{var=1}variable var={var}'</SAMP
></P
></LI
><LI
><P
>file</P
><P
>Location of output file. Default: empty.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>file = /tmp/parser.out</SAMP
></P
></LI
><LI
><P
>command</P
><P
>Shell command to execute after script compilation. Default: empty</P
><P
>Example: <SAMP
CLASS="PROMPT"
>command = "sh /tmp/parser.out"</SAMP
></P
></LI
></UL
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="TSCRIPT"
>6.3. T-Script</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="TSCRIPT-INTRO"
>6.3.1. Introduction</A
></H3
><P
><A
HREF="http://silvercoders.com/index.php?page=T_Script"
TARGET="_top"
>T-Script</A
> 
	    is a scripting language which primary purpose is to generate text files. It can be 
	    useful for processing templates with some additional data retrieved from data 
	    sources like SQL databases or text files.</P
><P
>Before compilation ensure that you have in your system packages
	    <TT
CLASS="FILENAME"
>bison</TT
> (at least 1.875 version) and <TT
CLASS="FILENAME"
>flex</TT
>.
	    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TSCRIPT-SYNTAX"
>6.3.2. Syntax</A
></H3
><P
>T-Script language syntax is based on other popular languages like C 
	    or JavaScript with little changes made to make writting templates simpler. 
	    Additional commands should be written inside { } parenthesis. Data
	    outside curly brackets will be writed to output file (or ommited if file 
	    was not specified). All expressions, variables, commands, function names are
	    case-sensitive.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="EXPR"
>6.3.2.1. Expressions and operators</A
></H4
><UL
><LI
><P
>Literal inside quotes.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>"some literal"</SAMP
></P
></LI
><LI
><P
>Number.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>1234</SAMP
></P
></LI
><LI
><P
>Value of variable "var".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>var</SAMP
></P
></LI
><LI
><P
>N-th element of array "var".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>var[n]</SAMP
></P
></LI
><LI
><P
>Subvariable "n" of variable "var".</P
><P
>Example: <SAMP
CLASS="PROMPT"
>var.n</SAMP
></P
></LI
><LI
><P
>Value of expression inside parenthesis.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>( expression )</SAMP
></P
></LI
><LI
><P
>Null keyword. Prescribe not defined value. Useful for
		    checking that some value was or wasn't defined.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>variable = null</SAMP
></P
></LI
><LI
><P
>Comparisions. Returns logical result of expressions
		    comparision.</P
><P
>Example: 
<PRE
CLASS="SCREEN"
>expression1 == expression2
expression1 != expression2
expression1 &lt; expression2
expression1 &gt; expression2
expression1 &lt;= expression2
expression1 &gt;= expression2</PRE
></P
></LI
><LI
><P
>Binary operators. Sum and product.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression1 | expression2</SAMP
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression1 &#38; expression2</SAMP
></P
></LI
><LI
><P
>Logical operators.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression1 || expression2</SAMP
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression1 &#38;&#38; expression2</SAMP
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>! expression</SAMP
></P
></LI
><LI
><P
>Strings concatenation. When both expression values haven't numeric type 
			treats expressions as strings and performs string concatenation.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression1 + expression2</SAMP
></P
></LI
><LI
><P
>Arithmetic operators. Evaluates to result of arithmetic operation on two expression values.</P
><P
>Example: 
<PRE
CLASS="SCREEN"
>expression1 + expression2
expression1 - expression2
expression1 * expression2
expression1 / expression2
expression1 % expression2</PRE
></P
></LI
><LI
><P
>Single-argument incremental/decremental operators.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression++</SAMP
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression--</SAMP
></P
></LI
><LI
><P
>String comparision with regular expression. Evaluates to 1 if expression1 value match with regular expression2, else
		    0.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>expression1 =~ expression2</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="COMMENTS"
>6.3.2.2. Comments</A
></H4
><UL
><LI
><P
>C-style comment.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>/* this is a comment - it can be also multiline */</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="COMMANDS"
>6.3.2.3. Commands</A
></H4
><UL
><LI
><P
>Assignment. Assigns expression value to specified variable.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>variable = expression</SAMP
></P
></LI
><LI
><P
>Conditional statement. Executes command only if expression is true. Second form executes 
		    command1 if expression is true or command2 if expression is false.</P
><P
>Example:
<PRE
CLASS="SCREEN"
>if ( expression ) command /if
if ( expression ) commands1 else commands2 /if</PRE
></P
><P
>Text between command blocks is treated as a command so the following example is correct:
<PRE
CLASS="SCREEN"
>Some text 
{if (a==1)} 
a equals 1 
{else} 
a doesn't equal 1 
{/if} </PRE
>
You can put backslash between command block and end of line to eat \n 
symbol and keep normal text flow. For example: 
<PRE
CLASS="SCREEN"
>Some text 
{if (a==1)}\ 
a equals 1 
{else}\ 
a doesn't equal 1 
{/if}\</PRE
></P
></LI
><LI
><P
>Iterative loop. Executes first command1 as loop initialization command. Then executes 
		    commands and command2 while expression is true.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>for ( command1 ; expression ; command2 ) commands /for</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="FUNCTIONS"
>6.3.2.4. Functions</A
></H4
><P
>Functions have two calling forms: with brackets
		(<SAMP
CLASS="PROMPT"
>{function(var)}</SAMP
>) and without brackets
		(<SAMP
CLASS="PROMPT"
>{function {var}}</SAMP
>).
	    <UL
><LI
><P
><SAMP
CLASS="PROMPT"
>string(number)</SAMP
></P
><P
>Converts numeric variable to string value.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>string(var)</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>number(string)</SAMP
></P
><P
>Converts string variable to numeric value. For arrays returns number of items in array.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>number(var)</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>typeof(variable)</SAMP
></P
><P
>Type checking. Returns type name of variable, e.g. string, 
			number, array, null.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>typeof(var)</SAMP
></P
></LI
></UL
>
		In script above functions can be used like that:
<PRE
CLASS="SCREEN"
>{x = 5}x = {x}
{var = "3"}var = {var}
x + var = {x + var}
x + var = {number(var) + x}
x + var = {string(x) + var}
x is type of {typeof(x)}
var is type of {typeof(var)}</PRE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="EXTENSIONS"
>6.3.3. Extensions</A
></H3
><P
>Extensions are <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>tscript</I
></SPAN
> library supplements. 
		That are functions and predefined variables (constants), wich can be used 
		in scripts.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="EXEC"
>6.3.3.1. Exec</A
></H4
><P
>Shell commands execution is possible with <SAMP
CLASS="PROMPT"
>exec()</SAMP
>. 
		    You can run many commands separated by semicolons in one function 
		    call.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>exec(commands)</SAMP
></P
><P
>Shell commands execution.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>exec("rm -f /")</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="STRING"
>6.3.3.2. String</A
></H4
><P
><SAMP
CLASS="PROMPT"
>String</SAMP
> consists basic functions for strings operations.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>trim(string)</SAMP
></P
><P
>Deleting of whitespace signs from the beginning and the end 
			    of string.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>trim("   aaa   ")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>replace(pattern, replacement, string)</SAMP
></P
><P
>This function scans string for matches to pattern, then replaces 
				the matched text with replacement. Pattern can be a regular expression.
				</P
><P
>Example: <SAMP
CLASS="PROMPT"
>replace(":", "-", mac)</SAMP
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>replace("[a-z]", "-", "Text")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>explode(separator, string)</SAMP
></P
><P
>Returns an array of strings, each of which is a substring
				of string formed by splitting it on boundaries formed by 
				separator. Separator can be a string or POSIX's regural expression.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>explode(":", "aaa:bbb:ccc")</SAMP
></P
><P
>Example: <SAMP
CLASS="PROMPT"
>explode("[ ]+", "aaa bbb ccc")</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="SYSINFO"
>6.3.3.3. Sysinfo</A
></H4
><P
>Extension with name <SAMP
CLASS="PROMPT"
>Sysinfo</SAMP
> consist functions 
			for retriving data from system.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>date([format_string])</SAMP
></P
><P
>Current date and time formated according to
					the format specification. Default format is '%Y/%m/%d'. 
					Conversion specifiers are introduced by a '%' character 
					You can read about all of them in <SAMP
CLASS="PROMPT"
>`man 
					strftime`</SAMP
>.</P
><P
>Returned object consist predefined subvariables
					<SAMP
CLASS="PROMPT"
>year</SAMP
>, <SAMP
CLASS="PROMPT"
>month</SAMP
>, <SAMP
CLASS="PROMPT"
>day</SAMP
>,
					<SAMP
CLASS="PROMPT"
>hour</SAMP
>, <SAMP
CLASS="PROMPT"
>minute</SAMP
>, <SAMP
CLASS="PROMPT"
>second</SAMP
>.</P
><P
>Example: 
<PRE
CLASS="SCREEN"
>{date("%s") /* returns current unix timestamp */}
{t = date()}
{t.month /* returns current month number */}</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>systype</SAMP
></P
><P
>System type constant. Returns "unix" or "win32"
					according to system where program's working.</P
><P
>Example:
<PRE
CLASS="SCREEN"
>{if (systype == "unix")}\
{exec echo executing command}\
{else}\
no shell
{/if}\</PRE
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="FILE"
>6.3.3.4. File</A
></H4
><P
>This extension is destined for basic file operations.
				<UL
><LI
><P
><SAMP
CLASS="PROMPT"
>file(filename)</SAMP
></P
><P
>Script output redirection. Redirects script output 
						to file. Data will be appended to specified file.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>{file file_name} commands {/file}</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>fileexists(filename)</SAMP
></P
><P
>If file exists returns 1, else 0.</P
><P
>Example: <PRE
CLASS="SCREEN"
>{if fileexists(file)}{deletefile(file)}{/if}</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>deletefile(filename)</SAMP
></P
><P
>File deletion.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>deletefile("/tmp/file.txt")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>readfile(filename)</SAMP
></P
><P
>Creates array where every element is separated
						line of file.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>readfile("/tmp/file.txt")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>getfile(filename)</SAMP
></P
><P
>Returns file contents.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>getfile("/tmp/file.txt")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>listdir(directory)</SAMP
></P
><P
>Returns list of files (and subdirectories) 
						in array. Every element contains subvariable 'size'
						with file size in bytes.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>listdir("/home/alec")</SAMP
></P
></LI
></UL
>
				Listing below presents example script with use of all file functions.
<PRE
CLASS="SCREEN"
>{list = listdir("/home/alec/lms/doc")}
{for (x = 0; x &lt; number(list); x++) }\
{list[x]}--{list[x].size}
{/for}\
{file "/home/alec/file.txt"}
Line 1
Line 2
{/file}\
{f = readfile /home/alec/file.txt}\
{for (i = 0; i &lt; number(f); i++) }\
line {i}: {f[i]}\
{/for}\
{f = getfile /home/alec/file.txt}\
{f}
{deletefile /home/alec/file.txt}\</PRE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="NET"
>6.3.3.5. Net</A
></H4
><P
>In this extension are included two functions (with lowercase names)
				destined to IP addresses and subnet masks operations.</P
><UL
><LI
><P
><SAMP
CLASS="PROMPT"
>mask2prefix(mask_string)</SAMP
></P
><P
>Returns number of bits in subnet mask.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>mask2prefix("255.255.255.0")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>ip2long(address_string)</SAMP
></P
><P
>Changes octal IP address to long number.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>ip2long("192.168.0.1")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>long2ip(number)</SAMP
></P
><P
>Changes long number to IP address octal format (xxx.xxx.xxx.xxx).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>long2ip(variable)</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>broadcast(address_string, mask_string)</SAMP
></P
><P
>Calculates broadcast address from specified IP address and
						mask (any mask format).</P
><P
>Example: <SAMP
CLASS="PROMPT"
>broadcast("192.168.0.1", "255.255.255.0")</SAMP
></P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="SQL"
>6.3.3.6. SQL</A
></H4
><P
>SQL extension implements functions for database operations.
		    Allows to run SQL commands.</P
><UL
><LI
><P
>SQL commands: <SAMP
CLASS="PROMPT"
>SELECT</SAMP
>, 
				<SAMP
CLASS="PROMPT"
>INSERT</SAMP
>, <SAMP
CLASS="PROMPT"
>DELETE</SAMP
>, 
				<SAMP
CLASS="PROMPT"
>UPDATE</SAMP
>, <SAMP
CLASS="PROMPT"
>CREATE</SAMP
>, 
				<SAMP
CLASS="PROMPT"
>DROP</SAMP
>.</P
><P
>Example:
<PRE
CLASS="SCREEN"
>{SELECT * FROM table}
{INSERT INTO table VALUES(1)}
{DELETE FROM table}
{UPDATE table SET column=1}
{CREATE TABLE foo (bar integer) }
{DROP TABLE foo}</PRE
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>rows(sql_query)</SAMP
></P
><P
>Returns SQL result rows count. Use it for non-select commands.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>rows("SELECT * FROM table")</SAMP
></P
></LI
><LI
><P
><SAMP
CLASS="PROMPT"
>escape(string)</SAMP
></P
><P
>Escapes a string for use within an SQL commands.</P
><P
>Example: <SAMP
CLASS="PROMPT"
>SELECT * FROM table WHERE name={escape(variable)}</SAMP
></P
></LI
></UL
><P
>Extension closely connected with LMS. Makes possible to
		    create scripts without of LMS's database structure knowledge.
		    Contains predefined constants, which consists data from database.
		    Query defined in program is executed when constant is used first
		    time. Constants names are uppercase. Each constant is an array
		    with rows indexed starting from zero, and each row consist
		    subvariables accessible by name (lowercase).</P
><UL
><LI
><P
>CUSTOMERS - customers list:
			    <TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - customer ID</TD
></TR
><TR
><TD
>lastname - customer lastname</TD
></TR
><TR
><TD
>name - customer name</TD
></TR
><TR
><TD
>status - status</TD
></TR
><TR
><TD
>address - address</TD
></TR
><TR
><TD
>zip - postal code</TD
></TR
><TR
><TD
>city - city</TD
></TR
><TR
><TD
>email - email address</TD
></TR
><TR
><TD
>phone1, phone2, phone3 - phone numbers</TD
></TR
><TR
><TD
>ten - tax exempt number</TD
></TR
><TR
><TD
>ssn - security serial number</TD
></TR
><TR
><TD
>info - additional informations</TD
></TR
><TR
><TD
>message - warning contents</TD
></TR
><TR
><TD
>warning - warning status (status of all customer's nodes summary)</TD
></TR
><TR
><TD
>access - accessibility status (status of all customer's nodes summary)</TD
></TR
><TR
><TD
>balance - customer's balance</TD
></TR
></TBODY
></TABLE
>
			</P
></LI
><LI
><P
>NODES - nodes list (and network devices addresses):
			    <TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - node ID</TD
></TR
><TR
><TD
>owner - customer name and lastname</TD
></TR
><TR
><TD
>ownerid - customer ID ('0' for devices)</TD
></TR
><TR
><TD
>name - node (device's address) name</TD
></TR
><TR
><TD
>access - status: connected/disconnected (1/0)</TD
></TR
><TR
><TD
>warning - warnings status: enabled/disabled (1/0)</TD
></TR
><TR
><TD
>netdev - device ID, to which is connected</TD
></TR
><TR
><TD
>lastonline - last activity timestamp</TD
></TR
><TR
><TD
>info - additional informations</TD
></TR
><TR
><TD
>message - warning message contents</TD
></TR
><TR
><TD
>mac - MAC address</TD
></TR
><TR
><TD
>passwd - password</TD
></TR
><TR
><TD
>ip - IP address</TD
></TR
><TR
><TD
>ip_pub - public IP address</TD
></TR
><TR
><TD
>linktype - connection type (0-cable, 1-air)</TD
></TR
></TBODY
></TABLE
>
			</P
></LI
><LI
><P
>NETWORKS - networks list:
			    <TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - network ID</TD
></TR
><TR
><TD
>name - network name</TD
></TR
><TR
><TD
>address - IP address</TD
></TR
><TR
><TD
>mask - subnet mask (xxx.xxx.xxx.xxx)</TD
></TR
><TR
><TD
>prefix - number of bits in mask</TD
></TR
><TR
><TD
>size - network size (number of addresses)</TD
></TR
><TR
><TD
>interface - interface name</TD
></TR
><TR
><TD
>gateway - gateway address</TD
></TR
><TR
><TD
>dns - primary DNS server</TD
></TR
><TR
><TD
>dns2 - secondary DNS server</TD
></TR
><TR
><TD
>wins - WINS server</TD
></TR
><TR
><TD
>domain - domain name</TD
></TR
><TR
><TD
>dhcpstart - start of DHCP range</TD
></TR
><TR
><TD
>dhcpend - end of DHCP range</TD
></TR
></TBODY
></TABLE
>
			    </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="EXAMPLES"
>6.3.4. Example Scripts</A
></H3
><P
>Let's begin from simple script creating file <TT
CLASS="FILENAME"
>/etc/hosts</TT
>
	    with list of computers (and devices) IPs and names list. 
	    <DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-HOSTS"
></A
><P
><B
>Example 6-1. Parser: Creating /etc/hosts file</B
></P
><PRE
CLASS="SCREEN"
>{result = SELECT name, inet_ntoa(ipaddr) AS ip FROM nodes}\
127.0.0.1	localhost
{for (r=0; r&lt;number(result); r++)}\
{result[r].name}\t{result[r].ip}
{/for}\</PRE
></DIV
></P
><P
>How to create debtors list? It's easy with use of predefined 
	    constants.
	    <DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-DEBTORS"
></A
><P
><B
>Example 6-2. Parser: Debtors list</B
></P
><PRE
CLASS="SCREEN"
>{
for (r=0; r&lt;number(CUSTOMERS); r++)
    if (CUSTOMERS[r].balance &#60; 0)
}\
{CUSTOMERS[r].lastname} {CUSTOMERS[r].name}\t{CUSTOMERS[r].balance}
{
    /if
/for
}\</PRE
></DIV
>
	    </P
><P
>In next example we're create file with hosts ethernet hardware addresses to 
		IP addresses mappings, used by <TT
CLASS="FILENAME"
>arp</TT
> program. Hosts with no
		access gets dummy MACs.
		    <DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-ETHERS"
></A
><P
><B
>Example 6-3. Parser: Ethers file for arp</B
></P
><PRE
CLASS="SCREEN"
>{if(number(NODES))}\
{       if(fileexists("/etc/ethers"))}\
{               deletefile("/etc/ethers")}\
{       /if}\ 
{       for (i=0; i&lt;number(NODES); i++)}\
{               if (number(NODES[i].access))}\
{                       nodes[i].mac}\t{NODES[i].ip}
{               else}\
{                      }00:00:00:00:00:00\t{NODES[i].ip}
{               /if}\
{      /for}\
{/if}\</PRE
></DIV
>
	    </P
><P
>Next example is longer. Here we are using especially 'exec'.
	    Script sends e-mails to customers with balance less than specified limit.	    
	    <DIV
CLASS="EXAMPLE"
><A
NAME="TSCRIPT-EXAMPLE-NOTIFY"
></A
><P
><B
>Example 6-4. Parser: Notify module replacement</B
></P
><PRE
CLASS="SCREEN"
>{limit = 0}
{dt = date()}
{customers = SELECT customers.id AS id, email, pin, name, lastname,
        SUM((type * -2 +7) * cash.value) AS balance
        FROM customers
        LEFT JOIN cash ON customers.id = cash.customerid AND (cash.type = 3 OR cash.type = 4)
        WHERE deleted = 0 AND email!=''
        GROUP BY customers.id, name, lastname, email, pin
        HAVING SUM((type * -2 +7) * cash.value) &lt; {limit}}

{for(i=0; i&lt;number(customers); i++)}

    {exec echo "NOTE: This message has been generated automatically.

We kindly remind that you have debt on your internet service provide account
for the amount of $ {customers[i].balance}.

If you have already regulated your subscription fees for current month, that
is {dt.month} {dt.year}, please just skip this message.

If you think this message was sent to you in error, please contact our
customer service representative.

All information about payments could be also found at:
http://bigpro.com/myAccount/

If you want to regulate your account status, please contact our accountant:

Aldfert Rule
phone: 0-509031337
e-mail: alde@staff.bigpro.com

PS. Last 10 operations on your account has been attached below for your
convenience.
--------------+--------------+-----------------------------
     Date     |    Value     |           Comment
--------------+--------------+-----------------------------" &gt; /tmp/mail}

    {last10 = SELECT comment, time, CASE WHEN type=4 THEN value*-1 ELSE value END AS value
            FROM cash WHERE customerid = {customers[i].id}
            ORDER BY time DESC LIMIT 10}
    
    {for(j=0; j&lt;number(last10); j++)}
    
        {exec echo "{last10[j].time}|\t{last10[j].value}|\t{last10[j].comment}" &gt;&gt; /tmp/mail}
    
    {/for}

    {exec mail -s "Liabilities information" -r lms@domain.tld {customers[i].email} &lt; /tmp/mail}

{/for}</PRE
></DIV
>
	    </P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="DEVEL"
></A
>Chapter 7. For curious</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="DEVEL-CATALOGS"
>7.1. Directory tree</A
></H2
><DIV
CLASS="TABLE"
><A
NAME="CATALOG-TREE"
></A
><P
><B
>Table 7-1. LMS directory tree</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="200"
ALIGN="CENTER"><COL
WIDTH="300"
ALIGN="CENTER"><THEAD
><TR
><TH
>Name</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>backups</TD
><TD
>Backup copies of LMS database</TD
></TR
><TR
><TD
>bin</TD
><TD
>Executable lms-* Perl scripts</TD
></TR
><TR
><TD
>contrib</TD
><TD
>LMS user's contributions</TD
></TR
><TR
><TD
>daemon</TD
><TD
>A.L.E.C's LMS Daemon</TD
></TR
><TR
><TD
>devel</TD
><TD
>Developers' scripts to build LMS package</TD
></TR
><TR
><TD
>doc</TD
><TD
>LMS Documentation</TD
></TR
><TR
><TD
>documents</TD
><TD
>Documents archive</TD
></TR
><TR
><TD
>img</TD
><TD
>User Interface Images</TD
></TR
><TR
><TD
>lib</TD
><TD
>Set of LMS and Smarty libraries</TD
></TR
><TR
><TD
>modules</TD
><TD
>User Interface Modules</TD
></TR
><TR
><TD
>sample</TD
><TD
>Sample scripts, configs and additions</TD
></TR
><TR
><TD
>templates</TD
><TD
>User Interface Theme</TD
></TR
><TR
><TD
>templates_c</TD
><TD
>Smarty Theme compilation directory</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="DEVEL-DB"
>7.2. Database structure</A
></H2
><P
>Simple database layout is provided below. For more details (data types, fields restrictions and default values) please refer to <A
HREF="../lms.mysql"
TARGET="_top"
><TT
CLASS="FILENAME"
>lms.mysql</TT
></A
>, <A
HREF="../lms.pgsql"
TARGET="_top"
><TT
CLASS="FILENAME"
>lms.pgsql</TT
></A
> in <TT
CLASS="FILENAME"
>doc/</TT
> directory.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="USERS"
>7.2.1. LMS users ('users')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>login - login</TD
></TR
><TR
><TD
>name - first and last name</TD
></TR
><TR
><TD
>email - user's email address</TD
></TR
><TR
><TD
>rights - binary access rights</TD
></TR
><TR
><TD
>hosts - list of hosts allowed to login</TD
></TR
><TR
><TD
>passwd - password to login</TD
></TR
><TR
><TD
>lastlogindate - date of last login</TD
></TR
><TR
><TD
>lastloginip - IP of last login</TD
></TR
><TR
><TD
>failedlogindate - date of last failed login attempt</TD
></TR
><TR
><TD
>failedloginip - IP of last failed login attempt</TD
></TR
><TR
><TD
>deleted - if is deleted boolean (0/1)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CUSTOMERS"
>7.2.2. Customers ('customers')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>lastname - last/company name</TD
></TR
><TR
><TD
>name - first name</TD
></TR
><TR
><TD
>status - customer status (3-connected, 2-awaiting, 1-prospect)</TD
></TR
><TR
><TD
>email - email address</TD
></TR
><TR
><TD
>phone1 - phone</TD
></TR
><TR
><TD
>phone2 - phone</TD
></TR
><TR
><TD
>phone3 - phone</TD
></TR
><TR
><TD
>im - internet messenger (gadu-gadu) serial number</TD
></TR
><TR
><TD
>pin - pin number (for authentication)</TD
></TR
><TR
><TD
>address - street address (street, apartment, flat, etc)</TD
></TR
><TR
><TD
>zip - zip code</TD
></TR
><TR
><TD
>city - location (city)</TD
></TR
><TR
><TD
>ten - tax exempt number</TD
></TR
><TR
><TD
>ssn - social security number</TD
></TR
><TR
><TD
>info - additional informations</TD
></TR
><TR
><TD
>serviceaddr - correspondence address</TD
></TR
><TR
><TD
>creationdate - record creation date</TD
></TR
><TR
><TD
>moddate - record modification date</TD
></TR
><TR
><TD
>creatorid - serial of LMS user who created this record</TD
></TR
><TR
><TD
>modid - serial of LMS user last modification this record</TD
></TR
><TR
><TD
>deleted - if is deleted from database boolean (0/1)</TD
></TR
><TR
><TD
>message - message to be displayed if warnings enabled</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CUSTOMERGROUPS"
>7.2.3. Customer groups ('customergroups')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - group name</TD
></TR
><TR
><TD
>description - group description</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CUSTOMERASSIGNMENTS"
>7.2.4. Customer groups - continued... ('customerassignments')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>customergroupid - group serial number</TD
></TR
><TR
><TD
>customerid - customer serial number</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="NETWORKS"
>7.2.5. Networks ('networks')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - network name</TD
></TR
><TR
><TD
>address - IP address</TD
></TR
><TR
><TD
>mask - network mask</TD
></TR
><TR
><TD
>interface - network interface (eg. eth1)</TD
></TR
><TR
><TD
>gateway - gateway IP address</TD
></TR
><TR
><TD
>dns - IP address of dns server</TD
></TR
><TR
><TD
>dns2 - IP address of secondary dns server</TD
></TR
><TR
><TD
>domain - domain of the network</TD
></TR
><TR
><TD
>wins - WINS server address</TD
></TR
><TR
><TD
>dhcpstart - first address of dynamic DHCP range</TD
></TR
><TR
><TD
>dhcpend - last address of dynamic DHCP range</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="NODES"
>7.2.6. Computers and network devices ('nodes')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - device name</TD
></TR
><TR
><TD
>mac - MAC address</TD
></TR
><TR
><TD
>ipaddr - IP address</TD
></TR
><TR
><TD
>passwd - computer password for radius/pppoe login</TD
></TR
><TR
><TD
>ownerid - serial number of the owner ('0' if network device)</TD
></TR
><TR
><TD
>creationdate - creation timestamp</TD
></TR
><TR
><TD
>moddate - last modification timestamp</TD
></TR
><TR
><TD
>creatorid - creator's serial number</TD
></TR
><TR
><TD
>modid - modifier's serial number</TD
></TR
><TR
><TD
>netdev - serial number of connected network device</TD
></TR
><TR
><TD
>linktype - type of connection (0-cable, 1-wireless)</TD
></TR
><TR
><TD
>access - connected/disconnected (cutoff) (1/0)</TD
></TR
><TR
><TD
>warning - should be warned with administration message? (1/0)</TD
></TR
><TR
><TD
>lastonline - last network activity timestamp</TD
></TR
><TR
><TD
>info - additional information</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="NETDEVICES"
>7.2.7. Network devices - continued... ('netdevices')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - name</TD
></TR
><TR
><TD
>location - physical location</TD
></TR
><TR
><TD
>description - device summary</TD
></TR
><TR
><TD
>producer - manufacturer's name</TD
></TR
><TR
><TD
>model - model number</TD
></TR
><TR
><TD
>serialnumber - products serial number (not DB identifier)</TD
></TR
><TR
><TD
>ports - number of connections available</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="NETLINKS"
>7.2.8. Network connections ('netlinks')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>src - connection's beginning</TD
></TR
><TR
><TD
>dst- connection's end</TD
></TR
><TR
><TD
>type - type of connection (0-cable, 1-wireless)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CASH"
>7.2.9. Financial operations ('cash')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>time - timestamp of operation</TD
></TR
><TR
><TD
>userid - LMS user id</TD
></TR
><TR
><TD
>type - type of operation (income, expenditure, payment, debt)</TD
></TR
><TR
><TD
>value - amount in dollars</TD
></TR
><TR
><TD
>taxid - tax rate identifier</TD
></TR
><TR
><TD
>customerid - customer's serial number ('0' - does not apply)</TD
></TR
><TR
><TD
>docid - serial number for document (e.g. invoice) related to this operation</TD
></TR
><TR
><TD
>itemid - document item identifier</TD
></TR
><TR
><TD
>comment - description of operation</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CASHIMPORT"
>7.2.10. Import of financial operations ('cashimport')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>date - timestamp of operation</TD
></TR
><TR
><TD
>customer - customer data</TD
></TR
><TR
><TD
>value - amount</TD
></TR
><TR
><TD
>taxid - tax rate identifier</TD
></TR
><TR
><TD
>customerid - customer's serial number</TD
></TR
><TR
><TD
>description - operation description</TD
></TR
><TR
><TD
>hash - unique operation identifier</TD
></TR
><TR
><TD
>closed - yes (1), if operation was moved to cash table</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TARIFFS"
>7.2.11. Subscription fees ('tariffs')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - subscription name</TD
></TR
><TR
><TD
>value - amount</TD
></TR
><TR
><TD
>taxid - tax rate identifier</TD
></TR
><TR
><TD
>prodid - product/service classification number</TD
></TR
><TR
><TD
>uprate - upload warranty</TD
></TR
><TR
><TD
>upceil - upload boundary</TD
></TR
><TR
><TD
>downrate - download warranty</TD
></TR
><TR
><TD
>downceil - download boundary</TD
></TR
><TR
><TD
>climit - limit of concurrent connections</TD
></TR
><TR
><TD
>plimit - limit of packets per second</TD
></TR
><TR
><TD
>description - description for subscription</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="PAYMENTS"
>7.2.12. Solid payments ('payments')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - name</TD
></TR
><TR
><TD
>value - amount</TD
></TR
><TR
><TD
>creditor - creditor name</TD
></TR
><TR
><TD
>period - interval of operation: daily/weekly/monthly/quarterly/annually (1/2/3/4/5)</TD
></TR
><TR
><TD
>at - pay day</TD
></TR
><TR
><TD
>description - description for payment</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ASSIGNMENTS"
>7.2.13. Financial assignments ('assignments')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>tariffid - subscription serial number</TD
></TR
><TR
><TD
>customerid - customer serial number</TD
></TR
><TR
><TD
>period - interval of operation: daily/weekly/monthly/quarterly/annually (1/2/3/4/5)</TD
></TR
><TR
><TD
>at - pay day</TD
></TR
><TR
><TD
>datefrom - start date for assignment</TD
></TR
><TR
><TD
>dateto - end date for assignment</TD
></TR
><TR
><TD
>invoice - invoice writeout? (1 - yes, 0 - no)</TD
></TR
><TR
><TD
>discount - discount percentage</TD
></TR
><TR
><TD
>suspended - is this payment suspended? (1 - yes, 0 - no)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TAXES"
>7.2.14. Tax rates ('taxes')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>value - tax value</TD
></TR
><TR
><TD
>taxed - "is taxed" flag</TD
></TR
><TR
><TD
>label - rate label</TD
></TR
><TR
><TD
>validfrom - binding period start</TD
></TR
><TR
><TD
>validto - binding period end</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="NUMBERPLANS"
>7.2.15. Documents numbering plans ('numberplans')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>template - number template (pattern)</TD
></TR
><TR
><TD
>period - numbering time span: day/week/month/quarter/year</TD
></TR
><TR
><TD
>doctype - document type</TD
></TR
><TR
><TD
>isdefault - '1' if this plan is default for respondent doctype, else '0'</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DOCUMENTS"
>7.2.16. Documents: invoices, receipts, contracts, etc. ('documents')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>number - number in year</TD
></TR
><TR
><TD
>numberplanid - numbering plan identifier</TD
></TR
><TR
><TD
>type - document type (1 - invoice, 2 - cash receipt)</TD
></TR
><TR
><TD
>cdate - date of write out</TD
></TR
><TR
><TD
>paytime - deadline in days</TD
></TR
><TR
><TD
>paytype - payment method (cash/transfer/etc.)</TD
></TR
><TR
><TD
>customerid - customer (buyer) serial number</TD
></TR
><TR
><TD
>userid - user serial number</TD
></TR
><TR
><TD
>name - name of customer</TD
></TR
><TR
><TD
>address - address of customer</TD
></TR
><TR
><TD
>ssn - SSN of customer</TD
></TR
><TR
><TD
>ten - Tax Exempt Number of customer</TD
></TR
><TR
><TD
>zip - zip code of customer</TD
></TR
><TR
><TD
>city - location of customer</TD
></TR
><TR
><TD
>closed - is document (invoice) closed (accounted)? (0/1)</TD
></TR
><TR
><TD
>reference - document ID reference</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DOCUMENTCONTENTS"
>7.2.17. Non-financial documents contents ('documentcontents')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>docid - document serial number</TD
></TR
><TR
><TD
>title - document title</TD
></TR
><TR
><TD
>fromdate - start of binding period</TD
></TR
><TR
><TD
>todate - end of binding period</TD
></TR
><TR
><TD
>filename - document file name</TD
></TR
><TR
><TD
>contenttype - file type</TD
></TR
><TR
><TD
>md5sum - file md5 sum</TD
></TR
><TR
><TD
>description - additional informations</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INVOICECONTENTS"
>7.2.18. Invoices ('invoicecontents')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>docid - invoice serial number</TD
></TR
><TR
><TD
>itemid - invoice item identifier</TD
></TR
><TR
><TD
>value - amount</TD
></TR
><TR
><TD
>taxid - tax rate identifier</TD
></TR
><TR
><TD
>prodid - product/service classification number</TD
></TR
><TR
><TD
>content - used unit (usually 'pc.')</TD
></TR
><TR
><TD
>count - unit count</TD
></TR
><TR
><TD
>description - description for invoice</TD
></TR
><TR
><TD
>tariffid - subscription serial number</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="RECEIPTCONTENTS"
>7.2.19. Cash Receipts ('receiptcontents')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>docid - receipt serial number</TD
></TR
><TR
><TD
>itemid - receipt item identifier</TD
></TR
><TR
><TD
>value - amount</TD
></TR
><TR
><TD
>description - description for receipt item</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="PASSWD"
>7.2.20. Accounts ('passwd')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>ownerid - customer serial number (0 - "system" account)</TD
></TR
><TR
><TD
>login - login name</TD
></TR
><TR
><TD
>password - password encrypted with crypt()</TD
></TR
><TR
><TD
>realname - additional name</TD
></TR
><TR
><TD
>lastlogin - last login date</TD
></TR
><TR
><TD
>uid - account system UID (usually ownerid+200)</TD
></TR
><TR
><TD
>home - account home directory</TD
></TR
><TR
><TD
>type - account type (binary sum: 1-shell, 2-email, 4-www, 8-ftp)</TD
></TR
><TR
><TD
>expdate - account expire date</TD
></TR
><TR
><TD
>domainid - domain serial number</TD
></TR
><TR
><TD
>createtime - account creation date</TD
></TR
><TR
><TD
>quota_sh - shell space limits</TD
></TR
><TR
><TD
>quota_mail - email space limits</TD
></TR
><TR
><TD
>quota_www - www space limits</TD
></TR
><TR
><TD
>quota_ftp - ftp space limits</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DOMAINS"
>7.2.21. Domains ('domains')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - domain name</TD
></TR
><TR
><TD
>description - comments</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="ALIASES"
>7.2.22. Aliases ('aliases')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>login - account name (without domain)</TD
></TR
><TR
><TD
>accountid - account serial number</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="TIMESTAMPS"
>7.2.23. History ('timestamps')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>time - last modified timestamp</TD
></TR
><TR
><TD
>tablename - name of modified table</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="STATS"
>7.2.24. Bandwidth consumption statistics ('stats')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>nodeid - node serial number</TD
></TR
><TR
><TD
>dt - timestamp</TD
></TR
><TR
><TD
>upload - number of bytes sent</TD
></TR
><TR
><TD
>download - number of bytes received</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="RTQUEUES"
>7.2.25. Helpdesk - Request Tracking ('rtqueues')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>name - queue name</TD
></TR
><TR
><TD
>email - email account for the queue</TD
></TR
><TR
><TD
>description - main description for the queue</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="RTTICKETS"
>7.2.26. Helpdesk - Request Tracking - continued... ('rttickets')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>queueid - queue serial number</TD
></TR
><TR
><TD
>requestor - reporter name and email</TD
></TR
><TR
><TD
>customerid - customer serial number (if reported by customer)</TD
></TR
><TR
><TD
>subject - ticket name)</TD
></TR
><TR
><TD
>state - status (0-new, 1-open, 2-resolved, 3-dead)</TD
></TR
><TR
><TD
>owner - LMS user serial number (ticket owner)</TD
></TR
><TR
><TD
>createtime - timestamp of report</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="RTMESSAGES"
>7.2.27. Helpdesk - Request Tracking - continued... ('rtmessages')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>ticketid - ticket serial number</TD
></TR
><TR
><TD
>userid - LMS user serial number (if ticket sender)</TD
></TR
><TR
><TD
>customerid - customer serial number (if ticket sender)</TD
></TR
><TR
><TD
>mailfrom - sender email</TD
></TR
><TR
><TD
>subject - message subject</TD
></TR
><TR
><TD
>messageid - Message-ID message header</TD
></TR
><TR
><TD
>inreplyto - thread serial number (if threaded)</TD
></TR
><TR
><TD
>replyto - Reply-To message header</TD
></TR
><TR
><TD
>headers - all message headers</TD
></TR
><TR
><TD
>body - content of message body</TD
></TR
><TR
><TD
>createtime - date of creation/send/delivery </TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="RTATTACHMENTS"
>7.2.28. Helpdesk - Request Tracking - continued... ('rtattachments')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>messageid - message serial number</TD
></TR
><TR
><TD
>filename - name of file attachment</TD
></TR
><TR
><TD
>contenttype - type of file</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="RTRIGHTS"
>7.2.29. Helpdesk - Request Tracking - continued... ('rtrights')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>queueid - queue serial number </TD
></TR
><TR
><TD
>userid - LMS user serial number</TD
></TR
><TR
><TD
>rights - permissions (1-read, 2-write)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="UICONFIG"
>7.2.30. LMS-UI Online Configuration ('uiconfig')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - serial number</TD
></TR
><TR
><TD
>section - config section name</TD
></TR
><TR
><TD
>var - config variable name</TD
></TR
><TR
><TD
>value - config variable value</TD
></TR
><TR
><TD
>description - option description or comment</TD
></TR
><TR
><TD
>disabled - is option disabled? (0-active, 1-disabled/default)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="EVENTS"
>7.2.31. Timetable - events ('events')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - identifier</TD
></TR
><TR
><TD
>title - title</TD
></TR
><TR
><TD
>description - info</TD
></TR
><TR
><TD
>note - note</TD
></TR
><TR
><TD
>date - event date</TD
></TR
><TR
><TD
>begintime - beginning of event</TD
></TR
><TR
><TD
>endtime - end of event</TD
></TR
><TR
><TD
>userid - event creator ID</TD
></TR
><TR
><TD
>customerid - customer ID</TD
></TR
><TR
><TD
>private - status (private/public)</TD
></TR
><TR
><TD
>closed - is event closed? (1-yes/0-no)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="EVENTASSIGNMENTS"
>7.2.32. Timetable - assignments ('eventassignments')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>eventid - event identifier</TD
></TR
><TR
><TD
>userid - user identifier</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="SESSIONS"
>7.2.33. Sessions ('sessions')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - session identifier</TD
></TR
><TR
><TD
>ctime - create time</TD
></TR
><TR
><TD
>mtime - last modification time</TD
></TR
><TR
><TD
>atime - last access time</TD
></TR
><TR
><TD
>vdata - verification data</TD
></TR
><TR
><TD
>content - data</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="HOSTS"
>7.2.34. Hosts ('hosts')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - identifier</TD
></TR
><TR
><TD
>name - host name</TD
></TR
><TR
><TD
>description - additional informations</TD
></TR
><TR
><TD
>lastreload - last reload date</TD
></TR
><TR
><TD
>reload - reload order</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMONINSTANCES"
>7.2.35. Daemon configuration - instances ('daemoninstances')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - identifier</TD
></TR
><TR
><TD
>name - instance name</TD
></TR
><TR
><TD
>hostid - host identifier</TD
></TR
><TR
><TD
>module - module file path and name</TD
></TR
><TR
><TD
>crontab - time of reload</TD
></TR
><TR
><TD
>priority - reload priority</TD
></TR
><TR
><TD
>description - additional informations</TD
></TR
><TR
><TD
>disabled - status (enabled/disabled)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DAEMONCONFIG"
>7.2.36. Daemon configuration - options ('daemonconfig')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>id - identifier</TD
></TR
><TR
><TD
>instanceid - instance identifier</TD
></TR
><TR
><TD
>var - option name</TD
></TR
><TR
><TD
>value - option value</TD
></TR
><TR
><TD
>description - additional informations</TD
></TR
><TR
><TD
>disabled - status (enabled/disabled)</TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DBINFO"
>7.2.37. Database information ('dbinfo')</A
></H3
><TABLE
BORDER="0"
><TBODY
><TR
><TD
>keytype - type</TD
></TR
><TR
><TD
>keyvalue - value</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="DEVEL-INI"
>7.3. Configuration file format</A
></H2
><P
>Configuration file default location is <TT
CLASS="FILENAME"
>/etc/lms/lms.ini</TT
>. 
          It's intended to be central configuration for all LMS components and you can setup 
          your <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
>, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lmsd</I
></SPAN
> daemon and Perl scripts 
          (including <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS_MGC</I
></SPAN
>) parameters here. However variable format 
          for Perl scripts is more restricted.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INI-COMMENTS"
>7.3.1. Comments</A
></H3
><P
>Configuration file parsers skip all lines that begin with '#' or ';' sign. 
               You can also append comments to the end of the lines containing valid variables 
               and sections , followed by that signs. </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INI-PARAMS"
>7.3.2. Sections, variables, values</A
></H3
><P
>Configuration options are grouped in sections. Name of the section, which is 
               build with alphanumerical signs must be enclosed in square brackets. Their name 
               should be unique in the span of configuration file.</P
><P
>Sections and parameters should be placed one per line. Parameter consists 
               of key (variable name) and value (variable content). Key is name of configuration 
               parameter, built from alphanumerical signs. Value should be placed in the same line, 
               after equality sign. If it contains any special characters it should be placed into 
               quotes or apostrophes.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="CONFIG-FORMAT"
></A
><P
><B
>Example 7-1. Format of configuration options</B
></P
><PRE
CLASS="SCREEN"
>[section]
key =  value
variable1 = "some text"
para_meter = 'i am "para_meter" variable in apostrophes'

[section_1]                    # you can comment here
key = "text with specials: \t and ;"     ; you can comment here either
; and this is comment all line long
key = "A.L.E.C's LMS Daemon is the best"
# option = disabled</PRE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INI-PERL"
>7.3.3. Perl scripts variables</A
></H3
><P
>Configuration for use by Perl scripts is someway restricted, due to restrictions of Config::IniFiles module which parses configuration file. Comments must be placed in new lines only. Values shouldn't be enclosed into apostrophes or quotes and are being read from equality sign since the end of line. </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="DEVEL-GENFAKE"
>7.4. Filling DB with random data</A
></H2
><P
>If you want to test your LMS installation instantly you can fill it with some random data using 'genfake' module.</P
><P
>To generate data you should, once logged in, open in your Web browser URL <TT
CLASS="FILENAME"
>http://ourserver.org/lms/?m=genfake</TT
> and write how many user records should be created in the text box. After you hit enter, the whole content of database will be erased and populated with some random data. You might get some database errors while generating data, as this algorithm is not truly random.
          <DIV
CLASS="NOTE"
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>For proper creation of dependences you should only run this module on empty database.</P
></TD
></TR
></TABLE
></DIV
>
          <DIV
CLASS="WARNING"
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>All data will be erased from database, except LMS users (Administrators) records.</P
></TD
></TR
></TABLE
></DIV
>
          </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="DEVEL-RIGHTS"
>7.5. Access levels</A
></H2
><P
>This description intended audience are LMS developers. :)</P
><P
>Originally access levels were supposed to be defined by various letters. It was assumption made at LMS-0.4, but it never actually took place. Due to it's presence in 1.0, I've racked my brain bout using 64-character string. So, in 64-character long field, there is just 256-bit hexadecimal number. Each character might describe maximum of 4 bits (4*64 = 256, which is a number of valid combinations). Turning some level on effects in turning some bit on. Then, if "full access" has index 0 in lib/accesstable.php, 0 bit will be set to 1, so the number will be 1. Levels may have numbers (indices) from 0 to 255. This is not final boundary, because using more letters and chars you can expand to 6 bytes per char easily, which gives you 384 combinations.
          </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="DEVEL-LIMITS"
>7.6. Restrictions</A
></H2
><P
>Each system has its restrictions. Some of ours are inherited from SQL engine being used. Some from assumptions (nearly) knowingly made by developers. Those are current restrictions:</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DEVEL-LIMITS-LMS"
>7.6.1. LMS project related</A
></H3
><P
>Amount of money (in 'cash' table) was stored (as of lms-1.1) as 32 integer value, so if you had 5000 users you might had problems in 8 years or so. Nowadays (since lms-1.1.7 Hathor) we use more appropriate type [ decimal (9.2), with 2 significant places after dot and 9 numers for whole sum] and the maximum is 9'999'999.99 (sum of all in/out cash operations). Procedures converting numbers to words are able to process numbers as big as 10^18.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DEVEL-LIMITS-UNICODE"
>7.6.2. Unicode-related problems</A
></H3
><P
>We are switching to Unicode in UI and databases. 
		Right now there are known problems. When you have to use SQL 
		with poor Unicode support, you should use UI converting capabilities. 
		(PHP only? watch out for perl scripts!). In following example (file 
		lms.ini) we have database in LATIN2 (aka ISO-8859-2) format. 
		<PRE
CLASS="SCREEN"
>[database]
user     = lms
password = lms12354
server_encoding = latin2 ; if DB is not encoded in Unicode </PRE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="DEVEL-LIMITS-DB"
>7.6.3. SQL engine related</A
></H3
><UL
><LI
><P
>MySQL</P
><UL
><LI
><P
>Database size:</P
><P
>Following MySQL documentation ("How Big Can MySQL Tables Be?" in chapter "Table size"), MySQL 3.22 is restricted 4GB per table. Since 3.23 restriction is 8 million terabytes (2^63 bytes). It's worth to mention, however, that some systems have filesystem level, usually at 2 or 4 GB.</P
></LI
><LI
><P
>Number of records:</P
><P
>True informations can be obtained, by issuing (in mysql shell):</P
><PRE
CLASS="SCREEN"
>mysql&gt; show table status;

...| Avg_row_length | Data_length | Max_data_length | Index_length |
...|             44 |       24136 |      4294967295 |        19456 |</PRE
><P
>See that free space is about 175 000 time more than currently used, so until you plan to have 100000 users, you're pretty safe in this matter :-)</P
></LI
></UL
></LI
><LI
><P
>PostgreSQL</P
><UL
><LI
><P
>Database size:</P
><P
>PostgreSQL stores data in 8kB blocks. Number of blocks in bound to 32-bit number with sign, which gives maximum table size of 16 terabytes. Filesystem restrictions are avoided by keeping data in slices, 1GB each.</P
></LI
><LI
><P
>Number of records:</P
><P
>PostgreSQL does not have row number limit for tables, however COUNT returns 32-bit number, so for tables longer that 2 billions of records this function will return wrong value (at least in version 7.1).</P
></LI
></UL
></LI
></UL
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="CONTRIB"
></A
>Chapter 8. Extensions</H1
><P
>This chapter describes additional modules and implementations which extend LMS functionality. Some of them need to be adjusted for user's own need, some of them integrate with <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>LMS-UI</I
></SPAN
> interface. All extensions are located in <TT
CLASS="FILENAME"
>contrib</TT
> subdirectory.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="CONTRIB-CUSTOMER"
>8.1. Customer account</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="CUSTOMER-INTRO"
>8.1.1. Intro</A
></H3
><P
>In <TT
CLASS="FILENAME"
>contrib/customer</TT
> directory you can find example solution, which displays financial balance and contact information for a given user, which makes possible for your customers to view this data themselves.</P
><P
>Script checks IP address for request and displays data which is relevant to computer's owner.</P
><P
>For proxy users, people not checking from home or to those who don't intend that they children/spouse/workers are able to see their financial data there's "Customer account 2" module.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CUSTOMER-INSTALL"
>8.1.2. Installation</A
></H3
><P
>You should copy those files to any path and make it accessible to your Web Server, or set appropriate alias (eg. Alias /myAccount/ /var/www/lms/contrib/customer) and put correct path to <TT
CLASS="FILENAME"
>lms.ini</TT
> in <TT
CLASS="FILENAME"
>index.php</TT
>.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="CONTRIB-CUSTOMER2"
>8.2. Customer account 2</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="CUSTOMER2-INTRO"
>8.2.1. Intro</A
></H3
><P
>In <TT
CLASS="FILENAME"
>contrib/customer_otherip</TT
> directory you can find equivalent of "Customer account" module, which does not authorize user basing on his IP address, but requires login. Authentication can be performed basing on user's PIN number and phone - or alternatively ID or contact number - as username, see balanceview.php and authentication.inc files).</P
><P
>Script shows user his balance and contact information, and, with help of <TT
CLASS="FILENAME"
>contrib/formularz_przelewu_wplaty</TT
> gives user a possibility to print money order for his debts.</P
><P
>It also allows aquiring and printing invoices by customers</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="CUSTOMER2-INSTALL"
>8.2.2. Installation</A
></H3
><P
>All installation is limited to setup of <TT
CLASS="FILENAME"
>sys_dir</TT
> option in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[directories]</I
></SPAN
> section of lms.ini file and linking <TT
CLASS="FILENAME"
>img/</TT
> with UI icons.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="CONTRIB-SQLPANEL"
>8.3. SQL Panel</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="SQLPANEL-INTRO"
>8.3.1. Intro</A
></H3
><P
>In <TT
CLASS="FILENAME"
>contrib/sqlpanel</TT
> directory you can find module which enables you direct access to LMS database, based on direct queries. Results are being shown as table, along with execution time. It's also possible to print query results.</P
><P
>Number of instantly displayed records is 50 by default. You can change this limit in <SAMP
CLASS="PROMPT"
>sqlpanel_pagelimit</SAMP
> variable in <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>[phpui]</I
></SPAN
> section of <TT
CLASS="FILENAME"
>lms.ini</TT
> file.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="SQLPANEL-INSTALL"
>8.3.2. Installation</A
></H3
><P
>Installation is limited to copying needed files into LMS tree: <TT
CLASS="FILENAME"
>sql.php</TT
> should be placed into <TT
CLASS="FILENAME"
>modules</TT
> directory, and <TT
CLASS="FILENAME"
>sql.html, sqlprint.html</TT
> 
		into <TT
CLASS="FILENAME"
>templates</TT
>. After those steps are done, you're able to access this module via http://lms.domain.pl/?m=sql.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="CONTRIB-SQUID"
>8.4. Squid redirector</A
></H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="SQUID-REDIRECTOR-INTRO"
>8.4.1. Intro</A
></H3
><P
>This tiny set of tools allows you to display users their warning messages (and cut access to entire Web off, it needed) in very elegant way, namely using squid Proxy Server. Obviously to make this work, all users should be forced to use proxy (or transparent proxy should be setup).</P
><P
>Key component is redirector. It's responsible for user redirection to programmed message, when warn flag is set in database for his computers. URL to programmed message is not subject of redirection, which enables user's browser to download images. If computer has warn flag set, it's redirected to message, where he has a choice to mark this message as read. After that user is taken back to original (requested) URL. If given computer is disconnected (cutoff) it always redirects him to the message, without any possibility to "quit" to Web. For more information, please see <TT
CLASS="FILENAME"
>README</TT
> file.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="SQUID-REDIRECTOR-INSTALL"
>8.4.2. Installation</A
></H3
><P
>Let's start from configuring squid (<TT
CLASS="FILENAME"
>squid.conf</TT
>):
<PRE
CLASS="SCREEN"
>redirector_bypass on
redirect_program /path/to/lms-squid</PRE
>
		That informs squid that it should use our redirector for each URL. Next step is to configure our redirector. Open lms-squid file in your favorite editor and change this line:
<PRE
CLASS="SCREEN"
>my $configfile = '/etc/lms/lms.ini';</PRE
>
		...to reflect location of your lms.ini file. The rest of configuration is being set in actual <TT
CLASS="FILENAME"
>lms.ini</TT
> file, where we should add <TT
CLASS="FILENAME"
>[redirector]</TT
> section and define URL of our programmed message:
<PRE
CLASS="SCREEN"
>[redirector]
redirect        = http://net-komp.net.pl</PRE
>
		At last, we copy files <TT
CLASS="FILENAME"
>index.php, message.html</TT
> to the directory that should serve a message to users and linking to lms images directory (<TT
CLASS="FILENAME"
>img</TT
>).</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="FAQ"
></A
>Chapter 9. FAQ</H1
><DIV
CLASS="QANDASET"
><DL
><DT
>9.1. <A
HREF="#Q1"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>My network device map does not show up. What to do?</B
></SPAN
></A
></DT
><DT
>9.2. <A
HREF="#Q2"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>How to add two computers with the same IP?</B
></SPAN
></A
></DT
><DT
>9.3. <A
HREF="#Q3"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>How to add two computers with the same MAC?</B
></SPAN
></A
></DT
><DT
>9.4. <A
HREF="#Q4"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>I see following error: <SAMP
CLASS="PROMPT"
>Can't locate Config/IniFiles.pm in @INC ...</SAMP
>What should I do?</B
></SPAN
></A
></DT
><DT
>9.5. <A
HREF="#Q5"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>I make few corrections. Do you accept any patches?</B
></SPAN
></A
></DT
><DT
>9.6. <A
HREF="#Q6"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>What is current version of LMS, which one i should use?</B
></SPAN
></A
></DT
><DT
>9.7. <A
HREF="#Q7"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>How to unsubscribe from the mailing list?</B
></SPAN
></A
></DT
><DT
>9.8. <A
HREF="#Q8"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>What is a limit of network devices on the map?</B
></SPAN
></A
></DT
><DT
>9.9. <A
HREF="#Q9"
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>Insecure $ENV{BASH_ENV} while running -T switch...</B
></SPAN
></A
></DT
></DL
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q1"
></A
><B
>9.1. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>My network device map does not show up. What to do?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>First you should check your Web Server logs. Usually it's helpful to increase amount of memory PHP may use in <SAMP
CLASS="PROMPT"
>memory_limit</SAMP
> option of <TT
CLASS="FILENAME"
>php.ini</TT
> file.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q2"
></A
><B
>9.2. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>How to add two computers with the same IP?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>There is no such possibility. Additionally, authors have no plans for such a functionality in near future. However you might try to use unofficial patch <SAMP
CLASS="PROMPT"
>multiip</SAMP
> which could be found in <SAMP
CLASS="PROMPT"
>contrib</SAMP
> directory.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q3"
></A
><B
>9.3. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>How to add two computers with the same MAC?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Check documentation. You probably look for <SAMP
CLASS="PROMPT"
>allow_mac_sharing = 1</SAMP
>.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q4"
></A
><B
>9.4. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>I see following error: <SAMP
CLASS="PROMPT"
>Can't locate Config/IniFiles.pm in @INC ...</SAMP
>What should I do?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>It's likely that you don't have required Perl modules installed. In this case it's <TT
CLASS="FILENAME"
>Config::IniFiles</TT
> that is missing. The easiest way to install Perl modules is to use CPAN extension, eg.
		<SAMP
CLASS="PROMPT"
>perl -MCPAN -e 'install Config::IniFiles'</SAMP
>.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q5"
></A
><B
>9.5. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>I make few corrections. Do you accept any patches?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>You should post it to our mailing list. Attach your patches (preferably to current cvs version, use unified diff format) along with short description on what your code does. Eg.
<PRE
CLASS="SCREEN"
>$ cd lms
$ cvs -z7 diff -u &#62; /tmp/my_patch.patch</PRE
>
		If you're interested into joining LMS developers team, please apply on the mailing list. You should however first make a good impression and stay on the list for a while, that may prove your skills, before asking us for cvs account.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q6"
></A
><B
>9.6. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>What is current version of LMS, which one i should use?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>LMS adopts versioning from Linux kernel. Thus, in LMS-x.y.z we have: x - major version number, y - stable if number is even, unstable if odd, z - minor version number. Therefore, if stable version appears, eg. 1.4.0 you shouldn't expect any new functionality in this branch, 1.5.x is created instead, where new features are being put, and which might not function well, or might be unstable.</P
><P
>Archive of all LMS versions can be found here:
		<A
HREF="http://lms.rulez.pl/download/"
TARGET="_top"
>lms.rulez.pl/download</A
></P
><P
>You should be aware that -RC version (release canditate) are 
		not as stable as one could expect. i.e. vestion 1.4.3 should be prefered 
		over 1.6-rc3. "-RC" are not to be used in production areas.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q7"
></A
><B
>9.7. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>How to unsubscribe from the mailing list?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Information about it is enclosed in all messages headers. You should send "unsubscribe" entitled message to lms-en-request@lists.rulez.pl.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q8"
></A
><B
>9.8. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>What is a limit of network devices on the map?</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Map creation algorithm isn't perfect. You can connect maximum of 24 computers to one network device (this number at max will appear on map, you can connect more devices of course). Similarly, each network device might be connected to the other 24 devices, but usually this number is subject of change (it might be smaller), depending on how devices are placed on the map. When this number is exceeded you may observe bogus connections going beyond the map, or less likely, problems with generating map at all.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="Q9"
></A
><B
>9.9. </B
><SPAN
CLASS="bold"
><B
CLASS="EMPHASIS"
>Insecure $ENV{BASH_ENV} while running -T switch...</B
></SPAN
></P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>Quoted error appears while you run Perl scripts that needs to use external programs on some systems. Problem description and possible solutions are described in Perl manual (man perlsec) in "Cleaning Up Your Path" chapter. Simplest solution is to remove -T switch, which is responsible for the error, from the first line of the script.</P
></DIV
></DIV
></DIV
></DIV
></DIV
></BODY
></HTML
>