LMS - LAN Management System 1.5-cvs

   [logo-small.png]

LMS Developers

   Copyright (c) 2001-2004 LMS Developers
     _________________________________________________________________

   Spis tre¶ci
   1. Wstêp

        1.1. Czym jest LMS
        1.2. Autorzy
        1.3. Licencja
        1.4. Informacje dodatkowe

   2. Instalacja i konfiguracja

        2.1. Wstêp
        2.2. Wymagania
        2.3. Instalacja LMS
        2.4. Instalacja serwera baz danych
        2.5. Konfiguracja podstawowa
        2.6. Prawa dostêpu
        2.7. Upgrade

   3. Interfejs U¿ytkownika (LMS-UI)

        3.1. Logowanie
        3.2. U¿ytkownicy
        3.3. Komputery
        3.4. Osprzêt sieciowy
        3.5. Sieci IP
        3.6. Taryfy i Finanse
        3.7. Mailing
        3.8. Prze³adowanie
        3.9. Bazy danych
        3.10. Administratorzy
        3.11. Statystyki
        3.12. Helpdesk

   4. Skrypty

        4.1. Instalacja
        4.2. Lista dostêpnych skryptów
        4.3. Opis i konfiguracja

   5. Generator plików konfiguracyjnych (lms-mgc)

        5.1. Instalacja
        5.2. Konfiguracja
        5.3. Przyk³ad zastosowania lms-mgc

   6. A.L.E.C's LMS Daemon

        6.1. Informacje podstawowe
        6.2. Modu³y

   7. Dla dociekliwych

        7.1. Drzewo katalogów
        7.2. Struktura bazy danych
        7.3. Format pliku konfiguracyjnego
        7.4. Generowanie danych losowych
        7.5. Poziomy dostêpu
        7.6. Ograniczenia

   8. Dodatki

        8.1. Moje konto
        8.2. Moje konto 2
        8.3. Panel SQL
        8.4. Ostrze¿enia + squid

   Spis tabel
   4-1. Lista skryptów wykonywalnych
   6-1. Lista modu³ów demona almsd
   7-1. Drzewo katalogów LMS

   Spis przyk³adów
   4-1. Lms-notify: Przyk³adowy wyci±g 10 ostatnich operacji kasowych
   4-2. Lms-notify: Przyk³ad szablonu
   5-1. Lms-mgc: Przyk³ad instancji
   7-1. Format opcji konfiguracyjnych
     _________________________________________________________________

Rozdzia³ 1. Wstêp

1.1. Czym jest LMS

   "LMS" jest skrótem od "LAN Management System". Jest to zestaw
   aplikacji w PHP, C i Perlu, u³atwiaj±cych zarz±dzanie sieciami
   osiedlowymi (popularnie zwanymi Amatorskimi Sieciami Komputerowymi),
   korzystaj±cych z bazy danych MySQL, PostgreSQL lub SQLite. G³ówne
   za³o¿enia to uzyskanie jako¶ci us³ug oraz obs³ugi u¿ytkowników na
   poziomie providera z prawdziwego zdarzenia. Najbardziej podstawowe
   cechy LMS to:
     * baza danych u¿ytkowników (imiê, nazwisko, adres, numer telefonu,
       uwagi i inne),
     * baza danych komputerów (adres IP, adres MAC),
     * baza danych sprzêtu sieciowego (nazwa, ilo¶æ portów),
     * generowanie mapy sieci,
     * prowadzenie prostego rachunku operacji finansowych oraz stanu
       funduszów sieci,
     * zestawienia finansowe, fakturowanie,
     * ró¿ne op³aty i taryfy abonamentowe,
     * wysy³anie poczt± elektroniczn± upomnieñ do u¿ytkowników,
     * automatyczne naliczanie op³at miesiêcznych,
     * generowanie praktycznie jakiegokolwiek konfiga na podstawie danych
       o komputerach w bazie (przyk³adowe konfigi obejmuj± rc.masq na
       iptables, dhcpd.conf, oidentd_masq.conf, /etc/ethers, dns prosty i
       odwrotny, htb),
     * wizualizacja statystyk wykorzystania ³±cza,
     * system obs³ugi zg³oszeñ (Helpdesk).

   Ca³o¶æ zosta³a wymy¶lona w ramach administracji ASK NetX i tam jest
   nieustannie rozwijana i poddawana testom.

   LMS nie zast±pi Ci umiejêtno¶ci jakie powinien mieæ administrator.
   Je¶li nie potrafisz wykonaæ tak prostych czynno¶æ jak instalacja czy
   konfiguracja, prawdopodobnie nie bêdziesz umia³ dostroiæ LMS do
   swojego systemu. Tak wiêc bez znajomo¶ci systemów U*IX siê nie
   obejdzie.
     _________________________________________________________________

1.2. Autorzy

1.2.1. LMS Developers

     * Kod PHP:

       £ukasz 'Baseciq' Mozer
       Micha³ 'DziQs' Zapalski
       Rados³aw 'Warden' Antoniuk
       Krzysztof 'hunter' Drewicz
       Marcin 'Lexx' Król
       Aleksander A.L.E.C Machniak
     * Kod C:

       Aleksander 'A.L.E.C' Machniak
       Marcin 'Lexx' Król
     * Kod Perl:

       £ukasz 'Baseciq' Mozer
       Micha³ 'DziQs' Zapalski
       Maciej 'agaran' Pijanka
       Krzysztof 'hunter' Drewicz
     * Design:

       £ukasz 'Baseciq' Mozer
     * HTML, JavaScript, CSS:

       £ukasz 'Baseciq' Mozer
       Pawe³ 'Bob_R' Czerski
       Pawe³ 'sickone' Kisiela
     * Grafika:

       Piotr 'Pierzak' M.
       Grzegorz 'byko' Cichowski
       Kuba 'kflis' Flis
       £ukasz 'Baseciq' Mozer
     * Support MySQL:

       Kuba 'shasta' Jankowski
       Rados³aw 'Warden' Antoniuk
       Przemys³aw Babiñski
     * Support Postgresql i SQLite:

       Aleksander 'A.L.E.C' Machniak
     * Dokumentacja i strona WWW:

       Aleksander 'A.L.E.C' Machniak
       Kuba 'shasta' Jankowski
       Grzegorz 'JaBBaS' Dziêgielewski
       £ukasz 'Baseciq' Mozer
       Marcin 'Lexx' Król
     * Betatesterzy:

       Grzegorz 'byko' Cichowski
       Rados³aw 'Warden' Antoniuk
       Tomasz 'dzwonek' Dzwonkowski
       Sebastian 'Victus' Frasunkiewicz
       Kuba 'kflis' Flis
       Krystian 'UFOczek' Kochanowski
       Grzegorz 'JaBBaS' Dziêgielewski
       Andrzej 'chsh' Gr±dziel
       Marcin 'Lexx' Król
     _________________________________________________________________

1.2.2. Inni

   LMS zawiera fragmenty nastêpuj±cego oprogramowania: phpMyAdmin,
   phpsysinfo, NewsPortal, procedury konwersji liczb na postaæ s³own±
   autorstwa Piotra Klebana oraz przyk³ady kodu zawarte w Podrêczniku
   PHP.
     _________________________________________________________________

1.3. Licencja

   Niniejszy program jest oprogramowaniem wolnodostêpnym; mo¿esz go
   rozprowadzaæ dalej i/lub modyfikowaæ na warunkach Powszechnej Licencji
   Publicznej GNU, wydanej przez Fundacjê Wolnodostêpnego Oprogramowania
   - wed³ug wersji 2-giej tej Licencji lub której¶ z pó¼niejszych wersji.

   Niniejszy program rozpowszechniany jest z nadziej±, i¿ bêdzie on
   u¿yteczny - jednak BEZ JAKIEJKOLWIEK GWARANCJI, nawet domy¶lnej
   gwarancji PRZYDATNO¦CI HANDLOWEJ albo PRZYDATNO¦CI DO OKRE¦LONYCH
   ZASTOSOWAÑ. W celu uzyskania bli¿szych informacji - Powszechna
   Licencja Publiczna GNU.

   Z pewno¶ci± wraz z niniejszym programem otrzyma³e¶ te¿ egzemplarz
   Powszechnej Licencji Publicznej GNU; je¶li nie - napisz do Free
   Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
   02111-1307, USA.

   Angielski tekst tej licencji znajduje siê tutaj.
     _________________________________________________________________

1.4. Informacje dodatkowe

1.4.1. Kontakt z autorami

   Najlepiej poprzez listê mailingow±, na któr± mo¿na siê zapisaæ
   wysy³aj±c pustego maila o temacie "subscribe lms" na adres
   ecartis@lists.rulez.pl, a maile wysy³a siê na adres
   lms@lists.rulez.pl.
     _________________________________________________________________

1.4.2. Zg³aszanie b³êdów i pomys³ów

   Aby efektywnie zg³osiæ b³±d lub nowy pomys³, najlepiej jest zapisaæ
   siê na listê mailingow± gdzie kto¶ z autorów b±d¼ u¿ytkowników bêdzie
   mia³ szansê odpowiedzieæ na pytania Ciê nurtuj±ce. Dostêpny jest tak¿e
   dla testów BTS, gdzie mo¿na zg³aszaæ b³êdy po uprzedniej rejestracji.
   Raporty z BTS id± tak¿e na listê mailingow±, wiêc najlepiej siê
   zapisaæ, zg³osiæ b³±d poprzez BTS, wys³aæ linka na listê i czekaæ na
   rozwój wydarzeñ. Adres BTS to http://bts.rulez.pl.
     _________________________________________________________________

1.4.3. Najnowsza wersja

   Zawsze aktualn± werjsê LMS mo¿na pobraæ z repozytorium CVS za pomoc±
   interfejsu www tutaj, lub klasycznie (dostêp anonimowy, puste has³o):
cvs -d :pserver:cvs@cvs.rulez.pl:/home/cvsroot login
cvs -d :pserver:cvs@cvs.rulez.pl:/home/cvsroot co lms
cvs -d :pserver:cvs@cvs.rulez.pl:/home/cvsroot logout

   Repozytorium CVS mo¿na tak¿e przegl±daæ przy pomocy interfejsu WWW pod
   adresem http://cvs.rulez.pl.
     _________________________________________________________________

1.4.4. Historia zmian

   Informacje o zmianach jakie zasz³y w kolejnych wersjach LMS zawarte s±
   w pliku ChangeLog.
     _________________________________________________________________

Rozdzia³ 2. Instalacja i konfiguracja

2.1. Wstêp

   LMS sk³ada siê z kilku modu³ów, podstawowym modu³em jest LMS-UI
   (interfejs u¿ytkownika). Jest on w ca³o¶ci napisany w PHP i do pracy
   wymaga bazy danych (w³a¶ciwie to ka¿dy modu³ wymaga bazy danych). To
   w³a¶nie w LMS-UI wykonujemy wszystkie czynno¶ci, reszta modu³ów ma
   tylko za zadanie zautomatyzowaæ pracê LMS.

   LMS to tak¿e zestaw skryptów w jêzyku Perl, i to w³a¶nie te skrypty
   wymagaj± aby¶ posiada³ interpreter tego jêzyka. Je¶li bêdziesz chcia³
   u¿ywaæ tych skryptów, musisz mieæ Perl'a. Skrypty pozwalaj± m.in. na
   comiesiêczne naliczanie op³at abonamentowych b±d¼ wysy³anie upomnieñ.
   Najwiêkszy z nich - LMS-MGC jest skryptem, ale na tyle uniwersalnym ¿e
   potrafi wygenerowaæ praktycznie dowolny plik konfiguracyjny i
   zrestartowaæ us³ugê na twoim serwerze.

   Jest jeszcze A.L.E.C's LMS Daemon, napisany w jêzyku C. Jest on
   przeznaczony (a w³a¶ciwie jego wtyczki) do generowania plików
   konfiguracyjnych i restartowania us³ug. Mo¿na go stosowaæ jako
   zamiennik lub uzupe³nienie skryptów perlowych. Odpowiada on za to, aby
   to co zosta³o zmienione w LMS-UI zosta³o zmienione tak¿e w
   rzeczywisto¶ci.
     _________________________________________________________________

2.2. Wymagania

2.2.1. Serwer WWW

   Poniewa¿ LMS-UI jest napisane w PHP, niezbêdny jest serwer WWW z
   interpreterem tego jêzyka. Preferowanym serwerem jest Apache
   (www.apache.org).
     _________________________________________________________________

2.2.2. Interpreter PHP

   Interpreter powinien byæ w wersji 4.2.x lub nowszej, chocia¿ dzia³a
   te¿ poprawnie na 4.1.x (ale poniewa¿ developerzy pracuj± na 4.2.3, nie
   mo¿na zagwarantowaæ poprawnej pracy na starszych wersjach. PHP mo¿na
   ¶ci±gn±æ ze strony www.php.net.
     _________________________________________________________________

2.2.3. Serwer baz danych

   LMS nie bêdzie dzia³a³ prawid³owo na wersjach MySQL starszych od
   3.23.xx.

   LMS wspó³pracuje tak¿e z PostgreSQL w wersji 7.3.x lub nowszych.

   Przy wspó³pracy LMS'a z baz± danych SQLite nie stwierdzono ¿adnych
   problemów z tym, ¿e jedyn± przetestowan± wersj± jest wersja 2.8.11.
     _________________________________________________________________

2.2.4. Biblioteka Smarty

   LMS-UI do pracy wymaga jeszcze biblioteki Smarty
   (http://smarty.php.net) w wersji 2.5.0 lub wy¿szej.
     _________________________________________________________________

2.2.5. Perl

   O ile dla LMS-UI wystarczy to co powy¿ej, to ¿eby mieæ dzia³aj±cy
   LMS-MGC i resztê skryptów potrzebujemy tak¿e Perla i modu³y do niego,
   które mo¿na pobraæ z www.cpan.org, czyli:
     * perl w³a¶ciwy i jego podstawowe modu³y (POSIX, GetOpt::Long);
     * Net::SMTP;
     * Config::IniFiles;
     * DBI;
     * DBD-mysql (Je¶li masz zamiar u¿ywaæ mysql'a);
     * DBD-Pg (Je¶li masz zamiar u¿ywaæ postgres'a);
     * DBD-SQLite (Je¶li masz zamiar u¿ywaæ bazê SQLite);
     _________________________________________________________________

2.2.6. Kompilator jêzyka C

   Je¶li chcesz uruchomiæ A.L.E.C's LMS Daemon bêdziesz potrzebowa³
   dzia³aj±cy kompilator jêzyka C, gdy¿ jest on dostarczany wy³±cznie w
   postaci kodu ¼ród³owego.
     _________________________________________________________________

2.3. Instalacja LMS

   LMS w postaci archiwum tar.gz mo¿na pobraæ ze strony domowej projektu
   (www.lms.rulez.pl), a nastêpnie rozpakowaæ i umie¶ciæ w wybranym
   katalogu (np. /var/www/lms ) dostêpnym dla serwera www:
$ cd /var/www
$ wget http://lms.rulez.pl/download/stable/lms-x.x.x.tar.gz
$ tar zxf lms-x.x.x.tar.gz

   Dostêpne s± dwa rodzaje paczek z LMS - zawieraj±ce bibliotekê Smarty
   (lms-x.x.x+libs.tar.gz) i bez niej. Je¿eli nie skorzysta³e¶ z wersji
   archiwum zawieraj±cej biblioteki, pobierz j± i umie¶æ w katalogu lib.
$ cd /var/www/lms/lib
$ wget http://smarty.php.net/distributions/Smarty-2.6.0.tar.gz
$ tar zxf Smarty-2.6.0.tar.gz
$ mv Smarty-2.6.0/libs Smarty

   Notatka

   Po³o¿enie wszystkich katalogów mo¿esz zmieniæ w sekcji [directories]
   pliku lms.ini.

   Pliki z konfiguracj± (sample/lms.ini i sample/lms-mgc.ini) umie¶æ w
   katalogu /etc/lms.

   Skrypty wykonywalne z katalogu bin najlepiej przenie¶æ do katalogu
   /usr/sbin.

   Ostrze¿enie

   Serwer www musi mieæ prawo odczytu pliku lms.ini oraz prawa odczytu i
   zapisu do katalogu backup. Stanowi to potencjalne obni¿enie poziomu
   bezpieczeñstwa systemu.
     _________________________________________________________________

2.4. Instalacja serwera baz danych

2.4.1. MySQL

2.4.1.1. Wstêp

   Ta bardzo popularna baza jest dostêpna z wiêkszo¶ci± dystrybucji
   Linuksa. Je¿eli jednak bêdziesz musia³ j± zainstalowaæ samodzielnie,
   zacznij od ¶ci±gniêcia ¼róde³ z www.mysql.org.
     _________________________________________________________________

2.4.1.2. Instalacja serwera MySQL

   Po rozpakowaniu, wejd¼ do katalogu z naszym MySQL i wydaj kolejno
   polecenia:
$ ./configure --prefix=/usr/local/mysql
$ make
$ make install
$ /usr/local/mysql/bin/mysql_install_db
$ chown mysql -R /usr/local/mysql/var
$ /usr/local/mysql/bin/safe_mysqld &
$ /usr/local/mysql/bin/mysqladmin -u root password nowe_has³o
     _________________________________________________________________

2.4.1.3. Utworzenie bazy danych

   Konieczne to jest je¿eli uruchamiasz LMS po raz PIERWSZY. Je¿eli
   uaktualniasz LMS z poprzedniej wersji, odpowiednie adnotacje co nale¿y
   zrobiæ z baz± danych s± w pliku ChangeLog. Tak wiêc, wejd¼ do katalogu
   w którym masz LMS'a i uruchom shell mysql'a:
mysql -u[tutaj wpisz u¿ytkownika z pe³nym dostêpem do bazy] -p
Enter password:[podaj has³o]
mysql> create database lms;
mysql> grant usage on lms.* to lms@localhost;
mysql> grant select,insert,update,delete,create,alter on lms.* to lms@localhost identified by 'haslo';
mysql> flush privileges;
mysql> use lms;
mysql> source doc/lms.mysql;
     _________________________________________________________________

2.4.1.4. Konfiguracja LMS (lms.ini)

   Poniewa¿ MySQL jest domy¶ln± baz± dla LMS'u, konfiguracja ogranicza
   siê do podania w sekcji [database] pliku /etc/lms/lms.ini has³a i
   u¿ytkownika:
user     = lms
password = has³o_z_pkt.3

   Po takim zabiegu, o ile LMS'owi uda siê nawi±zaæ po³±czenie do bazy
   danych, mo¿na ju¿ bez problemu dostaæ siê do systemu. Je¿eli jednak w
   bazie danych nie ma ¿adnego konta administratora, jedyn± rzecz± jak±
   zobaczysz bêdzie formularz dodania administratora. Je¿eli podasz
   prawid³owe dane administratora, LMS przeniesie Ciê na stronê logowania
   gdzie od razu bêdziesz móg³ u¿yæ nowo utworzonego konta.

   Zatrzymaj siê tutaj i dodaj co¶ do crona, tak dla ¶wiêtego spokoju:
12 4 3,10,17,21,28 * * /usr/bin/mysqldump -u lms --password=Twoje-super-tajne-has³o \
                    --add-drop-table --add-locks lms > backups/lms-auto-"$(date +%s)".sql

   Spowoduje to wykonywanie o 4:12 rano, ka¿dego 3, 10, 17, 21 i 28 dnia
   miesi±ca automagicznie zrzutu danych z mysqla.
     _________________________________________________________________

2.4.2. PostgreSQL

2.4.2.1. Wstêp

   LMS jest testowany na PostgreSQL 7.3.4 i nowszych, ale poniewa¿ ¿adne
   skomplikowane w³a¶ciwo¶ci tej bazy nie s± wykorzystywane, nie powinno
   byæ problemów z innymi wersjami. Je¿eli nie masz zainstalowanego
   serwera PostgreSQL, najlepszym rozwi±zaniem bêdzie w³asnorêczna
   kompilacja ze ¼róde³ dostêpnych na stronie www.postgresql.org.
     _________________________________________________________________

2.4.2.2. Instalacja

   Jest to wersja skrócona instalacji, wiêcej informacji znajdziesz w
   dokumentacji postgresa. Po ¶ci±gniêciu i rozpakowaniu wejd¼ do
   katalogu g³ównego i wpisz kolejno poni¿sze polecenia.
$ ./configure --enable-locale
$ gmake
$ su
$ gmake install
$ adduser postgres
$ mkdir /usr/local/pgsql/data
$ chown postgres /usr/local/pgsql/data
$ su - postgres
$ /usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data
$ /usr/local/pgsql/bin/postmaster -D /usr/local/pgsql/data >logfile 2>&1 &
     _________________________________________________________________

2.4.2.3. Utworzenie bazy danych

   Maj±c uruchomiony serwer mo¿esz przyst±piæ do tworzenia bazy o nazwie
   'lms', której w³a¶cicielem bêdzie u¿ytkownik z loginem 'lms'.
$ /usr/local/pgsql/bin/createuser -d -A -P lms
$ /usr/local/pgsql/bin/createdb -E LATIN2 -U lms lms
$ /usr/local/pgsql/bin/psql -d lms -U lms -f /lms/doc/lms.pgsql
     _________________________________________________________________

2.4.2.4. Konfiguracja LMS (lms.ini)

   Dla systemu LMS domy¶lnym serwerem baz danych jest MySQL, dlatego w
   sekcji [database] pliku /etc/lms/lms.ini nale¿y ustawiæ nastêpuj±ce
   opcje:
type     = postgres
user     = lms
password = has³o_podane_przy_tworzeniu_u¿ytkownika_lms

   Notatka

   Has³o jest wymagane w zale¿no¶ci od konfiguracji autentykacji
   u¿ytkowników postgresa w /usr/local/pgsql/data/pg_hba.conf. Domy¶lnie
   has³o nie jest wymagane.

   Po takim zabiegu, o ile LMS'owi uda siê nawi±zaæ po³±czenie do bazy
   danych, mo¿na ju¿ bez problemu dostaæ siê do systemu. Je¿eli jednak w
   bazie danych nie ma ¿adnego konta administratora, jedyn± rzecz± jak±
   zobaczysz bêdzie formularz dodania administratora.
     _________________________________________________________________

2.4.3. SQLite

2.4.3.1. Wstêp

   Ta jednoplikowa baza jest chwalona za swoj± szybko¶æ, wg autorów
   okre¶lan± na 2-3 krotnie szybsz± od MySQL. Poza tym przy odpowiedniej
   konfiguracji umo¿liwia wczytanie ca³ej bazy do pamiêci RAM przez co
   osi±gany jest znaczny wzrost wydajno¶ci. Poni¿ej przedstawiono krótki
   opis instalacji. ¬ród³a mo¿na pobraæ z www.sqlite.org.
     _________________________________________________________________

2.4.3.2. Instalacja SQLite

   Opisano tutaj sposób instalacji bibliotek SQLite oraz dodanie obs³ugi
   tej bazy do PHP (PHP w wersji 5.0 ma wbudowan± obs³ugê SQLite). Po
   rozpakowaniu ¼róde³, wejd¼ do katalogu z SQLite i wydaj kolejno
   polecenia (¶cie¿ki przyk³adowe):
$ ./configure
$ make
$ make install
$ ldconfig
$ pear download http://pecl.php.net/get/SQLite-1.0.2.tgz
$ pear install SQLite-1.0.2.tgz

   Nastêpnie w pliku php.ini ustaw:
extension=sqlite.so

   Istnieje równie¿ mo¿liwo¶æ wkompilowania obs³ugi SQLite w PHP przy
   pomocy opcji --with-sqlite.
     _________________________________________________________________

2.4.3.3. Utworzenie bazy danych

   Konieczne to jest je¿eli uruchamiasz LMS po raz PIERWSZY. Tak wiêc,
   wejd¼ do katalogu w którym masz LMS'a i uruchom shell sqlite'a:
$ sqlite -init doc/lms.sqlite /usr/local/lms/lms.db
sqlite> .exit
$ chown 99.98 /usr/local/lms/lms
     _________________________________________________________________

2.4.3.4. Konfiguracja LMS (lms.ini)

   Jednym z ograniczeñ SQLite jest brak autentykacji u¿ytkowników,
   dlatego konfiguracja ogranicza siê do podania typu oraz ¶cie¿ki do
   pliku bazy. W sekcji [database] pliku /etc/lms/lms.ini podajemy:
type     = sqlite
database = /usr/local/lms/lms.db

   Po takim zabiegu, mo¿na ju¿ bez problemu dostaæ siê do systemu. Je¿eli
   jednak w bazie danych nie ma ¿adnego konta administratora, jedyn±
   rzecz± jak± zobaczysz bêdzie formularz dodania administratora.
     _________________________________________________________________

2.5. Konfiguracja podstawowa

   G³ównym plikiem konfiguracyjnym LMS jest lms.ini, który nale¿y
   umie¶ciæ w katalogu /etc/lms lub w katalogu g³ównym LMS'a. Zawiera on
   zmienne konfiguracyjne LMS-UI oraz wszystkich skryptów wykonywalnych z
   wyj±tkiem LMS-MGC.

   Notatka

   Pamiêtaj o usuniêciu ¶redników na pocz±tku linii z ustawianym
   parametrem konfiguracyjnym.
     _________________________________________________________________

2.5.1. Sekcja [database] - ustawienia bazy danych

     * type
       Typ bazy danych. Aktualnie w 100% supportowany jest 'mysql', ale
       jak na razie nie widaæ wiêkszych problemów z 'postgres' i
       'sqlite'. Domy¶lnie: mysql
       Przyk³ad: type = mysql
     * host
       Host gdzie zainstalowana jest baza danych. Najczê¶ciej, localhost,
       ale mo¿na tutaj wstawiæ cokolwiek (ip, domena, ¶cie¿ka do gniazda
       w formacie '/path/to/socket'). Domy¶lnie: localhost
       Przyk³ad: host = localhost
     * user
       U¿ytkownik do bazy danych. W wielu wypadkach (je¿eli postêpowa³e¶
       zgodnie ze wskazówkami w dokumentacji) bêdzie to 'lms'. Je¿eli
       chcesz u¿ywaæ konta uprzywilejowanego, prawdopodobnie wpiszesz
       'root' (MySQL na wiêkszo¶ci *nixów), 'mysql' (na PLD) b±d¼
       'postgres' (PostgreSQL). Domy¶lnie: mysql
       Przyk³ad: user = lms
     * password
       Has³o do bazy danych. Domy¶lnie puste.
       Przyk³ad: password = password
     * database
       Nazwa bazy danych (a w przypadku SQLite ¶cie¿ka do pliku bazy),
       domy¶lnie lms.
       Przyk³ad: database = lms
     _________________________________________________________________

2.5.2. Sekcja [directories] - ustawienia katalogów

     * sys_dir
       Katalog systemowy. Jest to miejsce gdzie jest ca³a zawarto¶æ UI
       LMS'a, czyli index.php, grafiki, templejty i reszta. Domy¶lnie,
       index.php stara siê sam odnale¼æ w filesystemie u¿ywaj±c getcwd(),
       ale lepiej by by³o gdyby mu powiedzieæ gdzie jest:
       Przyk³ad: sys_dir = /var/www/htdocs/lms/
     * modules_dir
       Katalog z "modu³ami" LMS'a. Czyli zawarto¶æ katalogu modules.
       Domy¶lnie jest to podkatalog modules w sys_dir.
       Przyk³ad: modules_dir = /usr/share/lms/modules/
     * lib_dir
       Katalog z "bibliotekami" LMS'a. Czyli zawarto¶æ katalogu lib.
       Domy¶lnie to podkatalog lib w sys_dir.
       Przyk³ad: lib_dir = /usr/share/lms/lib/
     * backup_dir
       Katalog z kopiami zapasowymi bazy danych - miejsce gdzie LMS
       zapisuje zrzuty z bazy. Domy¶lnie jest to podkatalog 'backups'.
       Przyk³ad: backup_dir = /var/backup/lms/

       Ostrze¿enie

   Je¶li katalog z kopiami zapasowymi bêdzie osi±galny z poziomu WWW, to
   ka¿dy bez autoryzacji bêdzie mia³ do nich dostêp.
     * smarty_dir
       Katalog z bibliotek± Smarty - domy¶lnie podkatalog Smarty w
       lib_dir.
       Przyk³ad: smarty_dir = /usr/lib/php/Smarty
     * smarty_compile_dir
       Katalog kompilacji Smartyego. Miejsce gdzie Smarty kompiluje
       szablony. Domy¶lnie to templates_c w katalogu sysdir.
       Przyk³ad: smarty_compile_dir = /var/smarty/compile/lms
     * smarty_templates_dir
       Katalog z szablonami którymi Smartiego. Domy¶lnie to podkatalog
       templates z sys_dir'a.
       Przyk³ad: smarty_templates_dir = /usr/share/lms/templates
     _________________________________________________________________

2.5.3. Sekcja [phpui] - ustawienia interfejsu

     * allow_from (opcjonalny)
       Lista sieci i adresów IP które maj± dostêp do LMS. Je¿eli puste,
       ka¿dy adres IP ma dostêp do LMS'a, je¿eli wpiszemy tutaj listê
       adresów b±d¼ klas adresowych, LMS odrzuci b³êdem HTTP 403 ka¿dego
       niechcianego u¿ytkownika.
       Przyk³ad: allow_from = 192.168.0.0/16, 213.25.209.224/27,
       213.241.77.29
     * timeout
       Timeout sesji www. Po tym czasie (w sekundach) u¿ytkownik zostanie
       wylogowany je¿eli nie podejmie ¿adnej akcji. Domy¶lnie 600 sekund.
       Przyk³ad: timeout = 900

       Ostrze¿enie

   Nie ma mo¿liwo¶ci ustawienia braku timeoutu. Je¿eli ustawisz t±
   warto¶æ na zero, nie bêdziesz móg³ korzystaæ z LMS!
     * userlist_pagelimit
       Limit wy¶wietlanych pozycji na stronie w li¶cie u¿ytkowników.
       Domy¶lnie brak limitu.
       Przyk³ad: userlist_pagelimit = 10
     * nodelist_pagelimit
       Limit wy¶wietlanych pozycji na stronie w li¶cie komputerów.
       Domy¶lnie brak limitu.
       Przyk³ad: nodelist_pagelimit = 10
     * balancelist_pagelimit
       Limit wy¶wietlanych pozycji na stronie na rachunku u¿ytkownika.
       Domy¶lnie: 100.
       Przyk³ad: balancelist_pagelimit = 50
     * invoicelist_pagelimit
       Limit wy¶wietlanych pozycji na stronie w li¶cie faktur. Domy¶lnie:
       100
       Przyk³ad: invoicelist_pagelimit = 50
     * ticketlist_pagelimit
       Limit wy¶wietlanych pozycji na stronie w li¶cie zg³oszeñ.
       Domy¶lnie: 100
       Przyk³ad: ticketlist_pagelimit = 50
     * reload_type
       Typ reloadu. Dozwolone warto¶ci:
       exec - wywo³ywanie jakiej¶ komendy (najczê¶ciej co¶ przez sudo,
       jaki¶ skrypt lub co¶, konfigurowalny poni¿ej)
       sql - zrobienie wpisów w SQL'u (te¿ mo¿na ustawiæ konkretne query
       SQL'a)
       Domy¶lna warto¶æ to 'sql'.
       Przyk³ad: reload_type = exec
     * reload_execcmd
       Komenda do wykonania podczas reloadu je¿eli reload_type jest
       ustawione na 'exec'. Domy¶lnie /bin/true. String ten puszczany do
       komendy system() wiêc proponujê rozwagê i pomy¶lenie co siê robi i
       jak :) Generalnie ¶redniki powinny byæ parsowane przez bash'a, ale
       z paru wzglêdów LMS sam dzieli poni¿szy ci±g pod wzglêdem
       ¶redników i wykonuje komendy pojedynczo.
       Przyk³ad: reload_execcmd = "sudo /usr/bin/reload_lms.sh"
     * reload_sqlquery
       Zapytanie SQL wykonywane podczas reloadu, je¶li reload_type = sql.
       Domy¶lnie zapytanie wrzuca do tabeli timestamps warto¶æ '_force'.
       W zapytaniu mo¿na u¿yæ '%TIME%' jako podstawki pod aktualny
       timestamp unixowy. UWAGA! Znak ¶rednika jest traktowany jako
       separator kwerend, tzn. oddzielaj±c znakiem ¶rednika mo¿esz wpisaæ
       kilka zapytañ SQL.
       Przyk³ad: reload_sqlquery = "INSERT INTO reload VALUES
       ('1','%TIME%')"
     * force_ssl
       Wymuszanie SSL'a. Ustawienie tej zmiennej na 1 spowoduje ¿e LMS
       bêdzie wymusza³ po³±czenie SSL powoduj±c redirect do
       'https://'.$_SERVER[HTTP_HOST].$_SERVER[REQUEST_URI] przy ka¿dej
       próbie dostêpu bez SSL. Domy¶lnie wy³±czone.
       Przyk³ad: force_ssl = 0
     * allow_mac_sharing
       Przyzwolenie na dodawanie rekordów komputerów z adresami MAC ju¿
       istniej±cymi (nie sprawdza czy jaki¶ inny komputer posiada taki
       adres MAC). Domy¶lnie wy³±czone
       Przyk³ad: allow_mac_sharing = 1
     * smarty_debug
       W³±czenie konsoli debugowej Smartyego, przydatne do ¶ledzenia
       warto¶ci przekazywanych z PHP do Smartyego. Domy¶lnie wy³±czone.
       Przyk³ad: smarty_debug = 1
     * debug_email
       Adres e-mail do debugowania - pod ten adres bêd± sz³y wiadomo¶ci
       wysy³ane z sekcji 'Mailing' LMS'a, zamiast do w³a¶ciwych
       u¿ytkowników.
       Przyk³ad: debug_email = root@localhost
     * default_zip, default_city, default_address
       Domy¶lny kod pocztowy, miasto, ulica, stosowane podczas wstawiania
       nowego u¿ytkownika. Przydatne gdy mamy do wpisania wielu
       u¿ytkowników z tej samej ulicy.
       Przyk³ad: default_zip = 39-300
     * use_current_payday
       Okre¶la, czy ma byæ u¿yta aktualna data jako dzieñ zap³aty podczas
       przypisywania zobowi±zañ u¿ytkownikom. Domy¶lnie wy³±czone.
       Przyk³ad: use_current_payday = 1
     * lastonline_limit
       Okre¶la czas (w sekundach), po którym komputer zostaje uznany za
       nieaktywny. Powinien odpowiadaæ czêstotliwo¶ci uruchamiania
       skryptu badaj±cego aktywno¶æ komputerów (np.lms-fping). Domy¶lnie:
       600.
       Przyk³ad: lastonline_limit = 300
     * arpd_servers
       Lista serwerów arpd do zczytywania MAC'adresów z odleg³ych sieci.
       Lista ta powinna zawieraæ wpisy w postaci adresIP[:port]
       oddzielone spacjami. Domy¶lnie pusta.
       Przyk³ad: arpd_servers = 192.168.1.1 192.168.2.1
     * helpdesk_backend_mode
       W³±czenie tej opcji spowoduje, ¿e wszystkie wiadomo¶ci w systemie
       helpdesk (oprócz tych skierowanych do zg³aszaj±cego) bêd± wysy³ane
       do serwera pocztowego na adres odpowiedniej kolejki. Na serwerze
       tym powinien byæ uruchomiony skrypt lms-rtparser, który zajmie siê
       zapisem wiadomo¶ci do bazy danych. Domy¶lnie: wy³±czona.
       Przyk³ad: helpdesk_backend_mode = 1
     _________________________________________________________________

2.6. Prawa dostêpu

2.6.1. Idea

   LMS ma mo¿liwo¶æ zdefiniowania do 256 regu³ dostêpu do systemu. Ka¿da
   z nich mo¿e zabraniaæ, b±d¼ pozwalaæ na dostêp do konkretnych modu³ów.
   Ka¿demu administratorowi mo¿na przydzieliæ dowoln± kombinacjê regu³
   dostêpu.

   Domy¶lnie zdefiniowanych jest osiem regu³ dostêpu.
     * pe³en dostêp
     * odczyt wszystkich danych
     * pod³±czanie i od³±czanie komputerów
     * manipulowanie finansami
     * prze³adowywanie konfiguracji
     * manipulowanie danymi u¿ytkowników
     * manipulowanie danymi komputerów
     * dostêp do statystyk
     * dostêp do korespondencji seryjnej
     * brak dostêpu do modyfikacji i zak³adania kont administratorów
     * zarz±dzanie Helpdeskiem (RT)
     * obs³uga Helpdesku (RT)
     * brak dostêpu

   Siedem z nich zezwala na dostêp do modu³ów oraz jedna zabrania. Modu³y
   do których administrator ma zawsze dostêp to: welcome, copyrights,
   logout, chpasswd (przy czym chpasswd umo¿liwia tylko zmianê w³asnego
   has³a), dostêp do reszty jest zdefiniowany regu³ami.
   Notatka

   Je¶li nie ustawimy administratorowi ¿adnej regu³y dostêpu, to LMS
   domy¶lnie przydzieli mu regu³kê 0, czyli pe³en dostêp.
     _________________________________________________________________

2.6.2. Jak to dzia³a?

   Decyzja czy u¿ytkownik ma prawo dostêpu do modu³u czy nie przebiega
   nastêpuj±co:
   - najpierw sprawdzana jest lista modu³ów, do których zawsze ma siê
   dostêp,
   - potem nastêpuje sprawdzenie czy modu³ pasuje do regu³ w
   poszczególnych poziomach, do których administrator ma dostêp,
   - na koñcu podejmowana jest decyzja czy u¿ytkownik ma uprawnienia by
   do modu³u siê dobraæ. Je¿eli modu³ siê za³apa³ na którykolwiek poziom,
   który zabrania dostêpu, dostêp zostanie zabroniony nawet je¿eli
   administrator ma ustawiony poziom, który pozwala na dostêp do modu³u
   (np. kto¶ ma pe³ny dostêp oraz brak dostêpu do modu³u dodawania
   komputerów, nie bêdzie on móg³ siê odwo³aæ do tego modu³u). Je¿eli
   modu³ pasuje do poziomu, który pozwala na dostêp do danego modu³u LMS
   zezwala na dalsz± pracê. Je¿eli natomiast modu³ siê nie "za³apa³" na
   ¿aden poziom równie¿ zostanie mu wy¶wietlony komunikat o braku
   dostêpu.
     _________________________________________________________________

2.7. Upgrade

   Uaktualnienie LMS'a przebiega w dwóch etapach. Najpierw utwórz katalog
   z plikami nowej wersji (nie zaleca siê nadpisywania starych plików
   nowymi), nastêpnie trzeba dokonaæ zmian w bazie.

   Dla u³atwienia migracji danych w katalogu /doc przygotowano pliki
   UPGRADE-1.0-1.5.mysql i UPGRADE-1.0-1.5.pgsql dla przej¶cia od wersji
   1.0 do wersji 1.5 oraz UPGRADE-1.2-1.5.mysql i UPGRADE-1.2-1.5.pgsql
   przy migracji od wersji 1.2 (oraz 1.3.0) do bie¿±cej. W nich
   znajdziesz krótki opis jak przeprowadziæ aktualizacjê w zale¿no¶ci od
   stosowanej bazy danych. W wersjach o numerze wy¿szym od 1.3.0
   aktualizacja struktury bazy danych nastêpuje automatycznie podczas
   pierwszego logowania.

   Notatka

   W wersjach wy¿szych od 1.0.x biblioteka ADOdb nie jest wymagana, mo¿na
   skasowaæ odpowiedni katalog z katalogu /lib
     _________________________________________________________________

Rozdzia³ 3. Interfejs U¿ytkownika (LMS-UI)

   LMS'owy Interfejs U¿ytkownika to panel administracyjny do tworzenia i
   zarz±dzania baz± u¿ytkowników i komputerów dostêpny za pomoc±
   przegl±darki internetowej. Umo¿liwia wprowadzanie danych komputerów,
   przypisanie ich do u¿ytkowników i sieci. Definiowanie op³at i
   zarz±dzanie finansami sieci, Szybkie wyszukiwanie danych o
   u¿ytkownikach i ich sprzêcie. Sporz±dzanie korespondencji seryjnej do
   u¿ytkowników, definiowanie praw dostêpu dla administratorów i ich
   hase³. Ponadto daje mo¿liwo¶æ przegl±dania statystyk wykorzystania
   ³±cza, a tak¿e tworzenia kopii bazy danych oraz zarz±dzania
   konfiguracj± us³ug na serwerze. LMS-UI posiada tak¿e wiele innych
   mo¿liwo¶ci, które w tym rozdziale zostan± opisane.
     _________________________________________________________________

3.1. Logowanie

   Po wpisaniu w przegl±darce adresu do strony z lms'em, powita ciê ekran
   logowania. Musisz podaæ w³a¶ciwy login oraz has³o. Has³a w bazie
   danych przechowywane s± w formie zaszyfrowanej.

   Je¿eli jest to twoje pierwsze logowanie i nie masz jeszcze za³o¿onego
   konta, zostaniesz przekierowany do modu³u tworzenia kont
   administratorów. W tym momencie bêdziesz mia³ tylko dostêp do tego
   jednego modu³u.
     _________________________________________________________________

3.1.1. Praca z LMS-UI

   Po zalogowaniu do LMS'a zobaczysz panel powitalny, na którym znajduj±
   siê podstawowe informacje na temat naszego systemu: wersjê LMS i jego
   sk³adników, wersjê j±dra i uptime serwera, ilo¶æ u¿ytkowników i
   komputerów w bazie oraz ich stan (pod³±czony/od³±czony), liczbê
   zad³u¿onych i kwota oraz przydatne lms'owe linki.

   Z menu po lewej stronie wybierasz interesuj±cy ciê modu³. Mo¿esz
   równie¿ dokonaæ zmiany has³a, wylogowaæ siê lub szybko przej¶æ do
   informacji o u¿ytkowniku i komputerze. W polach szybkiego
   wyszukiwania, oprócz id u¿ytkownika lub komputera, mo¿esz podawaæ
   nazwisko, nazwê, fragment adresu, telefon, email, adres IP lub MAC. W
   przypadku gdy w bazie znajduje siê wiêcej u¿ytkowników pasuj±cych do
   szukanych danych zostan± wy¶wietlone informacje tylko o jednym
   u¿ytkowniku lub komputerze.
     _________________________________________________________________

3.2. U¿ytkownicy

   Tutaj zarz±dzasz danymi u¿ytkowników twojej sieci i ich finansami, ale
   tak¿e ich komputerami. Mo¿esz na przyk³ad jednym klikniêciem od³±czyæ
   wszystkie komputery u¿ytkownika.
   Notatka

   Do automatycznego od³±czania komputerów u¿ytkowników, których bilans
   jest poni¿ej zadanej warto¶ci s³u¿y skrypt lms-cutoff.
     _________________________________________________________________

3.2.1. Lista

   Po wej¶ciu do panelu 'U¿ytkownicy' uka¿e siê lista u¿ytkowników, któr±
   mo¿esz filtrowaæ wed³ug wybranych kryteriów (statusu, grupy lub sieci)
   lub sortowaæ klikaj±c na nazwie kolumny. Na li¶cie ikona ¿arówki
   informuje o statusie pod³±czenia komputerów u¿ytkownika, a ikona znaku
   drogowego o statusie ostrze¿eñ. Klikniêcie na nich zmienia status na
   przeciwny w stosunku do wszystkich komputerów danego u¿ytkownika. Gdy
   u¿ytkownik nie posiada przypisanych ¿adnych komputerów ikony te
   zostan± zamienione znakiem wykrzyknika.

   U u¿ytkowników z saldem ujemnym pojawia siê link "Rozlicz",
   pozwalaj±cy na zaksiêgowanie jednym klikniêciem wp³aty równowa¿±cej
   ujemne saldo.

   Klikniêcie na wybranym u¿ytkowniku spowoduje przej¶cie do panelu z
   informacjami szczegó³owymi o nim i przypisanych mu komputerach,
   taryfach oraz operacjach finansowych. Tam te¿ mo¿esz modyfikowaæ dane
   u¿ytkownika, definiowaæ op³aty abonamentowe i zaksiêgowaæ wp³atê lub
   obci±¿enie jego rachunku.
     _________________________________________________________________

3.2.2. Nowy

   Dodaj±c nowego u¿ytkownika podajesz jego nazwisko/nazwê i dane
   teleadresowe oraz status (pod³±czony/oczekuj±cy/zainteresowany).
   Notatka

   Czêsto zg³aszane jest blêdne kapitalizowanie narodowych znaków
   diakrytycznych. Odpowiedzialny za to jest serwer bazy danych i
   rozwi±zania nale¿y szukaæ w jego konfiguracji.
     _________________________________________________________________

3.2.3. Szukaj

   Mo¿liwe jest wyszukiwanie u¿ytkowników (tak¿e usuniêtych) wg zadanych
   kryteriów. Modu³ ten, od pola szybkiego wyszukiwania z menu po lewej
   stronie, oprócz tego, ¿e jest bardziej rozbudowany i pozwala
   wyszukiwaæ wg wielu kryteriów, ró¿ni siê tak¿e tym, ¿e zwraca listê
   u¿ytkowników spe³niaj±cych podane kryteria.
     _________________________________________________________________

3.2.4. Grupy

   Tutaj zarz±dzasz grupami u¿ytkowników. Po klikniêciu menu 'Grupy'
   uka¿e ci siê lista grup z podstawowymi informacjami o grupach.
   Klikaj±c na wybranej grupie przejdziesz do modu³u, w którym mo¿esz
   zmieniæ dane tej sieci, przegl±daæ oraz przypisywaæ u¿ytkowników do
   grup.
     _________________________________________________________________

3.2.5. Nowa grupa

   Grupa powinna posiadaæ unikaln± nazwê, sk³adaj±c± siê z liter, cyfr,
   znaku my¶lnika lub podkre¶lenia. Poniewa¿ grupy wykorzystywane s± w
   skryptach w nazwie nie mo¿e byæ znaku spacji.
     _________________________________________________________________

3.2.6. Ostrze¿enia

   Tutaj mo¿na "hurtowo" przypisaæ tre¶æ wiadomo¶ci administracyjnej
   u¿ytkownikom, których wybiera siê z listy w lewym oknie. Mo¿liwe jest
   tak¿e w³±czenie lub wy³±czenie ostrze¿eñ wszystkim komputerom
   nale¿±cym do wybranych u¿ytkowników.
     _________________________________________________________________

3.2.7. Wydruki

   Zestaw modu³ów wy¶wietlaj±cych listy w formie przyjaznej dla drukarki
   zawiera:
     * Lista u¿ytkowników z wieloma filtrami i dowolnym sortowaniem,
     * Raport wierzytelno¶ci u¿ytkownika(ów) na dany dzieñ,
     * Bilans u¿ytkownika za wybrany okres
     _________________________________________________________________

3.3. Komputery

   Panel ten s³u¿y do zarz±dzania komputerami i umo¿liwia: przegl±danie
   listy komputerów, wyszukiwanie, dodawanie nowych lub usuwanie ju¿
   wpisanych do bazy komputerów, a tak¿e podgl±d i zmianê informacji o
   nich.
     _________________________________________________________________

3.3.1. Lista

   Lista komputerów, ta która pokazuje siê po wej¶ciu do panelu
   'Komputery'. obejmuje wszystkie komputery w bazie. Mo¿na j± sortowaæ
   klikaj±c na nazwie dowolnej kolumny. W ka¿dym wierszu, po prawej
   stronie znajduj± siê ikony s³u¿±ce kolejno do: zmiany statusu
   komputera [Pod³±cz/Od³±cz], zmiany statusu ostrze¿enia [Ostrzegaj/Nie
   ostrzegaj], usuniêcia z bazy [Usuñ], wywo³ania panelu edycyjnego
   [Edytuj] oraz wy¶wietlenia informacji szczegó³owych na temat danego
   komputera [Info]. Do panelu informacyjnego, który jest zintegrowany z
   panelem informacji o w³a¶cicielu komputera mo¿na tak¿e przej¶æ
   klikaj±c na pod¶wietlonym wierszu.
     _________________________________________________________________

3.3.2. Nowy

   Tutaj dodaje siê nowe komputery do bazy danych. W tym celu definiujemy
   nazwê komputera (sk³adaj±c± siê z liter, cyfr, znaku podkre¶lenia lub
   my¶lnika), jego w³a¶ciciela, adres IP, adres MAC oraz status. Przy
   polach na adresy IP i MAC znajduj± siê linki do paneli, w których
   mo¿na wybraæ dostêpny adres IP oraz znaleziony w sieci MAC. Po
   wpisaniu danych naci¶nij "Zapisz". Przy wprowadzaniu danych dla wielu
   komputerów wygodnie jest zaznaczyæ pole "Wywo³aj ponownie..."
   Notatka

   Aby wyszukaæ komputery w swojej sieci mo¿esz skorzystaæ z programu
   nbtscan. Je¶li jest on zainstalowany w systemie, po naci¶niêciu
   'Skanuj' zobaczysz listê znalezionych komputerów.
   Notatka

   Aby dodaæ komputer musisz mieæ sieæ i u¿ytkownika, którym go
   przypiszesz.
     _________________________________________________________________

3.3.3. Szukaj

   Wyszukiwanie komputerów wed³ug zadanych kryteriów. Mo¿esz podaæ ca³±
   lub fragment nazwy komputera oraz jego adresów IP i MAC.
     _________________________________________________________________

3.3.4. Ostrze¿enia

   Tutaj definiuje siê tre¶æ wiadomo¶ci administracyjnych dla
   u¿ytkowników oraz w³±cza lub wy³±cza komputerom ostrze¿enia. Po lewej
   stronie znajduje siê lista, na której komputery z w³±czonym
   ostrze¿eniem zaznaczone s± kolorem czerwonym. Jesli chcesz tylko
   zmieniæ/przypisaæ u¿ytkownikom tre¶æ wiadomo¶ci administracyjnej,
   zaznacz odpowiednie komputery na li¶cie i pozostaw puste pola 'W³±cz
   ostrze¿enia' oraz 'Wy³±cz ostrze¿enia'.
     _________________________________________________________________

3.3.5. Wydruki

   Wy¶wietlenie list komputerów, w formacie przyjaznym dla drukarki z
   mo¿liwo¶ci± definiowania filtrów i sortowania podobnie jak na Li¶cie.
     _________________________________________________________________

3.4. Osprzêt sieciowy

   W panelu przeznaczonym do ewidencji sprzêtu zarz±dzamy struktur±
   sieci, urz±dzeniami typu swich, hub, router, serwer i po³±czeniami
   miêdzy nimi, a tak¿e przy³±czonymi do nich komputerami. Ka¿demu
   urzêdzeniu mo¿na przypisaæ co najmniej jeden adres sieciowy.
     _________________________________________________________________

3.4.1. Lista

   Lista urz±dzeñ zawiera ich nazwy i symbole, po³o¿enie i opis, a
   ponadto ilo¶æ dostêpnych portów. Lista mo¿e byæ sortowana wg dowolnego
   parametru/kolumny. Klikniêcie na wybranym urz±dzeniu spowoduje
   wy¶wietlenie informacji szczegó³owych o nim, gdzie mo¿liwe jest
   definiowanie po³±czeñ urz±dzeñ i komputerów, adresów IP urz±dzenia
   oraz zamiana dwóch urz±dzeñ.
     _________________________________________________________________

3.4.2. Nowe

   Urz±dzenie sieciowe powinno posiadaæ unikaln± nazwê. Pozosta³e
   parametry tj. producent, model, nr seryjny, ilo¶æ portów, lokalizacja
   i opis s± opcjonalne.
     _________________________________________________________________

3.4.3. Mapa

   Generowanie graficznej mapy ca³ej sieci, na podstawie danych z bazy
   lms'a nastêpuje po wybraniu opcji menu 'Mapa'. Mo¿esz zdefiniowaæ,
   które urz±dzenie jest nadrzêdne w stosunku do pozosta³ych.
   Notatka

   Do wygenerowania mapy potrzebna jest wbudowana w PHP obs³uga
   biblioteki graficznej GD.

   Na mapie hosty wy³±czone oznaczone s± kolorem czarnym. Ikona z
   pytajnikiem oznacza, ¿e dany komputer nie by³ jeszcze
   skanowany/w³±czony. Aby skorzystaæ z tej funkcjonalno¶ci nale¿y,
   korzystaj±c z crona, uruchamiaæ skrypt skanuj±cy. Na mapie komputer
   traktowany jest za w³±czony je¶li czas ostatniego pozytywnego
   skanowania nie jest starszy od zadanej warto¶ci (domy¶lnie 600
   sekund). Parametr ten okre¶la siê przy pomocy opcji lastonline_limit w
   sekcji [phpui] pliku konfiguracyjnego. Powy¿sze odnosi siê równie¿ do
   urz±dzeñ z tym, ¿e status urz±dzenia okre¶la siê na podstawie statusu
   wszystkich jego adresów. Status komputerów jest tak¿e widoczny na
   li¶cie komputerów.
   Notatka

   Do badania aktywno¶ci hostów mo¿na wykorzystaæ skrypt lms-fping lub
   demona almsd.
     _________________________________________________________________

3.5. Sieci IP

   Tutaj definiujesz dane swojej sieci tj. klasê adresow±, domenê, DNS'y,
   bramê, zakres DHCP. Je¿eli LMS s³u¿y ci do zarz±dzania wieloma
   sieciami lub dzielisz jedn± sieæ na podsieci, albo korzystasz z
   ró¿nych klas adresowych tutaj jest to mo¿liwe.
     _________________________________________________________________

3.5.1. Lista

   Lista sieci oprócz podstawowych danych o sieciach zawiera podsumowanie
   ilo¶ci adresów wolnych i przypisanych. Modyfikowanie w³a¶ciwo¶ci sieci
   nastêpuje w module dostêpnym po wybraniu sieci z listy lub
   bezpo¶rednio po klikniêciu ikony [Edytuj].

   Podczas edycji danych sieci mo¿esz przegl±daæ listê komputerów z tej
   sieci, gdzie w miejscu adresu IP pojawia siê nazwa
   komputera/urz±dzenia, do którego mo¿esz przej¶æ klikaj±c na
   odpowiednim polu. Klikniêcie na polu z adresem IP przeniesie Ciê do
   modu³u dodawania nowego komputera. Znajdziesz tu tak¿e dwa przydatne
   linki: Porz±dkuj sieæ s³u¿±cy do przeadresowania komputerów, tak aby
   wyeliminowaæ luki w adresacji oraz Przeadresuj do sieci s³u¿±cy do
   przenoszenia wszystkich komputerów/urz±dzeñ z tej sieci do innej.
     _________________________________________________________________

3.5.2. Nowa sieæ

   Definiuj±c now± sieæ musisz okre¶liæ jej unikaln± nazwê i klasê
   adresow± podaj±c adres IP sieci i maskê. Pozosta³e dane s± opcjonalne.
     _________________________________________________________________

3.6. Taryfy i Finanse

   Jest to w³a¶ciwie wiele modu³ów umo¿liwiaj±cych zarz±dzanie finansami
   sieci. Masz mo¿liwo¶æ definiowania taryf abonamentowych, op³at
   (zleceñ) sta³ych, ksiêgowania operacji finansowych, przegl±dania
   bilansu i historii rachunku oraz sporz±dzania faktur i zestawieñ
   finansowych.
     _________________________________________________________________

3.6.1. Lista taryf

   Po wej¶ciu do panelu 'Taryfy i finanse' zobaczysz listê taryf
   zawieraj±c± podstawowe informacje o nich. Klikaj±c wybran± taryfê na
   li¶cie zostaniesz przeniesiony do modu³u 'Informacje o taryfie', gdzie
   mo¿esz edytowaæ jej parametry lub zamieniaæ u¿ytkownikom taryfy. W
   polu 'ilo¶æ u¿ytkowników' podana jest liczba u¿ytkowników, którym dana
   taryfa zosta³a przypisana oraz kolejno od lewej (w nawiasie) ca³kowita
   liczba przypisañ taryfy i liczba aktywnych przypisañ taryfy,
   uwzglêdniaj±ca okresy obowi±zywania.
     _________________________________________________________________

3.6.2. Nowa taryfa

   Definiuj±c now± taryfê musisz podaæ unikaln± nazwê, kwotê i stawkê
   podatku. Przy czym "zw." w polu stawka podatku oznacza "zwolnienie z
   podatku".
     _________________________________________________________________

3.6.3. Lista op³at

   Lista op³at sta³ych ¶wiadczonych na rzecz innych podmiotów, oprócz
   elementów standardowych zawiera ikonê [Nalicz], przy pomocy której
   mo¿na obci±¿yæ rachunek sieci. Automatycznym naliczaniem op³at zajmuje
   siê skrypt 'lms-payments' lub odpowiedni modu³ demona almsd. Klikaj±c
   wybran± op³atê na li¶cie zostaniesz przeniesiony do modu³u 'Informacje
   o op³acie', gdzie mo¿esz edytowaæ jej parametry lub zaksiêgowaæ dan±
   op³atê w bazie operacji finansowych.
     _________________________________________________________________

3.6.4. Nowa op³ata

   Nowej op³acie sta³ej przypisujesz unikaln± nazwê, wierzyciela oraz
   kwotê i dzieñ naliczenia.
     _________________________________________________________________

3.6.5. Bilans finansowy

   Historia operacji finansowych z podsumowaniem przychodu, rozchodu,
   wp³at i zobowi±zañ u¿ytkowników. Ikona drukarki umo¿liwia wydruk
   faktury odpowiadaj±cej danej pozycji z listy.
     _________________________________________________________________

3.6.6. Nowa operacja

   Wprowadzanie nowych operacji finansowych. Mo¿liwe jest zaksiêgowanie
   tej samej wp³aty lub obci±¿enia wielu u¿ytkownikom równocze¶nie.

   Notatka

   Do naliczania sta³ych op³at abonamentowych najlepiej wykorzystywaæ
   skrypt lms-payments lub demona almsd, które potrafi± ponadto wystawiaæ
   faktury.
     _________________________________________________________________

3.6.7. Lista faktur

   Lista wystawionych faktur z mo¿liwo¶ci± wydruku wybranych faktur
   (ikona [Drukuj]) oraz rozliczenia danej pozycji, czyli zaksiêgowania
   wp³aty (ikona [Rozlicz]).
     _________________________________________________________________

3.6.8. Nowa faktura

   Rêczne wystawianie faktur dla wybranego u¿ytkownika.

   LMS umo¿liwia wystawianie faktur automatycznie i rêcznie. Rêczne
   wystawienie dowolnej faktury jest mo¿liwe z menu 'Nowa faktura' w
   panelu 'Taryfy i finanse'. Automatyczne wystawianie faktur wymaga
   w³±czenia tej opcji podczas przypisywania taryf u¿ytkownikom. W takim
   wypadku zapisem faktur do bazy zajmuje siê skrypt lms-payments lub
   demon almsd

   Do poprawnego dzia³ania i tworzenia wydruków wymagane jest ustawienie
   podstawowych opcji w sekcji [invoices] lms.ini:
     * number_template
       Wzorzec numeru faktury. Dostêpne zmienne wzorca to: '%N' - numer
       kolejny w roku, '%M' - miesi±c wystawienia, '%Y' - rok
       wystawienia. Domy¶lnie: %N/LMS/%Y
       Przyk³ad: number_template = %N/%Y
     * header
       Dane sprzedawcy. Domy¶lnie: pusty. Mo¿na u¿yæ ci±gu "\n" aby
       oddzieliæ linie od siebie.
       Przyk³ad: header = "SuperNet ISP\nul.Nowa 15\n12-000 W±chock\n"
     * footer
       Stopka faktury - np. dane sprzedawcy. Domy¶lnie: pusta. Stopka
       zostanie umieszczona na dole faktury, ma³± czcionk±. Podobnie jak
       i w przypadku opcji header, mo¿na u¿yæ ci±gu "\n" aby oddzieliæ
       linie od siebie.
       Przyk³ad: footer = "Blokowa Sieæ Komputerowa K-27 w Mielcu,
       tel.555-23-23, bla bla"
     * default_author
       Domy¶lna osoba wystawiaj±ca fakturê. Domy¶lnie: puste
       Przyk³ad: default_author = "specjalista d/s fakturowania"

   Ponadto dostêpne s± zmienne:
     * cplace
       Miejsce wystawienia faktury. Domy¶lnie: puste.
       Przyk³ad: cplace = Warszawa
     * template_file
       Szablon faktury, który powinien znajdowaæ siê w katalogu
       templates. Domy¶lnie: invoice.html.
       Przyk³ad: template_file = invoice-mynet.html
     * content_type
       Content-type dla faktury. Je¿eli wpiszesz tutaj
       'application/octet-stream' to przegl±darka zechce wys³aæ plik do
       zapisania na dysku, zamiast go wy¶wietliæ. Przydatne je¶li u¿ywasz
       w³asnego templejta, który wygeneruje np.rtf'a lub xls'a.
       Domy¶lnie: 'text/html; charset=iso-8859-2'
       Przyk³ad: content_type = application/octet-stream
     * attachment_name
       Mo¿na podaæ nazwê pliku, jako który ma zostaæ zapisany gotowy
       wydruk. Domy¶lnie: pusta.
       Przyk³ad: attachment_name = faktura.xls

   Wygenerowane faktury mo¿na obejrzeæ w dwojaki sposób: albo poprzez
   ikonkê drukarki na wykazie bilansu finansowego (ogólnego b±d¼
   pojedynczego u¿ytkownika), albo poprzez 'Lista faktur' z menu 'Taryfy
   i finanse'. W przypadku listy faktur, mo¿liwe jest tak¿e filtrowanie
   faktur do wydruku. Wynikowy dokument HTML zawiera orygina³y i kopie,
   które s± oddzielone znacznikami podzia³u strony poprzez CSS. Tak wiêc
   ka¿da nowoczesna przegl±darka zgodna z CSS powinna bezproblemowo
   drukowaæ faktury ³adnie podzielone na strony. Funkcja ta by³a
   testowana na przegl±darkach Microsoft Internet Explorer 6.0, Opera
   7.02 oraz Mozilla 1.3.

   Notatka

   Praktycznie ka¿da przegl±darka internetowa ma mo¿liwo¶æ konfiguracji
   wydruku, gdzie mo¿na wy³±czyæ funkcje takie jak drukowanie stopki i
   nag³ówka, czy te¿ adresu na wydruku.
   Ostrze¿enie

   W bazie danych zapisywane s± kwoty brutto.
     _________________________________________________________________

3.6.9. Wydruki

   Wydruki zestawieñ finansowych obejmuj±:
     * Bilans finansowy sieci obejmuj±cy operacje finansowe za dany okres
       z mo¿liwo¶ci± wybrania administratora.
     * £±czny przychód bezrachunkowy sieci w danym okresie.
     * Raport wierzytelno¶ci na dany dzieñ, dla wszystkich lub wybranego
       u¿ytkownika.
     * Rejestr sprzeda¿y, czyli zestawienie faktur na dany okres.
     * Bilans u¿ytkownika na dany okres.
     _________________________________________________________________

3.7. Mailing

   Mailing, czyli Korespondencja Seryjna umo¿liwia wysy³anie wiadomo¶ci
   do grupy u¿ytkowników twojej sieci. Podajesz dane nadawcy, tre¶æ
   wiadomo¶ci oraz wybierasz grupê odbiorców, do której zostanie wys³any
   e-mail. Grupê adresatów mo¿na okre¶liæ wg statusu oraz sieci lub grup
   u¿ytkowników do których nale¿±.

   Notatka

   Serwer musi byæ odpowiednio skonfigurowany do u¿ycia funkcji mail().
   Notatka

   Do automatycznego wysy³ania upomnieñ do u¿ytkowników zalegaj±cych z
   op³atami mo¿na wykorzystaæ skrypt lms-notify lub modu³y notify i
   ggnotify demona almsd.
     _________________________________________________________________

3.8. Prze³adowanie

   Klikniêcie na menu 'Prze³adowanie' spowoduje prze³adowanie
   konfiguracji i us³ug zdefiniowanych dla generatora plików
   konfiguracyjnych LMS-MGC lub demona almsd. Wiêcej informacji
   znajdziesz w rozdzia³ach dotycz±cych LMS-MGC oraz demona.
     _________________________________________________________________

3.9. Bazy danych

   Z panelu 'Bazy danych' mo¿esz zarz±dzaæ kopiami awaryjnymi danych z
   bazy lms'a. Kopia bazy to plik tekstowy zawieraj±cy zapytania SQL i
   dane z wszystkich tabel w bazie, zapisywany w katalogu zdefiniowanym w
   sekcji [directories] lms.ini zmienn± backup_dir.

   Notatka

   Domy¶lnie kopie zapisywane s± w katalogu lms/backups dostêpnym przez
   przegl±darkê, dlatego dobrze by³o by przenie¶æ go w inne miejsce.

   Sporz±dzone kopie mo¿na w ka¿dej chwili przegl±daæ, usuwaæ lub
   zapisywaæ na lokalnym dysku. Klikniêcie na ikonkê Odtwórz spowoduje
   wyczyszczenie bie¿±cej bazy danych i za³adowanie do niej danych z
   wybranego pliku kopii. Tu¿ przed odtworzeniem tworzona jest kopia
   aktualnej bazy danych.
     _________________________________________________________________

3.10. Administratorzy

   Panel 'Administratorzy' s³u¿y do zarz±dzania kontami administratorów,
   czyli osób korzystaj±cych z LMS'a, zak³adania i przegl±dania ich kont,
   zmiany hase³ i definiowania praw dostêpu.

   Prawa dostêpu zosta³y szczegó³owo opisane w rozdziale Prawa dostêpu.
     _________________________________________________________________

3.10.1. Lista

   Po wej¶ciu do panelu 'Administratorzy' zobaczysz listê wszystkich
   administratorów z informacj± o ostatnim logowaniu. Klikniêcie na
   pozycji z listy spowoduje wy¶wietlenie informacji szczegó³owych o
   danym koncie, w tym o zdefiniowanych prawach dostêpu. W ka¿dej chwili
   mo¿liwa jest zmiana danych i uprawnieñ za pomoc± przycisku 'Edytuj'.
   Aby za³o¿yæ nowe konto administratora skorzystaj z górnego menu
   'Nowy'.
     _________________________________________________________________

3.10.2. Nowy

   Aby dodaæ nowe konto administratora nale¿y podaæ login oraz has³o,
   które nie mo¿e byæ puste. Podanie imienia, nazwiska i adresu poczty
   elektronicznej nie jest wymagane. Poni¿ej mo¿na zaznaczyæ uprawnienia
   dostêpu do systemu. Je¿eli wszystkie pola pozostawisz puste,
   administratorowi przypisany zostanie 'Pe³en dostêp'.
     _________________________________________________________________

3.11. Statystyki

   Interfejs do przegl±dania statystyk wykorzystania ³±cza w postaci
   prostych wykresów jest dostêpny w menu 'Statystyki'. Dane statystyk
   zawieraj± lo¶æ danych wysy³anych i pobieranych z Internetu (na danym
   interfejsie) dla ka¿dego komputera. Korzystaj±c z górnego menu mo¿esz
   szybko wygenerowaæ statystyki z ostatniej godziny, ostatniego dnia,
   ostatnich 30 dni lub ostatniego roku.

   Notatka

   Zapisem danych do bazy zajmuje siê skrypt lms-traffic, albo demon
   almsd.
     _________________________________________________________________

3.11.1. Filtr

   Przed wygenerowaniem wykresu mo¿esz zdefiniowaæ parametry okre¶laj±ce
   okres jaki ma byæ brany pod uwagê, ograniczyæ do jednej sieci (je¶li
   masz ich wiêcej), ilo¶ci komputerów oraz posortowaæ odpowiednio wyniki
   (na przyk³ad wed³ug downloadu).
     _________________________________________________________________

3.11.2. Kompaktowanie

   W zale¿no¶ci od wybranej przez u¿ytkownika czêstotliwo¶ci zapisu, mo¿e
   nast±piæ szybki przyrost danych w bazie, co spowoduje zwiêkszenie
   czasu oczekiwania na rysowanie wykresów. Z tego powodu w menu
   'Kompaktowanie' udostêpniono mo¿liwo¶æ zmniejszenia rozmiarów bazy
   statystyk bez utraty danych. Wybieraj±c poziom dok³adno¶ci danych,
   dane zostan± u¶rednione w nastêpuj±cy sposób:
     * Poziom Niski: dane z poprzedniego dnia i starsze, zostan±
       u¶rednione do jednego dnia, czyli je¶li do bazy zapisywane by³y z
       czêstotliwo¶ci± 10 minut, to 6*24 wpisów zostanie zast±pione
       jednym.
     * Poziom ¦redni: dane starsze ni¿ miesi±c zostan± u¶rednione do
       jednego dnia.
     * Poziom Wysoki: dane starsze ni¿ miesi±c zostan± u¶rednione do
       jednej godziny.

   Ostrze¿enie

   Kompaktowanie bazy danych jest procesem nieodwracalnym.
     _________________________________________________________________

3.12. Helpdesk

   Helpdesk (inaczej Request Tracker) to system obs³ugi zg³oszeñ. W
   systemie mo¿na prowadziæ bazê wszystkich zg³oszeñ i zapytañ
   u¿ytkowników sieci, ale tak¿e osób które nie s± wpisane do bazy LMS'a.
   Zg³oszenia mo¿na pogrupowaæ w kategorie (kolejki) i wyszukiwaæ wg
   zadanych kryteriów. Do ka¿dej kolejki mo¿na zdefiniowaæ uprawnienia
   dla administratorów.

   W menu po lewej stronie znajduje siê pole szybkiego wyszukiwania
   zg³oszenia, w którym mo¿na podawaæ jego ID lub nazwisko zg³aszaj±cego
   je u¿ytkownika. W drugim przypadku zostanie wy¶wietlona lista
   wszystkich zg³oszeñ danego u¿ytkownika.

   Ka¿de zg³oszenie posiada historiê, na któr± sk³adaj± siê wiadomo¶ci od
   administratorów i u¿ytkowników. Administrator mo¿e wys³aæ swoj±
   wiadomo¶æ do u¿ytkownika, klikaj±c 'Wy¶lij' podczas dodawania
   wiadomo¶ci. (Nale¿y podaæ e-mail odbiorcy. Adresem nadawcy bêdzie
   adres kolejki, a je¶li jest pusty, adres administratora). Wszystkie
   wiadomo¶ci tak¿e te wys³ane, zostaj± zapisane w historii zg³oszenia.
   Zg³oszenie mo¿e mieæ cztery stany: nowy, otwarty, rozwi±zany i martwy.

   Skrypt lms-rtparser zosta³ stworzony aby umo¿liwiæ obs³ugê systemu i
   przesy³anie zg³oszeñ poczt± elektroniczn±.
     _________________________________________________________________

3.12.1. Lista kolejek

   Na li¶cie kolejek znajduj± siê podstawowe informacje i statystyki
   zg³oszeñ. Klikniêcie na wybranej kolejce powoduje wy¶wietlenie listy
   zg³oszeñ. St±d mo¿na tak¿e przej¶æ do informacji szczegó³owych (w tym
   tak¿e uprawnieniach) o kolejce lub usun±æ wybran± kolejkê. Usuniêcie
   kolejki spowoduje tak¿e usuniêcie zg³oszeñ z bazy danych przypisanych
   do niej.
     _________________________________________________________________

3.12.2. Nowa kolejka

   Kolejka (kategoria) posiada nazwê, opcjonalny opis oraz opcjonalny
   adres poczty elektronicznej, który u¿ywany jest do korespondencji. W
   tabeli 'Uprawnienia' definiuje siê prawa do danej kolejki, które maj±
   moc wiêksz± od ogólnych uprawnieñ administratorów tzn. je¶li admin nie
   ma praw do danej kolejki, to nawet je¶li ma 'pe³ny dostêp' zg³oszeñ w
   tej kolejce nie zobaczy. Prawo zapisu (dodawanie/edytowanie zg³oszeñ i
   wiadomo¶ci) oznacza automatyczne prawo do odczytu.
     _________________________________________________________________

3.12.3. Wyszukaj

   Wyszukiwanie zg³oszeñ polega na wybraniu z bazy zg³oszeñ spe³niaj±cych
   wszystkie podane kryteria (warunek AND, nie OR). Mo¿esz podaæ temat,
   w³a¶ciciela, kolejkê, status i zg³aszaj±cego. Klientów sieci wybieraj
   z listy, dla pozosta³ych nale¿y podaæ Nazwisko/Imiê i/lub e-mail.
     _________________________________________________________________

3.12.4. Nowe zg³oszenie

   Dodaj±c nowe zg³oszenie nale¿y okre¶liæ dla niego temat, tre¶æ, wybraæ
   kolejkê oraz zg³aszaj±cego u¿ytkownika. Osoby spoza sieci wpisujemy w
   polach Nazwisko i Imiê. Opcjonalnie, je¶li wiadomo¶æ zosta³a zg³oszona
   poczt± elektroniczn± podajemy adres e-mail (tak¿e dla u¿ytkownika
   zapisanego w bazie).
     _________________________________________________________________

Rozdzia³ 4. Skrypty

4.1. Instalacja

   Je¶li chcesz ustawiæ konfiguracjê którego¶ ze skryptów, robi siê to w
   odpowiedniej sekcji lms.ini. Same skrypty przenie¶ z katalogu
   /lms/bin/ do katalogu /usr/sbin. Po przeniesieniu musisz je jeszcze
   dopisaæ do crontaba tak, aby by³y uruchamiane automatycznie, w³a¶nie
   wtedy kiedy tego chcesz.

   Przyk³adowo, wpis w crontabie dla skryptu lms-payments (wykonywanego
   codziennie o godzinie 00:01) powinien wygl±daæ nastêpuj±co:
1 0 * * *       /usr/sbin/lms-payments 1 > /dev/null

   Po wiêcej informacji mo¿esz siêgn±æ do man crontab

   Wiêkszo¶æ lms'owych skryptów posiada dodatkowe opcje uruchomieniowe:
-C plik     po³o¿enie i nazwa alternatywnego pliku lms.ini, domy¶lnie /etc/lms/lms.ini
-q          wykonanie skryptu bez wy¶wietlania komunikatów
-h          pomoc (a w zasadzie to tylko listing opcji)
-v          informacja o wersji skryptu
     _________________________________________________________________

4.2. Lista dostêpnych skryptów

   Tabela 4-1. Lista skryptów wykonywalnych
   Nazwa Opis
   lms-notify Korespondencja seryjna do u¿ytkowników sieci
   lms-notify-sms Powiadamianie o zaleg³o¶ciach sms'em
   lms-cutoff Od³±czanie u¿ytkowników zad³u¿onych
   lms-etherdesc Generowanie pliku dla iptraf zawieraj±cego pary MAC
   adres - nazwa hosta
   lms-payments Naliczanie op³at okresowych (abonamentowych) z
   fakturowaniem
   lms-traffic Zapis statystyk wykorzystania ³±cza
   lms-traffic-logiptables Statystyki ³±cza dla iptables
   lms-makearp Tworzenie tablicy ARP (/etc/ethers)
   lms-makedhcpconf Konfiguracja serwera DHCP (/etc/dhcpd.conf)
   lms-makeiptables Konfiguracja firewalla iptables
   lms-makeipchains Konfiguracja firewalla ipchains
   lms-makeopenbsdpf Konfiguracja firewalla dla systemu OpenBSD
   lms-makeoidentconf Konfiguracja oident
   lms-sendinvoices Wysy³anie faktur do u¿ytkowników
   lms-makemacs Filtrowanie ruchu na bazie adresów ¼ród³owych MAC
   lms-makehosts Generuje plik /etc/hosts
   lms-makewarnings Generuje regu³ki przekierowuj±ce ruch u¿ytkowników
   zad³u¿onych
   lms-makemessages Generuje regu³ki przekierowuj±ce ruch u¿ytkowników,
   którym ustawiono wiadomo¶æ administracyjn±
   lms-fping Badanie aktywno¶ci komputerów.
   lms-rtparser Backend do Helpdesk'a.
     _________________________________________________________________

4.3. Opis i konfiguracja

4.3.1. lms-notify

   lms-notify jest dobrym sposobem przypominania ludziom o tym ¿e do
   pracy sieci i ³±cz konieczne s± ich pieni±¿ki. Pozwala on na napisanie
   kilku[-nastu] plików tekstowych (w iso-8859-2) i traktowania ich jako
   szablonów do mailingu.
     _________________________________________________________________

4.3.1.1. Szablony

   W szablonach mo¿na u¿ywaæ nastêpuj±cych zmiennych:
     * %date-m - zostanie zast±pione aktualnym miesi±cem, licz±c od 1
       poprzedzone 0, np. 02
     * %date-y - zostanie zast±pione aktualnym rokiem, np 2003
     * %saldo - zostanie zast±pione aktualnym saldem u¿ytkownika, np. 535
     * %abonament - zostanie zast±pione kwot± abonamentu jaka jest do
       danego u¿ytkownika przypisana, np. 107
     * %b - saldo z zanegowanym znakiem, np. 107
     * %B - saldo z prawdziwym znakiem, np. -107
     * %last_10_in_a_table - wyci±g ostatnich 10 operacji kasowych na
       koncie u¿ytkownika, np:
     * %pin - numer PIN u¿ytkownika.

   Przyk³ad 4-1. Lms-notify: Przyk³adowy wyci±g 10 ostatnich operacji
   kasowych
Data       | Opis                                                 | Warto¶æ
-----------+------------------------------------------------------+---------
2003-02-02 | Abonament za miesi±c 2003/02                         |  107.00
2003-02-01 | Wp³ata                                               | -107.00
2003-02-01 | Abonament za miesi±c 2003/02                         |  107.00
2003-02-01 | Wp³ata                                               | -321.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
2003-01-31 | Abonament za miesi±c 2003/01                         |  107.00
-----------+------------------------------------------------------+---------

   Przyk³ad 4-2. Lms-notify: Przyk³ad szablonu
UWAGA! Ta wiadomo¶æ zosta³a wygenerowana automatycznie.

Uprzejmie informujemy i¿ na Pani/Pana koncie figuruje zaleg³o¶æ w op³atach za
internet w wysoko¶ci %B z³.

Je¿eli porozumieli siê ju¿ Pañstwo z administratorami w kwestii op³aty za
bie¿±cy miesi±c czyli %date-m %date-y roku, prosimy o
zignorowanie tej wiadomo¶ci.

W wypadku gdy uwa¿aj± Pañstwo i¿ zaleg³o¶æ ta jest nieporozumieniem prosimy o
jak najszybszy kontakt.

Wszelkie informacje na temat Pañstwa rozliczeñ mog± Pañstwo znale¼æ pod
adresem http://www.naszasiec.pl/mojekonto/

Je¿eli chcieliby Pañstwo uregulowaæ zaleg³o¶ci prosimy o kontakt:

Dzia³ Rozliczeñ ASK NaszaSiec

Gerwazy Regu³a
telefon: 0-509031337
e-mail: gerwazy@staff.naszasiec.pl

Gwidon Mniejwa¿ny
telefon: 0-606666666
e-mail: gwidonm@naszasiec.pl

ps. za³±czamy ostatnie 10 operacji jakie zosta³o zarejestrowane przez nasz
system bilingowy na Pañstwa koncie:

kwota operacji | typ operacji | data

%last_10_in_a_table

--
Amatorska Sieæ Komputerowa NaszaSiec
http://www.naszasiec.pl/
     _________________________________________________________________

4.3.1.2. Konfiguracja

   Konfiguracjê dla lms-notify mo¿na ustaliæ w pliku lms.ini w sekcji
   [notify]. Mo¿esz tam ustawiæ nastêpuj±ce parametry:
     * limit (opcjonalny)
       Pozwala na ustalenie limitu bilansu, poni¿ej którego do
       u¿ytkownika zostanie wys³any e-mail z upomnieniem. Domy¶lnie limit
       = 0
       Przyk³ad: limit = -20
     * mailsubject (wymagany)
       Pozwala na ustalenie tematu e-maila wysy³anego do u¿ytkownika.
       Mo¿na u¿ywaæ podstawieñ znanych z szablonów (%B, %b, %date-y,
       %date-m, %last_10_in_a_table). Domy¶lnie: nie ustawione.
       Przyk³ad: mailsubject = Informacje o zaleg³o¶ciach w op³atach za
       internet
     * mailtemplate (wymagany)
       Pozwala na wskazanie szablonu wiadomo¶ci, która zostanie wys³ana
       do u¿ytkownika. Wiêcej o szablonach tutaj. Domy¶lnie: nie
       ustawione.
       Przyk³ad: mailtemplate = /etc/lms/notifytemplate.txt
     * mailfrom
       Adres e-mail z którego zostanie wys³any e-mail. Proszê pamiêtaæ,
       ¿e na niektórych MTA (np. exim) konto to musi istnieæ w systemie.
       Domy¶lnie nieustawione
       Przyk³ad: mailfrom = staff@domain.pl
     * mailfname
       Nazwa nadawcy maila
       Przyk³ad: mailfname = Administratorzy
     * smtp_server
       Serwer SMTP, przez który ma zostaæ wys³ana wiadomo¶æ. Domy¶lnie:
       127.0.0.1
       Przyk³ad: smtp_server = smtp.mydomain.pl
     * debug_email (opcjonalny)
       Adres e-mail do debugowania. Gdy ustawiony, ca³a poczta zostaje
       wys³ana na dany email zamiast do u¿ytkowników. Przydatne do
       debugowania i sprawdzania czy wszystko dzia³a OK. Domy¶lnie: nie
       ustawiony.
       Przyk³ad: debug_email = lexx@domain.pl
     _________________________________________________________________

4.3.2. lms-notify-sms

   lms-notify-sms to odpowiednik lms-notify, s³u¿±cy do wysy³ania smsów.
   Do wysy³ania wiadomo¶ci potrzebna jest komórka Nokii oraz
   oprogramowanie, które nale¿y pobraæ z (www.gnokii.org) i zainstalowaæ
   w systemie.

   Konfiguracjê dla lms-notify-sms mo¿na ustaliæ w pliku lms.ini w sekcji
   [notify-sms], a masz do dyspozycji nastêpuj±ce opcje:
     * limit (opcjonalny)
       Pozwala na ustalenie limitu bilansu poni¿ej którego do u¿ytkownika
       zostanie wys³any sms z upomnieniem. Domy¶lnie: 0
       Przyk³ad: limit = -20
     * smstemplate (wymagany)
       Szablon wiadomo¶ci. Domy¶lnie: nie ustawione.
       Przyk³ad: smstemplate = /etc/lms/smstemplate.txt
     _________________________________________________________________

4.3.3. lms-cutoff

   Skrypt pozwala na od³±czenie (a raczej zmianê w bazie danych stanu
   komputerów na wy³±czony) u¿ytkowników których bilans jest poni¿ej
   zadanej warto¶ci. W³a¶ciwe od³±czanie powinno byæ realizowane przez
   generator plików konfiguracyjnych.

   Konfiguracjê dla lms-cutoff mo¿emy ustaliæ w pliku lms.ini w sekcji
   [cutoff]. Mo¿emy tam ustawiæ nastêpuj±ce parametry:
     * limit (opcjonalny)
       Pozwala na ustalenie limitu bilansu poni¿ej którego do bazy danych
       zostanie zapisany stan od³±czony. Domy¶lnie: 0
       Przyk³ad: limit = -20
     _________________________________________________________________

4.3.4. lms-payments

   Skrypt s³u¿±cy do naliczania op³at abonamentowych przypisanych
   u¿ytkownikom oraz op³at sta³ych. Ponadto zapisuje dane do faktur. Aby
   dzia³a³ poprawnie powinien byæ uruchamiany codziennie.

   Skrypt ten udostêpnia dwie opcje do fakturowania, które mo¿na ustawiæ
   w sekcji [payments] pliku lms.ini:
     * deadline (opcjonalny)
       Pozwala na ustalenie terminu p³atno¶ci w dniach. Domy¶lnie: 14
       Przyk³ad: deadline = 7
     * paytype (opcjonalny)
       Okre¶la rodzaj p³atno¶ci. Domy¶lnie: 'PRZELEW'
       Przyk³ad: paytype = 'GOTÓWKA'
     _________________________________________________________________

4.3.5. lms-traffic

   Skrypt s³u¿y do logowania informacji o ilo¶ci danych pobranych i
   wys³anych przez ka¿dy komputer w sieci lokalnej. W bazie danych
   zapisywana jest ilo¶æ danych w bajtach, numer komputera z bazy lms i
   znacznik czasu. Od u¿ytkownika zale¿y w jakich odstêpach dane bêd±
   odczytywane. Poniewa¿ dane odczytywane s± z pliku utworzonego przez
   u¿ytkownika, nie ma znaczenia z jakiego ¼ród³a pochodz±, mo¿e to byæ
   iptables, ipchains lub program zewnêtrzny np. ipfm.

   Przegl±danie wykresów wykorzystania ³±cza oraz definiowanie filtrów
   dostêpne jest z g³ównego menu 'Statystyki'.
     _________________________________________________________________

4.3.5.1. Instalacja

   Przed uruchomieniem lms-traffic nale¿y zadbaæ o utworzenie pliku z
   danymi. Zawarto¶æ pliku powinna mieæ nastêpuj±cy format:
<adres IP> <n_spacji> <upload> <n_spacji> <download>
<adres IP> <n_spacji> <upload> <n_spacji> <download>
...

   Skrypt tworz±cy statystyki nale¿y uruchamiaæ z tak± sam±
   czêstotliwo¶ci± co lms-traffic.

   Notatka

   Przyk³ad takiego skryptu dla iptables znajduje siê w pliku
   /sample/traffic_ipt.sh.

   Nastêpnie instalujemy skrypt dopisuj±c do crontaba. Oprócz
   standardowych opcji wiersza poleceñ mo¿liwe jest zdefiniowanie
   lokalizacji pliku z logiem
-f=/plik        po³o¿enie i nazwa pliku ze statystykami domy¶lnie /var/log/traffic.log

   Ostrze¿enie

   Czêstotliwo¶æ zapisywania danych do bazy ustala u¿ytkownik. Ustawienie
   jej poni¿ej 10 minut, mo¿e spowodowaæ szybki przyrost ilo¶ci rekordów
   w bazie danych, a co za tym idzie zwiêkszyæ czas oczekiwania na
   wy¶wietlenie wyników.
     _________________________________________________________________

4.3.6. lms-traffic-logiptables

   Skrypt s³u¿y do logowania informacji o ilo¶ci danych pobranych i
   wys³anych przez ka¿dy komputer z sieci lokalnej, na podstawie
   liczników iptables. Dane sczytuje z firewalla, tworz±c jednocze¶nie
   odpowiednie regu³y. Zatem, nie jest konieczne rêczne tworzenie regu³
   iptables, ani wywo³ywanie skryptu lms-traffic.

   Konfiguracjê nale¿y umie¶ciæ w sekcji [traffic-logiptables]:
     * outfile
       Lokalizacja skryptu z regu³ami iptables. Domy¶lnie:
       /etc/rc.d/rc.stat
       Przyk³ad: outfile = /etc/rc.d/rc.stat
     * iptables_binary
       Lokalizacja programu iptables. Domy¶lnie: /usr/sbin/iptables
       Przyk³ad: iptables_binary = /usr/local/sbin/iptables
     * wan_interfaces
       Nazwy interfejsów, na których dane maj± byæ zliczane. Domy¶lnie:
       niezdefiniowane.
       Przyk³ad: wan_interfaces = eth0
     * local_ports
       Lista portów (¼ród³owych i docelowych) dla zliczanych pakietów.
       Domy¶lnie: niezdefiniowane.
       Przyk³ad: local_ports = 80
     * script_owneruid
       UID w³a¶ciciela skryptu okre¶lonego w 'outfile'. Domy¶lnie: 0
       (root).
       Przyk³ad: script_owneruid = 0
     * script_ownergid
       GID w³a¶ciciela skryptu okre¶lonego w 'outfile'. Domy¶lnie: 0
       (root).
       Przyk³ad: script_ownergid = 0
     * script_permission
       Uprawnienia skryptu okre¶lonego w 'outfile'. Domy¶lnie: 700
       (rwx------).
       Przyk³ad: script_permission = 700
     _________________________________________________________________

4.3.7. lms-makeiptables, lms-makeipchains

   Para skryptów s³u¿±cych do generowania plików zawieraj±cych regu³y
   firewalla. Do utworzonego pliku mo¿esz do³±czyæ inne wcze¶niej
   utworzone pliki, a w koñcu nadaæ mu odpowiednie uprawnienia. Skrypty
   nie uruchamiaj± wygenerowanych plików.

   Konfiguracjê dla tych skryptów mo¿esz ustaliæ w pliku lms.ini w sekcji
   [iptables] (i odpowiednio [ipchains]). Oba skrypty posiadaj± te same
   opcje:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas generowania pliku firewalla. Je¶li nie
       ustawiono, zostanie stworzony konfig dla wszystkich sieci.
       Przyk³ad: networks = public-custa public-custb
     * iptables_binary (ipchains_binary)
       Lokalizacja programu iptables (ipchains). Domy¶lnie:
       /usr/sbin/iptables (/usr/sbin/ipchains)
       Przyk³ad: iptables_binary = /usr/local/sbin/iptables
     * script_file
       Plik, do którego zapisujemy regu³y firwalla. Domy¶lnie:
       /etc/rc.d/rc.masq
       Przyk³ad: script_file = /etc/rc.d/rc.firewall
     * pre_script
       Plik wykonywany PO wyczyszczeniu regu³ek, ale PRZED ustawieniem
       nowych. Domy¶lnie: niezdefiniowany.
       Przyk³ad: pre_script = /etc/rc.d/rc.masq-pre
     * post_script
       Plik wykonywany PO ustawieniu regu³ek. Domy¶lnie: niezdefiniowany.
       Przyk³ad: post_script = /etc/rc.d/rc.masq-post
     * forward_to
       Lista sieci, dla których w³±czamy forwarding. Mo¿liwe warto¶ci: ""
       - pe³ny forward, "dowolny ci±g" - wy³±cz forward, "siec1 siec2" -
       lista sieci z w³±czonym forwardingiem. Domy¶lnie: pe³ny forward.
       Przyk³ad: forward_to = public-custa public-custb
     * script_owneruid
       UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: script_owneruid = 0
     * script_ownergid
       GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: script_ownergid = 0
     * script_permission
       Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).
       Przyk³ad: script_permission = 700
     * snat_address
       Adres SNAT. Je¶li nie ustawiono, dla hostów z adresami publicznymi
       bêdzie u¿yte "-j MASQUERADE". Je¶li ustawiono zostanie u¿yte "-j
       SNAT --to xxx.xxx.xxx.xxx". Dotyczy lms-makeiptables. Domy¶lnie:
       nie ustawiony.
       Przyk³ad: snat_address = 123.123.123.123
     * tcp_redirect_ports (udp_redirect_ports)
       Konfiguracja przekierowañ w formie port_¼ród³owy:port_docelowy dla
       przekierowañ na lokaln± maszynê dla po³±czeñ wychodz±cych. Dotyczy
       lms-makeipchains. Domy¶lnie: nie ustawione.
       Przyk³ad: tcp_redirect_ports = 80:3128 25:25
     _________________________________________________________________

4.3.8. lms-etherdesc

   Skrypt s³u¿±cy do generowania pliku zawieraj±cego MAC adresy oraz
   nazwy hostów pobierane z bazy lms'a. Adresy zapisywane s± w formacie
   'stripped mac', czyli bez ":". Tego typu plik wykorzystywany jest
   przez pakiet iptraf.

   Konfiguracjê tego skryptu zawiera sekcja [ethers] w pliku lms.ini:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony konfig dla wszystkich sieci.
       Przyk³ad: networks = public-custa public-custb
     * etherdesc_owneruid
       UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: etherdesc_owneruid = 0
     * etherdesc_file
       Lokalizacja pliku. Domy¶lnie: /var/lib/iptraf/ethernet.desc.
       Przyk³ad: etherdesc_file = /etc/ethernet.desc
     * etherdesc_ownergid
       GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: etherdesc_ownergid = 0
     * etherdesc_permission
       Uprawnienia pliku skryptu. Domy¶lnie: 600 (rw-------).
       Przyk³ad: etherdesc_permission = 600
     _________________________________________________________________

4.3.9. lms-sendinvoices

   Skrypt s³u¿y do wysy³ania poczt± elektroniczn± faktur, jako
   za³±czników do wiadomo¶ci. Faktury generowane s± na podstawie szablonu
   dostêpnego w lms-ui, dlatego wymagane jest podanie u¿ytkownika i has³a
   do interfejsu www lms-ui.

   W odró¿nieniu od pozosta³ych skrytpów ten wymaga dodatkowych modu³ów
   perla: Data::Dumper, LWP::UserAgent, MIME::Entity.

   Konfiguracjê nale¿y umie¶ciæ w sekcji [sendinvoices]:
     * lms_url
       Adres do lms-ui. Domy¶lnie: http://localhost/lms/
       Przyk³ad: lms_url = http://lms.mynet.pl
     * lms_user
       Login administratora. Domy¶lnie: pusty
       Przyk³ad: lms_user = admin
     * lms_password
       Has³o do lms-ui. Domy¶lnie: puste
       Przyk³ad: lms_password = moje_has³o
     * debug_email
       Konto pocztowe do testów. Domy¶lnie: niezdefiniowane.
       Przyk³ad: debug_email = admin@mynet.pl
     * sender_name
       Nadawca listu. Domy¶lnie: niezdefiniowany.
       Przyk³ad: sender_name = ASK MyNet
     * sender_email
       Adres nadawcy listu. Domy¶lnie: niezdefiniowany.
       Przyk³ad: sender_email = admin@mynet.pl
     * tmp_dir
       Lokalizacja katalogu tymczasowego. Je¶li nie podano katalog
       odczytywany jest ze zmiennej ¶rodowiskowej 'TMP' lub przyjmowany
       jest katalog '/tmp'.
       Przyk³ad: tmp_dir = /home/user/tmp
     _________________________________________________________________

4.3.10. lms-makemacs

   Skrypt s³u¿±cy do generowania pliku zawieraj±cego regu³y netfiltra
   filtruj±ce ruch u¿ytkowników na bazie testu adresu ¼ród³owego MAC. Dla
   ka¿dego komputera generowana jest jedna regu³a dla tablicy nat,
   zadanego ³añcucha, testuj±ca adres ¼ród³owy IP pakietu oraz adres
   ¼ród³owy MAC ramki. Je¶li testy zakoñcz± siê pozytywnie nastêpuje
   powrót do ³añcucha nadrzêdnego za pomoc± decyzji RETURN. Na koñcu
   listy regu³ dodawane s± 2 regu³y przekierowuj±ce ruch http oraz
   webcache na podany w konfiguracji adres IP oraz port (z wykorzystaniem
   decyzji DNAT). Przekierowanie mo¿e odbywaæ siê na wirtualny host www z
   zawiadomieniem u¿ytkownika o zaleg³o¶ciach finansowych bez mo¿liwo¶ci
   wy³±czenia zawiadomienia. Na koñcu dodawana jest regu³a blokuj±ca
   jakikolwiek inny ruch.

   Konfiguracjê tego skryptu zawiera sekcja [macs] w pliku lms.ini:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich sieci.
       Przyk³ad: networks = public-custa public-custb
     * usergroups
       Lista nazw grup u¿ytkowników (oddzielonych spacjami), które maj±
       byæ uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich grup
       u¿ytkowników.
       Przyk³ad: usergroups = osiedle1 osiedle2
     * iptables_binary
       Lokalizacja programu iptables. Domy¶lnie: /sbin/iptables
       Przyk³ad: iptables_binary = /usr/local/sbin/iptables
     * config_owneruid
       UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_owneruid = 0
     * config_file
       Lokalizacja pliku. Domy¶lnie: /etc/rc.d/rc.macs.
       Przyk³ad: config_file = /etc/conf.d/rc.macs
     * config_ownergid
       GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_ownergid = 0
     * config_permission
       Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).
       Przyk³ad: config_permission = 700
     * chain
       £añuch do którego bêd± dodawane generowane regu³y. Domy¶lnie:
       MACS.
       Przyk³ad: chain = TESTY_MACOW
     * redirect_address
       Adres IP + port na który bêdzie przekierowywany niesklasyfikowany
       ruch http i webcache. Domy¶lnie: 127.0.0.1:80.
       Przyk³ad: redirect_address = 192.168.1.1:3000
     * lock_noaccess
       Czy generowaæ regu³ki testuj±ce z decyzj± RETURN dla komputerów,
       które s± od³±czone. Domy¶lnie: 0 (regu³y s± generowane)
       Przyk³ad: lock_noaccess = 1
     _________________________________________________________________

4.3.11. lms-makehosts

   Skrypt s³u¿±cy do generowania pliku /etc/hosts zawieraj±cego
   odwzorowania nazw komputerów na adresy IP.

   Konfiguracjê tego skryptu zawiera sekcja [hosts] w pliku lms.ini:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich sieci.
       Przyk³ad: networks = public-custa public-custb
     * usergroups
       Lista nazw grup u¿ytkowników (oddzielonych spacjami), które maj±
       byæ uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich grup
       u¿ytkowników.
       Przyk³ad: usergroups = osiedle1 osiedle2
     * config_owneruid
       UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_owneruid = 0
     * config_file
       Lokalizacja pliku. Domy¶lnie: /etc/hosts.
       Przyk³ad: config_file = /etc/hosts
     * config_ownergid
       GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_ownergid = 0
     * config_permission
       Uprawnienia pliku skryptu. Domy¶lnie: 644 (rw-r--r--).
       Przyk³ad: config_permission = 600
     * config_header
       Pierwsza linia w pliku /etc/hosts. Domy¶lnie: 127.0.0.1 localhost
       localhost.localdomain.
       Przyk³ad: config_header = 192.168.1.1 serwer serwer.nasza-siec
     _________________________________________________________________

4.3.12. lms-makewarnings

   Skrypt s³u¿±cy do generowania pliku zawieraj±cego regu³y netfiltra
   przekierowuj±ce ruch http i webcache u¿ytkowników o saldzie mniejszym
   lub równym od zadanego na zadany adres IP i port (wykorzystywana jest
   tablica nat, testy adresów ¼ród³owych IP oraz decyzja DNAT).

   Konfiguracjê tego skryptu zawiera sekcja [warnings] w pliku lms.ini:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich sieci.
       Przyk³ad: networks = public-custa public-custb
     * usergroups
       Lista nazw grup u¿ytkowników (oddzielonych spacjami), które maj±
       byæ uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich grup
       u¿ytkowników.
       Przyk³ad: usergroups = osiedle1 osiedle2
     * iptables_binary
       Lokalizacja programu iptables. Domy¶lnie: /sbin/iptables
       Przyk³ad: iptables_binary = /usr/local/sbin/iptables
     * config_owneruid
       UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_owneruid = 0
     * config_file
       Lokalizacja pliku. Domy¶lnie: /etc/rc.d/rc.warnings.
       Przyk³ad: config_file = /etc/conf.d/rc.warnings
     * config_ownergid
       GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_ownergid = 0
     * config_permission
       Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).
       Przyk³ad: config_permission = 700
     * chain
       £añuch do którego bêd± dodawane generowane regu³y. Domy¶lnie:
       WARNINGS.
       Przyk³ad: chain = OSTRZEZENIA
     * redirect_address
       Adres IP + port na który bêdzie przekierowywany ruch http i
       webcache pochodz±cy z hostów dla których ma byæ w³±czone
       ostrze¿enie o zaleg³o¶ciach finansowych. Domy¶lnie: 127.0.0.1:80.
       Przyk³ad: redirect_address = 192.168.1.1:3001
     * limit
       Saldo u¿ytkownika przy którym dla wszystkich komputerów
       u¿ytkownika generowane s± regu³ki przekierowuj±ce ruch. Domy¶lnie:
       0
       Przyk³ad: limit = -85
     _________________________________________________________________

4.3.13. lms-makemessages

   Skrypt s³u¿±cy do generowania pliku zawieraj±cego regu³y netfiltra
   przekierowuj±ce ruch http i webcache u¿ytkowników dla których zosta³o
   w³±czone przekazywanie wiadomo¶ci administracyjnej (ostrze¿enia) na
   zadany adres IP i port (wykorzystywana jest tablica nat, testy adresów
   ¼ród³owych IP oraz decyzja DNAT).

   Konfiguracjê tego skryptu zawiera sekcja [messages] w pliku lms.ini:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich sieci.
       Przyk³ad: networks = public-custa public-custb
     * usergroups
       Lista nazw grup u¿ytkowników (oddzielonych spacjami), które maj±
       byæ uwzglêdnione podczas generowania pliku. Je¶li nie ustawiono,
       zostanie stworzony plik konfiguracyjny dla wszystkich grup
       u¿ytkowników.
       Przyk³ad: usergroups = osiedle1 osiedle2
     * iptables_binary
       Lokalizacja programu iptables. Domy¶lnie: /sbin/iptables
       Przyk³ad: iptables_binary = /usr/local/sbin/iptables
     * config_owneruid
       UID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_owneruid = 0
     * config_file
       Lokalizacja pliku. Domy¶lnie: /etc/rc.d/rc.messages.
       Przyk³ad: config_file = /etc/conf.d/rc.messages
     * config_ownergid
       GID w³a¶ciciela pliku. Domy¶lnie: 0 (root).
       Przyk³ad: config_ownergid = 0
     * config_permission
       Uprawnienia pliku skryptu. Domy¶lnie: 700 (rwx------).
       Przyk³ad: config_permission = 700
     * chain
       £añuch do którego bêd± dodawane generowane regu³y. Domy¶lnie:
       MESSAGES.
       Przyk³ad: chain = WIADOMOSCI
     * redirect_address
       Adres IP + port na który bêdzie przekierowywany ruch http i
       webcache pochodz±cy z hostów dla których ma byæ w³±czona wiadomo¶æ
       administracyjna. Domy¶lnie: 127.0.0.1:80.
       Przyk³ad: redirect_address = 192.168.1.1:3002
     _________________________________________________________________

4.3.14. lms-fping

   Skrypt zapisuje do bazy informacje o aktywno¶ci komputerów. Do
   skanowania wykorzystywany jest szybki program fping (z opcjami -ar1).
   Najpierw tworzona jest lista hostów, a nastêpnie, po wywo³aniu
   fping'a, komputerom w³±czonym zostaje przypisana data i czas
   skanowania. Dziêki temu mamy w bazie informacje kiedy dany komputer
   by³ ostatnio w³±czony.

   Konfiguracjê tego skryptu zawiera sekcja [fping] w pliku lms.ini:
     * networks
       Lista nazw sieci (oddzielonych spacjami), które maj± byæ
       uwzglêdnione podczas skanowania. Je¶li nie ustawiono przeskanowane
       zostan± wszystkie komputery.
       Przyk³ad: networks = public-custa public-custb
     * fping_binary
       Lokalizacja programu fping. Domy¶lnie: /usr/sbin/fping
       Przyk³ad: fping_binary = /usr/local/sbin/fping
     * temp_file
       Lokalizacja pliku tymczasowego na listê hostów, który po wykonaniu
       skryptu zostaje usuniêty. Domy¶lnie: /tmp/fping_hosts.
       Przyk³ad: temp_file = /tmp/hosts
     _________________________________________________________________

4.3.15. lms-rtparser

   Jest to tzw. backend dla systemu Helpdesk, czyli scrypt który
   wspó³pracuj±c z serwerem pocztowym zapisuje do bazy danych wszystkie
   wiadomo¶ci skierowane na adresy Helpdesk'a. Skrypt pobiera z wej¶cia
   wiadomo¶æ pocztow±, parsuje zawarto¶æ i umieszcza zg³oszenie w
   kolejce, wysy³aj±c do zg³aszaj±cych potwierdzenie przyjêcia
   wiadomo¶ci. W temacie potwierdzenia znajduje siê symbol zg³oszenia.
   Podczas parsowania wiadomo¶ci nastêpuje, na podstawie tematu
   wiadomo¶ci, próba rozpoznania czy wiadomo¶æ nie jest odpowiedzi± na
   inn± wiadomo¶æ z ju¿ przypisanym numerem zg³oszenia. Od wiadomo¶ci
   zostaj± od³±czone za³±czniki i umieszczone w katalogu zdefiniowanym w
   opcji mail_dir.

   Oprócz modu³ów Perla standardowo wymaganych przez resztê skryptów,
   nale¿y zainstalowaæ tak¿e modu³ MIME::Parser oraz Net::SMTP.

   Skrypt mo¿na uruchamiaæ na wiele sposobów. Jednym z nich jest
   stworzenie skryptu pow³oki, który odczytuj±c skrzynkê pocztow± wywo³a
   lms-rtparser dla ka¿dego maila. Wygodniejszym zastosowaniem jest
   jednak zintegrowanie go z serwerem pocztowym. Poni¿ej przedstawiono
   sposób pod³±czenia go do postfixa przy u¿yciu opcji header_checks.
# plik main.cf:
header_checks = regexp:/etc/postfix/header_checks

# plik header_checks
/^To:.*adres@domena.*/ FILTER filter:dummy

# plik master.cf:
filter unix - n n - 10 pipe
      -flags=Rq user=nobody argv=/path/to/lms-rtparser

   Notatka

   Je¿eli chcesz aby wiadomo¶ci wprowadzane poprzez lms-ui by³y kierowane
   do parsera, zamiast bezpo¶rednio zapisywane do bazy, powiniene¶
   w³±czyæ opcjê konfiguracyjn± helpdesk_backend_mode w sekcji [phpui].

   Konfiguracjê tego skryptu zawiera sekcja [rt] w pliku lms.ini:
     * default_queue
       Numer ID kolejki, do której trafi± zg³oszenia. Je¶li nie podano,
       Kolejka zostanie odszukana na podstawie adresu odbiorcy maila.
       Opcja ta mo¿e zostaæ nadpisana przy pomocy parametru -q przy
       uruchomieniu skryptu. Domy¶lnie: niezdefiniowana.
       Przyk³ad: default_queue =
     * mail_from
       Nadawca potwierdzenia (adres). Je¶li nie zdefiniowano, zostanie
       u¿yty adres kolejki do której zapisano zg³oszenie. Domy¶lnie:
       pusty.
       Przyk³ad: mail_from = rt@net.pl
     * mail_from_name
       Nadawca potwierdzenia (nazwa). Domy¶lnie: niezdefiniowana.
       Przyk³ad: mail_from_name = 'BOK SuperLAN'
     * smtp_server
       Serwer SMTP, przez który zostanie wys³ana wiadomo¶æ. Domy¶lnie:
       localhost.
       Przyk³ad: smtp_server = smtp.mydomain.pl
     * mail_dir
       Katalog w którym zostan± zapisane za³±czniki. Katalog ten powinien
       byæ dostêpny dla apache'a i u¿ytkownika uruchamiaj±cego
       lms-rtparser. Gdy nie ustawiono, za³±czniki zostan± utracone.
       Domy¶lnie: niezdefiniowany.
       Przyk³ad: mail_dir = /usr/local/lms/mail
     * tmp_dir
       Katalog tymczasowy. Domy¶lnie zostanie u¿yty katalog zdefiniowany
       w zmiennej systemowej lub /tmp.
       Przyk³ad: tmp_dir = /home/user/tmp
     _________________________________________________________________

Rozdzia³ 5. Generator plików konfiguracyjnych (lms-mgc)

   LMS-MGC to "magiczny" generator plików konfiguracyjnych. Przy
   odrobinie wysi³ku mo¿na stworzyæ przy jego pomocy dowolnego rodzaju
   plik konfiguracyjny (np. generuj±cy odpowiednie strefy dla DNS)
     _________________________________________________________________

5.1. Instalacja

   Lms-mgc posiada w³asny plik konfiguracyjny: lms-mgc.ini. Jego
   instalacja polega na przeniesieniu do katalogu /usr/sbin. Uruchomienie
   generatora mo¿na wykonaæ na dwa sposoby: wpisaæ do crona (np. co
   godzinê)
0 * * * *       /usr/sbin/lms-mgc 1 > /dev/null

   albo z poziomu LMS skorzystaæ z menu "Prze³adowanie". Druga metoda
   wymaga u¿ycia sudo. Niestety, jedyne wyj¶cie by umo¿liwiæ uruchomienie
   lms-mgc, to dopisanie u¿ytkownika do sudo, a nastêpnie ustawienie w
   sekcji [phpui] lms.ini:

   reload_type = exec

   reload_execcmd = sudo /usr/sbin/lms-mgc

   Lms-mgc posiada nastêpuj±ce opcje uruchomienia:
-C, --config-file=/path/lms-mgc.ini alternatywny plik konfiguracyjny
                                    (default: /etc/lms/lms-mgc.ini);
-i, --instances=name                nazwa (lub numer) instancji do uruchomienia, bez czytania
                                    konfiguracji z lms-mgc.ini, np. -i "name1 name2"
-h, --help                          wy¶wietla pomoc;
-v, --version                       wy¶wietla numer wersji;
-q, --quiet                         tylko komunikaty o b³êdach;
-d, --debug                         informacje szczegó³owe dla ka¿dego IP;
     _________________________________________________________________

5.2. Konfiguracja

   Konfiguracjê dla LMS-MGC przeprowadza siê w pliku lms-mgc.ini
     _________________________________________________________________

5.2.1. Sekcja [database] - ustawienia bazy danych

     * type
       Typ bazy danych. Aktualnie w 100% supportowany jest 'mysql', ale
       jak narazie nie widaæ wiêkszych problemów z 'postgres'. Domy¶lnie:
       mysql
       Przyk³ad: type = mysql
     * host
       Host gdzie zainstalowana jest baza danych. Najczê¶ciej, localhost,
       ale mo¿na tutaj wstawiæ cokolwiek (ipek, domena, path to socketa w
       formacie 'localhost:/path/to/socket'). Domy¶lnie: localhost
       Przyk³ad: host = localhost
     * user
       U¿ytkownik do bazy danych. W wielu wypadkach (je¿eli postêpowa³e¶
       zgodnie ze wskazówkami w doc/INSTALL) bêdzie to 'lms'. Je¿eli
       chcesz u¿ywaæ konta uprzywilejowanego, prawdopodobnie wpiszesz
       'root' (MySQL na wiêkszo¶ci *nixów), 'mysql' (na PLD) b±d¼
       'postgres' (PostgreSQL). Domy¶lnie: root
       Przyk³ad: user = mysql
     * password
       Has³o do bazy danych. Domy¶lnie puste.
       Przyk³ad: password = tajne_haslo
     * database
       Nazwa bazy danych, domy¶lnie lms.
       Przyk³ad: database = lms
     _________________________________________________________________

5.2.2. Sekcja [mgc] - lista instancji

   W³a¶ciwa konfiguracja dotycz±ca generatorów poszczególnych plików
   konfiguracyjnych jest umieszczana w sekcji [mgc] i pochodnych. W samej
   sekcji [mgc] mo¿emy u¿yæ nastêpuj±cego parametru:
     * instances
       Lista "instancji" oddzielona spacjami.
       Przyk³ad: instaces = dhcp firewall squid

   Notatka

   Zmienn± instances mo¿na tak¿e umie¶ciæ w sekcji dowolnej instancji.
   Patrz ni¿ej.
     _________________________________________________________________

5.2.3. Sekcja [mgc:xxx] - konfiguracja instancji

   Ka¿da instancja ma swoj± nazwê i jej konfiguracjê tworzy siê
   umieszczaj±c sekcjê o nazwie [mgc:nazwa], czyli przyk³adowo:
   [mgc:mydaemon]

   W samych instancjach mo¿emy u¿ywaæ nastêpuj±cych opcji
   konfiguracyjnych:
     * instances
       Zmienna, w której mo¿esz podaæ listê innych instancji, aby
       nastêpnie wywo³ywaæ mgc poleceniem 'lms-mgc -i sekcja' zamiast
       'lms-mgc -i "sekcja1 sekcja2 sekcja3"'. Je¶li zostanie u¿yta,
       wszystkie pozosta³e zmienne tej sekcji zostan± zignorowane.
       Przyk³ad: instances = dns1 dns2 dns3
     * outfile
       Definiuje plik do którego ma byæ zapisany wynik dzia³ania bie¿±cej
       instancji (je¿eli ta zmienna bêdzie nie ustawiona, instancja siê
       zakoñczy)
       Przyk³ad: outfile = /etc/somefile
     * append
       Pozwala ustawiæ aby wynik dzia³ania instancji nie nadpisywa³ pliku
       wynikowego, lecz zosta³ dopisany na jego koñcu
       Przyk³ad: append = 1
     * outfile_perm
       Pozwala na ustawienie praw dostêpu do pliku wyj¶ciowego (domy¶lnie
       600)
       Przyk³ad: outfile_perm = 700
     * outfile_owner
       Pozwala na ustawienie w³a¶ciciela pliku wyj¶ciowego (domy¶lnie 0)
       Przyk³ad: outfile_owner = 0

       Ostrze¿enie

   W³a¶ciciel musi byæ podany numerycznie!
     * outfile_group
       Pozwala na ustawienie grupy pliku wyj¶ciowego (domy¶lnie 0)
       Przyk³ad: outfile_group = 0

       Ostrze¿enie

   Grupa musi byæ podana numerycznie!
     * header_file
       Pozwala na umieszczenie w pliku wynikowym zawarto¶ci innego pliku
       jako nag³ówek (domy¶lnie nie ustawione)
       Przyk³ad: header_file = /etc/lms/myservice_header
     * header
       Pozwala na umieszczenie w pliku wynikowym zawarto¶ci zmiennej jako
       nag³ówka (domy¶lnie puste)
       Przyk³ad: header = option1 = bla\noption2 = blabla

       Notatka

   Znak \n zosta³ tu u¿yty jako separator linii. Koñcowe \n nie jest
   wymagane.
     * networks
       Pozwala ustaliæ które z naszych sieci bêd± uwzglêdniane w pliku
       konfiguracyjnym (domy¶lnie wszystkie)
       Przyk³ad: networks = cust1-publ cust2-publ cust3-priv

   Teraz mgc pobiera kolejne sieci i wykonuje w kó³ko nastêpuj±ce
   czynno¶ci:
     * network_header
       Generuje nag³ówek dla ka¿dej sieci (domy¶lnie puste):
       Przyk³ad: network_header = network %ADDR/%MASK { # Config section
       for %NAME
     * dst_networks
       Pozwala ustawiæ sieci docelowe, czyli takie dla których bêdzie
       przetwarzany parametr: dst_network_header (domy¶lnie wszystkie):
       Przyk³ad: dst_networks = main coalloc
     * dst_network_header
       Pozwala ustawiæ nag³ówek dla sieci docelowych
       Przyk³ad: dst_network_header = \tallow to %DADDR/%DMASK;
     * network_body
       Parametr jest przetwarzany po wys³aniu nag³ówków dla sieci, a
       przed rozpoczêciem analizy adresów IP
       Przyk³ad: network_body = \tnodes {

   Teraz MGC rozpocznie przetwarzanie regu³ek dla kolejnych adresów IP.
   Robi to w dosyæ specyficzny sposób. Tzn. oblicza kolejny adres IP i
   sprawdza czy zdefiniowano regu³ê dla hosta i wykonuje pierwsz±.
   Sprawdzanie jest wykonywane w nastepuj±cej kolejno¶ci:
     * ignore
       Pozwala na ustawienie listy adresów w postaci adres/prefix lub
       adres/maska oddzielanej spacjami dla której ma byæ ignorowane
       generowanie
       Przyk³ad: ignore = 192.168.0.100/32
     * node(IP)
       Przy pomocy tej opcji mo¿na zdefiniowaæ regu³ê dla wybranego
       komputera. W nawiasie podaje siê jego adres IP. Ka¿da sekcja
       instancji mo¿e zawieraæ dowoln± ilo¶æ takich opcji.
       Przyk³ad: node(192.168.0.20) = ??
     * allnodes
       Pozwala na ustawienie regu³ki przetwarzanej dla ka¿dego kolejnego
       adresu IP.
       Przyk³ad: allnodes = ??
     * allexistnodes
       Pozwala na ustawienie regu³ki przetwarzanej dla ka¿dego kolejnego
       adresu IP który jest u¿ywany.
       Przyk³ad: allexistnodes = ??
     * grantednode_priv
       Jest przetwarzana gdy dany adres komputer z danym adresem IP
       istnieje, ale w lms-ui ma status "pod³±czony" (regu³ka
       przetwarzana dla adresów prywatnych)
       Przyk³ad: grantednode_priv = \t\tnode %NAME (%IP/%MAC) unique %ID;
     * grantednode_publ
       Jest przetwarzana gdy dany adres komputer z danym adresem IP
       istnieje, ale w lms-ui ma status "pod³±czony" (regu³ka
       przetwarzana dla adresów publicznych)
       Przyk³ad: grantednode_publ = \t\tnode %NAME (%IP/%MAC) unique %ID;
     * deniednode_priv
       Jest przetwarzana gdy dany adres komputer z danym adresem IP
       istnieje, ale w lms-ui ma status "od³±czony" (regu³ka przetwarzana
       dla adresów prywatnych)
       Przyk³ad: deniednode_priv = node %NAME (%IP/%MAC) unique %ID deny;
     * deniednode_publ
       Jest przetwarzana gdy dany adres komputer z danym adresem IP
       istnieje, ale w lms-ui ma status "od³±czony" (regu³ka przetwarzana
       dla adresów publicznych)
       Przyk³ad: deniednode_publ = node %NAME (%IP/%MAC) unique %ID deny;
     * dhcpnode_priv
       Jest przetwarzana gdy dany adres IP zawiera siê w klasie DHCP
       (regu³ka przetwarzana dla adresów prywatnych)
       Przyk³ad: dhcpnode_priv = node unknown (%IP) reject;
     * dhcpnode_publ
       Jest przetwarzana gdy dany adres IP zawiera siê w klasie DHCP
       (regu³ka przetwarzana dla adresów publicznych)
       Przyk³ad: dhcpnode_publ = node unknown (%IP) reject;
     * freeip_priv
       Jest przetwarzana gdy dany adres IP nie jest przypisany do ¿adnego
       komputera (regu³ka przetwarzana dla adresów prywatnych)
       Przyk³ad: freeip_priv = node unknown (%IP) lock_as_unused;
     * freeip_publ
       Jest przetwarzana gdy dany adres IP nie jest przypisany do ¿adnego
       komputera (regu³ka przetwarzana dla adresów publicznych)
       Przyk³ad: freeip_publ = node unknown (%IP) lock_as_unused;
     * default_priv
       Regu³ka domy¶lna. Jest przetwarzana gdy adres nie zostanie
       przetworzony przez ¿adn± regu³kê grantednode lub deniednode
       (regu³ka przetwarzana dla adresów prywatnych)
       Przyk³ad: default_priv = node unknown (%IP) lock_as_intruder;

       Notatka

   lms-mgc sam rozpoznaje który adres nale¿y do klasy publicznej, a który
   do prywatnej.
     * default_publ
       Regu³ka domy¶lna. Jest przetwarzana gdy adres nie zostanie
       przetworzony przez ¿adn± regu³kê grantednode lub deniednode
       (regu³ka przetwarzana dla adresów publicznych)
       Przyk³ad: default_publ = node unknown (%IP) lock_as_intruder;

   W koñcu nastêpuje wygenerowanie koñcowej czê¶ci pliku i wykonanie
   polecenia systemowego.
     * network_footer
       Pozwala na ustawienie stopki dla w³a¶nie przetwarzanej sieci
       Przyk³ad: network_footer = ??
     * footer_file
       Pozwala na umieszczenie w pliku wynikowym zawarto¶ci innego pliku
       jako stopka (domy¶lnie nie ustawione)
       Przyk³ad: footer_file = /etc/lms/myservice_footer
     * footer
       Pozwala na umieszczenie w pliku wynikowym zawarto¶ci zmiennej jako
       stopki (domy¶lnie puste)
       Przyk³ad: footer = # End.
     * post_exec
       Komenda do wywo³ania po wygenerowaniu pliku konfiguracyjnego
       Przyk³ad: post_exec = killall -HUP mydaemon
     _________________________________________________________________

5.2.4. Zmienne konfiguracyjne

   W opcjach konfiguracyjnych mo¿na u¿ywaæ nastêpuj±cych zmiennych:
     * %IP - zostanie rozwiniête do adresu IP
     * %ID - ID sieci w bazie
     * %MAC - zostanie rozwiniête do adresu MAC karty sieciowej
     * %OWNER - w³a¶ciciel komputera
     * %NAME - nazwa sieci du¿ymi znakami
     * %name - nazwa sieci ma³ymi znakami
     * %UPRATE - gwarantowany transfer dla danych wychodz±cych
     * %DOWNRATE - gwarantowany transfer dla danych przychodz±cych
     * %UPCEIL - maksymalny transfer dla danych wychodz±cych
     * %DOWNCEIL - maksymalny transfer dla danych przychodz±cych
     * %CLIMIT - limit równoczesnych po³±czeñ
     * %PLIMIT - limit pakietów
     * %1 %2 %3 %4 - kolejne oktety (od lewej) adresu IP
     * %ADDR - adres sieci
     * %GATE - brama sieci
     * %DNS - serwer DNS tej sieci
     * %DOMAIN - domena tej sieci
     * %WINS - adres serwera WINS dla tej sieci
     * %DHCPS - pierwszy adres DHCP tej sieci
     * %DHCPE - ostatni adres DHCP tej sieci
     * %DATE - data w formacie YYYYMMDD;
     * %TIME - czas w formacie HHMM;
     * %TIMES - czas w formacie HHMMSS;
     * %UTIME - czas w formacie unix timestamp;
     _________________________________________________________________

5.3. Przyk³ad zastosowania lms-mgc

   Konfiguracja i zasada dzia³ania lms-mgc mo¿e siê wydawaæ do¶æ zawi³a,
   dlatego pos³u¿ymy siê przyk³adem. Poni¿ej przedstawiono sposób
   generowania i uruchamiania firewalla ipchains (bardzo prostego).

   Przyk³ad 5-1. Lms-mgc: Przyk³ad instancji

   Zacznij od utworzenia nowej sekcji mgc w lms-mgc.ini, nazywaj±c j±
   'ipchains' i stwórz w tej sekcji prost± maskaradê per adres IP z lanu:
[mgc:ipchains]
outfile           = /etc/rc.d/rc.masq
outfile_perm      = 700
header            = #!/bin/sh\n/sbin/ipchains -F\n/sbin/ipchains -X\n/sbin/ipchains -P forward DENY
grantednode_priv  = /sbin/ipchains -A forward -s %IP -j MASQ
post_exec         = /etc/rc.d/rc.masq

   Dopiszmy tak¿e do sekcji g³ównej mgc informacjê ¿eby mgc uruchamia³ t±
   sekcjê:
[mgc]
instances         = ipchains

   Teraz próba odpalenia lms-mgc powinna zaowocowaæ wygenerowaniem
   /etc/rc.d/rc.masq, oraz jego odpaleniem.
     _________________________________________________________________

Rozdzia³ 6. A.L.E.C's LMS Daemon

6.1. Informacje podstawowe

   Napisany w jêzyku C program ma u³atwiaæ zarz±dzanie us³ugami. Sam
   demon odpowiada za uruchamianie odpowiednich modu³ów na ¿±danie
   u¿ytkownika. Modu³y natomiast, s³u¿± do tworzenia plików
   konfiguracyjnych na podstawie danych z bazy LMS'a oraz restartowania
   odpowiednich us³ug na serwerze.

   Dlaczego taka nazwa? Wiêkszo¶æ kodu demona napisa³ jeden z developerów
   - Aleksander 'A.L.E.C' Machniak, niemniej nale¿y tak¿e podkre¶liæ
   udzia³ Marcina 'Lexx' Króla. Program zawiera fragmenty kodu autorstwa
   Mateusza 'mteg' Golicza oraz korzysta z biblioteki iniparser Nicolasa
   Devillarda. Je¶li Ty masz ochotê napisaæ jaki¶ modu³ lub poprawiæ
   funkcjonalno¶æ demona jak najbardziej do tego zachêcam.
     _________________________________________________________________

6.1.1. Wymagania

   A.L.E.C's LMS Daemon potrzebuje:
     * instalacji interfejsu u¿ytkownika LMS-UI
     * libmysqlclient (tj. pe³nej instalacji MySQL'a lub odpowiedniego
       pakietu) lub libpq w przypadku bazy PostgreSQL
     * libdl (to w ka¿dej dzisiejszej dystrybucji jest)
     * kompilatora jêzyka C
     _________________________________________________________________

6.1.2. Instalacja

   Przed kompilacj± nale¿y przy pomocy skryptu ./configure ustaliæ opcje
   przedstawione na poni¿szym listingu (w nawiasach podano warto¶ci
   domy¶lne opcji):
  --help                pomoc
  --enable-debug0       logowanie zapytañ SQL (wy³±czone)
  --enable-debug1       logowanie zdarzeñ (wy³±czone)
  --with-sqlite         gdy korzystasz z bazy SQLite (wy³±czone)
  --with-pgsql          gdy korzystasz z bazy PostgreSQL (wy³±czone)
  --with-mysql          gdy korzystasz z bazy MySQL (w³±czone)
  --prefix=DIR          katalog instalacyjny demona (/usr/local/bin)
  --libdir=DIR          lokalizacja bibliotek bazy danych (/usr/lib)
  --incdir=DIR          lokalizacja plików nag³ówkowych bazy danych (/usr/include)

   Zatem wymagane jest okre¶lenie bazy z jakiej bêdziemy korzystaæ
   (-with-mysql lub -with-pgsql) oraz po³o¿enia bibliotek dostarczanych
   wraz z baz± (--incdir, --libdir).
# ./configure --with-pgsql --libdir=/usr/local/pgsql/lib --incdir=/usr/local/pgsql/include

   Nastêpnie kompilacja i instalacja (umieszczenie demona w katalogu
   okre¶lonym zmienn± --prefix):
# make && make install

   Na koniec skompilowane modu³y (pliki z rozszerzeniem .so), znajduj±ce
   siê w katalogu modules/nazwa_modu³u przenie¶ do dowolnego katalogu.
   Ich lokalizacjê bêdziesz okre¶la³ w pliku konfiguracyjnym.
     _________________________________________________________________

6.1.3. Konfiguracja

   Przyk³adowy konfig demona i modu³ów zawarto w pliku lms.ini.sample.
   Poni¿szy listing przedstawia podstawowe opcje dla demona (konfiguracjê
   modu³ów omówiono w osobnych rozdzia³ach ich dotycz±cych):
[database]
host            = localhost     # nazwa lub ip hosta, domy¶lnie: localhost
user            = lms           # nazwa u¿ytkownika, domy¶lnie: lms
password        = mypasswd      # has³o do bazy, domy¶lnie: puste
database        = lms           # nazwa bazy, domy¶lnie: lms
port            = 0             # numer portu, domy¶lnie: 0

[lmsd]
sleeptime       = 30            # okre¶la odstêp czasu (w sekundach) jak czêsto ma
                                # byæ sprawdzane ¿±danie reloadu, domy¶lnie: 30
instances       = hosts oident firewall       # lista instancji modu³ów
command         = 'echo "³±czê siê z baz±"'   # polecenie wykonywane przed ka¿dym po³±czeniem z baz±

   Notatka

   Lista instancji sk³ada siê z nazw instancji oddzielonych spacj±.
   Instancja to nazwa sekcji w pliku konfiguracyjnym.

   W sekcji dotycz±cej instancji, oprócz parametrów konfiguracji modu³ów,
   umieszcza siê opcje podstawowe, jak na poni¿szym listingu:
[nazwa_instancji]
module = /¶cie¿ka/nazwa_modu³u.so
info = "Opcjonalny opis modu³u"

   Zmiana opcji 'instances' oraz dowolnej opcji w sekcjach instancji, w
   odró¿nieniu od pozosta³ych opcji globalnych, nie wymaga restartu
   demona.
     _________________________________________________________________

6.1.4. Uruchomienie

   Program mo¿esz uruchamiaæ jako demona pracuj±cego w tle (opcja '-b').
   Wtedy prze³adowanie konfiguracji i us³ug jest dokonywane na ¿±danie,
   przy u¿yciu menu 'Prze³adowanie' w LMS-UI. Opcja 'sleeptime' (-s)
   okre¶la okres miêdzy odczytami bazy. Gdy demon wykryje ¿±danie
   wykonania reloadu, wywo³a modu³y okre¶lone opcj± 'instances' z
   lms.ini. Na przyk³ad:
# almsd -b

   Innym sposobem uruchomienia jest jednorazowy reload w wykorzystaniem
   crona. Z tego sposobu nale¿y korzystaæ uruchamiaj±c modu³y takie jak
   'payments' 'notify', 'traffic', czy 'pinger'. W tym wypadku mo¿esz
   okre¶liæ listê instancji do wykonania za pomoc± opcji '-i'.
   Przyk³adowy wpis do crontab'a wygl±da nastêpuj±co:
  1 0 * * *    /usr/local/bin/almsd -qi "payments notify"

   Poni¿szy listing przedstawia dostêpne opcje linii poleceñ programu:
  -c    ¶cie¿ka do pliku konfiguracyjnego (domy¶lnie: /etc/lms/lms.ini)
  -i    lista instancji (oddzielonych spacj±) do prze³adowania
  -b    uruchomienie w tle
  -s    czas w sek. miêdzy odczytami tabeli 'reload' (domy¶lnie: 30)
  -q    wykonaj reload i zakoñcz
  -h    wy¶wietla opcje linii poleceñ
     _________________________________________________________________

6.2. Modu³y

   Sam demon potrafi tylko uruchamiaæ modu³y i to one odwalaj± ca³±
   robotê. Wiêkszo¶æ modu³ów jest przeznaczona do okre¶lonego
   zastosowania, jedynie 'hostfile' mo¿na u¿ywaæ do ró¿nych konfigów
   (us³ug), np. ró¿nych typów firewalli. Przyk³ady konfiguracji demona i
   modu³ów zawiera plik daemon/lms.ini.sample. Parametry konfiguracyjne
   modu³ów umieszcza siê w sekcjach instancji je wywo³uj±cych.
     _________________________________________________________________

6.2.1. Lista dostêpnych modu³ów

   Tabela 6-1. Lista modu³ów demona almsd
   Nazwa Opis
   system Wywo³ywanie poleceñ pow³oki
   dhcp Konfiguracja serwera dhcpd
   cutoff Od³±czanie u¿ytkowników z zaleg³o¶ciami w op³atach
   dns Konfiguracja serwera dns
   ethers Tworzenie pliku /etc/ethers
   hostfile Modu³ uniwersalny (np. tworzenie regu³ iptables)
   notify Powiadamianie u¿ytkowników o zaleg³o¶ciach w op³atach poczt±
   elektroniczn±
   ggnotify Powiadamianie u¿ytkowników o zaleg³o¶ciach w op³atach przez
   gadu-gadu
   payments Naliczanie op³at abonamentowych
   oident Konfiguracja oident
   tc Tworzenie regu³ HTB
   traffic Statystyki wykorzystania ³±cza
   pinger Badanie aktywno¶ci u¿ytkowników
     _________________________________________________________________

6.2.2. System

6.2.2.1. Opis

   Jedyne co robi ten modu³ to wykonanie zadanego polecenia (listy
   poleceñ) pow³oki. Mo¿e siê przydaæ gdy chcesz podczas prze³adowania
   konfiguracji wykonaæ jak±¶ komendê lub uruchomiæ zewnêtrzny skrypt, na
   przyk³ad jeden z tych, które mo¿esz znale¼æ w katalogu /bin.
     _________________________________________________________________

6.2.2.2. Konfiguracja

   W zwi±zku z powy¿szym mo¿esz zdefiniowaæ jedynie tre¶æ polecenia.
   Pow³oka powinna sobie tak¿e poradziæ z list± poleceñ oddzielonych
   ¶rednikami:
     * command
       Polecenie pow³oki. Domy¶lnie: puste.
       Przyk³ad: command = 'echo "tu modu³ system"'
     _________________________________________________________________

6.2.3. Payments

6.2.3.1. Opis

   Modu³ nalicza op³aty abonamentowe u¿ytkowników oraz op³aty sta³e.
   Nale¿y go uruchamiaæ codziennie. Op³aty naliczane na podstawie
   przypisanych u¿ytkownikowi taryf zapisywane s± do bazy wraz z
   komentarzem okre¶lonym zmienn± 'comment'. Po naliczeniu op³at tworzone
   s± faktury. Komentarz do op³aty sta³ej to zlepek sk³adaj±cy siê z jej
   nazwy oraz wierzyciela. Na koñcu usuwane s± z bazy nieaktualne
   obci±¿enia u¿ytkowników.
     _________________________________________________________________

6.2.3.2. Konfiguracja

   Dla tego modu³u s± dostêpne nastêpuj±ce zmienne kofiguracyjne:
     * comment
       Komentarz do operacji. '%period' zostanie zamienione na daty od-do
       nale¿nego abonamentu, np. '10.10.2003 - 09.11.2003', a '%tariff'
       na nazwê odpowiedniej taryfy. Domy¶lnie: 'Abonament wg taryfy:
       '%tariff' za okres: %period'.
       Przyk³ad: comment = 'Abonament miesiêczny za okres %period'
     * up_payments
       "Naliczanie z góry", czyli czy okres w komentarzu ma byæ liczony
       do przodu, czy do ty³u w stosunku do daty naliczenia op³aty.
       Domy¶lnie: yes.
       Przyk³ad: up_payments = no
     * expiry_days
       Okre¶la liczbê dni od daty wyga¶niêcia przypisanych u¿ytkownikowi
       zobowi±zañ, po której dane tego zobowi±zania zostan± usuniête z
       bazy. Przy ustawieniu na '0' dane zostan± usuniête natychmiast po
       dacie, do której obowi±zywa³o zobowi±zanie. Domy¶lnie: 30.
       Przyk³ad: expiry_days = 365
     * deadline
       Termin p³atno¶ci podany w dniach. Domy¶lnie: 14.
       Przyk³ad: deadline = 21
     * paytype
       Rozdzaj p³atno¶ci. Domy¶lnie: 'PRZELEW'.
       Przyk³ad: paytype = 'GOTÓWKA'
     _________________________________________________________________

6.2.4. Notify

6.2.4.1. Opis

   Modu³ 'notify' s³u¿y do informowania u¿ytkowników o zaleg³o¶ciach w
   op³atach za pomoc± poczty elektronicznej. Aktualne saldo u¿ytkownika
   porównywane jest ze zmienn± 'limit', je¶li jest ni¿sze - wiadomo¶æ
   zostaje wys³ana. Tre¶æ wiadomo¶ci pobierana jest z przygotowanego
   szablonu, w którym mo¿na stosowaæ nastêpuj±ce zmienne:
     * %saldo - aktualne saldo u¿ytkownika
     * %name - imiê u¿ytkownika
     * %lastname - nazwisko/nazwa u¿ytkownika
     * %last_10_in_a_table - wyci±g ostatnich 10 operacji na kocie
       u¿ytkownika
     _________________________________________________________________

6.2.4.2. Konfiguracja

   Poni¿ej przedstawiono dostêpne opcje konfiguracyjne modu³u 'notify':
     * template
       Lokalizacja pliku z szablonem wiadomo¶ci. Domy¶lnie: pusty
       Przyk³ad: template = modules/notify/sample/mailtemplate
     * file
       Lokalizacja pliku tymczasowego. Domy¶lnie: /tmp/mail
       Przyk³ad: file = /tmp/mail.txt
     * command
       Polecenie pow³oki wysy³aj±ce e-maila. '%address' zostanie
       zast±pione adresem e-mail u¿ytkownika. Domy¶lnie: 'mail %address
       -s "Inf. o zaleg³o¶ciach w op³atach" < /tmp/mail'.
       Przyk³ad: command = 'mail %address -s "musisz zap³aciæ, bo jak
       nie..." < /tmp/mail.txt'
     * limit
       Wiadomo¶æ o zaleg³o¶ciach zostaje wys³ana je¶li saldo u¿ytkownika
       spadnie poni¿ej kwoty okre¶lonej zmienn± limit. Domy¶lnie: 0
       Przyk³ad: limit = -20
     * debug_mail
       Okre¶la adres na który zostan± wys³ane wszystkie wiadomo¶ci,
       przydatne podczas testów. Domy¶lnie: puste.
       Przyk³ad: debug_mail = localhost@moja.net
     _________________________________________________________________

6.2.5. Ggnotify

6.2.5.1. Opis

   Odpowiednik modu³u 'notify' s³u¿±cy do wysy³ania wiadomo¶ci gadu-gadu.
   Aktualne saldo u¿ytkownika porównywane jest ze zmienn± 'limit', je¶li
   jest ni¿sze - wiadomo¶æ zostaje wys³ana. Tre¶æ wiadomo¶ci pobierana
   jest z przygotowanego szablonu, w którym mo¿na stosowaæ zmienne takie
   jak dla modu³u 'notify' (mo¿e to byæ te¿ ten sam szablon).

   Modu³ wymaga zainstalowanej biblioteki libgadu oraz ¼róde³ programu
   ekg. Odpowiednie ¶cie¿ki do nich nale¿y ustawiæ w
   modules/ggnotify/Makefile przed kompilacj± modu³u.
     _________________________________________________________________

6.2.5.2. Konfiguracja

   Podobnie jak w 'notify' masz do dyspozycji nastêpuj±ce zmienne:
     * template
       Lokalizacja pliku z szablonem wiadomo¶ci. Domy¶lnie: pusty.
       Przyk³ad: template = modules/ggnotify/sample/mailtemplate
     * uin
       Identyfikator gadu-gadu u¿ytkownika wysy³aj±cego wiadomo¶ci.
       Domy¶lnie: pusty.
       Przyk³ad: uin = 1234567
     * password
       Has³o dla konta okre¶lonego zmienn± 'uin'. Domy¶lnie: puste.
       Przyk³ad: password = "moje_trudne__has³o"
     * limit
       Wiadomo¶æ o zaleg³o¶ciach zostaje wys³ana je¶li saldo u¿ytkownika
       spadnie poni¿ej kwoty okre¶lonej zmienn± limit. Domy¶lnie: 0
       Przyk³ad: limit = -20
     * debug_uin
       Je¶li ustawione, na to konto zostan± wys³ane wszystkie wiadomo¶ci.
       Domy¶lnie: puste.
       Przyk³ad: debug_uin = 7654321
     _________________________________________________________________

6.2.6. Cutoff

6.2.6.1. Opis

   Cutoff zmienia na 'od³±czony' status komputerów u¿ytkownikom, którzy
   maj± na koncie zaleg³o¶ci wiêksze ni¿ okre¶lony limit. Ten modu³ nie
   zajmuje siê fizycznym blokowaniem dostêpu do sieci. Nale¿y pamiêtaæ
   aby uruchamiaæ go przed modu³ami takimi jak np. 'hostfile'. Wa¿na jest
   kolejno¶æ instancji na li¶cie w zmiennej 'instances'. Modu³ 'cutoff'
   najlepiej uruchamiaæ codziennie.
     _________________________________________________________________

6.2.6.2. Konfiguracja

   Modu³ 'cutoff' posiada tylko jeden parametr:
     * limit
       Od³±czenie nastêpuje je¶li saldo u¿ytkownika spadnie poni¿ej kwoty
       okre¶lonej t± zmienn±. Domy¶lnie: 0.
       Przyk³ad: limit = -20
     _________________________________________________________________

6.2.7. Dhcp

6.2.7.1. Opis

   Modu³ zarz±dzaj±cy serwerem DHCP, tworzy plik konfiguracyjny oraz
   restartuje us³ugê. Zmienna 'command' umo¿liwia równie¿ wykonywanie
   innych czynno¶ci (programów).
     _________________________________________________________________

6.2.7.2. Konfiguracja

   Wiêkszo¶æ parametrów konfiguracyjnych odpowiada fragmentom pliku
   konfiguracyjnego dhcpd, które w typowych zastosowaniach nie wymagaj±
   zmiany:
     * file
       Okre¶la lokalizacjê pliku konfiguracyjnego serwera dhcp.
       Domy¶lnie: /tmp/dhcpd.conf.
       Przyk³ad: file = /etc/dhcpd.conf
     * command
       Polecenie wykonywane po utworzeniu pliku konfiguracyjnego.
       Domy¶lnie: pusta.
       Przyk³ad: command = 'killall -HUP dhcpd'
     * begin
       Nag³ówek pliku. Domy¶lnie: "shared-network LMS {".
       Przyk³ad: begin = "shared-network LMS {"
     * end
       Stopka pliku. Domy¶lnie: "}".
       Przyk³ad: end = "\n}"
     * subnet_start
       Nag³ówek podsieci. '%a' - nazwa, '%m' - maska. Domy¶lnie: "subnet
       %a netmask %m {\ndefault-lease-time 86400;\nmax-lease-time
       86400;".
       Przyk³ad: subnet_start = "subnet %a netmask %m {default-lease-time
       3600;"
     * subnet_end
       Stopka podsieci. Domy¶lnie: "}".
       Przyk³ad: subnet_end = '\t}'
     * subnet_gateway
       Brama podsieci. '%i' zostanie zamienione na adres ip. Domy¶lnie:
       'option routers %i;'.
       Przyk³ad: subnet_gateway = "option routers %i"
     * subnet_dns
       DNS'y podsieci. '%i - adresy dns'ów. Domy¶lnie: "option
       domain-name-servers %i;".
       Przyk³ad: subnet_dns = "option domain-name-servers 192.168.0.1"
     * subnet_domain
       Nazwa domenowa podsieci. '%n' - nazwa. Domy¶lnie: "option
       domain-name %n;".
       Przyk³ad: subnet_domain = "option domain-name test.%n;"
     * subnet_wins
       Serwery wins. '%i' - adres ip serwera. Domy¶lnie: "option
       netbios-name-servers %i;".
       Przyk³ad: subnet_wins = ""
     * subnet_range
       Zakres adresów podsieci. '%s' - adres pocz±tkowy, '%e' - koniec
       zakresu. Domy¶lnie: "range %s %e;".
       Przyk³ad: subnet_range = "range %s %e;"
     * host
       Parametry hostów, gdzie '%n' - nazwa hosta, '%m' - MAC, '%i' -
       adres ip. Domy¶lnie: "\thost %n {\n\t\thardware ethernet %m;
       fixed-address %i; \n\t}".
       Przyk³ad: host = "host %n {hardware ethernet %m; fixed-address
       %i;}"
     * networks
       Lista nazw sieci, które maj± byæ brane pod uwagê. Wielko¶æ liter
       nie ma znaczenia. Domy¶lnie: pusta (wszystkie sieci).
       Przyk³ad: networks = "lan1 lan2"
     * usergroups
       Lista nazw grup u¿ytkowników, które maj± byæ brane pod uwagê.
       Wielko¶æ liter nie ma znaczenia. Domy¶lnie: pusta (wszystkie
       grupy).
       Przyk³ad: usergroups = "grupa1 grupa2"
     _________________________________________________________________

6.2.8. Hostfile

6.2.8.1. Opis

   Modu³ 'hostfile' jest do¶æ uniwersalnym narzêdziem. Poniewa¿ wykonuje
   pêtlê po wszystkich komputerach w bazie rozró¿niaj±c ich status
   (od³±czony/pod³±czony), sieæ do której s± pod³aczone oraz grupy do
   których nale¿± ich w³a¶ciciele, dlatego mo¿liwe jest tworzenie np.
   regu³ dowolnego firewalla, czy te¿ pliku /etc/hosts. Dane zapisuje do
   pliku i nastêpnie wykonuje okre¶lone polecenie pow³oki.
     _________________________________________________________________

6.2.8.2. Konfiguracja

   W opcjach 'grantedhost' i 'deniedhost' mo¿na stosowaæ specjalne
   zmienne, które podczas zapisu do pliku zostan± zast±pione '%i' -
   adresem ip, '%m' - mac adresem, '%n' - nazw± komputera, '%domain' -
   domen±, '%net' - nazw± sieci, '%gw' - adresem bramy w sieci do której
   nale¿y dany komputer. Poni¿ej opcje udostêpniane przez ten modu³
     * file
       Lokalizacja pliku tymczasowego. Domy¶lnie: /tmp/hostfile
       Przyk³ad: file = /etc/rc.d/rc.firewall
     * command
       Polecenie pow³oki wyk. po utworzeniu pliku 'file'. Domy¶lnie:
       puste
       Przyk³ad: command = '/bin/sh /etc/rc.d/rc.firewall'
     * begin
       Nag³ówek pliku tymczasowego. Domy¶lnie: "/usr/sbin/iptables -F
       FORWARD\n"
       Przyk³ad: begin = "IPT=/usr/sbin/iptables \n$IPT -F FORWARD\n"
     * end
       Stopka pliku tymczasowego. Domy¶lnie: "/usr/sbin/iptables -A
       FORWARD -J REJECT\n"
       Przyk³ad: end = "$IPT -A FORWARD -J REJECT\n"
     * grantedhost
       Tekst dla hosta pod³±czonego. Domy¶lnie: "/usr/sbin/iptables -A
       FORWARD -s %i -m mac --mac-source %m -j ACCEPT\n"
       Przyk³ad: grantedhost = "$IPT -A FORWARD -s %i -m mac --mac-source
       %m -j ACCEPT\n"
     * deniedhost
       Tekst dla hosta od³±czonego. Domy¶lnie: "/usr/sbin/iptables -A
       FORWARD -s %i -m mac --mac-source %m -j REJECT\n"
       Przyk³ad: deniedhost = "$IPT -A FORWARD -s %i -m mac --mac-source
       %m -j REJECT\n"
     * networks
       Lista nazw sieci, które maj± byæ brane pod uwagê. Wielko¶æ liter
       nie ma znaczenia. Domy¶lnie: pusta (wszystkie sieci).
       Przyk³ad: networks = "lan1 lan2"
     * usergroups
       Lista nazw grup u¿ytkowników, które maj± byæ brane pod uwagê.
       Wielko¶æ liter nie ma znaczenia. Domy¶lnie: pusta (wszystkie
       grupy).
       Przyk³ad: usergroups = "grupa1 grupa2"
     * skip_dev_ips
       Je¶li ustawiona na tak (yes, true) pominiête zostan± adresy
       urz±dzeñ sieciowych. Domy¶lnie: tak
       Przyk³ad: skip_dev_ips = no
     _________________________________________________________________

6.2.9. Traffic

6.2.9.1. Opis

   'Traffic' to odpowiednik perlowego lms-traffic, zapisuj±cy do bazy
   statystyki wykorzystania ³±cza z pliku utworzonego przez u¿ytkownika.
   Plik taki powinien mieæ format: ip_hosta upload download . Wiêcej
   informacji (w tym jak utworzyæ taki plik) mo¿na znale¼æ w rozdziale
   dotycz±cym lms-traffic.
     _________________________________________________________________

6.2.9.2. Konfiguracja

   Jedyny dostêpny parametr jest jednocze¶nie obowi±zkowy:
     * file
       Lokalizacja pliku ze statystykami firewalla. Domy¶lnie:
       /var/log/traffic.log
       Przyk³ad: file = /tmp/log
     _________________________________________________________________

6.2.10. Tc (HTB)

6.2.10.1. Opis

   Modu³ generuj±cy skrypt zawieraj±cy polecenia iptables i tc s³u¿±ce do
   ograniczania pasma i limitowania po³±czeñ u¿ytkownikom. Regu³ki dla
   komputerów mo¿na dowolnie zdefiniowaæ i wykorzystaæ nie tylko do
   "traffic control". Zasada dzia³ania skryptu przedstawia siê
   nastêpuj±co: Najpierw z bazy pobierane s± dane dla wszystkich
   u¿ytkowników. Obliczane s± sumy ograniczeñ (uprate, downrate, upceil,
   downceil, limity po³±czeñ) dla ka¿dego u¿ytkownika Nastêpnie
   wykonywana jest pêtla ze sprawdzeniem przynale¿no¶ci do grupy
   u¿ytkowników i sieci (je¶li okre¶lono). Je¶li warto¶ci ograniczeñ s±
   ró¿ne od zera nastêpuje zapis regu³ do pliku z podmian± zmiennych. W
   regu³kach mo¿na stosowaæ nastêpuj±ce zmienne: %name - nazwa hosta, %i
   - adres IP, %m - MAC, %uprate, %downrate, %upceil, %downceil, %plimit,
   %climit oraz %x - licznik o warto¶ci pocz±tkowej 100 zwiêkszany o
   jeden dla ka¿dego komputera.

   Domy¶lna polityka tworzenia klas htb zak³ada utworzenie jednej klasy
   dla wszystkich komputerów u¿ytkownika. Mo¿e to byæ zmienione za pomoc±
   opcji 'one_class_per_host'.

   Konfiguracja domy¶lna zak³ada, ¿e twój system jest przystosowany do
   zastosowania htb oraz iptables z modu³ami limit, connlimit, mark i
   ipp2p. Mo¿esz sam spatchowaæ j±dro lub skorzystaæ ze ¼róde³ dostêpnych
   na stronie www.inet.one.pl.
     _________________________________________________________________

6.2.10.2. Konfiguracja

   Masz do dyspozycji standardowe parametry takie jak usergroups, file,
   command, networks i dodatkowo opcje definiuj±ce tre¶æ regu³ek tc i
   firewalla. Domy¶lna konfiguracja przeznaczona jest dla ³±cz 512/128
   kbit i 100mbit.

   Notatka

   Warto¶ci opcji konfiguracyjnych w lms.ini nale¿y podawaæ w jednej
   linii. W przypadku tego modu³u mo¿e to byæ niezbyt wygodne, dlatego
   mo¿esz stworzyæ plik z zawarto¶ci± ca³ego nag³ówka (opcja begin), a
   nastêpnie u¿yæ opcji command do jego sklejenia z reszt± skryptu
   wygenerowan± przez modu³.
     * file
       Lokalizacja pliku tymczasowego. Domy¶lnie: /etc/rc.d/rc.htb.
       Przyk³ad: file = /tmp/rc.htb
     * command
       Polecenie pow³oki wykonywane po utworzeniu pliku. Domy¶lnie: "sh
       /etc/rc.d/rc.htb start".
       Przyk³ad: command = "chmod 700 /tmp/rc.htb; /tmp/rc.htb start"
     * begin
       Nag³ówek skryptu. Domy¶lnie:
"#!/bin/sh
IPT=/usr/sbin/iptables
TC=/sbin/tc
LAN=eth0
WAN=eth1
BURST="burst 30k"

stop ()
{
$IPT -t mangle -D FORWARD -i $WAN -j LIMITS >/dev/null 2>&1
$IPT -t mangle -D FORWARD -o $WAN -j LIMITS >/dev/null 2>&1
$IPT -t mangle -F LIMITS >/dev/null 2>&1
$IPT -t mangle -X LIMITS >/dev/null 2>&1
$IPT -t mangle -F OUTPUT
$IPT -t filter -F FORWARD
$TC qdisc del dev $LAN root 2> /dev/null
$TC qdisc del dev $WAN root 2> /dev/null
}

start ()
{
stop
$IPT -t mangle -N LIMITS
$IPT -t mangle -I FORWARD -i $WAN -j LIMITS
$IPT -t mangle -I FORWARD -o $WAN -j LIMITS
# incomming traffic
$IPT -t mangle -A OUTPUT -j MARK --set-mark 1
$TC qdisc add dev $LAN root handle 1:0 htb default 3 r2q 1
$TC class add dev $LAN parent 1:0 classid 1:1 htb rate 99000kbit ceil 99000kbit quantum 1500
$TC class add dev $LAN parent 1:1 classid 1:2 htb rate   500kbit ceil   500kbit
$TC class add dev $LAN parent 1:1 classid 1:3 htb rate 98500kbit ceil 98500kbit prio 9 quantum 1500
$TC qdisc add dev $LAN parent 1:3 esfq perturb 10 hash dst
# priorities for ICMP, TOS 0x10 and ports 22 and 53
$TC class add dev $LAN parent 1:2 classid 1:20 htb rate 50kbit ceil 500kbit $BURST prio 1 quantum 1500
$TC qdisc add dev $LAN parent 1:20 esfq perturb 10 hash dst
$TC filter add dev $LAN parent 1:0 protocol ip prio 2 u32 match ip sport 22 0xffff flowid 1:20
$TC filter add dev $LAN parent 1:0 protocol ip prio 2 u32 match ip sport 53 0xffff flowid 1:20
$TC filter add dev $LAN parent 1:0 protocol ip prio 1 u32 match ip tos 0x10 0xff flowid 1:20
$TC filter add dev $LAN parent 1:0 protocol ip prio 1 u32 match ip protocol 1 0xff flowid 1:20
# server -> LAN
$TC filter add dev $LAN parent 1:0 protocol ip prio 4 handle 1 fw flowid 1:3

# outgoing traffic
$TC qdisc add dev $WAN root handle 2:0 htb default 11 r2q 1
$TC class add dev $WAN parent 2:0 classid 2:1 htb rate 120kbit ceil 120kbit
# priorities for ACK, ICMP, TOS 0x10, ports 22 and 53
$TC class add dev $WAN parent 2:1 classid 2:10 htb rate 60kbit ceil 120kbit prio 1 quantum 1500
$TC qdisc add dev $WAN parent 2:10 esfq perturb 10 hash dst
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip protocol 6 0xff \
match u8 0x05 0x0f at 0 match u16 0x0000 0xffc0 at 1 match u8 0x10 0xff at 33 flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip dport 22 0xffff flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip dport 53 0xffff flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip tos 0x10 0xff flowid 2:10
$TC filter add dev $WAN parent 2:0 protocol ip prio 1 u32 match ip protocol 1 0xff flowid 2:10
# server -> Internet
$TC class add dev $WAN parent 2:1 classid 2:11 htb rate 30kbit ceil 120kbit prio 2 quantum 1500
$TC qdisc add dev $WAN parent 2:11 esfq perturb 10 hash dst
$TC filter add dev $WAN parent 2:0 protocol ip prio 3 handle 1 fw flowid 2:11
$TC filter add dev $WAN parent 2:0 protocol ip prio 9 u32 match ip dst 0/0 flowid 2:11
       Przyk³ad: begin = "#!/bin/bash\n$TC=/usr/local/sbin/tc\n"
     * end
       Stopka skryptu. Domy¶lnie:
}

case "$1" in
    'start')
        start
    ;;
    'stop')
        stop
    ;;
    'status')
        echo "WAN Interface"
        echo "============="
        $TC class show dev $WAN | grep root
        $TC class show dev $WAN | grep -v root | sort | nl
        echo "LAN Interface"
        echo "============="
        $TC class show dev $LAN | grep root
        $TC class show dev $LAN | grep -v root | sort | nl
    ;;
    *)
        echo -e "\nUsage: rc.htb start|stop|status"
    ;;
esac
       Przyk³ad: end = ""
     * one_class_per_host
       Okre¶la politykê tworzenia klas htb. W ustawieniu domy¶lnym
       wszystkie komputery u¿ytkownika zostan± wrzucone do jednej klasy.
       Ustawienie tej opcji na 'true' spowoduje, ¿e regu³y okre¶lone w
       host_htb_up i host_htb_down zostan± wygenerowane dla wszystkich
       komputerów u¿ytkownika (z inn± warto¶ci± '%x'). Regu³y z
       host_mark_down, host_mark_up, host_plimit i host_climit generowane
       s± dla ka¿dego komputera niezale¿nie od ustawieñ tej zmiennej.
       Domy¶lnie: false
       Przyk³ad: one_class_per_host = 1
     * host_mark_down
       Regu³a markuj±ca dla ka¿dego komutera. Domy¶lnie:
# %n
$IPT -t mangle -A LIMITS -d %i -j MARK --set-mark %x
       Przyk³ad: host_mark_down = ""
     * host_mark_up
       Regu³a markuj±ca dla ka¿dego komutera. Domy¶lnie:
$IPT -t mangle -A LIMITS -s %i -j MARK --set-mark %x
       Przyk³ad: host_mark_up = ""
     * host_htb_down
       Zestaw regu³ dla ka¿dego komutera, wykonywanych gdy uprate i
       downrate s± ró¿ne od zera. Domy¶lnie:
$TC class add dev $LAN parent 1:2 classid 1:%x htb rate %downratekbit ceil %downceilkbit $BURST prio 2 quantum 1500
$TC qdisc add dev $LAN parent 1:%x esfq perturb 10 hash dst
$TC filter add dev $LAN parent 1:0 protocol ip prio 5 handle %x fw flowid 1:%x
       Przyk³ad: host_htb_down = ""
     * host_htb_up
       Zestaw regu³ dla ka¿dego komutera, wykonywanych gdy uprate i
       downrate s± ró¿ne od zera. Domy¶lnie:
$TC class add dev $WAN parent 2:1 classid 2:%x htb rate %upratekbit ceil %upceilkbit $BURST prio 2 quantum 1500
$TC qdisc add dev $WAN parent 2:%x esfq perturb 10 hash dst
$TC filter add dev $WAN parent 2:0 protocol ip prio 5 handle %x fw flowid 2:%x
       Przyk³ad: host_htb_up = ""
     * host_climit
       Regu³ka z ograniczeniem ilo¶ci równoczesnych po³±czeñ tcp.
       Wykonywana gdy climit w bazie jest ró¿ny od zera. Domy¶lnie:
$IPT -t filter -I FORWARD -p tcp -s %i -m connlimit --connlimit-above %climit -m ipp2p --ipp2p -j REJECT
       Przyk³ad: host_climit = "$IPT -t filter -I FORWARD -p tcp -s %i -m
       connlimit --connlimit-above -j REJECT"
     * host_plimit
       Regu³ka z ograniczeniem ilo¶ci pakietów w jednostce czasu (tutaj
       sekunda). Wykonywana gdy plimit w bazie jest ró¿ny od zera.
       Domy¶lnie:
$IPT -t filter -I FORWARD -p tcp -d %i -m limit --limit %plimit/s -m ipp2p --ipp2p -j ACCEPT
$IPT -t filter -I FORWARD -p tcp -s %i -m limit --limit %plimit/s -m ipp2p --ipp2p -j ACCEPT
       Przyk³ad: host_plimit = ""
     * networks
       Lista nazw sieci, które maj± byæ brane pod uwagê. Wielko¶æ liter
       nie ma znaczenia. Domy¶lnie: pusta (wszystkie sieci).
       Przyk³ad: networks = "lan1 lan2"
     * usergroups
       Lista nazw grup u¿ytkowników, które maj± byæ brane pod uwagê.
       Wielko¶æ liter nie ma znaczenia. Domy¶lnie: pusta (wszystkie
       grupy).
       Przyk³ad: usergroups = "grupa1 grupa2"
     _________________________________________________________________

6.2.11. Dns

6.2.11.1. Opis

   Modu³ do konfiguracji stref serwera 'named' jest jednym z bardziej
   skomplikowanych. Tworzy dla ka¿dej sieci pliki stref oraz odpowiednie
   wpisy w named.conf w oparciu o szablony tych plików. Przyk³adowe
   szablony znajduj± siê w katalogu /modules/dns/sample.
     _________________________________________________________________

6.2.11.2. Konfiguracja

     * forward-patterns
       Katalog z szablonami stref. Domy¶lnie: forward.
       Przyk³ad: forward-patterns = /dns/patterns/forward
     * reverse-patterns
       Katalog z szablonami stref odwrotnych. Domy¶lnie: reverse.
       Przyk³ad: reverse-patterns = /dns/patterns/revers
     * generic-forward
       Szablon domy¶lny. Zostanie wykorzystany je¶li w katalogu
       okre¶lonym 'forward-patterns' nie bêdzie pliku odpowiadaj±cego
       nazwie domenowej sieci. Domy¶lnie:
       modules/dns/sample/forward/generic.
       Przyk³ad: generic-forward = /dns/patterns/forward
     * generic-reverse
       Szablon domy¶lny. Zostanie wykorzystany je¶li w katalogu
       okre¶lonym 'reverse-patterns' nie bêdzie pliku odpowiadaj±cego
       numerowi IP sieci. Domy¶lnie: modules/dns/sample/reverse/generic.
       Przyk³ad: generic-reverse = /dns/patterns/forward
     * forward-zones
       Katalog na pliki wynikowe stref. Domy¶lnie:
       modules/dns/sample/out/forward.
       Przyk³ad: forward-zones = /dns/forward
     * reverse-zones
       Katalog na pliki wynikowe stref odwrotnych. Domy¶lnie:
       modules/dns/sample/out/reverse.
       Przyk³ad: reverse-zones = /dns/reverse
     * host-reverse
       Linia w pliku strefy odw. odpowiadaj±ca ka¿demu komputerowi w dane
       sieci. Domy¶lnie: "%n IN A %i\n".
       Przyk³ad: host-reverse = "\t %n IN A %i\n"
     * host-forward
       Linia w pliku strefy odpowiadaj±ca ka¿demu komputerowi w danej
       sieci. Domy¶lnie: "%c IN PTR %n.%d.\n".
       Przyk³ad: host-forward = "\t %c IN PTR %n.%d.\n"
     * conf-pattern
       Lokalizacja szablonu g³ównego pliku konfiguracyjnego serwera.
       Domy¶lnie: modules/dns/sample/named.conf.
       Przyk³ad: conf-pattern = /dns/patterns/named.conf
     * conf-output
       Lokalizacja g³ównego pliku konfiguracyjnego serwera. Domy¶lnie:
       /tmp/named.conf.
       Przyk³ad: conf-output = /etc/named.conf
     * conf-forward-entry
       Wpis dla ka¿dej strefy w g³ównym pliku konfiguracyjnym. Domy¶lnie:
       'zone "%n" {\ntype master;\n file "forward/%n"; \nnotify yes; \n};
       \n'.
       Przyk³ad: conf-forward-entry = 'zone "%n" { \n\ttype master;
       \n\tfile "forward/%n"; \n\tnotify yes; \n}; \n'
     * conf-reverse-entry
       Wpis dla ka¿dej strefy odw. w g³ównym pliku konfiguracyjnym.
       Domy¶lnie: 'zone "%c.in-addr.arpa" { \ntype master; \nfile
       "reverse/%i"; \nnotify yes; \n}; \n'.
       Przyk³ad: conf-revers-entry = 'zone "%c.in-addr.arpa" { \n\ttype
       master; \n\tfile "reverse/%i"; \n\tnotify yes; \n}; \n'
     * command
       Polecenie wykonywane po utworzeniu plików konf. Domy¶lnie: puste.
       Przyk³ad: command = ""
     * networks
       Lista nazw sieci, które maj± byæ brane pod uwagê. Wielko¶æ liter
       nie ma znaczenia. Domy¶lnie: pusta (wszystkie sieci).
       Przyk³ad: networks = "lan1 lan2"
     * usergroups
       Lista nazw grup u¿ytkowników, które maj± byæ brane pod uwagê.
       Wielko¶æ liter nie ma znaczenia. Domy¶lnie: pusta (wszystkie
       grupy).
       Przyk³ad: usergroups = "grupa1 grupa2"
     _________________________________________________________________

6.2.12. Ethers

6.2.12.1. Opis

   Modu³ tworz±cy konfiguracjê tablicy ARP systemu. Ustawiaj±c opcjê
   'dummy_macs' mo¿na sprawiæ, aby komputerom od³±czonym zosta³
   przypisany mac-adres 00:00:00:00:00:00.
     _________________________________________________________________

6.2.12.2. Konfiguracja

   Tutaj s± tylko standardowe opcje:
     * file
       Lokalizacja pliku wynikowego. Domy¶lnie: /tmp/ethers.
       Przyk³ad: file = /etc/ethers
     * command
       Polecenie pow³oki wykonywane po wygenerowaniu konfiga. Domy¶lnie:
       puste.
       Przyk³ad: command = "arp -f /etc/ethers"
     * dummy_macs
       Je¶li ustawimy na 'yes', to komputerom od³±czonym zostanie
       przypisany mac-adres '00:00:00:00:00:00'. Domy¶lnie: "no".
       Przyk³ad: dummy_macs = yes
     * networks
       Lista nazw sieci, które maj± byæ brane pod uwagê. Wielko¶æ liter
       nie ma znaczenia. Domy¶lnie: pusta (wszystkie sieci).
       Przyk³ad: networks = "lan1 lan2"
     * usergroups
       Lista nazw grup u¿ytkowników, które maj± byæ brane pod uwagê.
       Wielko¶æ liter nie ma znaczenia. Domy¶lnie: pusta (wszystkie
       grupy).
       Przyk³ad: usergroups = "grupa1 grupa2"
     _________________________________________________________________

6.2.13. Oident

6.2.13.1. Opis

   Modu³ do konfiguracji oidentd. W zasadzie mo¿na to zrobiæ modu³em
   'hostfile', ale tutaj masz ju¿ gotowe ustawienia domy¶lne.
     _________________________________________________________________

6.2.13.2. Konfiguracja

   A oto parametry modu³u 'oident'
     * begin
       Tekst wstawiany na pocz±tku pliku. Domy¶lnie: puste.
       Przyk³ad: begin = "#Generowany automatycznie\n"
     * end
       Tekst wstawiany na koñcu pliku. Domy¶lnie: puste.
       Przyk³ad: end = ""
     * host
       Linia tekstu dla ka¿dego komputera. Domy¶lnie: "%i\t%n\tUNIX".
       Przyk³ad: host = "%i %n WINDOWS"
     * file
       Tekst wstawiany na pocz±tku pliku. Domy¶lnie: /tmp/oidentd.conf.
       Przyk³ad: file = /etc/identd.conf
     * networks
       Lista nazw sieci do uwzglêdnienia. Domy¶lnie: pusta (wszystkie
       sieci).
       Przyk³ad: networks = 'lan1 lan2'
     * command
       Polecenie do wykonania po utworzeniu pliku. Domy¶lnie: puste.
       Przyk³ad: command = "killall -HUP midentd"
     _________________________________________________________________

6.2.14. Pinger

6.2.14.1. Opis

   Modu³ pinger to odpowiednik perlowego skryptu lms-fping. Ró¿nice s±
   jednak zasadnicze. Nie potrzebuje zewnêtrznego programu i dzia³a przy
   wykorzystaniu protoko³u ARP. Powodem tego jest mniej wiêcej dwukrotnie
   szybsze wykonanie skanowania sieci. Nie ma tak¿e problemów z
   komputerami maj±cymi wy³±czone odpowiadanie na pingi. Po skanowaniu,
   wszystkim w³±czonym komputerom jest ustawiany w bazie danych czas
   skanowania, wykorzystywany do obrazowania aktywno¶ci komputerów np. na
   mapie sieci.
     _________________________________________________________________

6.2.14.2. Konfiguracja

   Pinger udostêpnia tylko jedn± opcjê konfiguracyjn±:
     * networks
       Lista nazw sieci, które maj± byæ skanowane. Domy¶lnie: pusta
       (wszystkie sieci).
       Przyk³ad: networks = 'lan1 lan2'
     _________________________________________________________________

Rozdzia³ 7. Dla dociekliwych

7.1. Drzewo katalogów

   Tabela 7-1. Drzewo katalogów LMS
      Nazwa                       Opis
     backups           Kopie zapasowe bazy danych
       bin            Skrypty wykonywalne lms-...
     contrib    Dodatki stworzone przez u¿ytkowników LMS
     daemon               A.L.E.C's LMS Daemon
      devel        Skrypty przydatne dla developerów
       doc                    Dokumentacja
       img         Obrazki do Interfejsu U¿ytkownika
       lib      LMS'owy zbiór bibliotek PHP oraz Smarty
     modules         Modu³y Interfejsu U¿ytkownika
     sample        Przyk³adowe skrypty i inne dodatki
    templates  Temlejty Smarty dla Interfejsu U¿ytkownika
   templates_c              Pliki tymczasowe
     _________________________________________________________________

7.2. Struktura bazy danych

   Poni¿ej przedstawiono ogóln± strukturê bazy danych LMS. Bardziej
   szczegó³owe informacje o typach danych, ograniczeniach nak³adanych na
   pola oraz warto¶ci domy¶lne zawarte s± w plikach lms.mysql, lms.pgsql
   i lms.sqlite w katalogu /doc.
     _________________________________________________________________

7.2.1. Administratorzy ('admins')

   id - identyfikator
   login - login
   name - nazwa (nazwisko i imiê)
   email - adres admina
   rights - prawa dostêpu
   passwd - has³o logowania
   lastlogindate - data ostatniego logowania
   lastloginip - adres IP, z którego nast±pi³o ostatnie logowanie
   failedlogindate - data ostatniej nieudanej próby logowania
   failedloginip - adres IP, z którego próbowano siê zalogowaæ
   deleted - czy usuniêty (0/1)
     _________________________________________________________________

7.2.2. U¿ytkownicy ('users')

   id - identyfikator
   lastname - nazwa/nazwisko
   name - imiê
   status - status u¿ytkownika (3-pod³±czony, 2-oczekuj±cy,
   1-zainteresowany)
   email - adres poczty internetowej
   phone1 - telefon
   phone2 - telefon
   phone3 - telefon
   gguin - identyfikator gadu-gadu
   pin - numer pin (uwierzytelnianie)
   address - adres (ulica, nr domu, nr lokalu)
   zip - kod pocztowy
   city - nazwa miasta
   nip - numer identyfikacji podatkowej NIP
   pesel - numer PESEL
   info - dodatkowe informacje
   serviceaddr - adres do dorêczeñ (np. na faktury)
   creationdate - czas utworzenia wpisu
   moddate - czas modyfikacji
   creatorid - identyfikator administratora tworz±cego wpis
   modid - identyfikator administratora dokonuj±cego zmian danych
   deleted - usuniêty z bazy (0/1)
   message - komunikat do wy¶wietlenia przy w³aczonych ostrze¿eniach
     _________________________________________________________________

7.2.3. Grupy u¿ytkowników ('usergroups')

   id - identyfikator
   name - nazwa
   description - opis
     _________________________________________________________________

7.2.4. Grupy u¿ytkowników - c.d. ('userassignments')

   id - identyfikator
   usergroupid - identyfikator grupy
   userid - identyfikator u¿ytkownika
     _________________________________________________________________

7.2.5. Sieci ('networks')

   id - identyfikator
   name - nazwa sieci
   address - adres IP
   mask - maska
   interface - interfejs (np. eth1)
   gateway - adres IP bramy
   dns - adres IP serwera nazw
   dns2 - adres IP zapasowego serwera nazw
   domain - domena
   wins - adres serwera WINS
   dhcpstart - pocz±tek zakresu DHCP
   dhcpend - koniec zakresu DHCP
     _________________________________________________________________

7.2.6. Komputery i adresy IP urz±dzeñ sieciowych ('nodes')

   id - identyfikator
   name - nazwa
   mac - adres MAC
   ipaddr - adres IP
   ownerid - identyfikator w³a¶ciciela ('0' - dla adresu urz±dzenia)
   creationdate - znacznik czasu utworzenia wpisu
   moddate - znacznik czasu ostatniej modyfikacji
   creatorid - identyfikator administratora tworz±cego wpis
   modid - identyfikator administratora
   netdev - identyfikator urz±dzenia sieciowego do którego jest
   pod³±czony komputer
   access - pod³±czony/od³±czony (1/0)
   warning - ostrzegaj/nie ostrzegaj (1/0)
   lastonline - znacznik czasu ostatniej obecno¶ci w sieci
     _________________________________________________________________

7.2.7. Sprzêt sieciowy ('netdevices')

   id - identyfikator
   name - nazwa
   location - lokalizacja
   description - opis
   producer - producent
   model - model
   serialnumber - numer seryjny
   ports - ilo¶æ portów
     _________________________________________________________________

7.2.8. Po³±czenia sieciowe ('netlinks')

   id - identyfikator
   src - jeden koniec
   dst- drugi koniec
     _________________________________________________________________

7.2.9. Operacje finansowe ('cash')

   id - identyfikator
   time - znacznik czasu zaksiêgowania operacji
   adminid - identyfikator administratora dokonuj±cego operacji
   type - typ operacji (przychód, rozchód, wp³ata, obci±¿enie)
   value - warto¶æ w z³otych
   taxvalue - procent podatku
   userid - identyfikator u¿ytkownika ('0' - je¶li nie dotyczy)
   invoiceid - identyfikator faktury obejmuj±cej dan± operacjê
   comment - opis operacji
     _________________________________________________________________

7.2.10. Taryfy ('tariffs')

   id - identyfikator
   name - nazwa
   value - kwota
   taxvalue - wysoko¶æ podatku w procentach
   pkwiu - numer PKWiU
   uprate - gwarantowany upload
   upceil - maksymalny upload
   downrate - gwarantowany download
   downceil - maksymalny download
   climit - limit po³±czeñ
   plimit - limit pakietów
   description - opis
     _________________________________________________________________

7.2.11. Op³aty sta³e ('payments')

   id - identyfikator
   name - nazwa
   value - kwota
   creditor - nazwa wierzyciela
   period - typ okresu naliczania: co tydzieñ/co miesi±c/co kwarta³/co
   rok (0/1/2/3)
   at - dzieñ naliczenia
   description - opis
     _________________________________________________________________

7.2.12. Powi±zania ('assignments')

   id - identyfikator
   tariffid - identyfikator taryfy
   userid - identyfikator u¿ytkownika
   period - typ okresu
   at - dzieñ naliczania
   datefrom - data obowi±zywania zobowi±zania
   dateto - data obowi±zywania zobowi±zania
   invoice - okre¶la czy ma byæ wystawiana faktura (1 - tak, 0 - nie)
   suspended - zawieszenie p³atno¶ci (1 - tak, 0 - nie)
     _________________________________________________________________

7.2.13. Faktury ('invoices')

   id - identyfikator
   number - numer w roku
   cdate - data wystawienia
   paytime - termin p³atno¶ci (ilo¶æ dni)
   paytype - rodzaj p³atno¶ci (przelew/gotówka/etc.)
   customerid - identyfikator u¿ytkownika-nabywcy
   name - nazwa (nazwisko i imiê) nabywcy
   address - adres nabywcy
   nip - nip nabywcy
   pesel - PESEL nabywcy
   zip - kod pocztowy nabywcy
   phone - telefon nabywcy
   city - miasto nabywcy
   finished - pole okre¶laj±ce zamkniêcie faktury (0/1)
     _________________________________________________________________

7.2.14. Faktury - cd. ('invoicecontents')

   invoiceid - identyfikator faktury
   value - kwota pozycji
   taxvalue - wysoko¶æ podatku w procentach
   pkwiu - numer PKWiU
   content - u¿yta jednostka (najczê¶ciej 'szt.')
   count - ilo¶æ
   description - opis
   tariffid - identyfikator taryfy
     _________________________________________________________________

7.2.15. Historia ('timestamps')

   time - czas ostatniej modyfikacji
   tablename - nazwa tabeli
     _________________________________________________________________

7.2.16. Statystyki wykorzystania ³±cza ('stats')

   nodeid - numer komputera
   dt - znacznik czasu
   upload - ilo¶æ danych wys³anych, w bajtach
   download - ilo¶æ danych odebranych, w bajtach
     _________________________________________________________________

7.2.17. Helpdesk - kolejki ('rtqueues')

   id - identyfikator
   name - nazwa
   email - adres konta pocztowego
   description - opis dodatkowy
     _________________________________________________________________

7.2.18. Helpdesk - zg³oszenia ('rttickets')

   id - identyfikator
   queueid - identyfikator kolejki
   requestor - dane zg³aszaj±cego (w tym e-mail)
   userid - identyfikator u¿ytkownika
   subject - temat zg³oszenia
   state - status (0-nowy, 1-otwarty, 2-rozwi±zany, 3-martwy)
   owner - identyfikator w³a¶ciciela-administratora
   createtime - data zg³oszenia
     _________________________________________________________________

7.2.19. Helpdesk - wiadomo¶ci ('rtmessages')

   id - identyfikator
   ticketid - identyfikator zg³oszenia
   adminid - identyfikator administratora nadawcy
   userid - identyfikator u¿ytkownika nadawcy
   mailfrom - e-mail nadawcy
   subject - temat wiadomo¶ci
   messageid - pocztowy identyfikator wiadomo¶ci
   inreplyto - identyfikator poprzedniej wiadomo¶ci
   replyto - nag³ówek wiadomo¶ci
   headers - wszystkie nag³ówki pocztowe wiadomo¶ci
   body - tre¶æ wiadomo¶ci
   createtime - data utworzenia/wys³ania/odebrania
     _________________________________________________________________

7.2.20. Helpdesk - za³±czniki ('rtattachments')

   messageid - identyfikator wiadomo¶ci
   filename - nazwa pliku
   contenttype - typ pliku
     _________________________________________________________________

7.2.21. Helpdesk - uprawnienia ('rtrights')

   id - identyfikator
   queueid - identyfikator kolejki
   adminid - identyfikator administratora
   rights - (1-odczyt, 2-zapis)
     _________________________________________________________________

7.2.22. Informacje o bazie danych ('dbinfo')

   keytype - typ
   keyvalue - warto¶æ
     _________________________________________________________________

7.3. Format pliku konfiguracyjnego

   W pliku konfiguracyjnym LMS'a (standardowo /etc/lms/lms.ini) mo¿na
   ustawiaæ parametry LMS-UI, daemona almsd oraz skryptów perlowych
   (LMS_MGC). Przy czym format warto¶ci parametrów dla skryptów perlowych
   podlega wiêkszym restrykcjom.
     _________________________________________________________________

7.3.1. Komentarze

   Programy parsuj±ce plik konfiguracyjny pomijaj± wszystkie linie
   zaczynaj±ce siê znakiem '#' lub ';'. Komentarze poprzedzone jednym z
   tych znaków mo¿na tak¿e wstawiaæ w tej samej linii co sekcje i opcje.
     _________________________________________________________________

7.3.2. Sekcje, klucze, warto¶ci

   Opcje konfiguracyjne pogrupowane s± w sekcje. Nazwê sekcji, sk³adaj±c±
   siê z liter i/lub cyfr nale¿y zamkn±æ w nawiasy kwadratowe. Ich nazwy
   powinny byæ unikalne.

   Sekcje i parametry umieszcza siê w osobnych liniach. Parametry
   sk³adaj± siê z klucza i warto¶ci. Klucz to nazwa parametru
   konfiguracyjnego sk³adaj±ca siê z liter i/lub cyfr. W tej samej linii
   co klucz, po znaku równo¶ci, umieszcza siê warto¶æ parametru. Je¶li
   warto¶æ zawiera znaki specjalne nale¿y j± obj±æ w apostrofy lub
   cudzys³ów.

   Przyk³ad 7-1. Format opcji konfiguracyjnych
[sekcja]
klucz = warto¶æ
zmienna1 = "jaki¶ tekst"
para_metr = 'zmienna "para_metr" w apostrofach'

[sekcja_1]                              #tu mo¿na komentowaæ
klucz = "tekst ze znakami \t i ;"       ; tu te¿ mo¿na komentowaæ
; a to jest komentarz na ca³± liniê
key = "A.L.E.C's LMS Daemon is the best"
# opcja = wy³±czona
     _________________________________________________________________

7.3.3. Zmienne dla skryptów perlowych

   Konfiguracja skryptów perlowych, z uwagi na zastosowanie modu³u
   Config::IniFiles, ma pewne ograniczenia. Komentarze mog± byæ wstawiane
   tylko i wy³±cznie w nowej linii. Warto¶ci zmiennych nie obejmuje siê w
   apostrofy lub cudzys³ów, a s± one czytane od znaku równo¶ci do koñca
   wiersza. Dlatego w³a¶nie nie mo¿na umieszczaæ komentarzy w jednej
   linii z parametrami.
     _________________________________________________________________

7.4. Generowanie danych losowych

   Dla osób chc±cych szybko sprawdziæ jak dzia³a LMS przygotowali¶my
   modu³ 'genfake', s³u¿±cy do tworzenia bazy zawieraj±cej przyk³adowe
   dane.

   Aby wygenerowaæ dane nale¿y, po zalogowaniu siê w LMS'ie wywo³aæ adres
   http://twoj.serwer.net/lms/?m=genfake, okre¶liæ ilu u¿ytkowników ma
   zostaæ stworzonych i nacisn±æ ENTER. To wszystko. Ewentualne b³êdy
   bazy danych, spowodowane ograniczeniami unikalno¶ci niektórych danych,
   mo¿na zignorowaæ.
   Notatka

   Dla prawid³owego wygenerowania zale¿no¶ci, modu³ 'genfake' nale¿y
   uruchamiaæ na pustej, nowoutworzonej bazie.
   Ostrze¿enie

   Wszystkie dane (oprócz danych administratorów) zostan± usuniête z
   bazy.
     _________________________________________________________________

7.5. Poziomy dostêpu

   W sumie tutaj to wyt³umaczê bardziej dla developerów, gdy¿ osoby
   korzystaj±ce z LMS raczej nie bêd± zainteresowane.

   Oryginalnie poziomy dostêpu mia³y byæ definiowane poprzez ró¿ne
   litery. By³o to za³o¿enie z czasów LMS-0.4, lecz nigdy nie
   wykorzystane. Z racji tego, ¿e wesz³o to do 1.0, d³ugo siê g³owi³em
   jak wykorzystaæ 64-znakowego stringa. Otó¿ w kolumnie rights jest po
   prostu 64-znakowa (256-bitowa) liczba heksadecymalna. Ka¿dy jej znak
   mo¿e opisaæ maksymalnie cztery bity kombinacji (4*64 = 256 - st±d
   ilo¶æ mo¿liwych poziomów). Tak wiêc w³±czenie jakiego¶ poziomu dostêpu
   powoduje ustawienie w tej liczbie odpowiedniego bitu. I tak je¿eli
   "pe³en dostêp" ma pozycjê 0 w lib/accesstable.php, zostanie ustawiony
   bit 0, czyli bêdzie to liczba 1. Wiêc poziomy mog± mieæ numery od 0 do
   255. Nie jest to finalne ograniczenie. Stosuj±c wiêcej liter i znaków
   mo¿na rozszerzyæ ilo¶æ mo¿liwych kombinacji do przynajmniej 6 bitów na
   znak, co da nam 384 kombinacje.
     _________________________________________________________________

7.6. Ograniczenia

   Ka¿dy system ma ograniczenia. Pewne wynikaj± z u¿ytego silnika SQL
   (DBMS) inne za¶ z za³o¿eñ [prawie] ¶wiadomie podjêtych przez
   developerów. Nasz system takowe posiada:
     _________________________________________________________________

7.6.1. Wynikaj±ce z naszego projektu

   Ilo¶æ pieniêdzy (tabela 'cash'). Pieni±¿ki (od lms-1.1) przechowujemy
   jako 32 bitow± liczbê ca³kowit± i w zwi±zku z tym za 8 lat bêdziecie
   nas nie lubiæ posiadaj±c oko³o 5000 u¿ytkowników.
     _________________________________________________________________

7.6.2. Wynikaj±ce z u¿ywanego DBMS

     * MySQL
          + Rozmiar bazy danych:
            Jak mówi dokumentacja do MySQL'a (rozdzia³: Table size,
            paragraf "How Big Can MySQL Tables Be?"), MySQL wersja 3.22
            by³ ograniczony do 4 GB na tabelkê. W wersji za¶ 3.23 zosta³o
            to podniesione do 8 milionów terabajtów (czyli 2^63 bajtów).
            Jednak warto zauwa¿yæ ¿e ró¿ne systemy operacyjne maj± limity
            nak³adane przez systemy plików, najczê¶ciej jest to 2 lub 4
            GB.
          + Ilo¶æ rekordów:
            Prawdziwe informacje na temat limitów uzyskamy dopiero po
            wydaniu polecenia: (w interpreterze poleceñ mysql)
mysql> show table status;

...| Avg_row_length | Data_length | Max_data_length | Index_length |
...|             44 |       24136 |      4294967295 |        19456 |
            Zauwa¿ymy ¿e miejsca wystarczy na oko³o 175 000 razy tyle ile
            mamy aktualnie wpisów w tabelce. (czyt.: mo¿esz spaæ
            spokojnie, chyba ¿e planujesz posiadanie ponad 100000
            u¿ytkowników :-)
     * PostgreSQL
          + Rozmiar bazy danych:
            PostgreSQL zapisuje dane w porcjach po 8 kB. Liczba tych
            bloków jest ograniczona do 32-bitowej liczby ca³kowitej ze
            znakiem, daj±c maksymaln± wielko¶æ tabeli wynosz±c± 16
            terabajtów. Z uwagi na ograniczenia systemów operacyjnych
            dane przechowywane s± w wielu plikach o wielko¶ci 1 GB ka¿dy.
          + Ilo¶æ rekordów:
            PostgreSQL nie narzuca ograniczenia na liczbê wierszy w
            dowolnej tabeli. Jednak funkcja COUNT zwraca 32-bitow± liczbê
            ca³kowit±, a zatem dla tabel zawieraj±cych ponad dwa miliardy
            wierszy wynik tej funkcji bêdzie nieprawid³owy. (Informacja
            dot. PostgreSQL 7.1)
     * SQLite
          + Rozmiar bazy danych:
            Od wersji 2.7.4 SQLite mo¿e obs³ugiwaæ bazy o rozmiarze do 2
            terabajtów. Dodatkowym ograniczeniem jest objêto¶æ danych
            zapisanych w jednym rekordzie. Wielko¶æ ta, ograniczona do 1
            MB mo¿e zostaæ zwiêkszona do 16 MB podczas kompilacji.
          + Ilo¶æ rekordów:
            Maksymalna ilo¶æ rekordów dla tej bazy to 2^32, ale nikt nie
            testowa³ nigdy takiej ilo¶ci.
     _________________________________________________________________

Rozdzia³ 8. Dodatki

   W niniejszym rozdziale zostan± opisane dodatkowe modu³y i rozwi±zania
   zwiêkszaj±ce funkcjonalno¶æ LMS'a znajduj±ce siê w katalogu contrib.
   Czê¶æ z nich nale¿y dostosowaæ do w³asnych potrzeb, a niektóre
   integruj± siê z interfejsem LMS-UI.
     _________________________________________________________________

8.1. Moje konto

8.1.1. Wstêp

   W katalogu contrib/customer znajduje siê przyk³ad rozwi±zania, dziêki
   któremu ka¿dy u¿ytkownik twojej sieci mo¿e sprawdziæ w³asny bilans
   finansowy.

   Skrypt sprawdza spod jakiego adresu jest ¿±danie i wy¶wietla bilans i
   informacje o u¿ytkowniku, który jest w³a¶cicielem komputera o tym
   adresie.

   Dla u¿ytkowników korzystaj±cych z proxy, nie korzystaj±cych z sieci
   tylko w domu, albo którzy nie chc± aby dzieci/ma³¿onkowie/pracownicy
   mieli wgl±d w dane fiansowe dotycz±ce ich dostêpu do sieci/innych
   us³ug przeznaczone jest "Moje konto 2".
     _________________________________________________________________

8.1.2. Instalacja

   Pliki nale¿y skopiowaæ w dowolne miejsce i wystawiæ pod adresem
   dostêpnym dla ka¿dego u¿ytkownika, a nastêpnie ustawiæ poprawn±
   ¶cie¿kê do lms.ini w pliku index.php.
     _________________________________________________________________

8.2. Moje konto 2

8.2.1. Wstêp

   W katalogu contrib/customer_otherip znajduje siê odpowiednik
   contrib/customer, który nie rozpoznaje u¿ytkownika po adresie IP, ale
   wymaga logowania. Uwierzytelnianie odbywa siê na podstawie numeru PIN
   oraz telefonu u¿ytkownika, ale mo¿liwe jest tak¿e wykorzystanie ID lub
   numeru umowy (dodatkowe pole w bazie) - patrz pliki balanceview.php i
   authentication.inc).

   Skrypt wy¶wietla bilans i informacje o u¿ytkowniku, a tak¿e w
   po³±czeniu z contrib/formularz_przelewu_wplaty umo¿liwia u¿ytkownikowi
   wydrukowanie druku wp³aty na kwotê zaleg³o¶ci.
     _________________________________________________________________

8.2.2. Instalacja

   Instalacja sprowadza siê do ustawienia opcji sys_dir w sekcji
   [directories] pliku lms.ini oraz zlinkowania katalogu img z lms'owymi
   ikonkami.
     _________________________________________________________________

8.3. Panel SQL

8.3.1. Wstêp

   W katalogu contrib/sqlpanel znajdziesz modu³, dziêki któremu bêdziesz
   mia³ mo¿liwo¶æ bezpo¶redniego dostêpu do bazy danych poprzez zadawanie
   zapytañ SQL. Wyniki wy¶wietlane s± w formie tabeli. Ponadto podawany
   jest czas wykonania zapytania. Mo¿liwe jest tak¿e drukowanie wyników
   zapytania.

   Ilo¶æ wy¶wietlanych wierszy na jednej stronie ograniczana jest
   domy¶lnie do 50. Mo¿na to zmieniæ przy pomocy zmiennej
   'sqlpanel_pagelimit' w sekcji [phpui] pliku konfiguracyjnego lms.ini.
     _________________________________________________________________

8.3.2. Instalacja

   Instalacja polega na skopiowaniu plików w odpowiednie miejsca w
   drzewie katalogów lms'a. Plik sql.php skopiuj do katalogu modules, a
   pliki sql.html, sqlprint.html, adminheader.html do katalogu templates.
   Po tej czynno¶ci dostêp do modu³u bêdzie mo¿liwy z menu
   Administratorzy->SQL.
     _________________________________________________________________

8.4. Ostrze¿enia + squid

8.4.1. Wstêp

   Ten ma³y zestaw narzêdzi pozwala za pomoc± squida w dosyæ elegancki
   sposób wy¶wietlaæ wiadomo¶ci administracyjne. Oczywi¶cie aby to
   dzia³a³o w 100%, wszyscy u¿ytkownicy musz± korzystaæ ze squida.

   Kluczowym elementem jest redirector. Odpowiada on za to, aby w
   momencie ustawienia dla danego komputera flagi warn, przekierowywa³
   wszystkie ¿±dania wysy³ane do serwera proxy na nasz, ustalony
   wcze¶niej adres. Przekierowaniu nie ulegaj± adresy zawieraj±ce adres
   naszej winetki, tak aby umo¿liwiæ za³adowanie siê obrazków. Po
   przekierowaniu u¿ytkownik ma mo¿liwo¶æ oznaczenia wiadomo¶ci jako
   przeczytanej, po czym skrypt automatycznie kieruje przegl±darkê na
   pierwotnie wywo³ywany URL. Wiêcej informacji znajdziesz w pliku
   README.
     _________________________________________________________________

8.4.2. Instalacja

   Zaczynamy od konfiguracji squida (squid.conf):
redirector_bypass on
redirect_program /sciezka/do/lms-squid-warnings

   które informuj± squida aby dla ka¿dego adresu u¿ywa³ naszego
   redirectora. Nastêpnie nale¿y skonfigurowaæ redirectora. Otwieramy w
   naszym ulubionym edytorze plik lms-squid-warnings i praktycznie
   wszystko co mo¿na w nim ustawiæ to:
my $configfile = '/etc/lms/lms.ini';

   Czyli po³o¿enie pliku konfiguracyjnego. Reszta konfiguracji ustawiana
   jest w lms.ini, gdzie dopisujemy sekcjê [squid-warnings] i definiujemy
   adres winetki:
[squid-warnings]
redirect        = http://nasz.serwer.pl/winetka/

   Do katalogu gdzie ma byæ widoczna winetka kopiujemy pliki index.php,
   message.html i zawarto¶æ katalogu img.
