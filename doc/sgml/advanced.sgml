<chapter id="devel">
	<title>Dla dociekliwych</title>
	<sect1 id="devel-catalogs">
		<title>Drzewo katalogów</title>
			<table>
				<title>Drzewo katalogów LMS</title>
			<tgroup cols="2">
				<colspec ALIGN="center" COLWIDTH="200">
				<colspec ALIGN="center" COLWIDTH="300">
		    	<thead>
				<row>
				<entry>Nazwa</entry>
				<entry>Opis</entry>
				</row>
		    	</thead>
		    	<tbody>
				<row>
				<entry>backups</entry>
				<entry>Kopie zapasowe bazy danych</entry>
				</row>
				<row>
				<entry>bin</entry>
				<entry>Skrypty wykonywalne lms-...</entry>
				</row>
				<row>
				<entry>contrib</entry>
				<entry>Dodatki stworzone przez u¿ytkowników LMS</entry>
				</row>
				<row>
				<entry>devel</entry>
				<entry>Skrypty przydatne dla developerów</entry>
				</row>
				<row>
				<entry>doc</entry>
				<entry>Dokumentacja</entry>
				</row>
				<row>
				<entry>img</entry>
				<entry>Obrazki do Interfejsu U¿ytkownka</entry>
				</row>
				<row>
				<entry>lib</entry>
				<entry>LMS'owy zbiór bibliotek PHP oraz Smarty</entry>
				</row>
				<row>
				<entry>modules</entry>
				<entry>Modu³y Interfejsu U¿ytkownika</entry>
				</row>
				<row>
				<entry>sample</entry>
				<entry>Przyk³adowe skrypty i inne dodatki</entry>
				</row>
				<row>
				<entry>templates</entry>
				<entry>Temlejty Smarty dla Interfejsu U¿ytkownika</entry>
				</row>
				<row>
				<entry>templates_c</entry>
				<entry>Pliki tymczasowe</entry>
				</row>
			</tbody>
			</tgroup>
	    		</table>
	</sect1>
	<sect1 id="devel-db">
		<title>Struktura bazy danych</title>
		<para>Poni¿ej przedstawiono ogóln± strukturê bazy danych LMS. Bardziej szczegó³owe
		informacje o typach danych, ograniczeniach nak³adanych na pola oraz warto¶ci domyslne
		zawarte s± w plikach <ulink url="../lms.mysql"><filename>lms.mysql</filename></ulink>
		oraz <ulink url="../lms.pgsql"><filename>lms.pgsql</filename></ulink> w katalogu
		<filename>/doc</filename>.</para>
		<sect2 id="admins">
			<title>Administratorzy ('admins')</title>
			<simplelist>
				<member>id - identyfikator</member>
				<member>login - login</member>
				<member>name - nazwa (nazwisko i imiê)</member>
				<member>email - adres admina</member>
				<member>rights - prawa dostêpu</member>
				<member>passwd - has³o logowania</member>
				<member>lastlogindate - data ostatniego logowania</member>
				<member>lastloginip - adres IP, z którego nast±pi³o ostatnie logowanie</member>
				<member>failedlogindate - data ostatniej nieudanej próby logowania</member>
				<member>failedloginip - adres IP, z którego próbowano siê zalogowaæ</member>
			</simplelist>
		</sect2>
		<sect2 id="users">
			<title>U¿ytkownicy ('users')</title>
			<simplelist>
				<member>id - identyfikator</member>
				<member>lastname - nazwa/nazwisko</member>
				<member>name - imiê</member>
				<member>status - pod³±czony/od³±czony</member>
				<member>email - adres poczty internetowej</member>
				<member>phone1 - telefon</member>
				<member>phone2 - telefon</member>
				<member>phone3 - telefon</member>
				<member>gguin - identyfikator gadu-gadu</member>
				<member>address - adres (ulica, nr domu, nr lokalu)</member>
				<member>zip - kod pocztowy</member>
				<member>city - nazwa miasta</member>
				<member>nip - numer identyfikacji podatkowej NIP</member>
				<member>info - dodatkowe informacje</member>
				<member>creationdate - czas utworzenia wpisu</member>
				<member>moddate - czas modyfikacji</member>
				<member>creatorid - identyfikator administratora tworz±cego wpis</member>
				<member>modid - identyfikator administratora dokonuj±cego zmian danych</member>
				<member>deleted - usuniêty z bazy</member>
			</simplelist>
		</sect2>
		<sect2 id="networks">
			<title>Sieci ('networks')</title>
			<simplelist>
				<member>id - identyfikator</member>
				<member>name - nazwa sieci</member>
				<member>address - adres IP</member>
				<member>mask - maska</member>
				<member>interface - interfejs (np. eth1)</member>
				<member>gateway - adres IP bramy</member>
				<member>dns - adres IP serwera nazw</member>
				<member>dns2 - adres IP zapasowego serwera nazw</member>
				<member>domain - domena</member>
				<member>wins - adres serwera WINS</member>
				<member>dhcpstart - pocz±tek zakresu DHCP</member>
				<member>dhcpend - koniec zakresu DHCP</member>
			</simplelist>
		</sect2>
		<sect2 id="nodes">
			<title>Komputery ('nodes')</title>
			<simplelist>
				<member>id - identyfikator</member>
				<member>name - nazwa</member>
				<member>mac - adres MAC</member>
				<member>ipaddr - adres IP</member>
				<member>ownerid - identyfikator w³a¶ciciela (u¿ytkownika)</member>
				<member>creationdate - znacznik czasu utworzenia wpisu</member>
				<member>moddate - znacznik czasu ostatniej modyfikacji</member>
				<member>creatorid - identyfikator administratora tworz±cego wpis</member>
				<member>modid - identyfikator administratora </member>
				<member>access - pod³±czony/od³aczony</member>
			</simplelist>
		</sect2>
		<sect2 id="cash">
			<title>Operacje finansowe ('cash')</title>
			<simplelist>
				<member>id - identyfikator</member>
				<member>time - znacznik czasu zaksiêgowania operacji</member>
				<member>adminid - identyfikator administratora dokonuj±cego operacji</member>
				<member>type - typ operacji (przychów, rozchód, wp³ata, obci±¿enie)</member>
				<member>value - warto¶æ w z³otych</member>
				<member>userid - identyfikator u¿ytkownika ('0' - je¶li nie dotyczy)</member>
				<member>comment - opis operacji</member>
			</simplelist>
		</sect2>
		<sect2 id="tariffs">
			<title>Taryfy</title>
			<simplelist>
				<member>id - identyfikator</member>
				<member>name - nazwa</member>
				<member>value - warto¶æ netto w z³otych</member>
				<member>uprate - ograniczenie szybko¶ci transferu danych wychodz±cych</member>
				<member>downrate - ograniczenie szybko¶ci transferu danych przychodz±cych</member>
				<member>description - opis</member>
			</simplelist>
		</sect2>
		<sect2 id="assignments">
			<title>Powi±zania ('assignments')</title>
   			<simplelist>
				<member>id - identyfikator</member>
				<member>tariffid - identyfikator taryfy</member>
				<member>userid - identyfikator u¿ytkownika</member>
				<member>period - okres (ilo¶æ dni)</member>
				<member>at - dzieñ naliczania</member>
			</simplelist>
		</sect2>
		<sect2 id="timestamps">
			<title>Znaczniki czasu ('timestamps')</title>
			<simplelist>
				<member>time - znacznik czasu</member>
				<member>tablename - nazwa tabeli</member>
			</simplelist>
		</sect2>
		<sect2 id="stats">
			<title>Statystyki wykorzystania ³±cza ('stats')</title>
			<simplelist>
				<member>nodeid - numer komputera</member>
				<member>dt - znacznik czasu</member>
				<member>upload - ilo¶æ danych wys³anych w bajtach</member>
				<member>download - ilo¶æ danych odebranych w bajtach</member>
			</simplelist>
		</sect2>
	</sect1>
	<sect1 id="devel-rights">
		<title>Poziomy dostêpu</title>
		<para>W  sumie  tutaj  to  wyt³umaczê  bardziej  dla developerów, gdy¿ osoby
		korzystaj±ce z LMS raczej nie bêd± zainteresowane.</para>
		<para>Oryginalnie poziomy dostêpu mia³y byæ definiowane poprzez ró¿ne litery.
		By³o to  za³o¿enie  z  czasów LMS-0.4, lecz nigdy nie wykorzystane. Z
		racji  tego,  ¿e  wesz³o  to  do 1.0, d³ugo siê g³owi³em jak wykorzystaæ
		64-znakowego  stringa. Otó¿ w kolumnie rights jest poprostu 64-znakowa
		(256-bitowa)  liczba  hexadecymalna.  Ka¿dy jej znak mo¿e opisaæ
		maksymalnie  cztery bity kombinacji (4*64 = 256 - st±d ilo¶æ mo¿liwych
		poziomów).  Tak  wiêc  w³±czenie  jakiego¶  poziomu  dostêpu  powoduje
		ustawienie  w  tej  liczbie  odpowiedniego  bitu.  I tak je¿eli "pe³en
		dostêp"  ma pozycjê 0 w lib/accesstable.php, zostanie ustawiony bit 0,
		czyli  bêdzie  to liczba 1. Wiêc poziomy mog± mieæ numery od 0 do 255.
		Nie jest to finalne ograniczenie. Stosuj±c wiêcej liter i znaków mo¿na
		rozszerzyæ ilo¶æ mo¿liwych kombinacji do przynajmniej 6 bitów na znak,
		co da nam 384 kombinacje.
		</para>
	</sect1>
	<sect1 id="devel-limits">
		<title>Ograniczenia</title>
		<para>Ka¿dy system ma ograniczenia. Pewne wynikaja z u¿ytego silnika SQL (DBMS)
		inne za¶ z za³o¿eñ [prawie] ¶wiadomie podjêtych przez developerów. Nasz system
		takowe posiada:</para>
		<sect2>
			<title>Wynikaj±ce z naszego projektu</title>
			<para>Ilo¶æ pieniêdzy (tabela 'cash'). Pieni±¿ki (od lms-1.1) przechowujemy jako
			32 bitow± liczbê ca³kowit± i w zwi±zku z tym za 8 lat bêdziecie nas nie lubiæ
			posiadaj±c oko³o 5000 u¿ytkowników.</para>
		</sect2>
		<sect2>
			<title>Wynikaj±ce z u¿ywanego DMBS</title>
			<itemizedlist>
			<listitem>
			<para>MySQL</para>
			<itemizedlist>
			<listitem>
			<para>Rozmiar bazy danych:</para>
			<para>Jak mówi dokumentacja do MySQL'a (rozdzia³: Table size, paragraf "How Big Can
			MySQL Tables Be?"), MySQL wersja 3.22 by³ ograniczony do 4 GB na tabelkê.
			W wersji za¶ 3.23 zosta³o to podniesione do 8 milionów terabajtów (czyli
			2^63 bajtów). Jednak warto zauwa¿yæ ¿e ró¿ne systemy operacyjne maj±
			limity nak³adane przez systemy plików, najczê¶ciej jest to 2 lub 4 GB.</para>
			</listitem>
			<listitem>
			<para>Ilo¶æ rekordów:</para>
			<para>Prawdziwe informacje na temat limitów uzyskamy dopiero po wydaniu polecenia:
			(w interpreterze poleceñ mysql)</para>
			<screen>
mysql&gt; show table status;

...| Avg_row_length | Data_length | Max_data_length | Index_length |
...|             44 |       24136 |      4294967295 |        19456 |</screen>
			<para>Zauwa¿ymy ¿e miejsca wystarczy na oko³o 175 000 razy tyle ile mamy
			aktualnie wpisów w tabelce. (czyt.: mo¿esz spaæ spkojnie, chyba ¿e
			planujesz posiadanie ponad 100000 u¿ytkowników :-)</para>
			</listitem>
			</itemizedlist>
			</listitem>
			<listitem>
			<para>PostgreSQL</para>
			<itemizedlist>
			<listitem>
			<para>Rozmiar bazy danych:</para>
			<para>PostgreSQL zapisuje dane w porcjach po 8 kB. Liczba tych bloków jest
			ograniczona do 32-bitowej liczby ca³kowitej ze znakiem, daj±c maksymaln±
			wielko¶c tabeli wynosz±c± 16 terabajtów. Z uwagi na ograniczenia systemów
			operacyjnych dane przechowywane s± w wielu plikach o wielko¶ci 1 GB ka¿dy.</para>
			</listitem>
			<listitem>
			<para>Ilo¶æ rekordów:</para>
			<para>PostgreSQL nie narzuca ograniczenia na liczbê wierszy w dowolnej tabeli.
			Jednak funkcja COUNT zwraca 32-bitow± liczbê ca³kowit±, a zatem dla tabel
			zawieraj±cych ponad dwa miliardy wierszy wynik tej funkcji bêdzie
			nieprawid³owy. (Informacja dot. PostgreSQL 7.1)</para>
			</listitem>
			</itemizedlist>
			</listitem>
			</itemizedlist>
			</sect2>
	</sect1>
</chapter>
