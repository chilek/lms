<!-- $Id$ -->
<chapter id="user">
 <title>User Interface (LMS-UI)</title>
 <para>LMS User Interface is basically administration panel available via Web
 interface that can be used to create and manage customer and computers (nodes)
 data and containing numerous features such as: You're able to bind computer data to your customers and assign it to given
 network. You're also able to define users liabilities and manage your network
 finances. You can search in user and computer data quickly, send mass mailing
 to specific user groups, define access to this UI for selected users and with
 fine grained access rights. Additionally you can track your bandwidth usability
 statistics, create backups of your database online and configuration and
 management of your services. Those are only selected features of
 <emphasis>LMS-UI</emphasis>, so read on to find description of all features.
 </para>
  <sect1 id="user-login">
	<title>Login</title>
        <para>After you enter LMS installation URL in your Web browser, you'll
        be prompted with login screen, where you need to enter correct username
        and password. All passwords in database are stored in encrypted form.
        </para>
        <para>If it's your first session with LMS, and you don't have any
        account created yet, you'll be redirected to new user account screen.
        At this moment you have only access to this one module, so that you can
        create your initial account.</para>
  </sect1>
  <sect1 id="menu-administration">
	<title>Administration</title>
        <para>After successful login to the system you'll have administration
        menu presented on the left side, while content of selected module will be
        displayed on the right side. Initially, you can read some useful information
        about system here. In administration menu, you're able to manage other users
        accounts and create or restore database backups.</para>
        <para>You can select any module to work with on the left panel. There
        are also buttons allowing you to change your password, logout or do a quick
        search for customers/computers/helpdesk. You can search by name or id, but also
        additionally by computer name, surname, fragment of address, phone, email, IP or
        MAC. If there are more than one matching record for your search you'll get only
        first result.</para>
	<sect2 id="administration-info">
	    <title>Info</title>
            <para>This is where all basic information about system that is
            running LMS are displayed. It lists the following information:
            LMS core and components versions, copyright notice, uptime and
            kernel version of your server, customers and nodes totals, computer
            activity totals and financial balance. Additionally all LMS links
            are gathered here.</para>
	</sect2>
	<sect2 id="administration-users">
	    <title>Users</title>
	    <para>'Users' panel is designed for LMS users (ie. network
            administrators) management. You can create or modify any account here, change
            assigned passwords and access rights.</para>
	    <para>For more information on access rights, see <xref linkend="install-rights">.</para> 
	    <para>Initially after selecting 'Users', you'll get list of all
            users with last login time and host information. When you click on the account,
            you're able to see it's details, including defined access rights.
	    You can modify data any time by clicking 'Edit' link. To create new user 
	    use left panel and click 'New user'.</para>
	</sect2>
	<sect2 id="administration-newuser">
	<title>New user</title>
	    <para>In order to create new user, you need to provide at least
            login name and non empty password. Name and email fields are optional. 
	    Allowed hosts is a coma separated list of host or network IP addresses
	    in 'allow_from' configuration option style. If that list is empty,
	    hosts checking is skipped. Below you can mark specific system access 
	    rights. If you leave all those fields unchecked
            (default), user will be granted with 'full access'.</para>
	</sect2>
	<sect2 id="administration-db">
	    <title>Backups</title>
	    <para>You can manage your database backup copies here. Database copy
            is plain text file with SQL statements needed to reconstruct all tables and it's
            data, which is saved in directory defined with <prompt>backup_dir</prompt>
            variable in <emphasis>[directories]</emphasis>
            section of <filename>lms.ini</filename>.</para>
	    <para><note><para>By default your backups will be placed in
            <filename>lms/backups</filename> directory, which could be accessed with your
            browser, without any authentication, so it's wise to move it above your Web
            Server DocumentRoot.</para></note></para>
	    <para>All copies can be viewed, removed or downloaded to your
            computer at any time. By clicking on 'recover' icon your current database will
            be deleted and replaced by the one in backup copy. For your safety, before such
            operation current database backup is performed automatically.</para>
	</sect2>
 </sect1>
 <sect1 id="menu-customers">
	<title>Customers</title>
	<para>This is your customers control center, where you can store and
        manage their data, their finances and also their computers. You can even cut all
        customer computers off with single mouse click.
	<note><para>Automatic cutoff of computers which owners are in debt is
        performed by lms-cutoff Perl script.</para></note></para>
	<sect2 id="menu-customers-list">
	    <title>List</title>
	    <para>After you select 'List' you'll see list of your users, that
            can be filtered based on selected criteria (customer status, group or network) or
            sort by any highlighted column. Warning triangle on the right side of the record
            shows if any warnings are active for the customer. Computer icon next to triangle
            informs you about computers status (connected of cutoff). Clicking of any of 
            those two symbols toggles status for all computers of the given customer. </para>
            <para>Records of customers with negative balance will have 'payback' icon
            (stack of coins), which allows you to account instant payment for the customer,
            which value will reset his debt.</para>
	    <para>When you click on selected customer you'll get screen with details
            for the customer, divided in several panels: customer details, computer details,
            liabilities details and customer account details. You can also select to edit
            any of the panels on this screen, define customer liabilities, payoff or charge the
            customer.</para>
	</sect2>
	<sect2 id="menu-customers-new">
	    <title>New Customer</title>
	    <para>This option will let you enter data for new customer record.
            You can enter his last and first name here, or if your customer is
also legal company, enter company name in "Name" and company representative in
"Forename" field. You should also fill customers phone (up to 3) and address (you
can enter additional address for correspondence) and his status (connected,
waiting in queue, prospect).
	    <note><para>Wrong capitalization (uppercase) of customer's last name is
one of most frequent bug reports. Uppercase is implemented via SQL functions and
thus you should seek for solution in your DB engine configuration.</para></note>
	    </para>
	</sect2>
	<sect2 id="menu-customers-search">
	    <title>Search</title>
	    <para>You're able to search customers (including deleted customers), using
various criteria. This module is more powerful than appropriate quick search
box in left panel, as you can specify exact field names to search and if many
customers are found, the list of records will be returned, not only the first one.
</para>
	</sect2>
	<sect2 id="menu-customers-groups">
	    <title>Groups</title>
	    <para>This is a place where it's possible to divide your customers into
groups. After you click 'Groups' you'll see list of all defined groups with some
basic information. Clicking on selected group will give you details view, where
you are able to edit this group properties, and view/add/remove group members.
</para>
	</sect2>
	<sect2 id="menu-customers-newgropup">
	    <title>New Group</title>
	    <para>You can define new group here, providing its name is unique,
and it only contains letters, digits and underscore and minus signs. Groups are
being used in scripts configuration, and for this reason group names cannot
contain spaces.</para>
	</sect2>
	<sect2 id="menu-customers-warnings">
	    <title>Messages</title>
            <para>In this module, you're able to write administrative message which
            will appear on customers Web browser screen and assign it massively to all
            or majority of your customers (just pick them using selection box on the left).
            It's also possible here to deselect administrative messages massively here.
            </para>
	</sect2>
	<sect2 id="menu-customers-prints">
	    <title>Printing</title>
	    <para>Set of modules to provide printer-friendly version of your
            records:
	    <itemizedlist>
		<listitem>
		    <para><emphasis>Customer list</emphasis> with filter and sort abilities, </para>
		</listitem>
		<listitem>
		    <para><emphasis>Liability report</emphasis> for any range of customer(s), for specified date,</para>
		</listitem>
		<listitem>
		    <para><emphasis>Customer balance</emphasis> for selected period</para>
		</listitem>
	    </itemizedlist>
	    </para>
	</sect2>
 </sect1>
 <sect1 id="menu-nodes">
	<title>Nodes</title>
	<para>This panel is designed to manage your computer records, namely:
view computer list (with sorting), search, add new or delete existing computers
from database and editing capabilities.</para>
	<sect2 id="menu-nodes-list">
	    <title>List</title>
	    <para>List of computers will appear after you select 'List' link.
You can sort it by clicking on any highlighted column name. You have several icons on
each computer record: light bulb for connecting and cutting off selected
computer, warning triangle for warning screen toggle, eraser for computer
removal, pencil for editing details and file icon for viewing it. The last
module (computer/owner view) might be also accessed simply by clicking on
selected record.</para>
	</sect2>
	<sect2 id="menu-nodes-new">
	<title>New Node</title>
	    <para>You can add new computer here. First select good name for it
(it may contain letters, digits, underscore or minus sign), then it's owner. IP
and MAC addresses may be entered manually, or - by clicking arrow signs on the
right - you may select them from pool which is read from database and ARP daemon. After
you finish - click 'Save'. If you need to enter more computers it's
helpful to activate 'Display this form again' checkbox.
	    <note><para>To search computer addresses in your network you can use
nbtscan program. If it's available in system, you can click 'Scan' to get all
data about computers that are online.</para></note>
	    <note><para>You need to create customer and network first, so you can
assign new computer to it.</para></note></para>
	</sect2>
	<sect2 id="menu-nodes-search">
	    <title>Search</title>
	    <para>You can search for computers here by any given criteria. You
can enter whole IP, MAC or computer name, or just its fragment and search will
guess for you.</para>
	</sect2>
	<sect2 id="menu-nodes-warnings">
	    <title>Messages</title>
		<para>You can write administration message here and it will
appear on customer's Web browser screen. In this module you can select majority or
all computers and assign them common message. Just choose computers using
selectbox on the left (computers with message already on will be displayed in
red). If you only want to assign a message to customer, but don't want to turn it
on, just write a message and don't select any of 'Enable/Disable message' boxes.
</para>
	</sect2>	
	<sect2 id="menu-nodes-print">
	    <title>Printing</title>
		<para>You can get printer friendly list of your computers here.
It's possible to use same filter and sorting capabilities as on 'List'.</para>
	</sect2>
 </sect1>
 <sect1 id="menu-netdevices">
	<title>Net Devices</title>
	<para>In this panel you're able to keep all your network inventory and
define connections between your equipment and customer nodes. Each device
(switch, hub, router, server) might have also IP address(es) assigned.</para>
	    <sect2 id="menu-netdevices-list">
	    <title>List</title>
		<para>List of devices might include its names, symbols, physical
and logical location, description and number of available connection ports. You
might sort its output by any highlighted column. To see device details or define
all options and manage connected devices just click on selected record. It's
also possible to interchange two connections between devices on this
screen.</para>
	    </sect2>
	    <sect2 id="menu-netdevices-new">
	    <title>New device</title>
		<para>Network device should have unique name, all other
parameters (manufacturer, model, serial number, ports, location and description)
are optional.</para>
	    </sect2>
	    <sect2 id="menu-netdevices-map">
	    <title>Map</title>
		<para>Selection of 'Map' option draws graphical map of entire
		network. You can define root device, which will appear on top of the map and all
		other devices will be drawn relative to it.
		<note><para>You need GD or Ming library compiled in PHP 
		to be able to use graphical map.</para></note>
		Use <filename>'map_type'</filename> option in section <emphasis>[phpui]</emphasis> 
		section to specify type of map. Set it to "flash" if you've
		got Ming library or "gd" for graphic images. By default (option
		not set) LMS will try to generate flash map, and when this fails, 
		t will fallback to GD.
		</para>
		<para>Device status is shown on the map - computers in black are
offline. Question mark on device icon means that its status is unknown (device 
has not been scanned yet). To use this functionality you need to setup scanning
script in crontab. Computer is marked as online if computer was online on last
successful scan and period since last scan is lesser than defined in
configuration (Default: 600 seconds). This parameter can be set with
<filename>lastonline_limit</filename> in [phpui] section of configuration file.
Above feature applies both to computers and devices, but in case of devices all
its ports (IPs) must be up for device to appear online. Computers status is also
available on nodes list in 'Nodes' panel. 
		<note><para>You can use lms-fping Perl script or lmsd daemon to
probe hosts availability.</para></note>
		</para>
	    </sect2>
 </sect1>
 <sect1 id="menu-networks">
	<title>IP Networks</title>
	<para>You can define all your networks here. Network is IP address class
with parameters such as domain, DNSes, default gateway and DHCP pool. If you use
LMS to manage numerous networks or you use numerous address classes, it's
possible to define them here.</para>
	<sect2 id="menu-networks-list">
	    <title>List</title>
	    <para>Among basic data about network, each record contains
information about address space conservation - you can see summary of assigned
and free addresses. You're able to modify network properties after you click on
selected network or by clicking 'Edit' icon.</para>
	    <para>During edit you are able to browse list of nodes connected to
this network, node name will appear instead of IP number if that number is
occupied. If you click on free IP address, without any computer assigned to it,
new computer form will appear. There are also other features available for your
convenience: <emphasis>Put in order</emphasis> will readdress computers so that
there's no gap in the list and <emphasis>Reassign the network</emphasis> to move
all nodes from one network to another.</para>
	</sect2>
	<sect2 id="menu-networks-new">
	    <title>New Network</title>
	    <para>Defines a new network. Network needs to have unique name and
address class, defined by its IP address and netmask. All other data is
optional.</para>
	</sect2>
 </sect1>
 <sect1 id="menu-finances">
	<title>Finances</title>
	<para>This is actually the whole collection of modules, that gives you
possibility to efficiently manage finances of your network. You can define
periodical liabilities here (subscriptions), solid liabilities (orders),
perform accounting operations, check each account history and draw invoices
and balance sheets.</para>
	<sect2 id="menu-tariffs-list">
	    <title>Tariffs List</title>
	    <para>When you enter 'Tariffs List' panel you'll be able to see list of
liabilities (Tariffs) that might be assigned to your customers, with basic
informations about it. When you select and click on liability you'll move to
'Tariff' module where you're able to edit its parameters and exchange customers
between available liabilities. In 'Number of customers'  field you can read
number of customers who are assigned to it and two numbers in parenthesis: total
number of assignments and number of active assignments, considered by its
activity periods.</para>
	</sect2>
	<sect2 id="menu-tariffs-new">
	    <title>New Tariff</title>
	    <para>When defining new tariff you need to enter unique name, amount
	    and tax rate.</para>
	</sect2>
	<sect2 id="menu-payments-list">
	    <title>Payments list</title>
    	    <para>This is a list of your company payments. Among standard fields
	    you'll find 'Account this payment' icon,
	    where you're able to charge your account. Periodical charges
	    might be done with 'lms-payments' Perl script, or appropriate module of lmsd
	    daemon. Select and click on chosen payment to view 'Payment Info' module, where
	    you're able to edit its parameters or account given payment to financial
	    database.</para>
	</sect2>
	<sect2 id="menu-payments-new">
	    <title>New payment</title>
	    <para>You have to assign unique name, amount and pay date for each
	    new payment you setup.</para>
	</sect2>
	<sect2 id="menu-balance">
	    <title>Balance sheet</title>
	    <para>This is history of your financial operations with total
incomes, expenditures, payments and customers liabilities. Printer icon allows
you to print invoice for corresponding record.</para>
	</sect2>
	<sect2 id="menu-newbalance">
	    <title>New Balance</title>
	    <para>You can add new financial operation with this module. It's
possible to account the same operation for multiple customers at the same
time.</para>
	    <para><note><para>It's best to use lms-payments Perl script or
<emphasis>lmsd</emphasis> daemon to automate periodical operations, such as
subscription fees. Those modules are also able to write out appropriate
invoices.</para></note></para>
	</sect2>
	<sect2 id="menu-invoices-list">
	    <title>Invoices list</title>
	    <para>List of invoices that has been already written out. You're
able to print (by selecting 'Print' icon) and account ('Account' icon) selected
invoices.</para>
	</sect2>
	<sect2 id="menu-invoices-new">
	    <title>New Invoice</title>
		<para>Allows you to issue an invoice for selected customer manually.</para>
	</sect2>
	<sect2 id="menu-receipts-list">
	    <title>Cash Receipts List</title>
		<para>Cash receipt it's a proof of customer payment in cash.
		Receipts list can be sorted in any order and filtered like the
		invoices list. You've got also print selected receipts.</para>
		<para>From list you can go to receipt edition. Making changes in
		created documents needs special care, because submitting changes
		will delete old receipt and linked operations and insert 
		new ones.</para>
	</sect2>
	<sect2 id="menu-receipts-new">
	    <title>New Receipt</title>
		<para>To create new proof of payment in first place you must to
		select customer from list, set date and number (better to leave
		values proposed by system) Then click 'Submit' to affirm choice.
		After that you can add any number of positions with value and
		description or select them from list of unpaid customer covenants
		placed at bottom. 'Save and Print' will finish and save receipt
		and payments in system and display receipt's printout in new window.</para>
	</sect2>
	<sect2 id="menu-import">
	    <title>Import</title>
		<para>If you use homebanking, and you're able to get a list of
		financial operations (ie. from bank www or email that they send
		you), Import module can be used to (semi)automatically load it
		into LMS accounting database and assign to respective customers.
		You should write (or use, if it's already in distribution) a
		parser script, which loads data to the cashimport table. Please,
		check example script lms-cashimport-ingbs to see how this is
		being done. After you run it, you should get a list of pending
		financial operations, in Import module, where you can correct
		them and accept into LMS accounting database.</para>
		<para>You can also load previously prepared text file using this
		module. It will be read line by line and parsed using setup
		regular expressions to get needed data types (ie. customer id,
		amount, etc). After file is loaded, you will be presented with
		the same corrections/acceptance screen as above.</para>
		<para>To setup regular expressions, which suit to your input
		files you should create PHP script which location you must set in
		<filename>import_config</filename> option in <emphasis>[phpui]</emphasis>
		section. Example values and parameters descriptions are placed in
		<filename>modules/cashimportcfg.php</filename>.
		Default configuration assumes that input data will be in 
		the following format (tab separated):
<screen>
23.02.2004	Machniak Aleksander	123,45	Internet subscription - 04/2004 ID:0013
15.02.2004	Pain Joseph	123,45	Invoice paid - LMS/34/2004
</screen>
		</para>
	</sect2>
	<sect2 id="menu-finances-print">
	    <title>Printing</title>
	    <para>There are several options for balance sheet printouts:
	    <itemizedlist>
		<listitem>
		    <para><emphasis>Balance sheet for your network</emphasis>
including financial operations for given period, signed by selected LMS
user.</para>
		</listitem>
		<listitem>
		    <para><emphasis>Total invoiceless income</emphasis> for
given period.</para>
		</listitem>
		<listitem>
		    <para><emphasis>Liability report</emphasis> for given day,
for all or selected user.</para>
		</listitem>
		<listitem>
		    <para><emphasis>Sale Registry</emphasis>, which consists of
invoices for given period.</para>
		</listitem>
		<listitem>
		    <para><emphasis>Customer balance sheet</emphasis> for given
period.</para>
		</listitem>
	    </itemizedlist>
	    </para>
	</sect2>
 </sect1>
 <sect1 id="menu-accounts">
	<title>Accounts</title>
	<para>It's now possible to manage accounts from your services using LMS.
This functionality is provided for advanced system administrators, because it
requires in-depth knowledge of services running on server in order to configure
them to use LMS database.</para>
	<para>You can create four types of accounts now: shell (1), email (2),
www (4) and ftp (8). Decimal values for internal representation of those accounts
are given in parenthesis. This approach enables to provide multi-type accounts,
eg. if you define shell+email+ftp account it will be given number 11 in
database. This means that for recognition of account type you should use binary
sums in WHERE clauses of your SQL queries (few examples are written
below).</para>
	<para>You have also possibility to define domains and aliases.</para>
	<sect2 id="accounts-accounts">
	    <title>Accounts</title>
	    <para>Account list contains basic information about your customer
accounts. It's possible to sort it by any highlighted column title and to filter
it for given criteria. You can edit any account clicking 'Edit' icon.
Administrator (LMS user) is also able to change account passwords.</para>
	</sect2>
	<sect2 id="accounts-new">
	    <title>New Account</title>
	    <para>To create new account you have to provide its login, password,
	    choose at least one account type and assign customer to it. Domain name is
	    optional and you'll need it only if you want to support email accounts.
	    Expiration date is also optional, leave it empty to make new account valid
	    forever.</para>
	    <para>You can define any home directory for account. Option
	    <filename>homedir_prefix</filename> from section <emphasis>[phpui]</emphasis>
	    consists default prefix "/home/".</para>
	</sect2>
	<sect2 id="accounts-aliases">
	    <title>Aliases</title>
	    <para>Every account (email type mainly) might have any number of
aliases that is needed. Mail server administrator might redirect mail locally
from all those aliases to one physical existing account. Basic information about
alias and accompanying account is provided on the list. It's possible to sort
this list by any highlighted column name and to filter list for given criteria.
It's not possible to edit an alias - if it's not desirable anymore you have to
erase (remove) it and create new if needed. Add new aliases at the bottom of the
list.</para>
	</sect2>
	<sect2 id="accounts-domains">
	    <title>Domains</title>
	    <para>You're able to see basic informations about domains on the
list. It's possible to sort
this list by any highlighted column name and to filter list for given criteria.
You can edit domain data by clicking 'Edit' icon. Add new domain at the bottom
of the list.</para>
	</sect2>
	<sect2 id="accounts-examples">
	    <title>Examples</title>
	    <para>The following section contains fragments of proftpd daemon
configuration (version 1.2.10) relevant to process of authentication with using
data available in LMS database. This example contains Postgres configuration and
optional MySQL configuration in comments, followed by pound (hash) sign.
	    <example id="accounts-e1">
		<title>Accounts. Proftpd configuration.</title>
<screen>
  ServerName	"LMS FTP Server"
  
  #dbname@host:port dbuser dbpass
  SQLConnectInfo lms@localhost:5432 lms mypassword
  
  SQLAuthTypes Crypt Plaintext
  SQLUserInfo passwd login password uid NULL home NULL
  RequireValidShell off
  SQLAuthenticate users
  
  # create user home directory if it doesn't exists yet
  SQLHomedirOnDemand on
  
  # login message
  SQLShowInfo PASS "230" "Last login: %{getlastlogin}"
  SQLLog PASS setlastlogin
  
  # SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE FROM_UNIXTIME(lastlogin) END FROM passwd WHERE login='%u'"
  # SQLNamedQuery setlastlogin UPDATE "lastlogin=UNIX_TIMESTAMP() WHERE login='%u'" passwd 
  SQLNamedQuery getlastlogin SELECT "CASE lastlogin WHEN 0 THEN '' ELSE lastlogin::abstime::timestamp::text END FROM passwd WHERE login='%u'"
  SQLNamedQuery setlastlogin UPDATE "lastlogin=EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)) WHERE login='%u'" passwd
  
  # We limit access to valid (not expired) accounts with ftp type
  # SQLUserWhereClause "type & 8 = 8 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())"
  SQLUserWhereClause "type & 8 = 8 AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))"
</screen>
	    </example></para>
	    <para>Next example will show us how to configure Postfix 2.1.1 mail
server with Cyrus-SASL 2.1.19 and Courier-IMAP/POP3 3.0.4, so that they use LMS
database. LMS accounts will be virtual, which means that they will be all
maintained by one uid on server with mail stored in Maildir format.</para>
	    <para>You'll need to patch your SASL for encrypted passwords,
because LMS database contains them only in this form. In comments we have
provided MySQL specific options. Only fragments relevant to database setup are
shown below:
	    <example id="accounts-e2">
		<title>Accounts. Mail server configuration (postfix+sasl+courier).</title>
<screen>
# smtpd.conf file (Cyrus-SASL):

pwcheck_method: auxprop
#sql_engine: mysql
sql_engine: pgsql
sql_user: lms
sql_passwd: dbpass
sql_hostnames: localhost
sql_database: lms
#sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
#       AND login='%u' AND domains.name ='%r' AND type & 2 = 2 
#	AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
sql_select: SELECT password FROM passwd, domains WHERE domainid = domains.id
	AND login='%u' AND domains.name ='%r' AND type & 2 = 2 
	AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))
password_format: crypt
mech_list: login plain

# authpgsqlrc (or authmysqlrc) (Courier):

# user postfix (owner of mail directory)
#MYSQL_UID_FIELD '1004'
PGSQL_UID_FIELD '1004'
# group postfix (owner of mail directory)
#MYSQL_GID_FIELD '1004'
PGSQL_GID_FIELD '1004'
#MYSQL_PORT		3306
PGSQL_PORT		5432
#MYSQL_USERNAME		lms
PGSQL_USERNAME		lms
#MYSQL_PASSWORD		dbpass
PGSQL_PASSWORD		dbpass
#MYSQL_DATABASE		lms
PGSQL_DATABASE		lms
#MYSQL_SELECT_CLAUSE SELECT login, \
#       password, '', 104, 104, '/var/spool/mail/virtual', \
#       CONCAT(login,'/'), '', login, '' \
#       FROM passwd, domains WHERE domainid = domains.id \
#       AND login = '$(local_part)' AND domains.name = '$(domain)' \
#       AND type & 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
PGSQL_SELECT_CLAUSE SELECT login, \
        password, '', 104, 104, '/var/spool/mail/virtual', \
        login ||'/', '', login, '' \
        FROM passwd, domains WHERE domainid = domains.id 
        AND login = '$(local_part)' AND domains.name = '$(domain)' \
        AND type & 2 = 2 \
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# main.cf (Postfix):

virtual_mailbox_base = /var/spool/mail/virtual
virtual_mailbox_domains = pgsql:/etc/postfix/pgsql_virtual_domains_maps.cf
virtual_mailbox_maps = pgsql:/etc/postfix/pgsql_virtual_mailbox_maps.cf
virtual_alias_maps = pgsql:/etc/postfix/pgsql_virtual_alias_maps.cf

# pgsql_virtual_domains_maps.cf (Postfix):

user = lms
password = dbpass
hosts = localhost
dbname = lms
#MySQL plugin doesn't support query option, thus we build query differently
#select_field = name
#table = domains
#where_field = name
query = SELECT name FROM domains WHERE name = '%s'

# pgsql_virtual_mailbox_maps.cf (Postfix):

user = lms
password = dbpass
hosts = localhost
dbname = lms
#table = passwd, domains
#select_field = CONCAT(login,'/')
#where_field = CONCAT(login,'@',domains.name)
additional_conditions = AND domainid = domains.id 
#       AND type & 2 = 2 AND (expdate = 0 OR expdate &gt; UNIX_TIMESTAMP())
query = SELECT login || '/' FROM passwd, domains WHERE domainid = domains.id
        AND login = '%u' AND domains.name = '%d' 
        AND type & 2 = 2 
        AND (expdate = 0 OR expdate &gt; EXTRACT(EPOCH FROM CURRENT_TIMESTAMP(0)))

# pgsql_virtual_alias_maps.cf (Postfix):

user = lms
password = dbpass
hosts = localhost
dbname = lms
#table = passwd, domains, aliases
#select_field = CONCAT(passwd.login,'@',domains.name)
#where_field = CONCAT(aliases.login,'@',domains.name)
#additional_conditions = AND  passwd.domainid = domains.id AND passwd.id = aliases.accountid
query = SELECT passwd.login || '@' || domains.name FROM passwd, domains, aliases 
        WHERE passwd.domainid = domains.id AND passwd.id = aliases.accountid
        AND aliases.login = '%u' AND domains.name = '%d' 
</screen>
	    </example></para>
	</sect2>
 </sect1>
 <sect1 id="menu-mailing">
	<title>Mailing</title>
	<para>Mailing is component where you can spam groups of your customers
	if you have to communicate something to them. Obviously you need to specify
	sender name and address, write your message in text box and select appropriate
	group of recipients. Your attendance can be grouped by status, network or customer
	groups. If you use mail server on remote host, you will need to set options
	smtp_host, smtp_port, smtp_username, smtp_password in [phpui] section.</para>
	<para>In message body you can use variables, which will be replaced by
	customer data:
	<simplelist>
	    <member><prompt>%customer</prompt> - name/lastname and forename</member>
	    <member><prompt>%balance</prompt> - balance value (with sign)</member>
	    <member><prompt>%cid</prompt> - customer ID</member>
	    <member><prompt>%pin</prompt> - customer PIN</member>
	    <member><prompt>%last_10_in_a_table</prompt> - last 10 operations on customer account</member>
	</simplelist>
	</para>
	<para><note><para>Your server has to support PEAR::Mail for this to
work.</para></note>
	<note><para>It's best to use lms-notify Perl script or notify
module of <emphasis>lmsd</emphasis> daemon to send emails
automatically whenever customer is in debt.</para></note></para>
 </sect1>
 <sect1 id="menu-reload">
	<title>Reload</title>
	<para>Click on 'Reload' and reload request or command should execute.
What services and how they're updated is configured in
<emphasis>LMS-MGC</emphasis> or <emphasis>lmsd</emphasis> daemon. You'll find
needed information about configuration in appropriate chapters of this
documentation.</para>
 </sect1>
 <sect1 id="menu-stats">
	<title>Stats</title>
	<para>This is interface to view bandwidth consumption per host
statistics enclosed in bar graphs. Statistics contains data about sent and
received bytes for given interface for each node. Using drop down menu you can
quickly generate statistics for given time periods: last hour, day, 30 days or
year.
	    <note><para>You need working lms-traffic Perl script or
<emphasis>lmsd</emphasis> daemon running to collect statistics.</para></note>
	</para>
	<sect2 id="menu-stats-filter">
	<title>Filter</title>
	    <para>Before you can see graphs you can define parameters to limit
period or network (if you have many), top number of computers considered and
sort output as you like (ie. by top download).</para>
	</sect2>
	<sect2 id="menu-stats-compact">
	<title>Compacting</title>
	    <para>Depending on chosen update frequency amount of database data
used for statistics might grow fast, which will lead to extension of time needed
to generate statistics. For that reason in 'Compacting' menu you're able to
shrink your database size without data loss. This module will compact data using
following logic:
		<itemizedlist>
		    <listitem><para><emphasis>Low precision</emphasis>: data
from previous date and older will be approximated to one day. If you save data
each 10 minutes 6*24 records will be compacted to one.</para></listitem>
		    <listitem><para><emphasis>Medium precision</emphasis>: data
older than month will be approximated to one day.</para></listitem>
		    <listitem><para><emphasis>High precision</emphasis>: data
older than month will be approximated to one hour.</para></listitem>
		</itemizedlist>
	    <warning><para>Data approximation is irreversible.</para></warning>
	    </para>
	</sect2>
 </sect1>
  <sect1 id="menu-helpdesk">
	<title>Helpdesk</title>
	    <para>Helpdesk (or Request Tracker) is customer request management
system. It's possible to keep history of all requests and questions here, both reported by
customers and users not registered in LMS database. Reports can be grouped in
queues (categories) and you're able to search them for a given criteria. It's possible to
define access rights for LMS users to each queue.</para>
	    <para>You have quick search box in left (menu) panel, which may be
used to jump to appropriate ticket giving ticket id or reporter name. Searching
by reporter name will give a list of all tickets available for this user.</para>
	    <para>Each ticket includes history built on messages sent by
administrators (LMS users) and customers. Administrator may send his message to
customer specifying recipient name and clicking 'Submit/Send', email will be
sent with queue address as sender, or - if it's empty - LMS user address. All
messages, including those sent, are recorder in ticket history. Each ticket may
be in one of the states: new, opened, resolved or dead.</para>
	    <para>Please look at <xref linkend="lms-rtparser"> script which has been developed to
support incoming requests and outgoing comments by your mail server.</para>
	<sect2 id="menu-helpdesk-list">
	<title>Queues List</title>
	    <para>Basic informations and request statistics are available on
queues list. Select and click on chosen queue to display all tickets belonging
to it. You can also go to detailed view (including permissions) about queue or
remove given queue. Removing queue will also remove all belonging tickets from
database.</para>
	</sect2>
	<sect2 id="menu-helpdesk-newqueue">
	<title>New queue</title>
	    <para>Queue (category) contains a name, optional description and
optional email address, used in correspondence. 'Permissions' table defines LMS
users access to this queue, which overrides those set in 'Administration', which
means, that the user who has 'full access' permissions won't be able to see
queue and tickets placed in it until he's given access to that queue.
Enabling 'write' (tickets and comments edit ability) to user automatically gives
him 'read' access. 'Notices' privilege is used to notify users about new tickets.
If 'newticket_notify' option is enabled all users with this privilege will get 
notifications by email.</para>
	</sect2>
	<sect2 id="menu-helpdesk-search">
	<title>Searching</title>
	    <para>Tickets are searchable by all given criteria (AND not OR). You
can provide subject, owner, queue, status and reporter for your search.
Customers may be selected from drop-down list, unregistered users may be
searched by name or email address.</para>
	</sect2>
	<sect2 id="menu-helpdesk-newticket">
	<title>New ticket</title>
	    <para>For each new ticket you need to provide subject, content,
queue and reporter. Unregistered users (not in customers database) should be
recorded using 'Submitter' fields. You can provide email address (in both
registered/unregistered cases) if ticket will be running via email.</para>
	</sect2>
 </sect1>
    <sect1 id="menu-configuration">
	<title>Configuration</title>
	    <sect2 id="config-ui">
	    <title>User Interface</title>
	        <para>Since LMS 1.5.3 you're able to configure all UI-related
    	        options directly via <emphasis>LMS-UI</emphasis>, instead of editing
        	<filename>lms.ini</filename>. Those options are stored in database and you first
                need to import them from your config file (even if you haven't edited anything
	        yet, default values will be imported). This can be done by clicking
    	        on the link presented on empty list.</para>
		<para><note><para>Options setup with <emphasis>LMS-UI</emphasis>
                have higher priority than those in configuration file. With options setup in UI,
	        the configuration will be still imported from file but values will be then
    	        overwritten by those found in DB.</para></note></para>
		<para><note><para>Daemon read some options other than its configuration from
    		database only, so it's prefered to store configuration in database.</para></note></para>
    		<para>In order to manually add new option click 'Add option' on the
	        bottom of the list. To edit option value, click on its record. You'll be given
    		with edit form, where you are also able to remove this option. Changing option
    		status allows you to turn it on and off instantly. When an option is off,
    	        default value will be used (if it posses any).</para>
	</sect2>
	<sect2 id="config-taxes">
	    <title>Tax Rates</title>
		<para>Before you have to begin with financial system you will need
		to define tax rates which you will use. On the list are place all 
		rates data. It's possible to edit tax rate, but system will not
		allow to change value of rate that was used in the past. Also isn't
		possible to delete that rate.</para>
		<para>Link 'Add tax rate' moves you to the form, where you can define 
		a new rate. Tax rate label is displayed on select lists and invoice
		printout. Value of tax rate is a number from 0 to 100 with two 
		decimal places precision. Taxing status is used for tax-free rate, that 
		means the rest of defined tax rates shold have taxing enabled.</para>
		<para>Tax rate which will be selected by default on lists is defined
		by <filename>default_taxrate</filename> option in section 
		<emphasis>[phpui]</emphasis>.</para>
	</sect2>
	<sect2 id="config-numberplans">
	    <title>Numbering Plans</title>
		<para></para>
	</sect2>
    </sect1>
</chapter>
