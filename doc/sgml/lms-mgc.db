<chapter>
 <title>LMS-MGC</title>
  <!--
   Na podstawie CVS; $Id$
  -->
  <para>LMS-MGC to "magiczny" generator plików konfiguracyjnych. Przy odrobinie wysi³ku mo¿emy stworzyæ przy jego pomocy dowolnego rodzaju plik konfiguracyjny (np. generuj±cy odpowiednie strefy dla DNS)</para>
  <para>Konfiguracjê dla LMS-MGC mo¿emy ustaliæ w pliku <filename>lms-mgc.ini</filename>, kótry jest podzielony na kilka sekcji. Podstawowe opcje mo¿emy ustawiæ w sekcji <emphasis>[database]</emphasis>:</para>
   <itemizedlist>
    <listitem>
     <para>type</para>
     <para>Typ bazy danych. Aktualnie w 100% supportowany jest 'mysql', ale jak narazie nie widaæ wiêkszych problemów z 'postgres'. Domy¶lnie: mysql</para>
     <example><title>Przyk³ad:</title><para>type = mysql</para></example>
    </listitem>
    <listitem>
     <para>host</para>
     <para>Host gdzie zainstalowana jest baza danych. Najczê¶ciej, localhost, ale mo¿na tutaj wstawiæ cokolwiek (ipek, domena, path to socketa w formacie 'localhost:/path/to/socket'). Domy¶lnie: localhost</para>
     <example><title>Przyk³ad:</title><para>host = localhost</para></example>
    </listitem>
    <listitem>
     <para>user</para>
     <para>U¿ytkownik do bazy danych. W wielu wypadkach (je¿eli postêpowa³e¶ zgodnie ze wskazówkami w doc/INSTALL) bêdzie to 'lms'. Je¿eli chcesz u¿ywaæ konta uprzywilejowanego, prawdopodobnie wpiszesz 'root' (MySQL na wiêkszo¶ci *nixów), 'mysql' (na PLD) b±d¼ 'postgres' (PostgreSQL). Domy¶lnie: root</para>
     <example><title>Przyk³ad:</title><para>user = mysql</para></example>
    </listitem>
    <listitem>
     <para>password</para>
     <para>Has³o do bazy danych. Domy¶lnie puste.</para>
     <example><title>Przyk³ad:</title><para>password = tajne_haslo</para></example>
    </listitem>
    <listitem>
     <para>database</para>
     <para>Nazwa bazy danych, domy¶lnie lms.</para>
     <example><title>Przyk³ad:</title><para>database = lms</para></example>
    </listitem>
   </itemizedlist>
  <para>W³a¶ciwa konfiguracja dotycz±ca generatorów poszczególnych plików konfiguracyjnych jest umieszczana w sekcji <emphasis>mgc</emphasis> i pochodnych. W samej sekcji <emphasis>mgc</emphasis> mo¿emy u¿yæ nastêpuj±cego parametru:
   <itemizedlist>
    <listitem>
     <para>instances</para>
     <para>Lista "instancji" oddzielona spacjami.</para>
     <example><title>Przyk³ad:</title><para>instaces = dhcp firewall squid</para></example>
    </listitem>
   </itemizedlist>
  <para>Teraz, ka¿da instancja ma swoj± nazwê i jej konfigruacjê tworzy siê umieszczaj±c sekcjê o nazwie <emphasis>[mgc:nazwa]</emphasis>, czyli przyk³adowo: <emphasis>[mgc:mydaemon]</emphasis></para>
  <para>W samych instancjach mo¿emy u¿ywaæ nastêpuj±cych opcji konfiguracyjnych:</para>
   <itemizedlist>
    <listitem>
     <para>outfile</para>
     <para>Definiuje plik do którego ma byæ zapisany wynik dzia³ania bierz±cej instancji (je¿eli ta zmienna zmienna bêdzie nie ustawiona, instancja siê zakoñczy)</para>
     <example><title>Przyk³ad:</title><para>outfile = /etc/somefile</para></example>
    </listitem>
    <listitem>
     <para>append</para>
     <para>Pozwala ustawiæ aby wynik dzia³ania instancji nie nadpisywa³ pliku wynikowego, lecz zosta³ dopisany na jego koñcu</para>
     <example><title>Przyk³ad:</title><para>append = 1</para></example>
    </listitem>
    <listitem>
     <para>outfile_perm</para>
     <para>Pozwala na ustawienie praw dostêpu do pliku wyj¶ciowego (domy¶lnie 600)</para>
     <example><title>Przyk³ad:</title><para>outfile_perm = 700</para></example>
    </listitem>
    <listitem>
     <para>outfile_owner</para>
     <para>Pozwala na ustawienie w³a¶ciciela pliku wyj¶ciowego (domy¶lnie 0)</para>
     <example><title>Przyk³ad:</title><para>outfile_owner = 0</para></example>
     <warning>W³a¶ciciel musi byæ podany numerycznie!</warning>
    </listitem>
    <listitem>
     <para>outfile_group</para>
     <para>Pozwala na ustawienie grupy pliku wyj¶ciowego (domy¶lnie 0)</para>
     <example><title>Przyk³ad:</title><para>outfile_group = 0</para></example>
     <warning>Grupa musi byæ podana numerycznie!</warning>
    </listitem>
    <listitem>
     <para>header_file</para>
     <para>Pozwala na umieszczenie w pliku wynikowym zawaro¶ci innego pliku jako nag³ówek (domy¶lnie nie ustawione)</para>
     <example><title>Przyk³ad:</title><para>header_file	= /etc/lms/myservice_header</para></example>
    </listitem>
    <listitem>
     <para>header</para>
     <para>Pozwala na umieszczenie w pliku wynikowym zawarto¶ci zmiennej jako nag³ówka (domy¶lnie puste)</para>
     <example><title>Przyk³ad:</title><para>header = option1 = bla\noption2 = blabla</para></example>
     <note>Znak \n zosta³ tu u¿yty jako seperator linii. Koñcowe \n nie jest wymagane.</note>
    </listitem>
    <listitem>
     <para>networks</para>
     <para>Pozwala ustaliæ które z naszych sieci bêd± uwzglêdniane w pliku konfiguracyjnym (domy¶lnie wszystkie)</para>
     <example><title>Przyk³ad:</title><para>networks = cust1-publ cust2-publ cust3-priv</para></example>
    </listitem>
   <note>Teraz mgc pobiera kolejne sieci i wykonuje w kó³ko nastêpuj±ce czynno¶ci:</note>
    <listitem>
     <para>network_header</para>
     <para>Generuje nag³ówek dla ka¿dej sieci (domy¶lnie puste):</para>
     <example><title>Przyk³ad:</title><para>network_header = network %ADDR/%MASK { # Config section for %NAME</para></example>
    </listitem>
    <listitem>
     <para>dst_networks</para>
     <para>Pozwala ustawiæ sieci docelowe, czyli takie dla których bêdzie przetwarzany parametr: dst_network_header (domy¶lnie wszystkie):</para>
     <example><title>Przyk³ad:</title><para>dst_networks = main coalloc</para></example>
    </listitem>
    <listitem>
     <para>dst_network_header</para>
     <para>Pozwala ustawiæ nag³ówek dla sieci docelowych</para>
     <example><title>Przyk³ad:</title><para>dst_network_header = \tallow to %DADDR/%DMASK;</para></example>
    </listitem>
    <listitem>
     <para>network_body</para>
     <para>Parametr jest przetwarzany po wys³aniu nag³ówków dla sieci, a przed rozpoczêciem analizy adresów IP</para>
     <example><title>Przyk³ad:</title><para>network_body = \tnodes {</para></example>
    </listitem>
   <note>Teraz MGC rozpocznie przetwarzanie kolejnych adresów IP. Robi to w dosyæ specyficzny sposób. Tj. oblicza kolejny adres IP, i kolejno sprawdza:</note>
    <listitem>
     <para>allnodes</para>
     <para>Pozwala na ustawienie regu³ki przetwarzanej dla ka¿dego kolejnego adresu IP.</para>
     <example><title>Przyk³ad:</title><para>allnodes = ??</para></example>
    </listitem>
    <listitem>
     <para>allexistnodes</para>
     <para>Pozwala na ustawienie regu³ki przetwarzanej dla ka¿dego kolejnego adresu IP który jest u¿ywany.</para>
     <example><title>Przyk³ad:</title><para>allexistnodes = ??</para></example>
    </listitem>
    <listitem>
     <para>ignore</para>
     <para>Pozwala na ustawienie listy adresów w postaci adres/prefix lub adres/maska oddzielanej spacjami dla której ma byæ ignorowane generowanie</para>
     <example><title>Przyk³ad:</title><para>ignore = ??</para></example>
    </listitem>
    <listitem>
     <para>grantednode_publ</para>
     <para>Jest przetwarzana gdy dany adres komputer z danym adresem IP istnieje, ale w lms-ui ma status "pod³±czony" (regu³ka przetwarzana dla adresów publicznych)</para>
     <example><title>Przyk³ad:</title><para>grantednode_publ = \t\tnode %NAME (%IP/%MAC) unique %ID;</para></example>
    </listitem>
    <listitem>
     <para>grantednode_prv</para>
     <para>Jest przetwarzana gdy dany adres komputer z danym adresem IP istnieje, ale w lms-ui ma status "pod³±czony" (regu³ka przetwarzana dla adresów prywatnych)</para>
     <example><title>Przyk³ad:</title><para>grantednode_prv = \t\tnode %NAME (%IP/%MAC) unique %ID;</para></example>
    </listitem>
    <listitem>
     <para>deniednode_publ</para>
     <para>Jest przetwarzana gdy dany adres komputer z danym adresem IP istnieje, ale w lms-ui ma status "od³±czony" (regu³ka przetwarzana dla adresów publicznych)</para>
     <example><title>Przyk³ad:</title><para>deniednode_publ = node %NAME (%IP/%MAC) unique %ID deny;</para></example>
    </listitem>
    <listitem>
     <para>deniednode_prv</para>
     <para>Jest przetwarzana gdy dany adres komputer z danym adresem IP istnieje, ale w lms-ui ma status "od³±czony" (regu³ka przetwarzana dla adresów prywatnych)</para>
     <example><title>Przyk³ad:</title><para>deniednode_prv = node %NAME (%IP/%MAC) unique %ID deny;</para></example>
    </listitem>
    <listitem>
     <para>dhcpnode_publ</para>
     <para>Jest przetwarzana gdy dany adres IP zawiera siê w klasie DHCP (regu³ka przetwarzana dla adresów publicznych)</para>
     <example><title>Przyk³ad:</title><para>dhcpnode_publ = node unknown (%IP) reject;</para></example>
    </listitem>
    <listitem>
     <para>dhcpnode_prv</para>
     <para>Jest przetwarzana gdy dany adres IP zawiera siê w klasie DHCP (regu³ka przetwarzana dla adresów prywatnych)</para>
     <example><title>Przyk³ad:</title><para>dhcpnode_prv = node unknown (%IP) reject;</para></example>
    </listitem>
    <listitem>
     <para>freeip_publ</para>
     <para>Jest przetwarzana gdy dany adres IP nie jest przypisany do ¿adnego komputera (regu³ka przetwarzana dla adresów publicznych)</para>
     <example><title>Przyk³ad:</title><para>freeip_publ	= node unknown (%IP) lock_as_unused;</para></example>
    </listitem>
    <listitem>
     <para>freeip_prv</para>
     <para>Jest przetwarzana gdy dany adres IP nie jest przypisany do ¿adnego komputera (regu³ka przetwarzana dla adresów prywatnych)</para>
     <example><title>Przyk³ad:</title><para>freeip_prv	= node unknown (%IP) lock_as_unused;</para></example>
    </listitem>
    <listitem>
     <para>default_publ</para>
     <para>Regu³ka domy¶lna. Jest przetwarzana gdy adres nie zostanie przetworzony przez ¿adn± regu³kê grantednode lub deniednode (regu³ka przetwarzana dla adresów publicznych)</para>
     <example><title>Przyk³ad:</title><para>default_publ = node unknown (%IP) lock_as_intruder;</para></example>
    </listitem>
    <listitem>
     <para>default_prv</para>
     <para>Regu³ka domy¶lna. Jest przetwarzana gdy adres nie zostanie przetworzony przez ¿adn± regu³kê grantednode lub deniednode (regu³ka przetwarzana dla adresów prywatnych)</para>
     <example><title>Przyk³ad:</title><para>default_publ = node unknown (%IP) lock_as_intruder;</para></example>
    </listitem>
   <note>lms-mgc sam rozpoznaje który adres nale¿y do klasy publicznej, a który do prywatnej.</note>
    <listitem>
     <para>network_footer</para>
     <para>Pozwala na ustawienie stopki dla w³a¶nie przetwarzanej sieci</para>
     <example><title>Przyk³ad:</title><para>network_footer = ??</para></example>
    </listitem>
    <listitem>
     <para>footer_file</para>
     <para>Pozwala na umieszczenie w pliku wynikowym zawaro¶ci innego pliku jako stopka (domy¶lnie nie ustawione)</para>
     <example><title>Przyk³ad:</title><para>footer_file	= /etc/lms/myservice_footer</para></example>
    </listitem>
    <listitem>
     <para>footer</para>
     <para>Pozwala na umieszczenie w pliku wynikowym zawarto¶ci zmiennej jako stopki (domy¶lnie puste)</para>
     <example><title>Przyk³ad:</title><para>footer = # End.</para></example>
    </listitem>
    <listitem>
     <para>post_exec</para>
     <para>Komenda do wywo³ania po wygenerowaniu pliku konfiguracyjnego</para>
     <example><title>Przyk³ad:</title><para>post_exec = killall -HUP mydaemon</para></example>
    </listitem>
    <listitem>
     <para></para>
     <para></para>
     <example><title>Przyk³ad:</title><para></para></example>
    </listitem>
   </itemizedlist>
  <para>Oprócz tego w czê¶ci opcji konfiguracyjnych mo¿emy u¿ywaæ nastêpuj±cych zmiennych:</para>
   <itemizedlist>
    <listitem>
     <para>%IP - zostanie rozwiniête do adresu IP</para>
    </listitem>
    <listitem>
     <para>%ID</para>
    </listitem>
    <listitem>
     <para>%MAC</para>
    </listitem>
    <listitem>
     <para>%OWNER</para>
    </listitem>
    <listitem>
     <para>%NAME</para>
    </listitem>
    <listitem>
     <para>%name</para>
    </listitem>
    <listitem>
     <para>%UPRATE</para>
    </listitem>
    <listitem>
     <para>%DOWNRATE</para>
    </listitem>
    <listitem>
     <para>%1 %2 %3 %4</para>
    </listitem>
    <listitem>
     <para>%ADDR</para>
    </listitem>
    <listitem>
     <para>%GATE</para>
    </listitem>
    <listitem>
     <para>%DNS</para>
    </listitem>
    <listitem>
     <para>%DOMAIN</para>
    </listitem>
    <listitem>
     <para>%WINS</para>
    </listitem>
    <listitem>
     <para>%DHCPS</para>
    </listitem>
    <listitem>
     <para>%DHCPE</para>
    </listitem>
    <listitem>
     <para>%DNAME</para>
    </listitem>
    <listitem>
     <para>%DADDR</para>
    </listitem>
    <listitem>
     <para>%DATE	- data w formacie YYYYMMDD;</para>
    </listitem>
    <listitem>
     <para>%TIME - czas w formacie HHMM;</para>
    </listitem>
    <listitem>
     <para>%TIMES - czas w formacie HHMMSS;</para>
    </listitem>
    <listitem>
     <para>%UTIME - czas w formacie unix timestamp;</para>
    </listitem>
   </itemizedlist>
  </chapter>
