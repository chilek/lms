{include file="header.html"}
<style>

	.card > .card-block {
		margin: 0.4em;
	}

</style>
<h3><a class="btn btn-secondary mb-2" href="?m=helpdesk">{trans("Back")}</a></h3>
<h5><span class="badge" style="color: white; background-color:{$_RT_STATES[$ticket.state].color};">{$_RT_STATES[$ticket.state].label}</span><strong> {trans($title)}</strong></h5>
{$allow_reopen_tickets_newer_than = intval(ConfigHelper::getConfig('userpanel.allow_reopen_tickets_newer_than'))}
{foreach $ticket.messages as $message}
<div class="card">
	<div class="card-header">
		{trans("Subject:")} <strong>{$message.subject|escape}</strong>
	</div>
	<div class="card-block">
		<div class="card-block">
			<blockquote class="blockquote">
				<p class="mb-0 p-2">{$message.body|escape|replace:"\n":"<br/>"}</p>
			</blockquote>
			<small class="p-2 text-muted">{trans("From")}:
				{if $message.customerid}
					{$message.customername}{elseif $message.userid}{$message.username}
				{elseif $message.mailfrom}
					{$message.mailfrom|escape}
				{else}
					{$ticket.requestor|escape}
					{if $ticket.requestoremail}
						&lt;{$ticket.requestoremail|escape}&gt;
					{/if}
				{/if}, {trans("Time:")} {$message.createtime|date_format:"%Y/%m/%d %H:%M"}
			</small>
				{if $message.attachments}
					<strong>{trans("Attachments:")}</strong>
					<ul class="list-inline">
						{foreach $message.attachments as $attachment}
							{if !$attachment@first}
							{/if}
							<li class="list-inline-item">
								<a class="btn btn-secondary btn-sm" href="?m=helpdesk&f=attachment&msgid={$message.id}&file={$attachment.filename}">{$attachment.filename}</a>
							</li>
						{/foreach}
					</ul>
				{/if}

				{if ($ticket.state != $smarty.const.RT_RESOLVED || ConfigHelper::getConfig('userpanel.allow_message_add_to_closed_tickets'))
					&& (!$allow_reopen_tickets_newer_than || $smarty.now - $allow_reopen_tickets_newer_than <= $ticket.lastmod)}
					<a class="btn btn-success float-right" href="?m=helpdesk&op=message&id={$ticket.id}&msgid={$message.id}">{trans("Reply")}</a>
				{/if}
			</div>
		</div>
	</div>
{/foreach}

{include file="footer.html"}

